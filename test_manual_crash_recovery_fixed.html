<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø´ - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: #0b1a24;
            padding: 15px;
            color: #fff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #16232e;
            border-radius: 24px;
            padding: 20px;
            border: 1px solid #3e5a6a;
        }
        h1 { color: #ffb347; font-size: 1.8rem; margin-bottom: 15px; text-align: center; }
        .card {
            background: #1e2f3a;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 25px;
            border-right: 8px solid #ff8c5a;
        }
        button {
            background: #2c5f7a;
            border: none;
            color: white;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            margin: 8px 0;
            width: 100%;
            border-bottom: 5px solid #1a3a4a;
            cursor: pointer;
            transition: 0.05s;
        }
        button:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .danger { background: #b2452b; border-bottom-color: #6e2a1b; }
        .success { background: #2e7d5e; border-bottom-color: #1d4f3b; }
        pre {
            background: #0f1a20;
            padding: 12px;
            border-radius: 12px;
            color: #c6e9ff;
            direction: ltr;
            text-align: left;
            overflow-x: auto;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .state-box {
            background: #0e1c24;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            border-left: 6px solid #ffaa5e;
        }
        .footer { text-align: center; margin-top: 20px; color: #9bb7c9; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø³ Ø§Ø² Ú©Ø±Ø´ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</h1>
    <p style="background: #2a4a5a; padding: 10px; border-radius: 12px; text-align: center;">ğŸ“± ØªØ³Øª Ø¯Ø³ØªÛŒ - Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Crash Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ State</p>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 1 -->
    <div class="card">
        <h2 style="color: #ffbc7a;">ğŸ“Œ Û±. Ú©Ø±Ø´ Ø¯Ø± ÙˆØ³Ø· ØªÙ…Ø±ÛŒÙ†</h2>
        <div class="state-box" id="sessionDisplay">
            ğŸŸ¡ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: Ø¨Ø¯ÙˆÙ† Ø¯Ø§Ø¯Ù‡
        </div>
        <button id="saveSessionBtn" class="success">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø±ÛŒÙ†</button>
        <button id="crashSimulateBtn" class="danger">ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´ (Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø­Ø§ÙØ¸Ù‡)</button>
        <button id="recoverSessionBtn">ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</button>
    </div>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 2 -->
    <div class="card">
        <h2 style="color: #a5d6a5;">ğŸ—„ï¸ Û². Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² IndexedDB</h2>
        <div class="state-box" id="dbDisplay">
            â³ Ø¯ÛŒØªØ§Ø¨ÛŒØ³: Ø®Ø§Ù„ÛŒ
        </div>
        <button id="saveProgressBtn" class="success">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø± DB</button>
        <button id="simulatePowerOffBtn" class="danger">âš¡ Ù‚Ø·Ø¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ù‚</button>
        <button id="restoreFromDbBtn">ğŸ“€ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø³ Ø§Ø² Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ</button>
    </div>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 3 -->
    <div class="card">
        <h2 style="color: #f9bc9e;">ğŸ“± Û³. Low Memory Kill</h2>
        <div class="state-box" id="memoryDisplay">
            Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡: Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡
        </div>
        <button id="saveLastScreenBtn">ğŸ“± Ø«Ø¨Øª Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡</button>
        <button id="simulateLowMemoryBtn" class="danger">ğŸ§  Ú©Ø´ØªÙ‡ Ø´Ø¯Ù† ØªÙˆØ³Ø· Ø³ÛŒØ³ØªÙ…</button>
        <button id="restoreScreenBtn">â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ù‚Ø¨Ù„</button>
    </div>

    <!-- Ù„Ø§Ú¯ -->
    <div style="background: #0e1c26; border-radius: 16px; padding: 18px; margin-top: 15px;">
        <h3 style="color: #ffcf8a;">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø±Ø®Ø¯Ø§Ø¯Ù‡Ø§</h3>
        <pre id="logPanel" style="height: 150px;">[Ø³ÛŒØ³ØªÙ…] Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ¨Ú©Ø§Ø±</pre>
        <button id="clearLogBtn" style="background: #4f5e66;">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
    </div>
    <div class="footer">âœ… Ù‡Ø± Ø¯Ú©Ù…Ù‡ ÛŒÚ© Ù…Ø±Ø­Ù„Ù‡ Â· ØªØ³Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ø³ØªÛŒ</div>
</div>

<script>
    (function() {
        "use strict";
        
        // --- Ú©Ù„ÛŒØ¯Ù‡Ø§ ---
        const SESSION_KEY = 'farsinglish_crash_session';
        const DB_KEY = 'farsinglish_crash_db';
        const SCREEN_KEY = 'farsinglish_last_screen';

        // --- Ø¹Ù†Ø§ØµØ± DOM ---
        const sessionDisplay = document.getElementById('sessionDisplay');
        const dbDisplay = document.getElementById('dbDisplay');
        const memoryDisplay = document.getElementById('memoryDisplay');
        const logPanel = document.getElementById('logPanel');

        // --- Ù„Ø§Ú¯ ---
        function log(msg) {
            const time = new Date().toLocaleTimeString('fa-IR');
            logPanel.innerHTML += `\n[${time}] ${msg}`;
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        // --- Ø³Ù†Ø§Ø±ÛŒÙˆ Û±: Session Storage ---
        function saveSession() {
            const mockSession = {
                lessonId: 7,
                title: 'Ø­Ø±ÙˆÙ Ø§Ø¶Ø§ÙÙ‡ - Ø³Ø·Ø­ Û±',
                progress: 'Û¸ Ø§Ø² Û±Û²',
                time: 'Û´:Û²Û²',
                timestamp: Date.now()
            };
            sessionStorage.setItem(SESSION_KEY, JSON.stringify(mockSession));
            sessionDisplay.innerHTML = `âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯: Ø¯Ø±Ø³ ${mockSession.title} | ${mockSession.progress} | Ø²Ù…Ø§Ù† ${mockSession.time}`;
            log('ğŸ’¾ session Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø¯Ø±Ø³ Û·)');
        }

        function simulateCrash() {
            sessionStorage.removeItem(SESSION_KEY);
            sessionDisplay.innerHTML = 'ğŸŸ¡ ÙˆØ¶Ø¹ÛŒØª: Ú©Ø±Ø´ Ø´Ø¯! (Ø­Ø§ÙØ¸Ù‡ Ù¾Ø§Ú© Ø´Ø¯)';
            log('ğŸ’¥ Ú©Ø±Ø´ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯ - session Ù¾Ø§Ú© Ø´Ø¯');
        }

        function recoverSession() {
            const data = sessionStorage.getItem(SESSION_KEY);
            if (data) {
                try {
                    const p = JSON.parse(data);
                    sessionDisplay.innerHTML = `ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚: ${p.title} | ${p.progress} | Ø§Ø¯Ø§Ù…Ù‡ ØªÙ…Ø±ÛŒÙ†`;
                    log('âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ session Ø§Ø² Ú©Ø±Ø´');
                } catch(e) {
                    sessionDisplay.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ';
                }
            } else {
                sessionDisplay.innerHTML = 'âš ï¸ Ø¯Ø§Ø¯Ù‡ session ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§Ø¨ØªØ¯Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.';
                log('âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ: Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª');
            }
        }

        // --- Ø³Ù†Ø§Ø±ÛŒÙˆ Û²: IndexedDB Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (LocalStorage) ---
        function saveProgress() {
            const progress = {
                lesson: 'Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡',
                level: 2,
                score: 85,
                nextReview: 'Û³ Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±',
                date: new Date().toISOString()
            };
            localStorage.setItem(DB_KEY, JSON.stringify(progress));
            dbDisplay.innerHTML = `ğŸ“€ Ø°Ø®ÛŒØ±Ù‡: ${progress.lesson} | Ø³Ø·Ø­ ${progress.level} | Ø§Ù…ØªÛŒØ§Ø² ${progress.score}%`;
            log('ğŸ—„ï¸ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø± IndexedDB Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        function simulatePowerOff() {
            localStorage.removeItem(DB_KEY);
            dbDisplay.innerHTML = 'âš¡ Ù‚Ø·Ø¹ Ø¨Ø±Ù‚ - Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª Ù¾Ø§Ú© Ø´Ø¯';
            log('âš¡ Ù‚Ø·Ø¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ù‚ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯');
        }

        function restoreFromDb() {
            const data = localStorage.getItem(DB_KEY);
            if (data) {
                const p = JSON.parse(data);
                dbDisplay.innerHTML = `â™»ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ: ${p.lesson} | Ø§Ù…ØªÛŒØ§Ø² ${p.score}% | Ù…Ø±ÙˆØ± ${p.nextReview}`;
                log('ğŸ“€ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚ Ø§Ø² IndexedDB');
            } else {
                dbDisplay.innerHTML = 'â›” Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø°Ø®ÛŒØ±Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡.';
                log('â›” Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ - Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ù„ÛŒ');
            }
        }

        // --- Ø³Ù†Ø§Ø±ÛŒÙˆ Û³: Low Memory / Last Screen ---
        function saveLastScreen() {
            const screen = 'ØµÙØ­Ù‡ ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª - Ú©Ø§Ø±Øª Û±Û´ Ø§Ø² Û²Û°';
            localStorage.setItem(SCREEN_KEY, screen);
            memoryDisplay.innerHTML = `ğŸ“± Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡ Ø«Ø¨Øª Ø´Ø¯: ${screen}`;
            log('ğŸ“± Ø«Ø¨Øª Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡: ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª');
        }

        function simulateLowMemory() {
            memoryDisplay.innerHTML = 'ğŸ§  Ø­Ø§ÙØ¸Ù‡ Ú©Ù… - Ø§Ù¾ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯';
            log('ğŸ§  Low memory kill Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯');
        }

        function restoreScreen() {
            const screen = localStorage.getItem(SCREEN_KEY);
            if (screen) {
                memoryDisplay.innerHTML = `â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡: ${screen} (Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ)`;
                log('â†©ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ØµÙØ­Ù‡ Ù¾Ø³ Ø§Ø² Ú©Ø±Ø´');
            } else {
                memoryDisplay.innerHTML = `ğŸ  ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶)`;
                log('ğŸ  ØµÙØ­Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯');
            }
        }

        // --- Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯ ---
        function clearLog() {
            logPanel.innerHTML = '[Ø³ÛŒØ³ØªÙ…] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯';
            log('ğŸ§¹ Ù„Ø§Ú¯ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯');
        }

        // --- Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ---
        function init() {
            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û±
            document.getElementById('saveSessionBtn').addEventListener('click', saveSession);
            document.getElementById('crashSimulateBtn').addEventListener('click', simulateCrash);
            document.getElementById('recoverSessionBtn').addEventListener('click', recoverSession);
            
            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û²
            document.getElementById('saveProgressBtn').addEventListener('click', saveProgress);
            document.getElementById('simulatePowerOffBtn').addEventListener('click', simulatePowerOff);
            document.getElementById('restoreFromDbBtn').addEventListener('click', restoreFromDb);
            
            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û³
            document.getElementById('saveLastScreenBtn').addEventListener('click', saveLastScreen);
            document.getElementById('simulateLowMemoryBtn').addEventListener('click', simulateLowMemory);
            document.getElementById('restoreScreenBtn').addEventListener('click', restoreScreen);
            
            // Ù„Ø§Ú¯
            document.getElementById('clearLogBtn').addEventListener('click', clearLog);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯
            if (localStorage.getItem(DB_KEY)) restoreFromDb();
            if (sessionStorage.getItem(SESSION_KEY)) recoverSession();
            
            log('ğŸš€ ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø´ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
        }

        window.onload = init;
    })();
</script>
</body>
</html>
