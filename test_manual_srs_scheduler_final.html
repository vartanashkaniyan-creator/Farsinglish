<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ SRS (Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ) - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .warning-banner {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.9; } 100% { opacity: 1; } }
        .scenario-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .formula-box {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            direction: ltr;
            text-align: center;
            font-family: monospace;
            font-size: 18px;
        }
        .btn-verify { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); width: 100%; padding: 15px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  Farsinglish - SRS Ù†Ù‡Ø§ÛŒÛŒ</h1>
        <div class="warning-banner">
            âš ï¸ ÙØ±Ù…ÙˆÙ„ SM-2 Ø¯Ù‚ÛŒÙ‚ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯ - Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯ ØªØ³Øª Ú©Ù†ÛŒØ¯
        </div>

        <div class="formula-box">
            <div style="font-size: 14px; margin-bottom: 10px;">ğŸ“ ÙØ±Ù…ÙˆÙ„ Ø¯Ù‚ÛŒÙ‚ SM-2:</div>
            <div style="font-size: 16px;">EF' = EF + (0.1 - (5 - q) * (0.08 + (5 - q) * 0.02))</div>
            <div style="font-size: 14px; margin-top: 10px; color: #f1c40f;">Iâ‚™ = Iâ‚™â‚‹â‚ Ã— EF  |  Iâ‚ = 1  |  Iâ‚‚ = 6</div>
        </div>
        
        <div id="scenarios-container"></div>
        <div style="display: flex; gap: 15px; margin: 25px 0;">
            <button onclick="resetAllScenarios()" class="btn-reset" style="flex: 1;">ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡</button>
            <button onclick="exportLog()" style="flex: 1; background: #27ae60;">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯</button>
        </div>
        <div class="summary-box" id="summary"></div>
        <div class="log-panel" id="log-panel"></div>
    </div>

    <script>
        class SRSScheduler {
            constructor() {
                this.defaultEaseFactor = 2.5;
                this.minEaseFactor = 1.3;
                this.maxEaseFactor = 3.0;
            }

            calculateNextReview(quality, repetitions, easeFactor, interval = 0) {
                if (quality < 0 || quality > 5) throw new Error('Ú©ÛŒÙÛŒØª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û° ØªØ§ Ûµ Ø¨Ø§Ø´Ø¯');
                
                // Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª < 3)
                if (quality < 3) {
                    return {
                        interval: 1,
                        repetitions: 0,
                        easeFactor: Math.max(this.minEaseFactor, parseFloat((easeFactor - 0.2).toFixed(2)))
                    };
                }

                // Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª >= 3)
                let newInterval;
                if (repetitions === 0) {
                    newInterval = 1;
                } else if (repetitions === 1) {
                    newInterval = 6;
                } else {
                    newInterval = Math.round(interval * easeFactor);
                }

                // ÙØ±Ù…ÙˆÙ„ Ø¯Ù‚ÛŒÙ‚ SM-2
                let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                newEaseFactor = Math.max(this.minEaseFactor, Math.min(this.maxEaseFactor, newEaseFactor));
                newEaseFactor = Math.round(newEaseFactor * 100) / 100;

                return {
                    interval: newInterval,
                    repetitions: repetitions + 1,
                    easeFactor: newEaseFactor
                };
            }
        }

        // Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ SM-2 Ø¯Ù‚ÛŒÙ‚
        const scenarios = [
            { id: 1, title: 'ğŸŒŸ Ø§ÙˆÙ„ÛŒÙ† Ù…ÙˆØ§Ø¬Ù‡Ù‡ - Ú©ÛŒÙÛŒØª Ûµ', params: { quality: 5, repetitions: 0, easeFactor: 2.5, interval: 0 }, expected: { interval: 1, repetitions: 1, easeFactor: 2.60 } },
            { id: 2, title: 'ğŸ“š Ù…Ø±ÙˆØ± Ø§ÙˆÙ„ - Ú©ÛŒÙÛŒØª Û´', params: { quality: 4, repetitions: 1, easeFactor: 2.5, interval: 1 }, expected: { interval: 6, repetitions: 2, easeFactor: 2.50 } },
            { id: 3, title: 'ğŸ”„ Ù…Ø±ÙˆØ± Ø¯ÙˆÙ… - Ú©ÛŒÙÛŒØª Ûµ', params: { quality: 5, repetitions: 2, easeFactor: 2.5, interval: 6 }, expected: { interval: 15, repetitions: 3, easeFactor: 2.60 } },
            { id: 4, title: 'âŒ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª - Ú©ÛŒÙÛŒØª Û±', params: { quality: 1, repetitions: 3, easeFactor: 2.6, interval: 15 }, expected: { interval: 1, repetitions: 0, easeFactor: 2.40 } },
            { id: 5, title: 'ğŸ”„ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø¬Ø¯Ø¯ - Ú©ÛŒÙÛŒØª Û³', params: { quality: 3, repetitions: 0, easeFactor: 2.4, interval: 0 }, expected: { interval: 1, repetitions: 1, easeFactor: 2.40 } },
            { id: 6, title: 'âš¡ Ù…Ø±ÙˆØ± Ø·ÙˆÙ„Ø§Ù†ÛŒ - Ú©ÛŒÙÛŒØª Ûµ', params: { quality: 5, repetitions: 10, easeFactor: 2.8, interval: 120 }, expected: { interval: 336, repetitions: 11, easeFactor: 2.90 } },
            { id: 7, title: 'ğŸ“‰ Ø§ÙØª Ú©ÛŒÙÛŒØª - Ú©ÛŒÙÛŒØª Û²', params: { quality: 2, repetitions: 5, easeFactor: 2.7, interval: 30 }, expected: { interval: 1, repetitions: 0, easeFactor: 2.50 } },
            { id: 8, title: 'ğŸ¯ Ù…Ø±ÙˆØ± Ù…Ø±Ø²ÛŒ - Ú©ÛŒÙÛŒØª Û³', params: { quality: 3, repetitions: 4, easeFactor: 2.5, interval: 20 }, expected: { interval: 50, repetitions: 5, easeFactor: 2.50 } }
        ];

        const scheduler = new SRSScheduler();
        let logEntries = [];

        function renderScenarios() {
            let html = '';
            scenarios.forEach(s => {
                html += `<div class="scenario-card" id="scenario-${s.id}">
                    <div class="scenario-header">
                        <span class="scenario-title">ğŸ§ª Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${s.id}: ${s.title}</span>
                        <span class="status ${getScenarioStatus(s.id) === 'pass' ? 'status-pass' : 'status-pending'}" id="status-${s.id}">
                            ${getScenarioStatus(s.id) === 'pass' ? 'âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±'}
                        </span>
                    </div>
                    <div style="background: #f0f2f5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ğŸ“Š ÙˆØ±ÙˆØ¯ÛŒ: Q=${s.params.quality}, Rep=${s.params.repetitions}, EF=${s.params.easeFactor}, I=${s.params.interval}</span>
                            <span class="quality-badge quality-${s.params.quality}">Ú©ÛŒÙÛŒØª ${s.params.quality}</span>
                        </div>
                        <div style="background: #3498db; color: white; padding: 10px; border-radius: 8px;">
                            ğŸ¯ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±: ÙØ§ØµÙ„Ù‡=${s.expected.interval}, ØªÚ©Ø±Ø§Ø±=${s.expected.repetitions}, EF=${s.expected.easeFactor}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="runScenario(${s.id})" style="flex: 1;">âš¡ Ø§Ø¬Ø±Ø§</button>
                        <button onclick="verifyScenario(${s.id})" class="btn-verify" style="flex: 1;">âœ“ ØªØ£ÛŒÛŒØ¯</button>
                        <button onclick="resetScenario(${s.id})" style="flex: 0.3; background: #95a5a6;">ğŸ”„</button>
                    </div>
                    <div id="result-${s.id}" class="result-box" style="display: none;"></div>
                </div>`;
            });
            document.getElementById('scenarios-container').innerHTML = html;
            updateSummary();
        }

        window.runScenario = function(id) {
            const s = scenarios.find(x => x.id === id);
            const result = scheduler.calculateNextReview(s.params.quality, s.params.repetitions, s.params.easeFactor, s.params.interval);
            const div = document.getElementById(`result-${id}`);
            div.style.display = 'block';
            div.innerHTML = `
                <div style="color: #2ecc71; font-size: 18px; margin-bottom: 10px;">ğŸ“Œ Ù†ØªÛŒØ¬Ù‡:</div>
                <div style="display: grid; grid-template-columns: repeat(3,1fr); gap: 10px;">
                    <div style="background: #34495e; padding: 10px; border-radius: 8px;">
                        <div style="font-size: 12px;">ÙØ§ØµÙ„Ù‡</div>
                        <div style="font-size: 28px; font-weight: bold;">${result.interval}</div>
                    </div>
                    <div style="background: #34495e; padding: 10px; border-radius: 8px;">
                        <div style="font-size: 12px;">ØªÚ©Ø±Ø§Ø±</div>
                        <div style="font-size: 28px; font-weight: bold;">${result.repetitions}</div>
                    </div>
                    <div style="background: #34495e; padding: 10px; border-radius: 8px;">
                        <div style="font-size: 12px;">EF</div>
                        <div style="font-size: 28px; font-weight: bold;">${result.easeFactor}</div>
                    </div>
                </div>
                <div style="margin-top: 15px; background: #2c3e50; padding: 10px; border-radius: 8px;">
                    <span style="color: ${result.interval === s.expected.interval ? '#2ecc71' : '#e74c3c'}">
                        ${result.interval === s.expected.interval ? 'âœ“' : 'âœ—'} ÙØ§ØµÙ„Ù‡: ${result.interval} (${s.expected.interval})
                    </span><br>
                    <span style="color: ${result.easeFactor === s.expected.easeFactor ? '#2ecc71' : '#e74c3c'}">
                        ${result.easeFactor === s.expected.easeFactor ? 'âœ“' : 'âœ—'} EF: ${result.easeFactor} (${s.expected.easeFactor})
                    </span>
                </div>
            `;
            addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: ÙØ§ØµÙ„Ù‡=${result.interval}, EF=${result.easeFactor}`);
        };

        window.verifyScenario = function(id) {
            const s = scenarios.find(x => x.id === id);
            const result = scheduler.calculateNextReview(s.params.quality, s.params.repetitions, s.params.easeFactor, s.params.interval);
            const passed = result.interval === s.expected.interval && 
                          result.repetitions === s.expected.repetitions && 
                          result.easeFactor === s.expected.easeFactor;
            
            const statusEl = document.getElementById(`status-${id}`);
            statusEl.className = `status ${passed ? 'status-pass' : 'status-fail'}`;
            statusEl.textContent = passed ? 'âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚';
            
            saveScenarioStatus(id, passed);
            if (passed) addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯`, 'success');
            else addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: âŒ Ù†Ø§Ù…ÙˆÙÙ‚ (EF: ${result.easeFactor} â‰  ${s.expected.easeFactor})`, 'error');
            
            updateSummary();
        };

        function saveScenarioStatus(id, passed) {
            const statuses = JSON.parse(localStorage.getItem('srs_final') || '{}');
            statuses[id] = passed ? 'pass' : 'fail';
            localStorage.setItem('srs_final', JSON.stringify(statuses));
        }

        function getScenarioStatus(id) {
            const statuses = JSON.parse(localStorage.getItem('srs_final') || '{}');
            return statuses[id] || 'pending';
        }

        window.resetAllScenarios = function() {
            localStorage.removeItem('srs_final');
            renderScenarios();
            addLog('ğŸ”„ Ù‡Ù…Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯');
        };

        function updateSummary() {
            let passed = 0;
            scenarios.forEach(s => { if (getScenarioStatus(s.id) === 'pass') passed++; });
            document.getElementById('summary').innerHTML = `
                <h3>ğŸ“Š Ù¾ÛŒØ´Ø±ÙØª: ${passed}/${scenarios.length}</h3>
                <div style="background: #2c3e50; height: 20px; border-radius: 10px; margin-top: 10px;">
                    <div style="background: #27ae60; width: ${(passed/scenarios.length)*100}%; height: 20px; border-radius: 10px;"></div>
                </div>
            `;
        }

        function addLog(msg, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR');
            logEntries.push({ time, msg, type });
            document.getElementById('log-panel').innerHTML = logEntries.slice(-8).map(e => 
                `<div style="color: ${e.type === 'success' ? '#0f0' : e.type === 'error' ? '#f00' : '#ff0'}">[${e.time}] ${e.msg}</div>`
            ).join('');
        }

        window.exportLog = function() {
            const text = logEntries.map(e => `[${e.time}] ${e.msg}`).join('\n');
            const blob = new Blob([text], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `srs-final-${Date.now()}.txt`;
            a.click();
        };

        window.onload = renderScenarios;
    </script>
</body>
</html>
