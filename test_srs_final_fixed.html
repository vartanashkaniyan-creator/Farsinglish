<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SRS نهایی - رفع EF</title>
    <style>body { font-family: Tahoma; padding: 20px; background: #1e3c72; color: white; }</style>
</head>
<body>
    <div style="max-width: 800px; margin: 0 auto;">
        <h1>✅ SRS SM-2 - نسخه نهایی</h1>
        
        <div id="results"></div>

        <script>
            class SRSScheduler {
                calculateNextReview(quality, repetitions, easeFactor, interval) {
                    if (quality < 3) {
                        return {
                            interval: 1,
                            repetitions: 0,
                            easeFactor: Math.max(1.3, easeFactor - 0.2)
                        };
                    }

                    let newInterval;
                    if (repetitions === 0) newInterval = 1;
                    else if (repetitions === 1) newInterval = 6;
                    else newInterval = Math.round(interval * easeFactor);

                    // فرمول SM-2 دقیق (بر اساس Anki)
                    let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    newEaseFactor = Math.max(1.3, Math.min(3.0, newEaseFactor));
                    newEaseFactor = Math.round(newEaseFactor * 100) / 100;

                    return {
                        interval: newInterval,
                        repetitions: repetitions + 1,
                        easeFactor: newEaseFactor
                    };
                }
            }

            const scheduler = new SRSScheduler();
            let output = '';

            // سناریو 5: کیفیت 3, تکرار 0, EF 2.5 (نه 2.4)
            const s5 = scheduler.calculateNextReview(3, 0, 2.5, 0);
            output += `<div style="background: #2c3e50; padding: 15px; margin: 10px 0; border-radius: 10px;">`;
            output += `<h3>✅ سناریو 5: کیفیت 3 (اولین مواجهه)</h3>`;
            output += `<p>EF مورد انتظار: 2.36 | EF محاسبه شده: ${s5.easeFactor}</p>`;
            output += `<p style="color: ${s5.easeFactor === 2.36 ? '#2ecc71' : '#e74c3c'}">`;
            output += s5.easeFactor === 2.36 ? '✓ صحیح' : '✗ خطا';
            output += `</p></div>`;

            // سناریو 8: کیفیت 3, تکرار 4, EF 2.5, فاصله 20
            const s8 = scheduler.calculateNextReview(3, 4, 2.5, 20);
            output += `<div style="background: #2c3e50; padding: 15px; margin: 10px 0; border-radius: 10px;">`;
            output += `<h3>✅ سناریو 8: کیفیت 3 (مرور مرزی)</h3>`;
            output += `<p>EF مورد انتظار: 2.36 | EF محاسبه شده: ${s8.easeFactor}</p>`;
            output += `<p>فاصله مورد انتظار: 50 | فاصله محاسبه شده: ${s8.interval}</p>`;
            output += `<p style="color: ${s8.easeFactor === 2.36 && s8.interval === 50 ? '#2ecc71' : '#e74c3c'}">`;
            output += (s8.easeFactor === 2.36 && s8.interval === 50) ? '✓ صحیح' : '✗ خطا';
            output += `</p></div>`;

            document.getElementById('results').innerHTML = output;
        </script>
    </div>
</body>
</html>
