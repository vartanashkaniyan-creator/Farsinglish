<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Exercise Validator - Ù…Ù†Ø·Ù‚ Ù…Ø­Ø¶</title>
    <style>
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            direction: ltr;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        .summary {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .summary-pass { color: #27ae60; font-weight: bold; }
        .summary-fail { color: #e74c3c; font-weight: bold; }
        .test-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .test-item:last-child { border-bottom: none; }
        .test-status {
            width: 80px;
            text-align: center;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .status-pass {
            background: #e8f8f0;
            color: #27ae60;
        }
        .status-fail {
            background: #fdedec;
            color: #e74c3c;
        }
        .test-name {
            flex: 1;
            font-weight: 500;
            color: #34495e;
        }
        .test-message {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 4px;
        }
        .re-run {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 20px 0;
            font-weight: 500;
        }
        .re-run:hover { background: #2980b9; }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 0.9rem;
            color: #856404;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Exercise Validator (Ù…Ù†Ø·Ù‚ Ù…Ø­Ø¶)</h1>
    <p style="color: #555; margin-bottom: 20px;">Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø® ØªÙ…Ø±ÛŒÙ† Â· ØªØ·Ø§Ø¨Ù‚ Ù…ØªÙ† Â· ØªØ´Ø®ÛŒØµ ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ</p>

    <div class="summary">
        <span>ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§: <span id="total">0</span></span>
        <span>âœ… Ù…ÙˆÙÙ‚: <span id="passed" class="summary-pass">0</span></span>
        <span>âŒ Ù†Ø§Ù…ÙˆÙÙ‚: <span id="failed" class="summary-fail">0</span></span>
    </div>

    <div class="test-list" id="test-list"></div>

    <button class="re-run" onclick="runAllTests()">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</button>

    <div class="note">
        <strong>ğŸ” Ø§ØµÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ:</strong> ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø·Ù‚ Ù…Ø­Ø¶ - Pure Function â†’ ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø´Ø®ØµØŒ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø´Ø®Øµ. Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ IndexedDBØŒ Ù…Ø³ØªÙ‚Ù„ Ø§Ø² Ø§Ø¨Ø²Ø§Ø±ØŒ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¬Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„.
    </div>

    <script>
        (function() {
            // --- Ù…Ø§Ú˜ÙˆÙ„ Exercise Validator (Ù…Ù†Ø·Ù‚ Ø®Ø§Ù„Øµ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ) ---
            const Validator = {
                // Ø«Ø§Ø¨Øªâ€ŒÙ‡Ø§
                SIMILARITY_THRESHOLD: 0.8, // Ø¢Ø³ØªØ§Ù†Ù‡ Ø´Ø¨Ø§Ù‡Øª Ø¨Ø±Ø§ÛŒ ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ (80%)
                
                /**
                 * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø® Ú†Ù†Ø¯Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ
                 * @param {number|string} selectedIndex - Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                 * @param {number} correctIndex - Ø§ÛŒÙ†Ø¯Ú©Ø³ ØµØ­ÛŒØ­
                 * @returns {boolean}
                 */
                validateMultipleChoice(selectedIndex, correctIndex) {
                    if (selectedIndex === undefined || selectedIndex === null) return false;
                    if (correctIndex === undefined || correctIndex === null) return false;
                    return Number(selectedIndex) === Number(correctIndex);
                },

                /**
                 * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø® Ø¬Ø§ÛŒâ€ŒØ®Ø§Ù„ÛŒ (ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÛŒÙ‚)
                 * @param {string} userAnswer - Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø±
                 * @param {string} correctAnswer - Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                 * @param {boolean} caseSensitive - Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ø­Ø±ÙˆÙ Ø¨Ø²Ø±Ú¯/Ú©ÙˆÚ†Ú©
                 * @returns {boolean}
                 */
                validateFillBlank(userAnswer, correctAnswer, caseSensitive = false) {
                    if (typeof userAnswer !== 'string' || typeof correctAnswer !== 'string') {
                        return false;
                    }
                    
                    let ua = userAnswer.trim();
                    let ca = correctAnswer.trim();
                    
                    if (!caseSensitive) {
                        ua = ua.toLowerCase();
                        ca = ca.toLowerCase();
                    }
                    
                    return ua === ca;
                },

                /**
                 * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø® ØªØ±Ø¬Ù…Ù‡ (Ø¨Ø§ ØªØ´Ø®ÛŒØµ ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ)
                 * @param {string} userAnswer - Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø±
                 * @param {string} correctAnswer - Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                 * @param {Object} options - Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                 * @returns {Object} Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª
                 */
                validateTranslation(userAnswer, correctAnswer, options = {}) {
                    const { 
                        caseSensitive = false,
                        ignoreSpaces = true,
                        allowTypo = true,
                        threshold = this.SIMILARITY_THRESHOLD
                    } = options;

                    if (typeof userAnswer !== 'string' || typeof correctAnswer !== 'string') {
                        return { isValid: false, reason: 'invalid_input', similarity: 0 };
                    }

                    let ua = userAnswer;
                    let ca = correctAnswer;

                    // Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
                    if (ignoreSpaces) {
                        ua = ua.replace(/\s+/g, ' ').trim();
                        ca = ca.replace(/\s+/g, ' ').trim();
                    }
                    
                    if (!caseSensitive) {
                        ua = ua.toLowerCase();
                        ca = ca.toLowerCase();
                    }

                    // ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÛŒÙ‚
                    if (ua === ca) {
                        return { isValid: true, reason: 'exact_match', similarity: 1 };
                    }

                    // ØªØ´Ø®ÛŒØµ ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ (Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
                    if (allowTypo) {
                        const similarity = this._calculateSimilarity(ua, ca);
                        if (similarity >= threshold) {
                            return { 
                                isValid: true, 
                                reason: 'typo_tolerated', 
                                similarity: Number(similarity.toFixed(2)) 
                            };
                        }
                        return { 
                            isValid: false, 
                            reason: 'similarity_below_threshold', 
                            similarity: Number(similarity.toFixed(2)) 
                        };
                    }

                    return { isValid: false, reason: 'no_match', similarity: 0 };
                },

                /**
                 * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø® ØªÙ„ÙØ¸ (ØªØ´Ø®ÛŒØµ ØªÙ‚Ø±ÛŒØ¨ÛŒ)
                 * @param {string} userAnswer - Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø±
                 * @param {string} correctAnswer - Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                 * @returns {Object}
                 */
                validatePronunciation(userAnswer, correctAnswer) {
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ´Ø®ÛŒØµ ØªÙ„ÙØ¸ (Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§Ø² API ØµÙˆØªÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                    const similarity = this._calculateSimilarity(userAnswer, correctAnswer);
                    return {
                        isValid: similarity >= 0.7,
                        confidence: Number(similarity.toFixed(2)),
                        recognized: userAnswer
                    };
                },

                /**
                 * Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¨Ø§Ù‡Øª Ø¯Ùˆ Ø±Ø´ØªÙ‡ (Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
                 * @private
                 */
                _calculateSimilarity(str1, str2) {
                    if (str1 === str2) return 1;
                    if (!str1 || !str2) return 0;
                    
                    // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… ÙØ§ØµÙ„Ù‡ Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† Ø³Ø§Ø¯Ù‡
                    const len1 = str1.length;
                    const len2 = str2.length;
                    const maxLen = Math.max(len1, len2);
                    
                    if (maxLen === 0) return 1;
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ù…Ø´ØªØ±Ú©
                    let matches = 0;
                    for (let i = 0; i < Math.min(len1, len2); i++) {
                        if (str1[i] === str2[i]) matches++;
                    }
                    
                    return matches / maxLen;
                },

                /**
                 * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ†
                 * @param {string} type - Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ†
                 * @param {any} userAnswer - Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø±
                 * @param {any} correctAnswer - Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                 * @param {Object} options - Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                 * @returns {Object}
                 */
                validate(type, userAnswer, correctAnswer, options = {}) {
                    switch (type) {
                        case 'multiple-choice':
                            return {
                                isValid: this.validateMultipleChoice(userAnswer, correctAnswer),
                                type: 'multiple-choice',
                                details: { selected: userAnswer, correct: correctAnswer }
                            };
                        case 'fill-blank':
                            return {
                                isValid: this.validateFillBlank(userAnswer, correctAnswer, options.caseSensitive),
                                type: 'fill-blank',
                                details: { user: userAnswer, correct: correctAnswer }
                            };
                        case 'translation':
                            return this.validateTranslation(userAnswer, correctAnswer, options);
                        case 'pronunciation':
                            return this.validatePronunciation(userAnswer, correctAnswer);
                        default:
                            return { isValid: false, error: 'unknown_type' };
                    }
                }
            };

            // --- ØªØ³Øªâ€ŒÙ‡Ø§ ---
            const tests = [
                {
                    name: 'âœ… ØªØ³Øª Multiple Choice - ØµØ­ÛŒØ­',
                    fn: () => {
                        return Validator.validateMultipleChoice(2, 2) === true;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Multiple Choice - ØºÙ„Ø·',
                    fn: () => {
                        return Validator.validateMultipleChoice(1, 2) === false;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Multiple Choice - ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±',
                    fn: () => {
                        return Validator.validateMultipleChoice(null, 2) === false;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Fill Blank - ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÛŒÙ‚',
                    fn: () => {
                        return Validator.validateFillBlank('hello', 'hello') === true;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Fill Blank - Ø­Ø³Ø§Ø³ Ø¨Ù‡ ÙØ§ØµÙ„Ù‡',
                    fn: () => {
                        return Validator.validateFillBlank('hello ', 'hello') === true;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Fill Blank - case insensitive',
                    fn: () => {
                        return Validator.validateFillBlank('HELLO', 'hello') === true;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Fill Blank - case sensitive',
                    fn: () => {
                        return Validator.validateFillBlank('HELLO', 'hello', true) === false;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Translation - ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÛŒÙ‚',
                    fn: () => {
                        const result = Validator.validateTranslation('hello', 'hello');
                        return result.isValid === true && result.reason === 'exact_match';
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Translation - ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ Ù…Ø¬Ø§Ø²',
                    fn: () => {
                        const result = Validator.validateTranslation('helo', 'hello');
                        return result.isValid === true && result.reason === 'typo_tolerated';
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Translation - ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²',
                    fn: () => {
                        const result = Validator.validateTranslation('xyz', 'hello');
                        return result.isValid === false;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª Pronunciation - ØªØ´Ø®ÛŒØµ ØªÙ„ÙØ¸',
                    fn: () => {
                        const result = Validator.validatePronunciation('hello', 'hello');
                        return result.isValid === true && result.confidence >= 0.7;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª validate Ø¹Ù…ÙˆÙ…ÛŒ - multiple choice',
                    fn: () => {
                        const result = Validator.validate('multiple-choice', 2, 2);
                        return result.isValid === true && result.type === 'multiple-choice';
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª validate Ø¹Ù…ÙˆÙ…ÛŒ - translation Ø¨Ø§ typo',
                    fn: () => {
                        const result = Validator.validate('translation', 'helo', 'hello', { allowTypo: true });
                        return result.isValid === true;
                    }
                },
                {
                    name: 'âœ… ØªØ³Øª validate Ø¹Ù…ÙˆÙ…ÛŒ - Ù†ÙˆØ¹ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡',
                    fn: () => {
                        const result = Validator.validate('unknown', 'a', 'b');
                        return result.error === 'unknown_type';
                    }
                }
            ];

            // --- ØªØ§Ø¨Ø¹ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ ---
            window.runAllTests = function() {
                const testList = document.getElementById('test-list');
                const totalSpan = document.getElementById('total');
                const passedSpan = document.getElementById('passed');
                const failedSpan = document.getElementById('failed');

                let passed = 0;
                let failed = 0;

                testList.innerHTML = '';

                tests.forEach((test, index) => {
                    try {
                        const result = test.fn();
                        const status = result ? 'pass' : 'fail';
                        const statusText = result ? 'âœ… PASS' : 'âŒ FAIL';
                        const message = result ? 'Ø´Ø±Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ø§Ø³Øª' : 'Ù†ØªÛŒØ¬Ù‡ Ø®Ù„Ø§Ù Ø§Ù†ØªØ¸Ø§Ø±';

                        if (result) passed++; else failed++;

                        const item = document.createElement('div');
                        item.className = 'test-item';
                        item.innerHTML = `
                            <div class="test-status ${status === 'pass' ? 'status-pass' : 'status-fail'}">${statusText}</div>
                            <div class="test-name">
                                ${test.name}
                                <div class="test-message">${message}</div>
                            </div>
                        `;
                        testList.appendChild(item);
                    } catch (error) {
                        failed++;
                        const item = document.createElement('div');
                        item.className = 'test-item';
                        item.innerHTML = `
                            <div class="test-status status-fail">âš ï¸ ERROR</div>
                            <div class="test-name">
                                ${test.name}
                                <div class="test-message">Ø®Ø·Ø§: ${error.message}</div>
                            </div>
                        `;
                        testList.appendChild(item);
                    }
                });

                totalSpan.innerText = tests.length;
                passedSpan.innerText = passed;
                failedSpan.innerText = failed;
            };

            // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
            window.onload = runAllTests;
        })();
    </script>
</body>
</html>
