<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ: Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Fake DB (Farsinglish)</title>
    <style>
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #1e293b;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 25px;
        }
        h1 {
            font-size: 1.8rem;
            margin-top: 0;
            margin-bottom: 8px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .subtitle {
            color: #475569;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 1rem;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .test-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 16px;
            transition: 0.2s;
        }
        .test-card:hover {
            border-color: #94a3b8;
            background: #f1f5f9;
        }
        .test-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .test-title span {
            background: #334155;
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 30px;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0 10px;
        }
        button {
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 40px;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.15s;
            color: #1e293b;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.02);
        }
        button.primary {
            background: #2563eb;
            border-color: #2563eb;
            color: white;
        }
        button.success {
            background: #16a34a;
            border-color: #16a34a;
            color: white;
        }
        button.warning {
            background: #ca8a04;
            border-color: #ca8a04;
            color: white;
        }
        button.small {
            padding: 4px 12px;
            font-size: 0.75rem;
        }
        .log-area {
            background: #0f172a;
            color: #cbd5e1;
            border-radius: 16px;
            padding: 18px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            direction: ltr;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 25px;
            border: 1px solid #334155;
        }
        .badge {
            background: #e2e8f0;
            color: #334155;
            padding: 2px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
        }
        .summary {
            background: #e6f7e6;
            border-right: 6px solid #2e7d32;
            padding: 12px 20px;
            border-radius: 14px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ Â· Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Fake DB</h1>
    <div class="subtitle">
        <span class="badge">ğŸ”· core/storage/fake-db.js</span>
        <span class="badge">ğŸ“Œ Ù…ØªØ¯Ù‡Ø§ÛŒ get / save / delete / clear</span>
        <span class="badge">ğŸ­ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙØªØ§Ø± Ø§ÛŒØ²ÙˆÙ„Ù‡ (Ø¨Ø¯ÙˆÙ† IndexedDB ÙˆØ§Ù‚Ø¹ÛŒ)</span>
    </div>

    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª (Û¹ ØªØ³Øª + Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ) -->
    <div class="test-grid" id="testGrid"></div>

    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ Ú©Ù„ÛŒ -->
    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 25px;">
        <button class="primary" id="runAllContractTestsBtn">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Û¹ Ù…ÙˆØ±Ø¯)</button>
        <button class="warning" id="resetFakeDbBtn">ğŸ”„ Ø±ÛŒØ³Øª Fake DB (Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„)</button>
        <button id="clearLogBtn">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
    </div>

    <!-- Ù„Ø§Ú¯ Ø®Ø±ÙˆØ¬ÛŒ -->
    <div class="log-area" id="logContainer">
        [Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ] Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.
    </div>

    <!-- Ø®Ù„Ø§ØµÙ‡ ÙˆØ¶Ø¹ÛŒØª -->
    <div class="summary" id="summaryArea">
        <strong>ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ :</strong> Ù‡ÛŒÚ† ØªØ³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡.
    </div>
</div>

<script>
    (function() {
        // ----- Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Fake DB (Ù…Ø·Ø§Ø¨Ù‚ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯) -----
        function createFakeDB(initialData = {}) {
            let store = { ...initialData };   // Ø¢Ø¨Ø¬Ú©Øª Ø¯Ø§Ø®Ù„ÛŒ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡)

            return {
                // get: Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ú©Ù„ÛŒØ¯ (Ù¾Ø±Ø§Ù…ÛŒØ³)
                get: (key) => {
                    return Promise.resolve(store[key] !== undefined ? store[key] : null);
                },
                // save: Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡ (key, value)
                save: (key, value) => {
                    store[key] = value;
                    return Promise.resolve(true);
                },
                // delete: Ø­Ø°Ù ÛŒÚ© Ú©Ù„ÛŒØ¯
                delete: (key) => {
                    delete store[key];
                    return Promise.resolve(true);
                },
                // clear: Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡
                clear: () => {
                    store = {};
                    return Promise.resolve(true);
                },
                // getAll: (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ú©Ù„ÛŒØ¯Ù‡Ø§
                getAll: () => {
                    return Promise.resolve({ ...store });
                },
                // Ù…ØªØ¯ ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ø®Ù„ÛŒ (ØµØ±ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªØ³Øª)
                _raw: () => store
            };
        }

        // Ù†Ù…ÙˆÙ†Ù‡ Fake DB Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ (Ø¨Ø§ Ú†Ù†Ø¯ Ø¯Ø§Ø¯Ù‡ Ø§ÙˆÙ„ÛŒÙ‡)
        let fakeDB = createFakeDB({
            'user:1': { id: 1, name: 'Ø¹Ù„ÛŒ', level: 3 },
            'settings:app': { theme: 'dark', lang: 'fa' }
        });

        // ----- Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯ (Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ) -----
        const logContainer = document.getElementById('logContainer');
        function logToPanel(message, type = 'info') {
            const prefix = type === 'success' ? 'âœ…' : (type === 'error' ? 'âŒ' : 'â¡ï¸');
            const time = new Date().toLocaleTimeString('fa-IR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            logContainer.innerHTML += `\n[${time}] ${prefix} ${message}`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLog() {
            logContainer.innerHTML = '[Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯.';
        }

        // ----- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§ -----
        function updateSummary(results) {
            const total = results.length;
            const passed = results.filter(r => r.passed).length;
            const failed = total - passed;
            const summaryDiv = document.getElementById('summaryArea');
            summaryDiv.innerHTML = `<strong>ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§ :</strong> âœ… ${passed} Ù…ÙˆÙÙ‚  |  âŒ ${failed} Ù†Ø§Ù…ÙˆÙÙ‚  |  ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹: ${total} ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯`;
            if (failed === 0 && total > 0) summaryDiv.style.background = '#e6f7e6';
            else if (failed > 0) summaryDiv.style.background = '#ffebee';
        }

        // ----- Ø¢Ø±Ø§ÛŒÙ‡ Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø®Ù„Ø§ØµÙ‡) -----
        let testResults = [];

        // ----- ØªØ¹Ø±ÛŒÙ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡) -----

        // 1. ØªØ³Øª get Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯
        async function testGetExisting() {
            try {
                const val = await fakeDB.get('user:1');
                const passed = val && val.name === 'Ø¹Ù„ÛŒ';
                logToPanel(`get('user:1') â†’ ${passed ? 'âœ… Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯' : 'âŒ Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ø¯Ø±Ø³Øª'}: ${JSON.stringify(val)}`, passed ? 'success' : 'error');
                return { name: 'get Ù…ÙˆØ¬ÙˆØ¯', passed };
            } catch (e) {
                logToPanel(`get Ù…ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'get Ù…ÙˆØ¬ÙˆØ¯', passed: false };
            }
        }

        // 2. ØªØ³Øª get Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (Ø¨Ø§ÛŒØ¯ null Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
        async function testGetMissing() {
            try {
                const val = await fakeDB.get('key:notfound');
                const passed = val === null;
                logToPanel(`get('key:notfound') â†’ null? ${passed ? 'âœ…' : 'âŒ'} (Ø¯Ø±ÛŒØ§ÙØª: ${val})`, passed ? 'success' : 'error');
                return { name: 'get Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯', passed };
            } catch (e) {
                logToPanel(`get Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'get Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯', passed: false };
            }
        }

        // 3. ØªØ³Øª save Ùˆ Ø³Ù¾Ø³ get (Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡)
        async function testSaveAndGet() {
            try {
                await fakeDB.save('test:color', 'blue');
                const retrieved = await fakeDB.get('test:color');
                const passed = retrieved === 'blue';
                logToPanel(`save('test:color','blue') â†’ get â†’ ${passed ? 'âœ…' : 'âŒ'} (Ø¯Ø±ÛŒØ§ÙØª: ${retrieved})`, passed ? 'success' : 'error');
                return { name: 'save + get', passed };
            } catch (e) {
                logToPanel(`save+get Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'save + get', passed: false };
            }
        }

        // 4. ØªØ³Øª Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…Ù‚Ø¯Ø§Ø± (overwrite)
        async function testOverwrite() {
            try {
                await fakeDB.save('user:1', { id: 1, name: 'Ø±Ø¶Ø§', level: 5 });
                const updated = await fakeDB.get('user:1');
                const passed = updated && updated.name === 'Ø±Ø¶Ø§' && updated.level === 5;
                logToPanel(`overwrite user:1 â†’ name: Ø±Ø¶Ø§ Ø³Ø·Ø­ 5 â†’ ${passed ? 'âœ…' : 'âŒ'}`, passed ? 'success' : 'error');
                // Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ù… ØªØ¯Ø§Ø®Ù„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                await fakeDB.save('user:1', { id: 1, name: 'Ø¹Ù„ÛŒ', level: 3 });
                return { name: 'Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ', passed };
            } catch (e) {
                logToPanel(`Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ', passed: false };
            }
        }

        // 5. ØªØ³Øª delete (Ø­Ø°Ù)
        async function testDelete() {
            try {
                await fakeDB.save('temp:delete', 'value');
                await fakeDB.delete('temp:delete');
                const val = await fakeDB.get('temp:delete');
                const passed = val === null;
                logToPanel(`delete('temp:delete') â†’ Ø¨Ø¹Ø¯Ø´ get â†’ null? ${passed ? 'âœ…' : 'âŒ'}`, passed ? 'success' : 'error');
                return { name: 'delete', passed };
            } catch (e) {
                logToPanel(`delete Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'delete', passed: false };
            }
        }

        // 6. ØªØ³Øª clear (Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡)
        async function testClear() {
            try {
                await fakeDB.save('temp:a', 1);
                await fakeDB.save('temp:b', 2);
                await fakeDB.clear();
                const valA = await fakeDB.get('temp:a');
                const valB = await fakeDB.get('temp:b');
                const settings = await fakeDB.get('settings:app');
                const passed = (valA === null && valB === null && settings === null);
                logToPanel(`clear() â†’ Ù‡Ù…Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯? ${passed ? 'âœ…' : 'âŒ'} (settings:${settings})`, passed ? 'success' : 'error');
                // Ø±ÛŒØ³ØªÙˆØ± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
                fakeDB = createFakeDB({ 'user:1': { id: 1, name: 'Ø¹Ù„ÛŒ', level: 3 }, 'settings:app': { theme: 'dark', lang: 'fa' } });
                return { name: 'clear', passed };
            } catch (e) {
                logToPanel(`clear Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'clear', passed: false };
            }
        }

        // 7. ØªØ³Øª getAll (Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§)
        async function testGetAll() {
            try {
                const all = await fakeDB.getAll();
                const keys = Object.keys(all);
                const passed = keys.includes('user:1') && keys.includes('settings:app');
                logToPanel(`getAll() â†’ ØªØ¹Ø¯Ø§Ø¯: ${keys.length} - Ø¯Ø§Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ? ${passed ? 'âœ…' : 'âŒ'}`, passed ? 'success' : 'error');
                return { name: 'getAll', passed };
            } catch (e) {
                logToPanel(`getAll Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'getAll', passed: false };
            }
        }

        // 8. ØªØ³Øª Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù† (Ø¢ÛŒØ§ Ø¯Ùˆ Ù†Ù…ÙˆÙ†Ù‡ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø±ÙˆÛŒ Ù‡Ù… Ø§Ø«Ø± Ø¯Ø§Ø±Ù†Ø¯ØŸ)
        async function testIsolation() {
            try {
                const anotherDB = createFakeDB({ isolated: true });
                await anotherDB.save('key1', 100);
                const valMain = await fakeDB.get('key1');
                const passed = (valMain === null);
                logToPanel(`Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù†: anotherDB Ø°Ø®ÛŒØ±Ù‡ key1 â†’ fakeDB Ø§ØµÙ„ÛŒ Ù†Ø¨Ø§ÛŒØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯. passed? ${passed ? 'âœ…' : 'âŒ'}`, passed ? 'success' : 'error');
                return { name: 'Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù†', passed };
            } catch (e) {
                logToPanel(`Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù† Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù†', passed: false };
            }
        }

        // 9. ØªØ³Øª Ø±ÙØªØ§Ø± Ù¾Ø±Ø§Ù…ÛŒØ³ (Ø¢ÛŒØ§ ÙˆØ§Ù‚Ø¹Ø§Ù‹ Ù¾Ø±Ø§Ù…ÛŒØ³ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯)
        async function testPromiseBehavior() {
            try {
                const p = fakeDB.get('user:1');
                const isPromise = p && typeof p.then === 'function';
                const result = await p;
                const passed = isPromise && result && result.id === 1;
                logToPanel(`Ø±ÙØªØ§Ø± Ù¾Ø±Ø§Ù…ÛŒØ³: ${passed ? 'âœ… promise Ø¯Ø±Ø³Øª' : 'âŒ promise Ù…Ø¹ÛŒÙˆØ¨'}`, passed ? 'success' : 'error');
                return { name: 'Ù¾Ø±Ø§Ù…ÛŒØ³', passed };
            } catch (e) {
                logToPanel(`Ù¾Ø±Ø§Ù…ÛŒØ³ Ø®Ø·Ø§: ${e.message}`, 'error');
                return { name: 'Ù¾Ø±Ø§Ù…ÛŒØ³', passed: false };
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² ØªØ³Øªâ€ŒÙ‡Ø§
        async function runContractTests(tests) {
            clearLog();
            logToPanel('ğŸ”¥ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Fake DB) ...');
            testResults = [];
            for (let testFn of tests) {
                const result = await testFn();
                testResults.push(result);
            }
            updateSummary(testResults);
            logToPanel('ğŸ Ù¾Ø§ÛŒØ§Ù† ØªØ³Øªâ€ŒÙ‡Ø§.');
        }

        // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÙˆÛŒØ§ Ø¯Ø± Ú¯Ø±ÛŒØ¯
        function buildTestGrid() {
            const grid = document.getElementById('testGrid');
            const testsList = [
                { name: 'get (Ù…ÙˆØ¬ÙˆØ¯)', fn: testGetExisting, desc: 'Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡ Ø¹Ø§Ø¯ÛŒ' },
                { name: 'get (Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯)', fn: testGetMissing, desc: 'Ø¨Ø§ÛŒØ¯ null Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯' },
                { name: 'save + get', fn: testSaveAndGet, desc: 'Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ' },
                { name: 'Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ', fn: testOverwrite, desc: 'Ø¢Ù¾Ø¯ÛŒØª Ù…Ù‚Ø¯Ø§Ø±' },
                { name: 'delete', fn: testDelete, desc: 'Ø­Ø°Ù ÛŒÚ© Ú©Ù„ÛŒØ¯' },
                { name: 'clear', fn: testClear, desc: 'Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡' },
                { name: 'getAll', fn: testGetAll, desc: 'Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡' },
                { name: 'Ø§ÛŒØ²ÙˆÙ„ÛŒØ´Ù†', fn: testIsolation, desc: 'Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø²Ø§' },
                { name: 'Ù¾Ø±Ø§Ù…ÛŒØ³', fn: testPromiseBehavior, desc: 'Ø¨Ø±Ø±Ø³ÛŒ thenable' }
            ];

            testsList.forEach((t, index) => {
                const card = document.createElement('div');
                card.className = 'test-card';
                card.innerHTML = `
                    <div class="test-title"><span>#${index+1}</span> ${t.name}</div>
                    <div style="font-size:0.8rem; color:#475569; margin-bottom:12px;">${t.desc}</div>
                    <button class="small primary" data-test-index="${index}">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                `;
                card.querySelector('button').addEventListener('click', async (e) => {
                    e.stopPropagation();
                    clearLog();
                    logToPanel(`ğŸ” Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª "${t.name}" ...`);
                    const res = await t.fn();
                    updateSummary([res]);
                });
                grid.appendChild(card);
            });
        }

        // ------ Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ -----
        document.getElementById('runAllContractTestsBtn').addEventListener('click', async () => {
            const tests = [testGetExisting, testGetMissing, testSaveAndGet, testOverwrite, testDelete, testClear, testGetAll, testIsolation, testPromiseBehavior];
            await runContractTests(tests);
        });

        document.getElementById('resetFakeDbBtn').addEventListener('click', async () => {
            fakeDB = createFakeDB({ 'user:1': { id: 1, name: 'Ø¹Ù„ÛŒ', level: 3 }, 'settings:app': { theme: 'dark', lang: 'fa' } });
            logToPanel('ğŸ”„ Fake DB Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯.', 'info');
        });

        document.getElementById('clearLogBtn').addEventListener('click', () => {
            clearLog();
        });

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        buildTestGrid();
        clearLog();
    })();
</script>
</body>
</html>
