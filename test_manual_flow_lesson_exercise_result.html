<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ - Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø³ØŒ ØªÙ…Ø±ÛŒÙ† Ùˆ Ù†ØªÛŒØ¬Ù‡ | Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Vazir', 'Arial', sans-serif;
            background: #f8fafc;
            color: #0f172a;
            padding: 16px;
            line-height: 1.6;
        }
        .container {
            max-width: 650px;
            margin: 0 auto;
            background: white;
            border-radius: 28px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            padding: 24px 20px;
            border: 1px solid #e2e8f0;
        }
        h1 {
            font-size: 1.7rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 3px solid #38bdf8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        h1 span { background: #0ea5e9; color: white; padding: 4px 12px; border-radius: 40px; font-size: 0.9rem; }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .step {
            background: #f1f5f9;
            padding: 10px 16px;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 500;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1 1 auto;
            justify-content: center;
            border: 1px solid transparent;
        }
        .step.active {
            background: #0284c7;
            color: white;
            border-color: #0369a1;
        }
        .step.completed {
            background: #bbf7d0;
            color: #166534;
            border-color: #4ade80;
        }
        .card {
            background: #ffffff;
            border: 1.5px solid #e2e8f0;
            border-radius: 20px;
            padding: 24px 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #f0f9ff;
            padding: 14px 18px;
            border-radius: 16px;
        }
        .badge {
            background: #0284c7;
            color: white;
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .exercise-box {
            background: #fef9c3;
            border-right: 8px solid #eab308;
            padding: 20px;
            border-radius: 18px;
            margin-bottom: 20px;
        }
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        .option-btn {
            background: white;
            border: 2px solid #cbd5e1;
            padding: 16px 8px;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #0f172a;
            transition: all 0.1s ease;
            cursor: pointer;
        }
        .option-btn.selected {
            background: #0284c7;
            border-color: #075985;
            color: white;
        }
        .option-btn.correct-answer {
            background: #22c55e;
            border-color: #15803d;
            color: white;
        }
        .option-btn.wrong-answer {
            background: #ef4444;
            border-color: #b91c1c;
            color: white;
        }
        .btn {
            background: #0f172a;
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            margin-top: 12px;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid #1e293b;
        }
        .btn:active { transform: scale(0.98); background: #1e293b; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .result-area {
            background: #f1f5f9;
            border-radius: 18px;
            padding: 20px;
            margin-top: 25px;
            border-left: 6px solid #94a3b8;
        }
        .log-console {
            background: #0b1120;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 220px;
            overflow-y: auto;
            direction: ltr;
            text-align: left;
            margin-top: 16px;
        }
        .flex-row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .mt-4 { margin-top: 24px; }
        .text-success { color: #16a34a; font-weight: bold; }
        .text-warning { color: #ca8a04; }
    </style>
</head>
<body>
<div class="container">
    <h1>
        ğŸ“˜ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ Ø¯Ø±Ø³ØŒ ØªÙ…Ø±ÛŒÙ† Ùˆ Ù†ØªÛŒØ¬Ù‡
        <span>Ø¯Ø³ØªÛŒ</span>
    </h1>

    <!-- Ù…Ø±Ø§Ø­Ù„ Ú¯Ø§Ù… Ø¨Ù‡ Ú¯Ø§Ù… -->
    <div class="step-indicator" id="stepIndicator">
        <div class="step active" id="step1">Û±ï¸âƒ£ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³</div>
        <div class="step" id="step2">Û²ï¸âƒ£ ØªÙ…Ø±ÛŒÙ†</div>
        <div class="step" id="step3">Û³ï¸âƒ£ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ</div>
        <div class="step" id="step4">Û´ï¸âƒ£ Ù†ØªÛŒØ¬Ù‡ Ùˆ SRS</div>
    </div>

    <!-- Ú©Ø§Ø±Øª Ø¯Ø±Ø³ Ø¬Ø§Ø±ÛŒ -->
    <div class="card" id="lessonCard">
        <div class="lesson-header">
            <div>
                <h2 id="lessonTitle">Ø¯Ø±Ø³ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ Û±: Greetings</h2>
                <p id="lessonMeta" style="color: #475569;">âœ… Û° Ø§Ø² Ûµ Ù„ØºØª ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡</p>
            </div>
            <div class="badge" id="levelBadge">Ø³Ø·Ø­ A1</div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ (ÙÙ‚Ø· Ø¯Ø± Ú¯Ø§Ù… Û±) -->
        <div id="startSection">
            <p style="margin-bottom: 16px;">ğŸ“Œ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ø±Ø³ Ù†Ù…ÙˆÙ†Ù‡ Ø±Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù†ÛŒØ¯.</p>
            <button class="btn" id="startLessonBtn">ğŸš€ Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ Ùˆ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªÙ…Ø±ÛŒÙ† Ø§ÙˆÙ„</button>
        </div>

        <!-- Ø¨Ø®Ø´ ØªÙ…Ø±ÛŒÙ† (Ù¾Ø³ Ø§Ø² Ø´Ø±ÙˆØ¹) -->
        <div id="exerciseSection" style="display: none;">
            <div class="exercise-box">
                <p style="color: #854d0e; font-weight: 600; margin-bottom: 12px;">ğŸ“ ØªÙ…Ø±ÛŒÙ†:</p>
                <p id="exerciseQuestion" style="font-size: 1.5rem; font-weight: 700; direction: ltr; text-align: center;">Hello</p>
                <p id="exerciseType" style="color: #92400e; text-align: center;">Ù…Ø¹Ø§Ø¯Ù„ ÙØ§Ø±Ø³ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
            </div>

            <div class="options" id="optionsContainer"></div>

            <div class="flex-row">
                <button class="btn" id="submitAnswerBtn" style="flex:2;" disabled>âœ… Ø«Ø¨Øª Ù¾Ø§Ø³Ø®</button>
                <button class="btn" id="nextExerciseBtn" style="flex:1; background: #64748b;" disabled>â© Ø¨Ø¹Ø¯ÛŒ</button>
            </div>
            <p id="feedbackMessage" style="margin-top: 12px; font-weight: 500;"></p>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Ù†ØªÛŒØ¬Ù‡ Ùˆ Ù¾ÛŒØ´Ø±ÙØª -->
    <div class="result-area" id="resultSection" style="display: none;">
        <h3 style="display: flex; gap: 10px; align-items: center;">ğŸ“Š Ù†ØªÛŒØ¬Ù‡ ØªÙ…Ø±ÛŒÙ†</h3>
        <div id="resultContent"></div>
        <button class="btn" id="restartFlowBtn" style="background: #0f172a;">ğŸ”„ Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¬Ø±ÛŒØ§Ù†</button>
    </div>

    <!-- Ú©Ù†Ø³ÙˆÙ„ ÙˆØ¶Ø¹ÛŒØª (Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„) -->
    <div style="margin-top: 30px;">
        <details open>
            <summary style="font-weight: 700; background: #e2e8f0; padding: 12px; border-radius: 12px; cursor: pointer;">ğŸ“‹ Ù„Ø§Ú¯ ÙˆØ¶Ø¹ÛŒØª - Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø±Ø¨Ø±</summary>
            <div class="log-console" id="logConsole">
                [Ø³ÛŒØ³ØªÙ…] Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø³ØŒ ØªÙ…Ø±ÛŒÙ† Ùˆ Ù†ØªÛŒØ¬Ù‡<br>
                [Ø±Ø§Ù‡Ù†Ù…Ø§] Ù…Ø±Ø§Ø­Ù„ Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø·ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.
            </div>
        </details>
    </div>
</div>

<script>
    (function(){
        "use strict";

        // ---------- Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) ----------
        const mockLesson = {
            id: 'lesson_greetings_1',
            title: 'Ø¯Ø±Ø³ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ Û±: Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ',
            level: 'A1',
            vocabulary: [
                { id: 'v1', word: 'Hello', translation: 'Ø³Ù„Ø§Ù…', options: ['Ø³Ù„Ø§Ù…', 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸', 'ØµØ¨Ø­ Ø¨Ø®ÛŒØ±', 'Ø´Ø¨ Ø¨Ø®ÛŒØ±'] },
                { id: 'v2', word: 'Goodbye', translation: 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸', options: ['Ø®Ø¯Ø§Ø­Ø§ÙØ¸', 'Ø³Ù„Ø§Ù…', 'Ø¨Ø¹Ø¯Ø§Ù‹', 'Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù…Øª'] },
                { id: 'v3', word: 'Morning', translation: 'ØµØ¨Ø­', options: ['ØµØ¨Ø­', 'Ø¸Ù‡Ø±', 'Ø¹ØµØ±', 'Ø´Ø¨'] },
                { id: 'v4', word: 'Night', translation: 'Ø´Ø¨', options: ['Ø´Ø¨', 'Ø±ÙˆØ²', 'ØµØ¨Ø­', 'Ø¹ØµØ±'] },
                { id: 'v5', word: 'Friend', translation: 'Ø¯ÙˆØ³Øª', options: ['Ø¯ÙˆØ³Øª', 'Ø¨Ø±Ø§Ø¯Ø±', 'Ø®ÙˆØ§Ù‡Ø±', 'Ù‡Ù…Ú©Ù„Ø§Ø³ÛŒ'] }
            ],
            currentIndex: 0,
            progress: { correct: 0, total: 5 }
        };

        // ---------- ÙˆØ¶Ø¹ÛŒØª Ø¬Ø±ÛŒØ§Ù† ----------
        const FlowState = {
            step: 1,                // 1: Ø§Ù†ØªØ®Ø§Ø¨/Ø´Ø±ÙˆØ¹, 2: ØªÙ…Ø±ÛŒÙ†, 3: Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ, 4: Ù†ØªÛŒØ¬Ù‡
            lesson: null,
            currentExercise: null,
            selectedOption: null,
            answerSubmitted: false,
            exerciseHistory: [],
            srsResult: null
        };

        // ---------- Ø§Ø¨Ø²Ø§Ø± Ù„Ø§Ú¯ ----------
        const Logger = {
            logs: [],
            log(level, message, data = null) {
                const time = new Date().toLocaleTimeString('fa-IR', { hour12: false });
                const logEntry = `[${time}] [${level}] ${message}`;
                this.logs.push(logEntry);
                const consoleDiv = document.getElementById('logConsole');
                if (consoleDiv) {
                    consoleDiv.innerHTML += `<br>${logEntry}` + (data ? ` ${JSON.stringify(data)}` : '');
                    consoleDiv.scrollTop = consoleDiv.scrollHeight;
                }
            },
            clear() {
                this.logs = [];
                const consoleDiv = document.getElementById('logConsole');
                if (consoleDiv) consoleDiv.innerHTML = '[Ø³ÛŒØ³ØªÙ…] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯.';
            }
        };

        // ---------- Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ø³Ø§Ø¯Ù‡ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) ----------
        function simulateSRS(quality) {
            const easeFactor = 2.5;
            let interval = 1;
            if (quality >= 4) interval = 6;
            if (quality === 5) interval = 10;
            if (quality < 3) interval = 1;
            return {
                interval,
                easeFactor: easeFactor + (quality - 3) * 0.1,
                quality,
                nextReviewDate: new Date(Date.now() + interval * 24 * 60 * 60 * 1000).toLocaleDateString('fa-IR')
            };
        }

        // ---------- Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¯Ø±Ø³ ----------
        function loadLesson() {
            FlowState.lesson = JSON.parse(JSON.stringify(mockLesson));
            FlowState.lesson.currentIndex = 0;
            FlowState.step = 1;
            FlowState.answerSubmitted = false;
            FlowState.selectedOption = null;
            FlowState.exerciseHistory = [];
            updateUIForStep(1);
            Logger.log('INFO', 'Ø¯Ø±Ø³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', { title: FlowState.lesson.title, vocabCount: FlowState.lesson.vocabulary.length });
        }

        // ---------- Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø§ÙˆÙ„ ----------
        function startExercise() {
            if (!FlowState.lesson) loadLesson();
            FlowState.step = 2;
            FlowState.lesson.currentIndex = 0;
            FlowState.answerSubmitted = false;
            FlowState.selectedOption = null;
            loadCurrentExercise();
            updateUIForStep(2);
            Logger.log('INFO', 'Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ†', { word: FlowState.currentExercise?.word });
        }

        // ---------- Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªÙ…Ø±ÛŒÙ† Ø¬Ø§Ø±ÛŒ ----------
        function loadCurrentExercise() {
            if (!FlowState.lesson) return;
            const idx = FlowState.lesson.currentIndex;
            if (idx >= FlowState.lesson.vocabulary.length) {
                // Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³
                endLesson();
                return;
            }
            FlowState.currentExercise = { ...FlowState.lesson.vocabulary[idx] };
            FlowState.selectedOption = null;
            FlowState.answerSubmitted = false;

            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± UI
            document.getElementById('exerciseQuestion').innerText = FlowState.currentExercise.word;
            document.getElementById('exerciseType').innerText = 'âœ… Ù…Ø¹Ø§Ø¯Ù„ ÙØ§Ø±Ø³ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
            
            const optsContainer = document.getElementById('optionsContainer');
            optsContainer.innerHTML = '';
            FlowState.currentExercise.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.dataset.option = opt;
                btn.onclick = () => selectOption(btn, opt);
                optsContainer.appendChild(btn);
            });

            document.getElementById('submitAnswerBtn').disabled = true;
            document.getElementById('nextExerciseBtn').disabled = true;
            document.getElementById('feedbackMessage').innerText = '';
        }

        // Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø²ÛŒÙ†Ù‡
        function selectOption(el, opt) {
            if (FlowState.answerSubmitted) return;
            // Ø­Ø°Ù Ø­Ø§Ù„Øª selected Ù‚Ø¨Ù„ÛŒ
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            el.classList.add('selected');
            FlowState.selectedOption = opt;
            document.getElementById('submitAnswerBtn').disabled = false;
        }

        // Ø«Ø¨Øª Ù¾Ø§Ø³Ø®
        function submitAnswer() {
            if (!FlowState.selectedOption || FlowState.answerSubmitted) return;
            const exercise = FlowState.currentExercise;
            const isCorrect = (FlowState.selectedOption === exercise.translation);
            FlowState.answerSubmitted = true;

            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø³Øª/ØºÙ„Ø· Ø¨ÙˆØ¯Ù† Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.innerText === exercise.translation) {
                    btn.classList.add('correct-answer');
                } else if (btn.innerText === FlowState.selectedOption && !isCorrect) {
                    btn.classList.add('wrong-answer');
                }
            });

            const quality = isCorrect ? 5 : 1;  // 5=Ø¹Ø§Ù„ÛŒ, 1=Ø¶Ø¹ÛŒÙ
            const srs = simulateSRS(quality);
            FlowState.srsResult = srs;

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
            FlowState.exerciseHistory.push({
                word: exercise.word,
                selected: FlowState.selectedOption,
                correct: exercise.translation,
                isCorrect,
                srs: srs
            });

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³
            if (isCorrect) FlowState.lesson.progress.correct++;
            FlowState.lesson.currentIndex++;

            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯
            const feedback = document.getElementById('feedbackMessage');
            feedback.innerHTML = isCorrect ? 
                `âœ… Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª! (Ú©ÛŒÙÛŒØª ${quality}) - Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: ${srs.interval} Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±` : 
                `âŒ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª. Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: "${exercise.translation}" (Ú©ÛŒÙÛŒØª ${quality})`;
            feedback.style.color = isCorrect ? '#16a34a' : '#b91c1c';

            document.getElementById('submitAnswerBtn').disabled = true;
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ
            if (FlowState.lesson.currentIndex < FlowState.lesson.vocabulary.length) {
                document.getElementById('nextExerciseBtn').disabled = false;
            } else {
                // Ø¯Ø±Ø³ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡
                document.getElementById('nextExerciseBtn').innerText = 'ğŸ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡';
                document.getElementById('nextExerciseBtn').disabled = false;
            }

            Logger.log('TEST', 'Ù¾Ø§Ø³Ø® Ø«Ø¨Øª Ø´Ø¯', { word: exercise.word, isCorrect, quality, interval: srs.interval });
        }

        // Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ ÛŒØ§ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
        function nextExercise() {
            if (FlowState.lesson.currentIndex >= FlowState.lesson.vocabulary.length) {
                // Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³
                endLesson();
            } else {
                loadCurrentExercise();
                document.getElementById('nextExerciseBtn').disabled = true;
            }
        }

        // Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
        function endLesson() {
            FlowState.step = 4;
            updateUIForStep(4);
            
            const correctCount = FlowState.lesson.progress.correct;
            const total = FlowState.lesson.vocabulary.length;
            const percent = Math.round((correctCount / total) * 100);
            
            let resultHtml = `
                <p style="font-size: 1.6rem; font-weight: 700; color: #0f172a;">${correctCount}/${total}</p>
                <p>Ø¯Ø±ØµØ¯ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: <strong>${percent}%</strong></p>
                <p>â­ Ø§Ù…ØªÛŒØ§Ø² Ú©Ø³Ø¨ Ø´Ø¯Ù‡: ${correctCount * 10}</p>
                <p>ğŸ“… Ø¯Ø±ÙˆØ³ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ù…Ø±ÙˆØ±: ${total - correctCount} Ù„ØºØª</p>
                <hr style="margin: 16px 0;">
                <h4>Ù†Ù…ÙˆÙ†Ù‡ Ø®Ø±ÙˆØ¬ÛŒ SRS (Ø¢Ø®Ø±ÛŒÙ† Ù„ØºØª):</h4>
                <p>ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ±: ${FlowState.srsResult?.interval || 1} Ø±ÙˆØ²</p>
                <p>ØªØ§Ø±ÛŒØ® Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: ${FlowState.srsResult?.nextReviewDate || 'ÙØ±Ø¯Ø§'}</p>
            `;
            
            document.getElementById('resultContent').innerHTML = resultHtml;
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('exerciseSection').style.display = 'none';
            document.getElementById('startSection').style.display = 'none';
            
            Logger.log('INFO', 'Ø¯Ø±Ø³ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯', { correct: correctCount, total, percent: percent + '%' });
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø§Ù…
        function updateUIForStep(step) {
            FlowState.step = step;
            // Ø¢Ù¾Ø¯ÛŒØª Ø§Ø³ØªÙ¾â€ŒÙ‡Ø§
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active', 'completed'));
            document.getElementById('step1').classList.add(step >= 1 ? (step > 1 ? 'completed' : 'active') : '');
            document.getElementById('step2').classList.add(step >= 2 ? (step > 2 ? 'completed' : 'active') : '');
            document.getElementById('step3').classList.add(step >= 3 ? (step > 3 ? 'completed' : 'active') : '');
            document.getElementById('step4').classList.add(step >= 4 ? 'active' : '');

            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            if (step === 1) {
                document.getElementById('startSection').style.display = 'block';
                document.getElementById('exerciseSection').style.display = 'none';
                document.getElementById('resultSection').style.display = 'none';
            } else if (step === 2 || step === 3) {
                document.getElementById('startSection').style.display = 'none';
                document.getElementById('exerciseSection').style.display = 'block';
                document.getElementById('resultSection').style.display = 'none';
            } else if (step === 4) {
                document.getElementById('startSection').style.display = 'none';
                document.getElementById('exerciseSection').style.display = 'none';
                document.getElementById('resultSection').style.display = 'block';
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªØ§ Ø¯Ø±Ø³
            if (FlowState.lesson) {
                document.getElementById('lessonTitle').innerText = FlowState.lesson.title;
                document.getElementById('lessonMeta').innerHTML = `âœ… ${FlowState.lesson.progress.correct} Ø§Ø² ${FlowState.lesson.vocabulary.length} Ù„ØºØª ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡`;
                document.getElementById('levelBadge').innerText = `Ø³Ø·Ø­ ${FlowState.lesson.level}`;
            }
        }

        // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„
        function restartFlow() {
            Logger.clear();
            loadLesson();
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('startSection').style.display = 'block';
            document.getElementById('exerciseSection').style.display = 'none';
            FlowState.step = 1;
            updateUIForStep(1);
            Logger.log('INFO', 'Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø±Ø¨Ø± Ø±ÛŒØ³Øª Ø´Ø¯');
        }

        // ---------- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ùˆ Ø¨Ø§ÛŒÙ†Ø¯ ----------
        window.onload = function() {
            loadLesson();

            document.getElementById('startLessonBtn').addEventListener('click', function(e) {
                startExercise();
            });

            document.getElementById('submitAnswerBtn').addEventListener('click', function(e) {
                submitAnswer();
            });

            document.getElementById('nextExerciseBtn').addEventListener('click', function(e) {
                nextExercise();
            });

            document.getElementById('restartFlowBtn').addEventListener('click', function(e) {
                restartFlow();
            });

            Logger.log('INFO', 'ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø³ØŒ ØªÙ…Ø±ÛŒÙ† Ùˆ Ù†ØªÛŒØ¬Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¯Ú©Ù…Ù‡ "Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.');
        };
    })();
</script>
</body>
</html>
