<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ CRUD IndexedDB - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Vazir', sans-serif;
            background: #f8fafc;
            padding: 16px;
            color: #0f172a;
            line-height: 1.6;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { font-size: 1.8rem; margin-bottom: 8px; color: #0f172a; display: flex; align-items: center; gap: 10px; }
        h2 { font-size: 1.3rem; margin-bottom: 16px; color: #334155; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px; }
        .subtitle { background: #e6f7e6; padding: 12px; border-radius: 12px; margin-bottom: 24px; border-right: 6px solid #2e7d32; font-weight: bold; }
        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 24px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; }
        .step { background: #f1f5f9; padding: 12px 16px; border-radius: 14px; margin-bottom: 20px; font-weight: 600; color: #1e293b; border-left: 6px solid #3b82f6; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 12px; margin: 20px 0; }
        .btn {
            background: white; border: 1px solid #cbd5e1; padding: 12px 20px; border-radius: 40px;
            font-size: 1rem; font-weight: 600; color: #1e293b; cursor: pointer; transition: 0.2s;
            display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            flex: 1 1 auto; justify-content: center;
        }
        .btn-primary { background: #2563eb; color: white; border: none; box-shadow: 0 6px 14px rgba(37,99,235,0.3); }
        .btn-success { background: #16a34a; color: white; border: none; }
        .btn-warning { background: #d97706; color: white; border: none; }
        .btn-danger { background: #dc2626; color: white; border: none; }
        .btn:active { transform: scale(0.96); }
        .result-box {
            background: #0b1120; color: #e2e8f0; padding: 18px; border-radius: 16px;
            font-family: 'Courier New', monospace; font-size: 0.9rem; margin-top: 20px;
            border: 1px solid #334155; max-height: 350px; overflow: auto; direction: ltr;
        }
        .log-entry { border-bottom: 1px solid #334155; padding: 8px 0; display: flex; gap: 12px; }
        .log-time { color: #94a3b8; min-width: 70px; }
        .log-success { color: #4ade80; }
        .log-error { color: #f87171; }
        .badge {
            background: #e2e8f0; padding: 6px 14px; border-radius: 30px; font-size: 0.85rem;
            display: inline-block; margin: 4px 0; font-weight: 600;
        }
        table { width: 100%; border-collapse: collapse; margin: 16px 0; }
        th { background: #f1f5f9; padding: 12px; text-align: right; border-radius: 12px 12px 0 0; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        .footer { text-align: center; margin-top: 40px; color: #64748b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—„ï¸ Farsinglish Â· ØªØ³Øª Ø¯Ø³ØªÛŒ CRUD</h1>
        <div class="subtitle">
            âš¡ IndexedDB Â· Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒÙ‡ (Ø§ÛŒØ¬Ø§Ø¯ØŒ Ø®ÙˆØ§Ù†Ø¯Ù†ØŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒØŒ Ø­Ø°Ù) Â· Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ø³ØªÛŒ
        </div>

        <!-- Ú©Ø§Ø±Øª Û±: ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>ğŸ“Œ Û±. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</h2>
                <span id="dbStatusBadge" class="badge" style="background: #fef9c3; color: #854d0e;">â³ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</span>
            </div>
            <p style="margin-bottom: 12px;">âœ… Ø¯ÛŒØªØ§Ø¨ÛŒØ³ <code>FarsinglishDB</code> Ù†Ø³Ø®Ù‡ Û± Â· Ø§Ø³ØªÙˆØ± <code>lessons</code> Ùˆ <code>progress</code></p>
            <button id="btnInitDB" class="btn btn-primary">ğŸ“‚ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</button>
            <div id="dbInitMessage" style="margin-top: 16px; padding: 10px; background: #f1f5f9; border-radius: 12px;"></div>
        </div>

        <!-- Ú©Ø§Ø±Øª Û²: Ø¹Ù…Ù„ÛŒØ§Øª CREATE -->
        <div class="card">
            <h2>â• Û². Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ (CREATE)</h2>
            <div class="step">ğŸ“˜ Ù†Ù…ÙˆÙ†Ù‡: Ø¯Ø±Ø³ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§</div>
            <div class="btn-group">
                <button id="btnCreateLesson1" class="btn">ğŸ“— Ø¯Ø±Ø³ Û±: Ø§Ø¹Ø¯Ø§Ø¯</button>
                <button id="btnCreateLesson2" class="btn">ğŸ“˜ Ø¯Ø±Ø³ Û²: Ø§Ø¹Ø¶Ø§ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</button>
                <button id="btnCreateLesson3" class="btn">ğŸ“™ Ø¯Ø±Ø³ Û³: Ø±Ù†Ú¯â€ŒÙ‡Ø§</button>
            </div>
            <div style="background: #fefce8; padding: 12px; border-radius: 14px; margin-top: 12px;">
                <span style="font-weight: bold;">âœï¸ Ø¯Ø±Ø³ Ø¯Ù„Ø®ÙˆØ§Ù‡:</span>
                <input type="text" id="customLessonTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #cbd5e1; font-size: 1rem;">
                <button id="btnCreateCustomLesson" class="btn btn-success" style="width: 100%;">â• Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³ Ø³ÙØ§Ø±Ø´ÛŒ</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Û³: Ø¹Ù…Ù„ÛŒØ§Øª READ -->
        <div class="card">
            <h2>ğŸ” Û³. Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (READ)</h2>
            <div class="btn-group">
                <button id="btnGetAllLessons" class="btn">ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§</button>
                <button id="btnGetLessonById" class="btn">ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡</button>
            </div>
            <div id="readInputContainer" style="display: none; margin-top: 16px;">
                <label>ğŸ†” Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø³:</label>
                <input type="text" id="lessonIdInput" placeholder="Ù…Ø«Ø§Ù„: lesson_1" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #cbd5e1;">
                <button id="btnFetchLesson" class="btn btn-primary">ğŸ” Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø³</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Û´: Ø¹Ù…Ù„ÛŒØ§Øª UPDATE -->
        <div class="card">
            <h2>âœï¸ Û´. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±Ø³ (UPDATE)</h2>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="updateLessonId" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø³" style="flex: 2; padding: 12px; border-radius: 12px; border: 1px solid #cbd5e1;">
                <input type="text" id="updateLessonTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯" style="flex: 3; padding: 12px; border-radius: 12px; border: 1px solid #cbd5e1;">
                <button id="btnUpdateLesson" class="btn btn-warning" style="flex: 1;">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ûµ: Ø¹Ù…Ù„ÛŒØ§Øª DELETE -->
        <div class="card">
            <h2>ğŸ—‘ï¸ Ûµ. Ø­Ø°Ù Ø¯Ø±Ø³ (DELETE)</h2>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="deleteLessonId" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø³ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù" style="flex: 3; padding: 12px; border-radius: 12px; border: 1px solid #cbd5e1;">
                <button id="btnDeleteLesson" class="btn btn-danger" style="flex: 1;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
            <button id="btnClearAll" style="margin-top: 16px; background: #7f1d1d; color: white; border: none; padding: 12px; border-radius: 12px; width: 100%;">âš ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙˆØ± lessons</button>
        </div>

        <!-- Ú©Ø§Ø±Øª Û¶: Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ùˆ Ù„Ø§Ú¯ -->
        <div class="card">
            <h2>ğŸ“‹ Û¶. Ø®Ø±ÙˆØ¬ÛŒ Ùˆ Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø³ØªÛŒ</h2>
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button id="btnClearLog" class="btn" style="background: #64748b; color: white;">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
                <button id="btnExportLog" class="btn" style="background: #0f172a; color: white;">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯</button>
            </div>
            <div id="logContainer" class="result-box">
                <div class="log-entry"><span class="log-time">â±ï¸</span> Ù…Ù†ØªØ¸Ø± Ø¹Ù…Ù„ÛŒØ§Øª Ø´Ù…Ø§...</div>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Û·: Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ -->
        <div class="card">
            <h2>ğŸ§ª Û·. Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</h2>
            <table>
                <tr><th>âœ… ØªØ³Øª</th><th>Ø´Ø±Ø­</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr>
                <tr><td>Û±</td><td>Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³ â†’ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª (READ)</td><td id="scenario1Status">â³</td></tr>
                <tr><td>Û²</td><td>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³ â†’ ØªØ£ÛŒÛŒØ¯ ØªØºÛŒÛŒØ±</td><td id="scenario2Status">â³</td></tr>
                <tr><td>Û³</td><td>Ø­Ø°Ù ÛŒÚ© Ø¯Ø±Ø³ â†’ Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´</td><td id="scenario3Status">â³</td></tr>
                <tr><td>Û´</td><td>Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ (Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©Ø³Ø§Ù†) â† Ø®Ø·Ø§</td><td id="scenario4Status">â³</td></tr>
                <tr><td>Ûµ</td><td>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙˆØ± â† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ</td><td id="scenario5Status">â³</td></tr>
            </table>
            <button id="btnResetScenarios" style="margin-top: 16px; background: #475569; color: white; padding: 10px; border-radius: 12px; width: 100%;">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§</button>
        </div>
        <div class="footer">
            ğŸš€ Farsinglish Â· ØªØ³Øª Ø¯Ø³ØªÛŒ CRUD Â· Ø§Ø¬Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
        </div>
    </div>

    <script>
        // -----------------------------------------------
        // IndexedDB Wrapper (Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ)
        // -----------------------------------------------
        const DB_NAME = 'FarsinglishTestDB';
        const DB_VERSION = 1;
        const LESSON_STORE = 'lessons';

        let db = null;

        // Ù„Ø§Ú¯ Ù…Ø­Ù„ÛŒ
        let logEntries = [];

        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            logEntries.unshift({ time, message, type });
            renderLog();
        }

        function renderLog() {
            const container = document.getElementById('logContainer');
            if (!container) return;
            let html = '';
            logEntries.slice(0, 15).forEach(entry => {
                const colorClass = entry.type === 'success' ? 'log-success' : (entry.type === 'error' ? 'log-error' : '');
                html += `<div class="log-entry"><span class="log-time">${entry.time}</span> <span class="${colorClass}">${entry.message}</span></div>`;
            });
            container.innerHTML = html || '<div class="log-entry">ğŸ“­ Ù„Ø§Ú¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>';
        }

        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(LESSON_STORE)) {
                        const store = db.createObjectStore(LESSON_STORE, { keyPath: 'id' });
                        store.createIndex('title', 'title', { unique: false });
                        store.createIndex('createdAt', 'createdAt', { unique: false });
                        addLog('ğŸ“¦ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³ØªÙˆØ± lessons', 'success');
                    }
                };
                request.onsuccess = (event) => {
                    db = event.target.result;
                    document.getElementById('dbStatusBadge').innerHTML = 'âœ… ÙØ¹Ø§Ù„';
                    document.getElementById('dbStatusBadge').style.background = '#dcfce7';
                    document.getElementById('dbStatusBadge').style.color = '#166534';
                    addLog('âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ IndexedDB Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯', 'success');
                    resolve(db);
                };
                request.onerror = (event) => {
                    addLog('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³: ' + event.target.error?.message, 'error');
                    reject(event.target.error);
                };
            });
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³
        function saveLesson(lesson) {
            return new Promise((resolve, reject) => {
                if (!db) { reject('Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª'); return; }
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                const request = store.put(lesson);
                request.onsuccess = () => { 
                    addLog(`ğŸ’¾ Ø¯Ø±Ø³ "${lesson.title}" Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${lesson.id} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`, 'success');
                    resolve(request.result);
                };
                request.onerror = (e) => { 
                    addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³: ${e.target.error?.message}`, 'error');
                    reject(e.target.error);
                };
            });
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§
        function getAllLessons() {
            return new Promise((resolve, reject) => {
                if (!db) { reject('Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª'); return; }
                const tx = db.transaction(LESSON_STORE, 'readonly');
                const store = tx.objectStore(LESSON_STORE);
                const request = store.getAll();
                request.onsuccess = () => { 
                    addLog(`ğŸ“– Ø¯Ø±ÛŒØ§ÙØª ${request.result.length} Ø¯Ø±Ø³ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³`, 'success');
                    resolve(request.result);
                };
                request.onerror = (e) => reject(e.target.error);
            });
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø³ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡
        function getLessonById(id) {
            return new Promise((resolve, reject) => {
                if (!db) reject('Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª');
                const tx = db.transaction(LESSON_STORE, 'readonly');
                const store = tx.objectStore(LESSON_STORE);
                const request = store.get(id);
                request.onsuccess = () => resolve(request.result);
                request.onerror = (e) => reject(e.target.error);
            });
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±Ø³
        function updateLesson(id, newTitle) {
            return new Promise(async (resolve, reject) => {
                try {
                    const lesson = await getLessonById(id);
                    if (!lesson) { throw new Error('Ø¯Ø±Ø³ ÛŒØ§ÙØª Ù†Ø´Ø¯'); }
                    lesson.title = newTitle;
                    lesson.updatedAt = new Date().toISOString();
                    const result = await saveLesson(lesson);
                    addLog(`âœï¸ Ø¯Ø±Ø³ "${id}" Ø¨Ù‡ "${newTitle}" Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯`, 'success');
                    resolve(result);
                } catch(e) {
                    addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´: ${e.message}`, 'error');
                    reject(e);
                }
            });
        }

        // Ø­Ø°Ù Ø¯Ø±Ø³
        function deleteLesson(id) {
            return new Promise((resolve, reject) => {
                if (!db) reject('Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª');
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                const request = store.delete(id);
                request.onsuccess = () => { 
                    addLog(`ğŸ—‘ï¸ Ø¯Ø±Ø³ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${id} Ø­Ø°Ù Ø´Ø¯`, 'success');
                    resolve(true);
                };
                request.onerror = (e) => reject(e.target.error);
            });
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ Ø§Ø³ØªÙˆØ±
        function clearStore() {
            return new Promise((resolve, reject) => {
                if (!db) reject();
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                const request = store.clear();
                request.onsuccess = () => { 
                    addLog('ğŸ§¹ ØªÙ…Ø§Ù… Ø¯Ø±ÙˆØ³ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'success');
                    resolve();
                };
                request.onerror = (e) => reject(e.target.error);
            });
        }

        // -----------------------------------------------
        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ UI
        // -----------------------------------------------
        window.onload = async function() {
            addLog('ğŸš€ ØµÙØ­Ù‡ ØªØ³Øª CRUD Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'info');
            // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¯Ø³ØªÛŒ Ú©Ø§Ø±Ø¨Ø±
        };

        document.getElementById('btnInitDB').addEventListener('click', async function() {
            try {
                await openDB();
            } catch(e) {
                addLog('Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ: ' + e.message, 'error');
            }
        });

        // CREATE: Ø¯Ø±Ø³ Ù†Ù…ÙˆÙ†Ù‡ Û±
        document.getElementById('btnCreateLesson1').addEventListener('click', async function() {
            if (!db) { addLog('âŒ Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const lesson = { id: 'lesson_1', title: 'Ø§Ø¹Ø¯Ø§Ø¯ Û±-Û±Û°', level: 1, createdAt: new Date().toISOString() };
            await saveLesson(lesson);
            updateScenarioStatus(1, 'âœ…');
        });

        document.getElementById('btnCreateLesson2').addEventListener('click', async function() {
            if (!db) { addLog('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const lesson = { id: 'lesson_2', title: 'Ø§Ø¹Ø¶Ø§ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡', level: 1, createdAt: new Date().toISOString() };
            await saveLesson(lesson);
            updateScenarioStatus(1, 'âœ…');
        });

        document.getElementById('btnCreateLesson3').addEventListener('click', async function() {
            if (!db) { addLog('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const lesson = { id: 'lesson_3', title: 'Ø±Ù†Ú¯â€ŒÙ‡Ø§', level: 2, createdAt: new Date().toISOString() };
            await saveLesson(lesson);
        });

        // Ø¯Ø±Ø³ Ø³ÙØ§Ø±Ø´ÛŒ
        document.getElementById('btnCreateCustomLesson').addEventListener('click', async function() {
            if (!db) { addLog('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const title = document.getElementById('customLessonTitle').value.trim();
            if (!title) { addLog('âš ï¸ Ù„Ø·ÙØ§ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const id = 'lesson_' + Date.now();
            const lesson = { id, title, level: 1, createdAt: new Date().toISOString() };
            await saveLesson(lesson);
            document.getElementById('customLessonTitle').value = '';
        });

        // READ: Ù‡Ù…Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§
        document.getElementById('btnGetAllLessons').addEventListener('click', async function() {
            if (!db) { addLog('âŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª', 'error'); return; }
            const lessons = await getAllLessons();
            addLog(`ğŸ“‹ Ù„ÛŒØ³Øª Ø¯Ø±Ø³â€ŒÙ‡Ø§ (${lessons.length}): ` + lessons.map(l => `${l.title} (${l.id})`).join('ØŒ '), 'info');
        });

        // Ù†Ù…Ø§ÛŒØ´ input Ø¬Ø³ØªØ¬Ùˆ
        document.getElementById('btnGetLessonById').addEventListener('click', function() {
            document.getElementById('readInputContainer').style.display = 'block';
        });

        document.getElementById('btnFetchLesson').addEventListener('click', async function() {
            const id = document.getElementById('lessonIdInput').value.trim();
            if (!id) { addLog('âš ï¸ Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
            const lesson = await getLessonById(id);
            if (lesson) {
                addLog(`ğŸ” Ø¯Ø±Ø³ ÛŒØ§ÙØª Ø´Ø¯: ${lesson.title} (Ø³Ø·Ø­ ${lesson.level})`, 'success');
            } else {
                addLog(`âŒ Ø¯Ø±Ø³ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${id} ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'error');
            }
        });

        // UPDATE
        document.getElementById('btnUpdateLesson').addEventListener('click', async function() {
            const id = document.getElementById('updateLessonId').value.trim();
            const newTitle = document.getElementById('updateLessonTitle').value.trim();
            if (!id || !newTitle) { addLog('âš ï¸ Ø´Ù†Ø§Ø³Ù‡ Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
            await updateLesson(id, newTitle);
            updateScenarioStatus(2, 'âœ…');
        });

        // DELETE
        document.getElementById('btnDeleteLesson').addEventListener('click', async function() {
            const id = document.getElementById('deleteLessonId').value.trim();
            if (!id) { addLog('âš ï¸ Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
            await deleteLesson(id);
            updateScenarioStatus(3, 'âœ…');
        });

        document.getElementById('btnClearAll').addEventListener('click', async function() {
            if (confirm('âš ï¸ Ù‡Ù…Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´ÙˆÙ†Ø¯ØŸ')) {
                await clearStore();
                updateScenarioStatus(5, 'âœ…');
            }
        });

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯
        document.getElementById('btnClearLog').addEventListener('click', function() {
            logEntries = [];
            renderLog();
        });

        // Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯
        document.getElementById('btnExportLog').addEventListener('click', function() {
            const text = logEntries.map(e => `[${e.time}] ${e.message}`).join('\n');
            alert('Ù„Ø§Ú¯ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª (F12)');
            console.log(text);
            addLog('ğŸ“¤ Ù„Ø§Ú¯ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'info');
        });

        // Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§
        function updateScenarioStatus(num, status) {
            document.getElementById(`scenario${num}Status`).innerHTML = status;
        }

        document.getElementById('btnResetScenarios').addEventListener('click', function() {
            for(let i=1; i<=5; i++) {
                document.getElementById(`scenario${i}Status`).innerHTML = 'â³';
            }
            addLog('ğŸ”„ ÙˆØ¶Ø¹ÛŒØª Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯', 'info');
        });

        // ØªØ³Øª Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ (Ø³Ù†Ø§Ø±ÛŒÙˆ Û´)
        async function testDuplicateLesson() {
            if (!db) return;
            const lesson = { id: 'duplicate_test', title: 'Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ', createdAt: new Date().toISOString() };
            await saveLesson(lesson);
            // Ø¨Ø§Ø± Ø¯ÙˆÙ… Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯
            try {
                await saveLesson(lesson); // Ú†ÙˆÙ† key ÛŒÚ©Ø³Ø§Ù† Ø§Ø³Øª Ø¯Ø± put Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ù†Ù‡ Ø®Ø·Ø§. Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ Ø§Ø² add Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ…
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                store.add(lesson); // add Ø¨Ø§ Ú©Ù„ÛŒØ¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
            } catch(e) {
                addLog('âœ… Ø®Ø·Ø§ÛŒ Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
                updateScenarioStatus(4, 'âœ…');
            }
        }

        // Ø§ØªØµØ§Ù„ ØªØ³Øª ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ (ØºÛŒØ±Ù…Ø³ØªÙ‚ÛŒÙ…)
        window.testDuplicate = testDuplicateLesson;

    </script>
</body>
</html>
