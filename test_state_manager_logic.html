<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ State Manager - Ù…Ù†Ø·Ù‚ Ù¾Ø§ÛŒÙ‡</title>
    <style>
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 24px;
        }
        h1 {
            font-size: 1.8rem;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }
        h2 {
            font-size: 1.3rem;
            margin: 20px 0 10px;
            color: #34495e;
        }
        .section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #2980b9;
            flex: 1 1 auto;
            min-width: 150px;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        button.secondary {
            background: #95a5a6;
            border-color: #7f8c8d;
        }
        button.secondary:hover {
            background: #7f8c8d;
        }
        button.success {
            background: #2ecc71;
            border-color: #27ae60;
        }
        button.success:hover {
            background: #27ae60;
        }
        button.warning {
            background: #f39c12;
            border-color: #e67e22;
        }
        button.warning:hover {
            background: #e67e22;
        }
        .output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
            border: 2px solid #334155;
        }
        .status-box {
            background: #d1fae5;
            border-right: 6px solid #10b981;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        .test-row {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .test-desc {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        .success-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.85rem;
            display: inline-block;
            margin-right: 8px;
        }
        .fail-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.85rem;
            display: inline-block;
            margin-right: 8px;
        }
        hr {
            border: none;
            border-top: 2px dashed #cbd5e0;
            margin: 25px 0 15px;
        }
        .footer-note {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 30px;
            border-top: 1px solid #e2e8f0;
            padding-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ State Manager (Ù…Ù†Ø·Ù‚ Ù¾Ø§ÛŒÙ‡)</h1>
    <p>Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§ÛŒØ²ÙˆÙ„Ù‡ Ùˆ Ø¯Ø³ØªÛŒ <code>core/state/state-manager.js</code> Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø®Ø±ÙˆØ¬ÛŒ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

    <div class="status-box" id="initStatus">
        âš¡ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡...
    </div>

    <div class="section">
        <h2>ğŸ“¦ Û±. Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ State</h2>
        <div class="button-group">
            <button id="initBtn" class="success">ğŸ“¦ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ (init)</button>
            <button id="showStateBtn" class="secondary">ğŸ‘ Ù†Ù…Ø§ÛŒØ´ State ÙØ¹Ù„ÛŒ</button>
            <button id="resetBtn" class="warning">ğŸ”„ Ø±ÛŒØ³Øª State</button>
        </div>
        <div class="output" id="output">Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø±ÙˆØ¬ÛŒØŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯...</div>
    </div>

    <hr>

    <div class="section">
        <h2>ğŸ§ª Û². ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ Ù…Ù†Ø·Ù‚ State</h2>

        <!-- ØªØ³Øª Û±: set/get Ø³Ø§Ø¯Ù‡ -->
        <div class="test-row">
            <div class="test-title">âœ… ØªØ³Øª Û±: set/get Ø³Ø§Ø¯Ù‡ <span class="success-badge" id="badge1">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ ÛŒÚ© ÙÛŒÙ„Ø¯ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¢Ù†. Ø¨Ø§ÛŒØ¯ Ù…Ù‚Ø¯Ø§Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø± Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§Ø´Ø¯.</div>
            <button id="test1Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û±</button>
        </div>

        <!-- ØªØ³Øª Û²: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ partial -->
        <div class="test-row">
            <div class="test-title">âœ… ØªØ³Øª Û²: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø²Ø¦ÛŒ (partial update) <span class="success-badge" id="badge2">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">ØªÙ†Ù‡Ø§ ÙÛŒÙ„Ø¯ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ Ùˆ Ø³Ø§ÛŒØ± ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¯Ø³Øªâ€ŒÙ†Ø®ÙˆØ±Ø¯Ù‡ Ø¨Ø§Ù‚ÛŒ Ø¨Ù…Ø§Ù†Ù†Ø¯.</div>
            <button id="test2Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û²</button>
        </div>

        <!-- ØªØ³Øª Û³: Immutability (ØªØºÛŒÛŒØ±Ù†Ø§Ù¾Ø°ÛŒØ±ÛŒ) -->
        <div class="test-row">
            <div class="test-title">âœ… ØªØ³Øª Û³: Ø¨Ø±Ø±Ø³ÛŒ Immutability <span class="success-badge" id="badge3">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">Ø´ÛŒØ¡ Ø¨Ø±Ú¯Ø´ØªÛŒ Ø§Ø² getState Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø§ ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ…ØŒ state Ø§ØµÙ„ÛŒ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯.</div>
            <button id="test3Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û³</button>
        </div>

        <!-- ØªØ³Øª Û´: Ù„Ø§ÛŒÙ‡ Ø¹Ù…ÛŒÙ‚ (deep object) -->
        <div class="test-row">
            <div class="test-title">âœ… ØªØ³Øª Û´: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø¨Ø¬Ú©Øª ØªÙˆ Ø¯Ø± ØªÙˆ <span class="success-badge" id="badge4">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">ØªØºÛŒÛŒØ± ÛŒÚ© ÙÛŒÙ„Ø¯ Ø¯Ø± Ø¹Ù…Ù‚ Ø¢Ø¨Ø¬Ú©ØªØŒ Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø¨Ø± Ø¨Ù‚ÛŒÙ‡ Ø³Ø§Ø®ØªØ§Ø±.</div>
            <button id="test4Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û´</button>
        </div>

        <!-- ØªØ³Øª Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø±Ø§ÛŒÙ‡ (push Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ…) -->
        <div class="test-row">
            <div class="test-title">âœ… ØªØ³Øª Ûµ: Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ (immutable) <span class="success-badge" id="badge5">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ… Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… Ø¢Ø±Ø§ÛŒÙ‡ Ø§ØµÙ„ÛŒ.</div>
            <button id="test5Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ûµ</button>
        </div>

        <!-- ØªØ³Øª Û¶: Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± (undefined) -->
        <div class="test-row">
            <div class="test-title">âš  ØªØ³Øª Û¶: Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± (undefined) <span class="fail-badge" id="badge6">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ set Ú©Ø±Ø¯Ù† undefined Ø¨Ø§ÛŒØ¯ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´ÙˆØ¯ ÛŒØ§ Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯.</div>
            <button id="test6Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û¶</button>
        </div>

        <!-- ØªØ³Øª Û·: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ -->
        <div class="test-row">
            <div class="test-title">ğŸ”„ ØªØ³Øª Û·: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ initialState <span class="success-badge" id="badge7">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§</span></div>
            <div class="test-desc">Ù¾Ø³ Ø§Ø² ØªØºÛŒÛŒØ±Ø§ØªØŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ resetState Ø¨Ø§ÛŒØ¯ state Ø±Ø§ Ø¨Ù‡ initialState Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯.</div>
            <button id="test7Btn" class="secondary">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û·</button>
        </div>
    </div>

    <hr>

    <div class="footer-note">
        ğŸ”¬ Ø§ÛŒÙ† ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ùˆ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ù‡Ø± ØªØ³Øª Ø¨Ø§ÛŒØ¯ Ù†ØªÛŒØ¬Ù‡ Ø³Ø¨Ø² (Ù…ÙˆÙÙ‚) ÛŒØ§ Ù‚Ø±Ù…Ø² (Ù†Ø§Ù…ÙˆÙÙ‚) Ø±Ø§ Ù†Ø´Ø§Ù† Ø¯Ù‡Ø¯.
    </div>
</div>

<script>
    // ---------- State Manager Ø³Ø§Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ ØªØ³Øª) ----------
    class StateManager {
        constructor(initialState = {}) {
            this._state = this._deepClone(initialState);
            this._initialState = this._deepClone(initialState);
            this._listeners = [];
        }

        // Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ immutable
        _deepClone(obj) {
            if (obj === null || typeof obj !== 'object') return obj;
            if (Array.isArray(obj)) {
                return obj.map(item => this._deepClone(item));
            }
            const cloned = {};
            for (const key in obj) {
                if (Object.prototype.hasOwnProperty.call(obj, key)) {
                    cloned[key] = this._deepClone(obj[key]);
                }
            }
            return cloned;
        }

        getState() {
            return this._deepClone(this._state);
        }

        setState(newState) {
            if (!newState || typeof newState !== 'object') {
                console.warn('setState: Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø±');
                return false;
            }
            // ØªØ±Ú©ÛŒØ¨ Ø¹Ù…ÛŒÙ‚ (merge)
            this._state = this._deepMerge(this._state, newState);
            this._notify();
            return true;
        }

        _deepMerge(target, source) {
            const output = this._deepClone(target);
            for (const key in source) {
                if (Object.prototype.hasOwnProperty.call(source, key)) {
                    if (source[key] !== null && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                        if (!output[key] || typeof output[key] !== 'object') {
                            output[key] = {};
                        }
                        output[key] = this._deepMerge(output[key], source[key]);
                    } else {
                        output[key] = this._deepClone(source[key]);
                    }
                }
            }
            return output;
        }

        resetState() {
            this._state = this._deepClone(this._initialState);
            this._notify();
        }

        subscribe(listener) {
            this._listeners.push(listener);
            return () => {
                this._listeners = this._listeners.filter(l => l !== listener);
            };
        }

        _notify() {
            this._listeners.forEach(listener => listener(this.getState()));
        }
    }

    // ---------- State Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª ----------
    const initialState = {
        user: {
            name: 'Ø¹Ù„ÛŒ',
            level: 1,
            settings: {
                theme: 'light',
                sound: true
            }
        },
        lessons: ['Ø¯Ø±Ø³ Û±', 'Ø¯Ø±Ø³ Û²'],
        progress: {
            completed: 0,
            total: 10
        },
        meta: {
            lastVisit: null
        }
    };

    // ---------- Ø§ÛŒØ¬Ø§Ø¯ instance StateManager ----------
    let stateManager = new StateManager(initialState);
    const logOutput = document.getElementById('output');
    const initStatus = document.getElementById('initStatus');

    // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
    function updateOutput(message, append = false) {
        if (append) {
            logOutput.innerHTML += '\n' + message;
        } else {
            logOutput.innerHTML = message;
        }
        logOutput.scrollTop = logOutput.scrollHeight;
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ badge
    function setBadge(badgeId, status, message = '') {
        const badge = document.getElementById(badgeId);
        if (badge) {
            badge.className = status ? 'success-badge' : 'fail-badge';
            badge.textContent = status ? 'âœ“ Ù…ÙˆÙÙ‚' : (message || 'âœ— Ù†Ø§Ù…ÙˆÙÙ‚');
        }
    }

    // Ù†Ù…Ø§ÛŒØ´ state Ø§ÙˆÙ„ÛŒÙ‡
    function showCurrentState() {
        const state = stateManager.getState();
        updateOutput(JSON.stringify(state, null, 2));
    }

    // ---------- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ ----------
    document.getElementById('initBtn').addEventListener('click', () => {
        stateManager = new StateManager(initialState);
        updateOutput('âœ… State Ø¨Ø§ initialState Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø´Ø¯:\n' + JSON.stringify(stateManager.getState(), null, 2));
        initStatus.innerHTML = 'âœ… State ÙØ¹Ø§Ù„ Ø§Ø³Øª';
    });

    document.getElementById('showStateBtn').addEventListener('click', () => {
        showCurrentState();
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
        stateManager.resetState();
        updateOutput('ğŸ”„ State Ø¨Ù‡ initialState Ø¨Ø§Ø²Ú¯Ø´Øª:\n' + JSON.stringify(stateManager.getState(), null, 2));
        initStatus.innerHTML = 'ğŸ”„ State Ø±ÛŒØ³Øª Ø´Ø¯';
        // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† badgeÙ‡Ø§
        for (let i = 1; i <= 7; i++) {
            const b = document.getElementById(`badge${i}`);
            if (b) {
                b.className = 'success-badge';
                b.textContent = 'Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§';
            }
        }
    });

    // ---------- ØªØ³Øª Û±: set/get Ø³Ø§Ø¯Ù‡ ----------
    document.getElementById('test1Btn').addEventListener('click', () => {
        try {
            const oldState = stateManager.getState();
            stateManager.setState({ user: { name: 'Ù…Ø­Ù…Ø¯' } });
            const newState = stateManager.getState();

            if (newState.user.name === 'Ù…Ø­Ù…Ø¯' && oldState.user.name === 'Ø¹Ù„ÛŒ') {
                updateOutput('âœ… ØªØ³Øª Û± Ù…ÙˆÙÙ‚: Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ "Ù…Ø­Ù…Ø¯" ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.\n' + JSON.stringify(newState, null, 2));
                setBadge('badge1', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û± Ù†Ø§Ù…ÙˆÙÙ‚: Ù…Ù‚Ø¯Ø§Ø± ØªØºÛŒÛŒØ± Ù†Ú©Ø±Ø¯Ù‡ ÛŒØ§ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.');
                setBadge('badge1', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û±: ' + e.message);
            setBadge('badge1', false);
        }
    });

    // ---------- ØªØ³Øª Û²: partial update ----------
    document.getElementById('test2Btn').addEventListener('click', () => {
        try {
            stateManager.setState({ user: { level: 5 } });
            const state = stateManager.getState();
            // Ø¨Ø±Ø±Ø³ÛŒ: name Ù†Ø¨Ø§ÛŒØ¯ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ØŒ level Ø¨Ø§ÛŒØ¯ 5 Ø´ÙˆØ¯
            if (state.user.name === 'Ù…Ø­Ù…Ø¯' && state.user.level === 5 && state.user.settings.theme === 'light') {
                updateOutput('âœ… ØªØ³Øª Û² Ù…ÙˆÙÙ‚: ÙÙ‚Ø· level Ø¨Ù‡ Ûµ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ØŒ Ø¨Ù‚ÛŒÙ‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø³Øªâ€ŒÙ†Ø®ÙˆØ±Ø¯Ù‡:\n' + JSON.stringify(state, null, 2));
                setBadge('badge2', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û² Ù†Ø§Ù…ÙˆÙÙ‚: Ø³Ø§ÛŒØ± ÙÛŒÙ„Ø¯Ù‡Ø§ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ ÛŒØ§ level Ø¯Ø±Ø³Øª ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡.');
                setBadge('badge2', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û²: ' + e.message);
            setBadge('badge2', false);
        }
    });

    // ---------- ØªØ³Øª Û³: Immutability ----------
    document.getElementById('test3Btn').addEventListener('click', () => {
        try {
            const beforeState = stateManager.getState();
            // ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… state Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡
            beforeState.user.name = 'ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ…';
            const afterState = stateManager.getState();

            if (afterState.user.name !== 'ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ…' && afterState.user.name === 'Ù…Ø­Ù…Ø¯') {
                updateOutput('âœ… ØªØ³Øª Û³ Ù…ÙˆÙÙ‚: ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… Ø±ÙˆÛŒ state ØªØ£Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø´Øª. Ù…Ù‚Ø¯Ø§Ø± still Ù…Ø­Ù…Ø¯ Ø§Ø³Øª.');
                setBadge('badge3', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û³ Ù†Ø§Ù…ÙˆÙÙ‚: state Ø§ØµÙ„ÛŒ Ø¨Ø§ ØªØºÛŒÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… ØªØºÛŒÛŒØ± Ú©Ø±Ø¯!');
                setBadge('badge3', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û³: ' + e.message);
            setBadge('badge3', false);
        }
    });

    // ---------- ØªØ³Øª Û´: Ø¢Ø¨Ø¬Ú©Øª ØªÙˆ Ø¯Ø± ØªÙˆ ----------
    document.getElementById('test4Btn').addEventListener('click', () => {
        try {
            stateManager.setState({ user: { settings: { theme: 'dark' } } });
            const state = stateManager.getState();

            if (state.user.settings.theme === 'dark' && state.user.settings.sound === true) {
                updateOutput('âœ… ØªØ³Øª Û´ Ù…ÙˆÙÙ‚: theme Ø¨Ù‡ dark ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ØŒ sound Ø¯Ø³Øªâ€ŒÙ†Ø®ÙˆØ±Ø¯Ù‡:\n' + JSON.stringify(state, null, 2));
                setBadge('badge4', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û´ Ù†Ø§Ù…ÙˆÙÙ‚: sound ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ ÛŒØ§ theme Ø¯Ø±Ø³Øª ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡.');
                setBadge('badge4', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û´: ' + e.message);
            setBadge('badge4', false);
        }
    });

    // ---------- ØªØ³Øª Ûµ: Ø¢Ø±Ø§ÛŒÙ‡ (immutable) ----------
    document.getElementById('test5Btn').addEventListener('click', () => {
        try {
            const beforeState = stateManager.getState();
            stateManager.setState({ lessons: [...beforeState.lessons, 'Ø¯Ø±Ø³ Û³'] });
            const afterState = stateManager.getState();

            if (afterState.lessons.length === 3 && afterState.lessons.includes('Ø¯Ø±Ø³ Û³')) {
                // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ù‚Ø¨Ù„ÛŒ ØªØºÛŒÛŒØ± Ù†Ú©Ø±Ø¯Ù‡ (Ø§ÛŒÙ…ÛŒÙˆØªØ¨Ù„ÛŒØªÛŒ)
                if (beforeState.lessons.length === 2 && !beforeState.lessons.includes('Ø¯Ø±Ø³ Û³')) {
                    updateOutput('âœ… ØªØ³Øª Ûµ Ù…ÙˆÙÙ‚: Ø¢Ø±Ø§ÛŒÙ‡ Ø¬Ø¯ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø¯Ø±Ø³ Û³ Ø§Ø³Øª Ùˆ Ø¢Ø±Ø§ÛŒÙ‡ Ù‚Ø¨Ù„ÛŒ unchanged:\n' + JSON.stringify(afterState, null, 2));
                    setBadge('badge5', true);
                } else {
                    updateOutput('âŒ ØªØ³Øª Ûµ: Ø¢Ø±Ø§ÛŒÙ‡ Ù‚Ø¨Ù„ÛŒ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª!');
                    setBadge('badge5', false);
                }
            } else {
                updateOutput('âŒ ØªØ³Øª Ûµ Ù†Ø§Ù…ÙˆÙÙ‚: Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù†Ú©Ø±Ø¯.');
                setBadge('badge5', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ûµ: ' + e.message);
            setBadge('badge5', false);
        }
    });

    // ---------- ØªØ³Øª Û¶: Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± ----------
    document.getElementById('test6Btn').addEventListener('click', () => {
        try {
            const beforeState = stateManager.getState();
            const result = stateManager.setState(undefined); // undefined
            const afterState = stateManager.getState();

            // Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒÙ… state ØªØºÛŒÛŒØ± Ù†Ú©Ù†Ø¯
            if (!result && JSON.stringify(beforeState) === JSON.stringify(afterState)) {
                updateOutput('âœ… ØªØ³Øª Û¶ Ù…ÙˆÙÙ‚: set Ø¨Ø§ undefined Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯ Ùˆ state unchanged.');
                setBadge('badge6', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û¶ Ù†Ø§Ù…ÙˆÙÙ‚: set Ø¨Ø§ undefined Ø¨Ø§Ø¹Ø« ØªØºÛŒÛŒØ± state Ø´Ø¯.');
                setBadge('badge6', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û¶: ' + e.message);
            setBadge('badge6', false);
        }
    });

    // ---------- ØªØ³Øª Û·: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ initialState ----------
    document.getElementById('test7Btn').addEventListener('click', () => {
        try {
            stateManager.resetState();
            const state = stateManager.getState();

            if (state.user.name === 'Ø¹Ù„ÛŒ' && state.user.level === 1 && state.lessons.length === 2) {
                updateOutput('âœ… ØªØ³Øª Û· Ù…ÙˆÙÙ‚: state Ø¨Ù‡ initialState Ø¨Ø§Ø²Ú¯Ø´Øª:\n' + JSON.stringify(state, null, 2));
                setBadge('badge7', true);
            } else {
                updateOutput('âŒ ØªØ³Øª Û· Ù†Ø§Ù…ÙˆÙÙ‚: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ initialState Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù†Ú©Ø±Ø¯.');
                setBadge('badge7', false);
            }
        } catch (e) {
            updateOutput('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Û·: ' + e.message);
            setBadge('badge7', false);
        }
    });

    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    initStatus.innerHTML = 'âœ… State Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ú©Ù…Ù‡ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.';
    updateOutput('ğŸ‘ˆ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ú©Ù…Ù‡ "Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡" Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.');
</script>
</body>
</html>
