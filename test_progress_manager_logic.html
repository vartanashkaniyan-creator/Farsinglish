<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù…Ù†Ø·Ù‚ Progress Manager - Farsinglish</title>
    <style>
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #553c9a;
            margin-bottom: 30px;
            font-size: 28px;
            border-bottom: 3px solid #f0f0f0;
            padding-bottom: 15px;
        }
        h2 {
            color: #2d3748;
            font-size: 20px;
            margin-top: 25px;
            margin-bottom: 15px;
            padding-right: 10px;
            border-right: 4px solid #667eea;
        }
        .button-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 25px 0;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            border: 1px solid rgba(255,255,255,0.2);
            font-family: 'Vazir', 'Tahoma', sans-serif;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        button.reset {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }
        .test-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-title span {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 14px;
        }
        .test-result {
            background: #edf2f7;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #cbd5e0;
            margin-top: 10px;
        }
        .success { color: #38a169; font-weight: bold; }
        .error { color: #e53e3e; font-weight: bold; }
        .warning { color: #d69e2e; font-weight: bold; }
        .info { color: #3182ce; font-weight: bold; }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #e2e8f0;
            color: #718096;
            font-size: 14px;
        }
        .summary {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #fbbf24;
        }
        .summary h3 {
            color: #92400e;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #fcd34d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª Ù…Ù†Ø·Ù‚ Progress Manager</h1>
        <p style="text-align: center; color: #4a5568; margin-bottom: 30px;">
            ØªØ³Øª Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù¾ÛŒØ´Ø±ÙØªØŒ Ø¯Ø±ØµØ¯ØŒ Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
        </p>

        <div class="button-container">
            <button onclick="runAllTests()">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="resetState()" class="reset">âŸ² Ø±ÛŒØ³Øª Ø­Ø§Ù„Øª</button>
        </div>

        <div id="summary" class="summary">
            <h3>ğŸ“Š Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
            <div id="summaryContent">
                <div class="summary-item">â³ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªØ§ÛŒØ¬ØŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯...</div>
            </div>
        </div>

        <!-- ØªØ³Øªâ€ŒÙ‡Ø§ -->
        <div id="tests">
            <div class="test-card" id="test1">
                <div class="test-title">
                    <span>Û±</span>
                    ØªØ³Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§ÛŒÙ‡
                </div>
                <button onclick="runTest(1)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result1" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test2">
                <div class="test-title">
                    <span>Û²</span>
                    ØªØ³Øª Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ XP
                </div>
                <button onclick="runTest(2)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result2" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test3">
                <div class="test-title">
                    <span>Û³</span>
                    ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                </div>
                <button onclick="runTest(3)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result3" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test4">
                <div class="test-title">
                    <span>Û´</span>
                    ØªØ³Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                </div>
                <button onclick="runTest(4)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result4" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test5">
                <div class="test-title">
                    <span>Ûµ</span>
                    ØªØ³Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ø³Ø® ØºÙ„Ø·
                </div>
                <button onclick="runTest(5)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result5" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test6">
                <div class="test-title">
                    <span>Û¶</span>
                    ØªØ³Øª Ù„Ø¨Ù‡: Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´Ø±ÙØª
                </div>
                <button onclick="runTest(6)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result6" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test7">
                <div class="test-title">
                    <span>Û·</span>
                    ØªØ³Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ streak Ø±ÙˆØ²Ø§Ù†Ù‡
                </div>
                <button onclick="runTest(7)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result7" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>

            <div class="test-card" id="test8">
                <div class="test-title">
                    <span>Û¸</span>
                    ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                </div>
                <button onclick="runTest(8)">Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ³Øª</button>
                <div id="result8" class="test-result">âº Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>
        </div>

        <div class="footer">
            <p>Farsinglish - ØªØ³Øª Ø¯Ø³ØªÛŒ Progress Manager</p>
            <p id="timestamp"></p>
        </div>
    </div>

    <script>
        // Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²: Ú©Ù„Ø§Ø³ ProgressManager (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡)
        class ProgressManager {
            constructor(initialProgress = null) {
                this.progress = initialProgress || {
                    userId: 'test-user',
                    lessons: {},
                    totalXp: 0,
                    level: 1,
                    streak: 0,
                    lastActive: null
                };
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª ÛŒÚ© Ø¯Ø±Ø³
            calculateLessonProgress(lessonId, completedItems, totalItems) {
                if (!lessonId || totalItems <= 0) return 0;
                const percentage = Math.min(100, Math.round((completedItems / totalItems) * 100));
                return percentage;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø¨Ø± Ø§Ø³Ø§Ø³ XP
            calculateLevel(xp) {
                if (xp < 0) return 1;
                return Math.floor(xp / 100) + 1;
            }

            // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³
            saveLessonProgress(lessonId, progressData) {
                if (!lessonId || !progressData) return false;
                this.progress.lessons[lessonId] = {
                    ...progressData,
                    lastUpdated: new Date().toISOString()
                };
                return true;
            }

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³
            loadLessonProgress(lessonId) {
                return this.progress.lessons[lessonId] || null;
            }

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ø³Ø®
            updateAfterAnswer(lessonId, isCorrect, xpGain = 10) {
                if (!lessonId) return false;
                
                const progress = this.loadLessonProgress(lessonId) || {
                    completed: 0,
                    total: 10,
                    correct: 0,
                    wrong: 0
                };

                if (isCorrect) {
                    progress.correct = (progress.correct || 0) + 1;
                    this.progress.totalXp += xpGain;
                } else {
                    progress.wrong = (progress.wrong || 0) + 1;
                }

                progress.completed = (progress.completed || 0) + 1;
                this.saveLessonProgress(lessonId, progress);
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø·Ø­
                this.progress.level = this.calculateLevel(this.progress.totalXp);
                
                return true;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ streak
            updateStreak() {
                const today = new Date().toDateString();
                const lastActive = this.progress.lastActive ? new Date(this.progress.lastActive).toDateString() : null;
                
                if (!lastActive) {
                    this.progress.streak = 1;
                } else if (lastActive === today) {
                    // Ø§Ù…Ø±ÙˆØ² Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡
                    return this.progress.streak;
                } else {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastActive === yesterday.toDateString()) {
                        this.progress.streak++;
                    } else {
                        this.progress.streak = 1;
                    }
                }
                
                this.progress.lastActive = new Date().toISOString();
                return this.progress.streak;
            }

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ
            validateIntegrity() {
                if (!this.progress.userId) return false;
                if (this.progress.totalXp < 0) return false;
                if (this.progress.level !== this.calculateLevel(this.progress.totalXp)) return false;
                return true;
            }

            // Ø±ÛŒØ³Øª state
            reset() {
                this.progress = {
                    userId: 'test-user',
                    lessons: {},
                    totalXp: 0,
                    level: 1,
                    streak: 0,
                    lastActive: null
                };
            }

            // Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
            getState() {
                return JSON.parse(JSON.stringify(this.progress));
            }
        }

        // Ù†Ù…ÙˆÙ†Ù‡ Ø§ØµÙ„ÛŒ
        const progressManager = new ProgressManager();
        const originalState = progressManager.getState();

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            return `[${timestamp}] ${message}`;
        }

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡
        function updateSummary() {
            const state = progressManager.getState();
            const summaryHtml = `
                <div class="summary-item"><span>ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±:</span> <span>${state.userId}</span></div>
                <div class="summary-item"><span>âœ¨ XP Ú©Ù„:</span> <span class="success">${state.totalXp}</span></div>
                <div class="summary-item"><span>ğŸ“Š Ø³Ø·Ø­:</span> <span class="info">${state.level}</span></div>
                <div class="summary-item"><span>ğŸ”¥ Streak:</span> <span class="warning">${state.streak}</span></div>
                <div class="summary-item"><span>ğŸ“š Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØª:</span> <span>${Object.keys(state.lessons).length}</span></div>
            `;
            document.getElementById('summaryContent').innerHTML = summaryHtml;
        }

        // Ø±ÛŒØ³Øª state
        function resetState() {
            progressManager.reset();
            updateSummary();
            for (let i = 1; i <= 8; i++) {
                document.getElementById(`result${i}`).innerHTML = 'âº Ø±ÛŒØ³Øª Ø´Ø¯ - Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªØ³Øª Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯';
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø§Øµ
        function runTest(testId) {
            const resultDiv = document.getElementById(`result${testId}`);
            resultDiv.innerHTML = '';
            
            try {
                let output = '';
                
                switch(testId) {
                    case 1:
                        output = testProgressPercentage();
                        break;
                    case 2:
                        output = testLevelCalculation();
                        break;
                    case 3:
                        output = testSaveLoadProgress();
                        break;
                    case 4:
                        output = testCorrectAnswer();
                        break;
                    case 5:
                        output = testWrongAnswer();
                        break;
                    case 6:
                        output = testNoProgress();
                        break;
                    case 7:
                        output = testStreak();
                        break;
                    case 8:
                        output = testIntegrity();
                        break;
                }
                
                resultDiv.innerHTML = output;
                updateSummary();
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Ø®Ø·Ø§: ${error.message}</span>`;
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
        function runAllTests() {
            resetState();
            for (let i = 1; i <= 8; i++) {
                runTest(i);
            }
        }

        // ØªØ³Øª Û±: Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
        function testProgressPercentage() {
            let result = log('ğŸ§ª ØªØ³Øª Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§ÛŒÙ‡') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const tests = [
                { completed: 5, total: 10, expected: 50 },
                { completed: 0, total: 10, expected: 0 },
                { completed: 10, total: 10, expected: 100 },
                { completed: 3, total: 4, expected: 75 },
                { completed: 1, total: 3, expected: 33 }
            ];
            
            let passed = 0;
            tests.forEach((t, index) => {
                const res = progressManager.calculateLessonProgress('test', t.completed, t.total);
                const status = res === t.expected ? 'âœ“' : 'âœ—';
                if (res === t.expected) passed++;
                
                result += `${status} ØªØ³Øª ${index + 1}: ${t.completed}/${t.total} = ${res}% (expected: ${t.expected}%)`;
                if (res !== t.expected) result += ' â† âŒ';
                result += '\n';
            });
            
            result += 'â”€'.repeat(50) + '\n';
            result += passed === tests.length ? 
                '<span class="success">âœ… Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ØµØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø´ØªÙ†Ø¯</span>' : 
                `<span class="error">âŒ ${tests.length - passed} ØªØ³Øª Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯</span>`;
            
            return result;
        }

        // ØªØ³Øª Û²: Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ
        function testLevelCalculation() {
            let result = log('ğŸ§ª ØªØ³Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø¨Ø± Ø§Ø³Ø§Ø³ XP') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const tests = [
                { xp: 0, expected: 1 },
                { xp: 50, expected: 1 },
                { xp: 100, expected: 2 },
                { xp: 150, expected: 2 },
                { xp: 200, expected: 3 },
                { xp: 999, expected: 10 }
            ];
            
            let passed = 0;
            tests.forEach((t, index) => {
                const res = progressManager.calculateLevel(t.xp);
                const status = res === t.expected ? 'âœ“' : 'âœ—';
                if (res === t.expected) passed++;
                
                result += `${status} ØªØ³Øª ${index + 1}: XP=${t.xp} â†’ Ø³Ø·Ø­ ${res} (expected: ${t.expected})`;
                if (res !== t.expected) result += ' â† âŒ';
                result += '\n';
            });
            
            result += 'â”€'.repeat(50) + '\n';
            result += passed === tests.length ? 
                '<span class="success">âœ… Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø´ØªÙ†Ø¯</span>' : 
                `<span class="error">âŒ ${tests.length - passed} ØªØ³Øª Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯</span>`;
            
            return result;
        }

        // ØªØ³Øª Û³: Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
        function testSaveLoadProgress() {
            let result = log('ğŸ§ª ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØª') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const lessonId = 'lesson-1';
            const progressData = {
                completed: 5,
                total: 10,
                correct: 4,
                wrong: 1
            };
            
            result += 'Û±. Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª...\n';
            const saveResult = progressManager.saveLessonProgress(lessonId, progressData);
            result += saveResult ? 'âœ“ Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙÙ‚' : 'âœ— Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡';
            result += '\n\n';
            
            result += 'Û². Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØª...\n';
            const loaded = progressManager.loadLessonProgress(lessonId);
            if (loaded) {
                result += `âœ“ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚:\n`;
                result += `   - ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡: ${loaded.completed}\n`;
                result += `   - ØµØ­ÛŒØ­: ${loaded.correct}\n`;
                result += `   - ØºÙ„Ø·: ${loaded.wrong}\n`;
            } else {
                result += 'âœ— Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ\n';
            }
            
            result += '\nÛ³. Ø¨Ø±Ø±Ø³ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡...\n';
            const isValid = loaded && 
                           loaded.completed === progressData.completed &&
                           loaded.correct === progressData.correct &&
                           loaded.wrong === progressData.wrong;
            
            result += isValid ? 
                '<span class="success">âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø³Ø§Ù„Ù… Ùˆ ÛŒÚ©Ø³Ø§Ù† Ù‡Ø³ØªÙ†Ø¯</span>' : 
                '<span class="error">âœ— Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…ØºØ§ÛŒØ±Øª Ø¯Ø§Ø±Ù†Ø¯</span>';
            
            return result;
        }

        // ØªØ³Øª Û´: Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
        function testCorrectAnswer() {
            let result = log('ğŸ§ª ØªØ³Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const lessonId = 'lesson-correct';
            const initialXp = progressManager.progress.totalXp;
            
            result += `XP Ø§ÙˆÙ„ÛŒÙ‡: ${initialXp}\n`;
            result += 'Ø§Ø¬Ø±Ø§ÛŒ Û³ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ù…ØªÙˆØ§Ù„ÛŒ...\n';
            
            for (let i = 1; i <= 3; i++) {
                progressManager.updateAfterAnswer(lessonId, true, 10);
                result += `  Ù¾Ø§Ø³Ø® ${i}: XP=${progressManager.progress.totalXp}\n`;
            }
            
            const finalXp = progressManager.progress.totalXp;
            const xpGained = finalXp - initialXp;
            
            result += 'â”€'.repeat(30) + '\n';
            result += `XP Ù†Ù‡Ø§ÛŒÛŒ: ${finalXp}\n`;
            result += `XP Ú©Ø³Ø¨ Ø´Ø¯Ù‡: ${xpGained}\n`;
            
            const expectedXp = 30;
            result += xpGained === expectedXp ? 
                '<span class="success">âœ“ Ø§ÙØ²Ø§ÛŒØ´ XP ØµØ­ÛŒØ­ Ø§Ø³Øª</span>' : 
                `<span class="error">âœ— Ø®Ø·Ø§: Ø§Ù†ØªØ¸Ø§Ø± ${expectedXp} XPØŒ Ø¯Ø±ÛŒØ§ÙØª ${xpGained} XP</span>`;
            
            return result;
        }

        // ØªØ³Øª Ûµ: Ù¾Ø§Ø³Ø® ØºÙ„Ø·
        function testWrongAnswer() {
            let result = log('ğŸ§ª ØªØ³Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ø³Ø® ØºÙ„Ø·') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const lessonId = 'lesson-wrong';
            const initialProgress = progressManager.loadLessonProgress(lessonId) || { wrong: 0 };
            const initialWrong = initialProgress.wrong || 0;
            
            result += `ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø· Ø§ÙˆÙ„ÛŒÙ‡: ${initialWrong}\n`;
            result += 'Ø§Ø¬Ø±Ø§ÛŒ Û² Ù¾Ø§Ø³Ø® ØºÙ„Ø·...\n';
            
            progressManager.updateAfterAnswer(lessonId, false);
            progressManager.updateAfterAnswer(lessonId, false);
            
            const finalProgress = progressManager.loadLessonProgress(lessonId);
            const finalWrong = finalProgress.wrong || 0;
            
            result += `ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø· Ù†Ù‡Ø§ÛŒÛŒ: ${finalWrong}\n`;
            
            const expectedWrong = initialWrong + 2;
            result += finalWrong === expectedWrong ? 
                '<span class="success">âœ“ Ø´Ù…Ø§Ø±Ø´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø· ØµØ­ÛŒØ­ Ø§Ø³Øª</span>' : 
                `<span class="error">âœ— Ø®Ø·Ø§: Ø§Ù†ØªØ¸Ø§Ø± ${expectedWrong} ØºÙ„Ø·ØŒ Ø¯Ø±ÛŒØ§ÙØª ${finalWrong} ØºÙ„Ø·</span>`;
            
            return result;
        }

        // ØªØ³Øª Û¶: Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´Ø±ÙØª
        function testNoProgress() {
            let result = log('ğŸ§ª ØªØ³Øª Ù„Ø¨Ù‡: Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´Ø±ÙØª') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            const nonExistentLesson = 'non-existent-lesson';
            
            result += `Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³ Ø¨Ø§ ID "${nonExistentLesson}" Ú©Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯...\n`;
            const progress = progressManager.loadLessonProgress(nonExistentLesson);
            
            result += progress === null ? 
                '<span class="success">âœ“ null Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯ (Ø±ÙØªØ§Ø± ØµØ­ÛŒØ­)</span>' : 
                `<span class="error">âœ— Ø®Ø·Ø§: Ø§Ù†ØªØ¸Ø§Ø± nullØŒ Ø¯Ø±ÛŒØ§ÙØª ${JSON.stringify(progress)}</span>`;
            
            result += '\n\nÙ…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø³ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯...\n';
            const percentage = progressManager.calculateLessonProgress(nonExistentLesson, 0, 0);
            
            result += percentage === 0 ? 
                '<span class="success">âœ“ Ø¯Ø±ØµØ¯ ØµÙØ± Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯ (Ø±ÙØªØ§Ø± ØµØ­ÛŒØ­)</span>' : 
                `<span class="error">âœ— Ø®Ø·Ø§: Ø§Ù†ØªØ¸Ø§Ø± 0ØŒ Ø¯Ø±ÛŒØ§ÙØª ${percentage}</span>`;
            
            return result;
        }

        // ØªØ³Øª Û·: Streak Ø±ÙˆØ²Ø§Ù†Ù‡
        function testStreak() {
            let result = log('ğŸ§ª ØªØ³Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Streak Ø±ÙˆØ²Ø§Ù†Ù‡') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ streak
            result += 'Ø±ÙˆØ² Ø§ÙˆÙ„: ÙØ¹Ø§Ù„ÛŒØª\n';
            progressManager.updateStreak();
            result += `Streak: ${progressManager.progress.streak}\n`;
            
            // ØªÙ‚Ù„Ø¨: ØªØºÛŒÛŒØ± lastActive Ø¨Ù‡ Ø¯ÛŒØ±ÙˆØ²
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            progressManager.progress.lastActive = yesterday.toISOString();
            
            result += '\nØ±ÙˆØ² Ø¯ÙˆÙ… (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡): ÙØ¹Ø§Ù„ÛŒØª\n';
            progressManager.updateStreak();
            result += `Streak: ${progressManager.progress.streak}\n`;
            
            // ØªÙ‚Ù„Ø¨: ØªØºÛŒÛŒØ± Ø¨Ù‡ Û³ Ø±ÙˆØ² Ù‚Ø¨Ù„
            const threeDaysAgo = new Date();
            threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
            progressManager.progress.lastActive = threeDaysAgo.toISOString();
            
            result += '\nÙØ¹Ø§Ù„ÛŒØª Ø¨Ø¹Ø¯ Ø§Ø² Û³ Ø±ÙˆØ² ÙˆÙ‚ÙÙ‡:\n';
            progressManager.updateStreak();
            result += `Streak: ${progressManager.progress.streak} (Ø¨Ø§ÛŒØ¯ Ø±ÛŒØ³Øª Ø´ÙˆØ¯ Ø¨Ù‡ Û±)\n`;
            
            const finalStreak = progressManager.progress.streak;
            result += finalStreak === 1 ? 
                '<span class="success">âœ“ Streak Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø±ÛŒØ³Øª Ø´Ø¯</span>' : 
                `<span class="error">âœ— Ø®Ø·Ø§: Streak Ø¨Ø§ÛŒØ¯ Û± Ø¨Ø§Ø´Ø¯ØŒ ÙˆÙ„ÛŒ ${finalStreak} Ø§Ø³Øª</span>`;
            
            return result;
        }

        // ØªØ³Øª Û¸: ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡
        function testIntegrity() {
            let result = log('ğŸ§ª ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§') + '\n';
            result += 'â”€'.repeat(50) + '\n';
            
            result += 'ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ:\n';
            const state = progressManager.getState();
            result += `- userId: ${state.userId}\n`;
            result += `- totalXp: ${state.totalXp}\n`;
            result += `- level: ${state.level}\n`;
            result += `- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø§Ø² Ø±ÙˆÛŒ XP: ${progressManager.calculateLevel(state.totalXp)}\n`;
            
            const isValid = progressManager.validateIntegrity();
            
            result += 'â”€'.repeat(30) + '\n';
            result += isValid ? 
                '<span class="success">âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ùˆ Ø³Ø§Ù„Ù… Ù‡Ø³ØªÙ†Ø¯</span>' : 
                '<span class="error">âŒ Ù…Ø´Ú©Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</span>';
            
            // ØªØ³Øª Ø®Ø±Ø§Ø¨ Ú©Ø±Ø¯Ù† Ø¹Ù…Ø¯ÛŒ
            result += '\n\nğŸ§ª ØªØ³Øª ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø®Ø±Ø§Ø¨:\n';
            progressManager.progress.level = 100; // Ø³Ø·Ø­ ØºÛŒØ±Ù…Ù†Ø·Ù‚ÛŒ
            const shouldBeFalse = progressManager.validateIntegrity();
            
            result += shouldBeFalse ? 
                '<span class="error">âœ— Ø³ÛŒØ³ØªÙ… Ø®Ø±Ø§Ø¨ÛŒ Ø±Ø§ ØªØ´Ø®ÛŒØµ Ù†Ø¯Ø§Ø¯</span>' : 
                '<span class="success">âœ“ Ø®Ø±Ø§Ø¨ÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯</span>';
            
            // Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„
            progressManager.progress.level = progressManager.calculateLevel(progressManager.progress.totalXp);
            
            return result;
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.getElementById('timestamp').innerHTML = `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${new Date().toLocaleString('fa-IR')}`;
        updateSummary();
    </script>
</body>
</html>
