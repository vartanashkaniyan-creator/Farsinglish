
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù„Ø¨Ù‡ ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ - Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡</title>
    <style>
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            padding: 24px;
        }
        h1 {
            font-size: 1.5rem;
            margin-top: 0;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 12px;
        }
        .test-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .test-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .test-title::before {
            content: "ğŸ§ª";
            font-size: 1.2rem;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            background: #e2e8f0;
            color: #1e293b;
            border: none;
            padding: 10px 18px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #cbd5e1;
            font-family: inherit;
        }
        button:hover {
            background: #cbd5e1;
            transform: translateY(-1px);
        }
        .console {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 2px solid #334155;
        }
        .badge {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            display: inline-block;
            margin-left: 8px;
        }
        .note {
            background: #fff3cd;
            border-right: 4px solid #ffc107;
            padding: 12px;
            font-size: 0.9rem;
            margin: 16px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“ ØªØ³Øª Ù„Ø¨Ù‡ ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</h1>
    <div class="note">
        <strong>âœ… Ù…Ø´Ú©Ù„ Ø¨Ø±Ø·Ø±Ù Ø´Ø¯:</strong> ØªÙˆØ§Ø¨Ø¹ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ù…ØªØµÙ„ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªÛŒØ¬Ù‡ØŒ Ø±ÙˆÛŒ Ù‡Ø± Ø¯Ú©Ù…Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ§ª Û³. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¹ Ùˆ Ù‚Ø§Ù„Ø¨ (Type & Pattern)</div>
        <div class="button-group">
            <button onclick="testEmailInvalid()">Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
            <button onclick="testPasswordWeak()">Ø±Ù…Ø² Ø¶Ø¹ÛŒÙ</button>
            <button onclick="testNumberOutOfRange()">Ø¹Ø¯Ø¯ Ø®Ø§Ø±Ø¬ Ù…Ø­Ø¯ÙˆØ¯Ù‡</button>
        </div>

        <div class="test-title">ğŸ§ª Û´. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡</div>
        <div class="button-group">
            <button onclick="testSpecialChars()">Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ</button>
            <button onclick="testUnicodeRTL()">ÛŒÙˆÙ†ÛŒÚ©Ø¯ Ùˆ RTL</button>
            <button onclick="testInjectionAttempt()">ØªÙ„Ø§Ø´ ØªØ²Ø±ÛŒÙ‚</button>
        </div>

        <div class="test-title">ğŸ§ª Ûµ. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ (Interaction)</div>
        <div class="button-group">
            <button onclick="testMultipleErrors()">Ú†Ù†Ø¯ Ø®Ø·Ø§ Ù‡Ù…Ø²Ù…Ø§Ù†</button>
            <button onclick="testValidAfterFix()">Ø§ØµÙ„Ø§Ø­ Ù¾Ø³ Ø§Ø² Ø®Ø·Ø§</button>
            <button onclick="runAllEdgeTests()" style="background:#3b82f6; color:white;">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="clearConsole()">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù†Ø³ÙˆÙ„</button>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ“Ÿ Ú©Ù†Ø³ÙˆÙ„ Ø®Ø±ÙˆØ¬ÛŒ</div>
        <div id="virtualConsole" class="console">
âœ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø¨Ù‡<br>Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
        </div>
    </div>
</div>

<script>
    // ---------- Ù…Ø§Ú˜ÙˆÙ„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ ----------
    const FormInput = {
        validateInput: (value, type = 'text', options = {}) => {
            if (value === null || value === undefined) {
                return { isValid: false, error: 'ÙˆØ±ÙˆØ¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯', sanitized: null };
            }

            const stringValue = String(value);

            if (stringValue.trim() === '') {
                return { isValid: false, error: 'ÙˆØ±ÙˆØ¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÙÙ‚Ø· ÙØ§ØµÙ„Ù‡ Ø¨Ø§Ø´Ø¯', sanitized: '' };
            }

            switch(type) {
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(stringValue)) {
                        return { isValid: false, error: 'Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', sanitized: stringValue };
                    }
                    return { isValid: true, error: null, sanitized: stringValue.toLowerCase() };

                case 'password':
                    if (options.minLength && stringValue.length < options.minLength) {
                        return { isValid: false, error: `Ø±Ù…Ø² Ø­Ø¯Ø§Ù‚Ù„ ${options.minLength} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§ÛŒØ¯ Ø¨Ø§Ø´Ø¯`, sanitized: stringValue };
                    }
                    return { isValid: true, error: null, sanitized: stringValue };

                case 'number':
                    const num = Number(stringValue);
                    if (isNaN(num)) {
                        return { isValid: false, error: 'Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', sanitized: stringValue };
                    }
                    if (options.min !== undefined && num < options.min) {
                        return { isValid: false, error: `Ø¹Ø¯Ø¯ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ${options.min} Ø¨Ø§Ø´Ø¯`, sanitized: stringValue };
                    }
                    if (options.max !== undefined && num > options.max) {
                        return { isValid: false, error: `Ø¹Ø¯Ø¯ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ú©Ø«Ø± ${options.max} Ø¨Ø§Ø´Ø¯`, sanitized: stringValue };
                    }
                    return { isValid: true, error: null, sanitized: num };

                default: // text
                    if (options.minLength && stringValue.length < options.minLength) {
                        return { isValid: false, error: `Ø­Ø¯Ø§Ù‚Ù„ ${options.minLength} Ú©Ø§Ø±Ø§Ú©ØªØ± Ù†ÛŒØ§Ø² Ø§Ø³Øª`, sanitized: stringValue };
                    }
                    if (options.maxLength && stringValue.length > options.maxLength) {
                        return { isValid: false, error: `Ø­Ø¯Ø§Ú©Ø«Ø± ${options.maxLength} Ú©Ø§Ø±Ø§Ú©ØªØ± Ù…Ø¬Ø§Ø² Ø§Ø³Øª`, sanitized: stringValue };
                    }
                    if (options.pattern && !new RegExp(options.pattern).test(stringValue)) {
                        return { isValid: false, error: 'ÙØ±Ù…Øª ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', sanitized: stringValue };
                    }
                    return { isValid: true, error: null, sanitized: stringValue };
            }
        }
    };

    // ---------- ØªØ§Ø¨Ø¹ Ù„Ø§Ú¯ ----------
    function log(message, type = 'info') {
        const consoleDiv = document.getElementById('virtualConsole');
        const timestamp = new Date().toLocaleTimeString('fa-IR');
        let prefix = '';
        
        switch(type) {
            case 'success': prefix = 'âœ…'; break;
            case 'error': prefix = 'âŒ'; break;
            case 'warning': prefix = 'âš ï¸'; break;
            default: prefix = 'ğŸ“Œ';
        }
        
        consoleDiv.innerHTML += `\n${prefix} [${timestamp}] ${message}`;
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    function clearConsole() {
        document.getElementById('virtualConsole').innerHTML = 'âœ… Ú©Ù†Ø³ÙˆÙ„ Ù¾Ø§Ú© Ø´Ø¯.';
        log('Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ Ù¾Ø§Ú© Ø´Ø¯');
    }

    // ---------- ØªÙˆØ§Ø¨Ø¹ ØªØ³Øª ----------
    function testEmailInvalid() {
        log('ğŸ§ª ØªØ³Øª: Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±', 'info');
        const results = [
            FormInput.validateInput('user@', 'email'),
            FormInput.validateInput('@domain.com', 'email'),
            FormInput.validateInput('user.domain.com', 'email')
        ];
        if (results.every(r => !r.isValid)) {
            log('âœ“ Ù‡Ù…Ù‡ Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø±Ø¯ Ø´Ø¯Ù†Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ø¨Ø±Ø®ÛŒ Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù‚Ø¨ÙˆÙ„ Ø´Ø¯Ù†Ø¯', 'error');
        }
    }

    function testPasswordWeak() {
        log('ğŸ§ª ØªØ³Øª: Ø±Ù…Ø² Ø¶Ø¹ÛŒÙ', 'info');
        const result = FormInput.validateInput('pass', 'password', { minLength: 8 });
        if (!result.isValid && result.error.includes('Ø­Ø¯Ø§Ù‚Ù„ 8')) {
            log('âœ“ Ø±Ù…Ø² Ø¶Ø¹ÛŒÙ Ø±Ø¯ Ø´Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ø±Ù…Ø² Ø¶Ø¹ÛŒÙ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ Ø´ÙˆØ¯', 'error');
        }
    }

    function testNumberOutOfRange() {
        log('ğŸ§ª ØªØ³Øª: Ø¹Ø¯Ø¯ Ø®Ø§Ø±Ø¬ Ù…Ø­Ø¯ÙˆØ¯Ù‡', 'info');
        const resultLow = FormInput.validateInput('5', 'number', { min: 10 });
        const resultHigh = FormInput.validateInput('20', 'number', { max: 15 });
        
        if (!resultLow.isValid && !resultHigh.isValid) {
            log('âœ“ Ø§Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ø±Ø¬ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø±Ø¯ Ø´Ø¯Ù†Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ø§Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ø±Ø¬ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ Ø´ÙˆÙ†Ø¯', 'error');
        }
    }

    function testSpecialChars() {
        log('ğŸ§ª ØªØ³Øª: Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ', 'info');
        const result = FormInput.validateInput('!@#$%^&*()', 'text');
        if (result.isValid) {
            log('âœ“ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ Ù‚Ø¨ÙˆÙ„ Ø´Ø¯Ù†Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ Ø¨Ø§ÛŒØ¯ Ù‚Ø¨ÙˆÙ„ Ø´ÙˆÙ†Ø¯', 'error');
        }
    }

    function testUnicodeRTL() {
        log('ğŸ§ª ØªØ³Øª: ÛŒÙˆÙ†ÛŒÚ©Ø¯ Ùˆ ÙØ§Ø±Ø³ÛŒ', 'info');
        const result = FormInput.validateInput('Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§', 'text');
        if (result.isValid && result.sanitized === 'Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§') {
            log('âœ“ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù‚Ø¨ÙˆÙ„ Ø´Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ÛŒØ¯ Ù‚Ø¨ÙˆÙ„ Ø´ÙˆØ¯', 'error');
        }
    }

    function testInjectionAttempt() {
        log('ğŸ§ª ØªØ³Øª: ØªÙ„Ø§Ø´ ØªØ²Ø±ÛŒÙ‚ XSS', 'info');
        const result = FormInput.validateInput('<script>alert(1)</script>', 'text');
        if (result.isValid) {
            log('âš ï¸ ÙˆØ±ÙˆØ¯ÛŒ Ø´Ø§Ù…Ù„ ØªÚ¯ Ù‚Ø¨ÙˆÙ„ Ø´Ø¯ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø§Ù†ÛŒØªØ§ÛŒØ² Ø¯Ø± Ø³Ø·Ø­ Ø¨Ø§Ù„Ø§ØªØ±)', 'warning');
        } else {
            log('âœ“ ÙˆØ±ÙˆØ¯ÛŒ Ø®Ø·Ø±Ù†Ø§Ú© Ø±Ø¯ Ø´Ø¯', 'success');
        }
    }

    function testMultipleErrors() {
        log('ğŸ§ª ØªØ³Øª: Ú†Ù†Ø¯ Ø®Ø·Ø§ Ù‡Ù…Ø²Ù…Ø§Ù†', 'info');
        const result = FormInput.validateInput('a', 'text', { minLength: 3, maxLength: 10, pattern: '^[A-Z]+$' });
        if (!result.isValid && result.error.includes('Ø­Ø¯Ø§Ù‚Ù„ 3')) {
            log('âœ“ Ø®Ø·Ø§ÛŒ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¯Ø§Ø± (minLength) Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ÛŒ minLength Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø´Øª', 'error');
        }
    }

    function testValidAfterFix() {
        log('ğŸ§ª ØªØ³Øª: Ø§ØµÙ„Ø§Ø­ Ù¾Ø³ Ø§Ø² Ø®Ø·Ø§', 'info');
        const invalidResult = FormInput.validateInput('a', 'text', { minLength: 2 });
        const validResult = FormInput.validateInput('ab', 'text', { minLength: 2 });
        
        if (!invalidResult.isValid && validResult.isValid) {
            log('âœ“ Ø±ÙØªØ§Ø± ØµØ­ÛŒØ­: ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± â†’ Ù…Ø¹ØªØ¨Ø±', 'success');
        } else {
            log('âœ— Ø®Ø·Ø§: Ø²Ù†Ø¬ÛŒØ±Ù‡ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯', 'error');
        }
    }

    function runAllEdgeTests() {
        log('ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø¨Ù‡...', 'info');
        testEmailInvalid();
        testPasswordWeak();
        testNumberOutOfRange();
        testSpecialChars();
        testUnicodeRTL();
        testInjectionAttempt();
        testMultipleErrors();
        testValidAfterFix();
        log('ğŸ Ù¾Ø§ÛŒØ§Ù† Ù…Ø¬Ù…ÙˆØ¹Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø¨Ù‡', 'success');
    }

    // Ù„Ø§Ú¯ Ø§ÙˆÙ„ÛŒÙ‡
    log('âœ… ÙØ§ÛŒÙ„ ØªØ³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
</script>
</body>
</html>
