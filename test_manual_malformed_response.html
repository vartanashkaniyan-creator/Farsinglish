<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ: Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø¨ (Malformed Response) - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .test-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .button-group { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        button { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 15px; cursor: pointer; flex: 1 1 auto; min-width: 150px; }
        button:hover { opacity: 0.9; }
        .result { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; direction: ltr; font-family: monospace; white-space: pre-wrap; }
        .success { border-right: 5px solid #27ae60; }
        .fail { border-right: 5px solid #e74c3c; }
        .info { background: #e1f5fe; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .progress { background: #34495e; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .status-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin: 5px; }
        .passed { background: #27ae60; color: white; }
        .failed { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“¡ Farsinglish - ØªØ³Øª Ø¯Ø³ØªÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø¨</h1>
        <h2>Malformed Response Handler</h2>
        <p>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø³Ø±ÙˆØ±</p>
    </div>

    <div class="test-card">
        <h3>ğŸ›¡ï¸ Û±. JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Invalid JSON)</h3>
        <div class="info">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ø¨Ø§ JSON Ø®Ø±Ø§Ø¨ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ÛŒ Parsing</div>
        <div class="button-group">
            <button onclick="testMalformedJSON()">ğŸ§ª ØªØ³Øª JSON Ø®Ø±Ø§Ø¨</button>
            <button onclick="testEmptyJSON()">ğŸ“­ ØªØ³Øª JSON Ø®Ø§Ù„ÛŒ</button>
            <button onclick="testPartialJSON()">ğŸ”§ ØªØ³Øª JSON Ù†Ø§Ù‚Øµ</button>
        </div>
        <div id="result-json" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ”£ Û². Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Invalid Data Type)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ø¨Ø§ Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù…ØªÙØ§ÙˆØª Ø§Ø²é¢„æœŸ</div>
        <div class="button-group">
            <button onclick="testStringInsteadOfObject()">ğŸ“ Ø±Ø´ØªÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
            <button onclick="testArrayInsteadOfObject()">ğŸ“š Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
            <button onclick="testNullInsteadOfObject()">â­• null Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
        </div>
        <div id="result-type" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ” Û³. ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú¯Ù…Ø´Ø¯Ù‡ (Missing Fields)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ø¨Ø§ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù‚Øµ</div>
        <div class="button-group">
            <button onclick="testMissingId()">ğŸ†” Ú¯Ù… Ø´Ø¯Ù† ID</button>
            <button onclick="testMissingTitle()">ğŸ“Œ Ú¯Ù… Ø´Ø¯Ù† Ø¹Ù†ÙˆØ§Ù†</button>
            <button onclick="testMissingAll()">âŒ Ú¯Ù… Ø´Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§</button>
        </div>
        <div id="result-missing" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>âš ï¸ Û´. Ø®Ø·Ø§Ù‡Ø§ÛŒ Encoding</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø² Ùˆ Encoding Ø§Ø´ØªØ¨Ø§Ù‡</div>
        <div class="button-group">
            <button onclick="testInvalidUnicode()">ğŸŒ Unicode Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
            <button onclick="testControlChars()">âŒ¨ï¸ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ</button>
            <button onclick="testWrongEncoding()">ğŸ”„ Encoding Ø§Ø´ØªØ¨Ø§Ù‡</button>
        </div>
        <div id="result-encoding" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ”„ Ûµ. Ø³Ø§Ø®ØªØ§Ø± ØªÙˆ Ø¯Ø± ØªÙˆ (Nested Structure)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ ØªÙˆ Ø¯Ø± ØªÙˆ</div>
        <div class="button-group">
            <button onclick="testNestedMalformed()">ğŸ“¦ nested Ø®Ø±Ø§Ø¨</button>
            <button onclick="testDeepNestedMissing()">ğŸ”¬ nested Ø¹Ù…ÛŒÙ‚ Ù†Ø§Ù‚Øµ</button>
            <button onclick="testCircularJSON()">ğŸ”„ JSON Ø­Ù„Ù‚ÙˆÛŒ</button>
        </div>
        <div id="result-nested" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ“Š Û¶. Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
        <div class="progress" id="summary">
            <p>âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: Û°</p>
            <p>âŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: Û°</p>
            <p>ğŸ“‹ Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§: Û°</p>
        </div>
        <button onclick="resetSummary()">ğŸ”„ Ø±ÛŒØ³Øª Ø®Ù„Ø§ØµÙ‡</button>
    </div>

    <script>
        // -------------------- Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ --------------------
        let testResults = {
            json: { passed: 0, failed: 0 },
            type: { passed: 0, failed: 0 },
            missing: { passed: 0, failed: 0 },
            encoding: { passed: 0, failed: 0 },
            nested: { passed: 0, failed: 0 }
        };

        function updateSummary() {
            const total = Object.values(testResults).reduce((acc, curr) => {
                return acc + curr.passed + curr.failed;
            }, 0);
            
            const passed = Object.values(testResults).reduce((acc, curr) => acc + curr.passed, 0);
            const failed = Object.values(testResults).reduce((acc, curr) => acc + curr.failed, 0);

            document.getElementById('summary').innerHTML = `
                <p>âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: ${passed}</p>
                <p>âŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed}</p>
                <p>ğŸ“‹ Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§: ${total}</p>
                <p>ğŸ“Š Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª: ${total ? Math.round(passed/total*100) : 0}%</p>
            `;
        }

        function addResult(category, passed, description) {
            if (passed) {
                testResults[category].passed++;
            } else {
                testResults[category].failed++;
            }
            updateSummary();
        }

        function resetSummary() {
            testResults = {
                json: { passed: 0, failed: 0 },
                type: { passed: 0, failed: 0 },
                missing: { passed: 0, failed: 0 },
                encoding: { passed: 0, failed: 0 },
                nested: { passed: 0, failed: 0 }
            };
            updateSummary();
        }

        // -------------------- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ --------------------
        async function safeJSONParse(str, elementId, description, category) {
            const resultDiv = document.getElementById(elementId);
            try {
                const data = JSON.parse(str);
                resultDiv.innerHTML = `âœ… JSON Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult(category, true, description);
                return data;
            } catch (error) {
                resultDiv.innerHTML = `âŒ Ø®Ø·Ø§ÛŒ Parsing:\n${error.message}\n\nğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ:\n${str}`;
                resultDiv.className = "result fail";
                addResult(category, false, description);
                return null;
            }
        }

        function validateLessonStructure(data, elementId, description, category) {
            const resultDiv = document.getElementById(elementId);
            let passed = true;
            let errors = [];

            if (!data || typeof data !== 'object') {
                passed = false;
                errors.push('Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø¢Ø¨Ø¬Ú©Øª Ø¨Ø§Ø´Ø¯');
            } else {
                if (!data.id) { passed = false; errors.push('ÙÛŒÙ„Ø¯ id ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
                if (!data.title) { passed = false; errors.push('ÙÛŒÙ„Ø¯ title ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
                if (!data.level) { passed = false; errors.push('ÙÛŒÙ„Ø¯ level ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
            }

            if (passed) {
                resultDiv.innerHTML = `âœ… Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø³ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult(category, true, description);
            } else {
                resultDiv.innerHTML = `âŒ Ø³Ø§Ø®ØªØ§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø±:\n${errors.join('\n')}\n\nğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result fail";
                addResult(category, false, description);
            }
        }

        // -------------------- Û±. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± --------------------
        function testMalformedJSON() {
            const malformedJSON = '{ "id": 1, "title": "Ø¯Ø±Ø³ Û±", "level": "Ù…Ø¨ØªØ¯ÛŒ", }'; // Ú©Ø§Ù…Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            safeJSONParse(malformedJSON, 'result-json', 'JSON Ø®Ø±Ø§Ø¨', 'json');
        }

        function testEmptyJSON() {
            safeJSONParse('', 'result-json', 'JSON Ø®Ø§Ù„ÛŒ', 'json');
        }

        function testPartialJSON() {
            const partialJSON = '{ "id": 1, "title": "Ø¯Ø±Ø³ Û±"';
            safeJSONParse(partialJSON, 'result-json', 'JSON Ù†Ø§Ù‚Øµ', 'json');
        }

        // -------------------- Û². ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± --------------------
        function testStringInsteadOfObject() {
            const response = '"Ø§ÛŒÙ† ÛŒÚ© Ø±Ø´ØªÙ‡ Ø§Ø³Øª Ù†Ù‡ Ø¢Ø¨Ø¬Ú©Øª"';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'Ø±Ø´ØªÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        function testArrayInsteadOfObject() {
            const response = '[{"id":1,"title":"Ø¯Ø±Ø³ Û±"}]';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        function testNullInsteadOfObject() {
            const response = 'null';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'null Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        // -------------------- Û³. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú¯Ù…Ø´Ø¯Ù‡ --------------------
        function testMissingId() {
            const response = '{"title": "Ø¯Ø±Ø³ Û±", "level": "Ù…Ø¨ØªØ¯ÛŒ"}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† ID', 'missing');
        }

        function testMissingTitle() {
            const response = '{"id": 1, "level": "Ù…Ø¨ØªØ¯ÛŒ"}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† Ø¹Ù†ÙˆØ§Ù†', 'missing');
        }

        function testMissingAll() {
            const response = '{}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§', 'missing');
        }

        // -------------------- Û´. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Encoding --------------------
        function testInvalidUnicode() {
            const invalidUnicode = '{ "id": 1, "title": "\uD800\uD800\uD800" }'; // Ø³ÙˆØ±ÙˆÚ¯ÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø±
            safeJSONParse(invalidUnicode, 'result-encoding', 'Unicode Ù†Ø§Ù…Ø¹ØªØ¨Ø±', 'encoding');
        }

        function testControlChars() {
            const controlChars = '{ "id": 1, "title": "Ø¯Ø±Ø³\u0000ÛŒÚ©" }'; // Ú©Ø§Ø±Ø§Ú©ØªØ± null
            safeJSONParse(controlChars, 'result-encoding', 'Ú©Ø§Ø±Ø§Ú©ØªØ± Ú©Ù†ØªØ±Ù„ÛŒ', 'encoding');
        }

        function testWrongEncoding() {
            const wrongEncoding = '{ "id": 1, "title": "ï¿½ï¿½ï¿½ï¿½" }'; // Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø±Ø§Ø¨
            safeJSONParse(wrongEncoding, 'result-encoding', 'Encoding Ø§Ø´ØªØ¨Ø§Ù‡', 'encoding');
        }

        // -------------------- Ûµ. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªØ§Ø± ØªÙˆ Ø¯Ø± ØªÙˆ --------------------
        function testNestedMalformed() {
            const nested = '{ "id": 1, "metadata": { "created": "2026-02-13", "tags": ["Ú¯Ø±Ø§Ù…Ø±",] } }'; // Ú©Ø§Ù…Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            safeJSONParse(nested, 'result-nested', 'nested Ø®Ø±Ø§Ø¨', 'nested');
        }

        function testDeepNestedMissing() {
            const deepNested = '{ "id": 1, "metadata": { "created": "2026-02-13" } }'; // ÙÛŒÙ„Ø¯ tags Ú¯Ù… Ø´Ø¯Ù‡
            const data = JSON.parse(deepNested);
            
            const resultDiv = document.getElementById('result-nested');
            if (data.metadata && data.metadata.tags) {
                resultDiv.innerHTML = `âœ… Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù„ Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult('nested', true, 'nested Ø¹Ù…ÛŒÙ‚');
            } else {
                resultDiv.innerHTML = `âŒ ÙÛŒÙ„Ø¯ metadata.tags ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result fail";
                addResult('nested', false, 'nested Ø¹Ù…ÛŒÙ‚');
            }
        }

        function testCircularJSON() {
            const circular = '{"id":1,"self":null}';
            try {
                const data = JSON.parse(circular);
                data.self = data; // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø±Ø¬Ø§Ø¹ Ø­Ù„Ù‚ÙˆÛŒ
                const resultDiv = document.getElementById('result-nested');
                
                // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ JSON.stringify Ø¯ÙˆØ¨Ø§Ø±Ù‡
                JSON.stringify(data);
                resultDiv.innerHTML = `âš ï¸ JSON Ø­Ù„Ù‚ÙˆÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯ (Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…Ø´Ú©Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ø¯)`;
                resultDiv.className = "result fail";
                addResult('nested', false, 'JSON Ø­Ù„Ù‚ÙˆÛŒ');
            } catch (error) {
                const resultDiv = document.getElementById('result-nested');
                resultDiv.innerHTML = `âœ… Ø®Ø·Ø§ÛŒ JSON Ø­Ù„Ù‚ÙˆÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯:\n${error.message}`;
                resultDiv.className = "result success";
                addResult('nested', true, 'JSON Ø­Ù„Ù‚ÙˆÛŒ');
            }
        }

        // -------------------- Ø±ÛŒØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ --------------------
        window.onload = function() {
            resetSummary();
        };
    </script>
</body>
</html><!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ: Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø¨ (Malformed Response) - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .test-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .button-group { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        button { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 15px; cursor: pointer; flex: 1 1 auto; min-width: 150px; }
        button:hover { opacity: 0.9; }
        .result { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; direction: ltr; font-family: monospace; white-space: pre-wrap; }
        .success { border-right: 5px solid #27ae60; }
        .fail { border-right: 5px solid #e74c3c; }
        .info { background: #e1f5fe; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .progress { background: #34495e; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .status-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin: 5px; }
        .passed { background: #27ae60; color: white; }
        .failed { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“¡ Farsinglish - ØªØ³Øª Ø¯Ø³ØªÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø¨</h1>
        <h2>Malformed Response Handler</h2>
        <p>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø³Ø±ÙˆØ±</p>
    </div>

    <div class="test-card">
        <h3>ğŸ›¡ï¸ Û±. JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Invalid JSON)</h3>
        <div class="info">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ø¨Ø§ JSON Ø®Ø±Ø§Ø¨ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ÛŒ Parsing</div>
        <div class="button-group">
            <button onclick="testMalformedJSON()">ğŸ§ª ØªØ³Øª JSON Ø®Ø±Ø§Ø¨</button>
            <button onclick="testEmptyJSON()">ğŸ“­ ØªØ³Øª JSON Ø®Ø§Ù„ÛŒ</button>
            <button onclick="testPartialJSON()">ğŸ”§ ØªØ³Øª JSON Ù†Ø§Ù‚Øµ</button>
        </div>
        <div id="result-json" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ”£ Û². Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Invalid Data Type)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ø¨Ø§ Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù…ØªÙØ§ÙˆØª Ø§Ø²é¢„æœŸ</div>
        <div class="button-group">
            <button onclick="testStringInsteadOfObject()">ğŸ“ Ø±Ø´ØªÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
            <button onclick="testArrayInsteadOfObject()">ğŸ“š Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
            <button onclick="testNullInsteadOfObject()">â­• null Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª</button>
        </div>
        <div id="result-type" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ” Û³. ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú¯Ù…Ø´Ø¯Ù‡ (Missing Fields)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ø¨Ø§ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù‚Øµ</div>
        <div class="button-group">
            <button onclick="testMissingId()">ğŸ†” Ú¯Ù… Ø´Ø¯Ù† ID</button>
            <button onclick="testMissingTitle()">ğŸ“Œ Ú¯Ù… Ø´Ø¯Ù† Ø¹Ù†ÙˆØ§Ù†</button>
            <button onclick="testMissingAll()">âŒ Ú¯Ù… Ø´Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§</button>
        </div>
        <div id="result-missing" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>âš ï¸ Û´. Ø®Ø·Ø§Ù‡Ø§ÛŒ Encoding</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø² Ùˆ Encoding Ø§Ø´ØªØ¨Ø§Ù‡</div>
        <div class="button-group">
            <button onclick="testInvalidUnicode()">ğŸŒ Unicode Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
            <button onclick="testControlChars()">âŒ¨ï¸ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ</button>
            <button onclick="testWrongEncoding()">ğŸ”„ Encoding Ø§Ø´ØªØ¨Ø§Ù‡</button>
        </div>
        <div id="result-encoding" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ”„ Ûµ. Ø³Ø§Ø®ØªØ§Ø± ØªÙˆ Ø¯Ø± ØªÙˆ (Nested Structure)</h3>
        <div class="info">Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ ØªÙˆ Ø¯Ø± ØªÙˆ</div>
        <div class="button-group">
            <button onclick="testNestedMalformed()">ğŸ“¦ nested Ø®Ø±Ø§Ø¨</button>
            <button onclick="testDeepNestedMissing()">ğŸ”¬ nested Ø¹Ù…ÛŒÙ‚ Ù†Ø§Ù‚Øµ</button>
            <button onclick="testCircularJSON()">ğŸ”„ JSON Ø­Ù„Ù‚ÙˆÛŒ</button>
        </div>
        <div id="result-nested" class="result">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
    </div>

    <div class="test-card">
        <h3>ğŸ“Š Û¶. Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
        <div class="progress" id="summary">
            <p>âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: Û°</p>
            <p>âŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: Û°</p>
            <p>ğŸ“‹ Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§: Û°</p>
        </div>
        <button onclick="resetSummary()">ğŸ”„ Ø±ÛŒØ³Øª Ø®Ù„Ø§ØµÙ‡</button>
    </div>

    <script>
        // -------------------- Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ --------------------
        let testResults = {
            json: { passed: 0, failed: 0 },
            type: { passed: 0, failed: 0 },
            missing: { passed: 0, failed: 0 },
            encoding: { passed: 0, failed: 0 },
            nested: { passed: 0, failed: 0 }
        };

        function updateSummary() {
            const total = Object.values(testResults).reduce((acc, curr) => {
                return acc + curr.passed + curr.failed;
            }, 0);
            
            const passed = Object.values(testResults).reduce((acc, curr) => acc + curr.passed, 0);
            const failed = Object.values(testResults).reduce((acc, curr) => acc + curr.failed, 0);

            document.getElementById('summary').innerHTML = `
                <p>âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: ${passed}</p>
                <p>âŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed}</p>
                <p>ğŸ“‹ Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§: ${total}</p>
                <p>ğŸ“Š Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª: ${total ? Math.round(passed/total*100) : 0}%</p>
            `;
        }

        function addResult(category, passed, description) {
            if (passed) {
                testResults[category].passed++;
            } else {
                testResults[category].failed++;
            }
            updateSummary();
        }

        function resetSummary() {
            testResults = {
                json: { passed: 0, failed: 0 },
                type: { passed: 0, failed: 0 },
                missing: { passed: 0, failed: 0 },
                encoding: { passed: 0, failed: 0 },
                nested: { passed: 0, failed: 0 }
            };
            updateSummary();
        }

        // -------------------- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ --------------------
        async function safeJSONParse(str, elementId, description, category) {
            const resultDiv = document.getElementById(elementId);
            try {
                const data = JSON.parse(str);
                resultDiv.innerHTML = `âœ… JSON Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult(category, true, description);
                return data;
            } catch (error) {
                resultDiv.innerHTML = `âŒ Ø®Ø·Ø§ÛŒ Parsing:\n${error.message}\n\nğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ:\n${str}`;
                resultDiv.className = "result fail";
                addResult(category, false, description);
                return null;
            }
        }

        function validateLessonStructure(data, elementId, description, category) {
            const resultDiv = document.getElementById(elementId);
            let passed = true;
            let errors = [];

            if (!data || typeof data !== 'object') {
                passed = false;
                errors.push('Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø¢Ø¨Ø¬Ú©Øª Ø¨Ø§Ø´Ø¯');
            } else {
                if (!data.id) { passed = false; errors.push('ÙÛŒÙ„Ø¯ id ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
                if (!data.title) { passed = false; errors.push('ÙÛŒÙ„Ø¯ title ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
                if (!data.level) { passed = false; errors.push('ÙÛŒÙ„Ø¯ level ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); }
            }

            if (passed) {
                resultDiv.innerHTML = `âœ… Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø³ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult(category, true, description);
            } else {
                resultDiv.innerHTML = `âŒ Ø³Ø§Ø®ØªØ§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø±:\n${errors.join('\n')}\n\nğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result fail";
                addResult(category, false, description);
            }
        }

        // -------------------- Û±. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± --------------------
        function testMalformedJSON() {
            const malformedJSON = '{ "id": 1, "title": "Ø¯Ø±Ø³ Û±", "level": "Ù…Ø¨ØªØ¯ÛŒ", }'; // Ú©Ø§Ù…Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            safeJSONParse(malformedJSON, 'result-json', 'JSON Ø®Ø±Ø§Ø¨', 'json');
        }

        function testEmptyJSON() {
            safeJSONParse('', 'result-json', 'JSON Ø®Ø§Ù„ÛŒ', 'json');
        }

        function testPartialJSON() {
            const partialJSON = '{ "id": 1, "title": "Ø¯Ø±Ø³ Û±"';
            safeJSONParse(partialJSON, 'result-json', 'JSON Ù†Ø§Ù‚Øµ', 'json');
        }

        // -------------------- Û². ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± --------------------
        function testStringInsteadOfObject() {
            const response = '"Ø§ÛŒÙ† ÛŒÚ© Ø±Ø´ØªÙ‡ Ø§Ø³Øª Ù†Ù‡ Ø¢Ø¨Ø¬Ú©Øª"';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'Ø±Ø´ØªÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        function testArrayInsteadOfObject() {
            const response = '[{"id":1,"title":"Ø¯Ø±Ø³ Û±"}]';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        function testNullInsteadOfObject() {
            const response = 'null';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-type', 'null Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ø¨Ø¬Ú©Øª', 'type');
        }

        // -------------------- Û³. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú¯Ù…Ø´Ø¯Ù‡ --------------------
        function testMissingId() {
            const response = '{"title": "Ø¯Ø±Ø³ Û±", "level": "Ù…Ø¨ØªØ¯ÛŒ"}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† ID', 'missing');
        }

        function testMissingTitle() {
            const response = '{"id": 1, "level": "Ù…Ø¨ØªØ¯ÛŒ"}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† Ø¹Ù†ÙˆØ§Ù†', 'missing');
        }

        function testMissingAll() {
            const response = '{}';
            const data = JSON.parse(response);
            validateLessonStructure(data, 'result-missing', 'Ú¯Ù… Ø´Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§', 'missing');
        }

        // -------------------- Û´. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Encoding --------------------
        function testInvalidUnicode() {
            const invalidUnicode = '{ "id": 1, "title": "\uD800\uD800\uD800" }'; // Ø³ÙˆØ±ÙˆÚ¯ÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø±
            safeJSONParse(invalidUnicode, 'result-encoding', 'Unicode Ù†Ø§Ù…Ø¹ØªØ¨Ø±', 'encoding');
        }

        function testControlChars() {
            const controlChars = '{ "id": 1, "title": "Ø¯Ø±Ø³\u0000ÛŒÚ©" }'; // Ú©Ø§Ø±Ø§Ú©ØªØ± null
            safeJSONParse(controlChars, 'result-encoding', 'Ú©Ø§Ø±Ø§Ú©ØªØ± Ú©Ù†ØªØ±Ù„ÛŒ', 'encoding');
        }

        function testWrongEncoding() {
            const wrongEncoding = '{ "id": 1, "title": "ï¿½ï¿½ï¿½ï¿½" }'; // Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø±Ø§Ø¨
            safeJSONParse(wrongEncoding, 'result-encoding', 'Encoding Ø§Ø´ØªØ¨Ø§Ù‡', 'encoding');
        }

        // -------------------- Ûµ. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªØ§Ø± ØªÙˆ Ø¯Ø± ØªÙˆ --------------------
        function testNestedMalformed() {
            const nested = '{ "id": 1, "metadata": { "created": "2026-02-13", "tags": ["Ú¯Ø±Ø§Ù…Ø±",] } }'; // Ú©Ø§Ù…Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            safeJSONParse(nested, 'result-nested', 'nested Ø®Ø±Ø§Ø¨', 'nested');
        }

        function testDeepNestedMissing() {
            const deepNested = '{ "id": 1, "metadata": { "created": "2026-02-13" } }'; // ÙÛŒÙ„Ø¯ tags Ú¯Ù… Ø´Ø¯Ù‡
            const data = JSON.parse(deepNested);
            
            const resultDiv = document.getElementById('result-nested');
            if (data.metadata && data.metadata.tags) {
                resultDiv.innerHTML = `âœ… Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù„ Ø§Ø³Øª:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result success";
                addResult('nested', true, 'nested Ø¹Ù…ÛŒÙ‚');
            } else {
                resultDiv.innerHTML = `âŒ ÙÛŒÙ„Ø¯ metadata.tags ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯:\n${JSON.stringify(data, null, 2)}`;
                resultDiv.className = "result fail";
                addResult('nested', false, 'nested Ø¹Ù…ÛŒÙ‚');
            }
        }

        function testCircularJSON() {
            const circular = '{"id":1,"self":null}';
            try {
                const data = JSON.parse(circular);
                data.self = data; // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø±Ø¬Ø§Ø¹ Ø­Ù„Ù‚ÙˆÛŒ
                const resultDiv = document.getElementById('result-nested');
                
                // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ JSON.stringify Ø¯ÙˆØ¨Ø§Ø±Ù‡
                JSON.stringify(data);
                resultDiv.innerHTML = `âš ï¸ JSON Ø­Ù„Ù‚ÙˆÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯ (Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…Ø´Ú©Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ø¯)`;
                resultDiv.className = "result fail";
                addResult('nested', false, 'JSON Ø­Ù„Ù‚ÙˆÛŒ');
            } catch (error) {
                const resultDiv = document.getElementById('result-nested');
                resultDiv.innerHTML = `âœ… Ø®Ø·Ø§ÛŒ JSON Ø­Ù„Ù‚ÙˆÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯:\n${error.message}`;
                resultDiv.className = "result success";
                addResult('nested', true, 'JSON Ø­Ù„Ù‚ÙˆÛŒ');
            }
        }

        // -------------------- Ø±ÛŒØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ --------------------
        window.onload = function() {
            resetSummary();
        };
    </script>
</body>
</html>
