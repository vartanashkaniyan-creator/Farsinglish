<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª User Model - Farsinglish</title>
    <style>
        :root {
            --primary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 18px;
            background: var(--light);
            border-bottom: 3px solid #e2e8f0;
        }
        
        .stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.15);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 8px;
        }
        
        .xp-level-preview {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 20px;
            margin: 20px;
            border-radius: 12px;
            border: 3px solid #bae6fd;
        }
        
        .preview-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .level-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .level-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9, #38bdf8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .xp-bar-container {
            flex: 1;
            background: #e2e8f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(to right, #10b981, #34d399);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .xp-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--dark);
            line-height: 20px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .preview-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        
        .preview-value {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .preview-label {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        .test-area {
            padding: 20px;
        }
        
        .test-group {
            margin-bottom: 25px;
        }
        
        .group-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .test-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s;
            position: relative;
        }
        
        .test-card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.1);
        }
        
        .test-card.passed {
            border-color: var(--success);
            background: linear-gradient(to right, #f0fdf4, #ffffff);
        }
        
        .test-card.failed {
            border-color: var(--danger);
            background: linear-gradient(to right, #fef2f2, #ffffff);
        }
        
        .test-card.running {
            border-color: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { border-color: #f59e0b; }
            50% { border-color: #fbbf24; }
            100% { border-color: #f59e0b; }
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .test-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .test-desc {
            color: #64748b;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .test-details {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #475569;
            border-right: 4px solid var(--primary);
            display: none;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: var(--light);
            border-top: 3px solid #e2e8f0;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-run {
            background: linear-gradient(to right, #0ea5e9, #38bdf8);
            color: white;
        }
        
        .btn-run:hover {
            background: linear-gradient(to right, #0284c7, #0ea5e9);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
        }
        
        .btn-reset {
            background: linear-gradient(to right, #64748b, #94a3b8);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(to right, #475569, #64748b);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(100, 116, 139, 0.3);
        }
        
        .console {
            background: #1e293b;
            color: white;
            padding: 20px;
            margin: 0 20px 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #334155;
        }
        
        .console-header {
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .console-line {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
            line-height: 1.4;
        }
        
        .log-success { color: #34d399; }
        .log-error { color: #f87171; }
        .log-info { color: #60a5fa; }
        .log-warning { color: #fbbf24; }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
        }
        
        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 2px;
        }
        
        @media (max-width: 768px) {
            .tests-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .preview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .level-display {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ØªØ³Øª User Model Ùˆ Ø³ÛŒØ³ØªÙ… XP</h1>
            <p>ØªØ³Øª Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø±ØŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒØŒ XP Ùˆ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§</p>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalTests">10</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
        </div>
        
        <div class="xp-level-preview">
            <div class="preview-title">ğŸ† Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø³ÛŒØ³ØªÙ… XP Ùˆ Level</div>
            
            <div class="level-display">
                <div class="level-circle" id="currentLevel">1</div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="xpBar" style="width: 0%"></div>
                    <div class="xp-text" id="xpText">0/100 XP</div>
                </div>
            </div>
            
            <div class="preview-grid">
                <div class="preview-item">
                    <div class="preview-value" id="previewXP">0</div>
                    <div class="preview-label">XP Ú©Ù„</div>
                </div>
                <div class="preview-item">
                    <div class="preview-value" id="previewStreak">0</div>
                    <div class="preview-label">Streak Ø±ÙˆØ²Ø§Ù†Ù‡</div>
                </div>
                <div class="preview-item">
                    <div class="preview-value" id="previewAchievements">0</div>
                    <div class="preview-label">Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§</div>
                </div>
            </div>
        </div>
        
        <div class="test-area">
            <div class="test-group">
                <div class="group-title">ğŸ‘¤ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ User Model</div>
                <div class="tests-grid" id="basicTests"></div>
            </div>
            
            <div class="test-group">
                <div class="group-title">ğŸ“ˆ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ XP Ùˆ Level</div>
                <div class="tests-grid" id="advancedTests"></div>
            </div>
        </div>
        
        <div class="console">
            <div class="console-header">ğŸ“ Ú©Ù†Ø³ÙˆÙ„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            <div id="consoleOutput"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-run" id="runTests">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button class="btn btn-reset" id="resetTests">
                <span>ğŸ”„</span>
                Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù‡Ù…Ù‡
            </button>
        </div>
        
        <div class="footer">
            ØªØ³Øª User Model | Ø³ÛŒØ³ØªÙ… XP Ùˆ Level | Farsinglish
        </div>
    </div>

    <script>
        // ==================== User Model Ú©Ø§Ù…Ù„ ====================
        class UserModel {
            constructor(data = {}) {
                this.id = data.id || 'user_' + Date.now();
                this.username = data.username || '';
                this.email = data.email || '';
                this.createdAt = data.createdAt || new Date().toISOString();
                this.lastLogin = data.lastLogin || null;
                
                // Ø³ÛŒØ³ØªÙ… XP Ùˆ Level
                this.experiencePoints = data.experiencePoints || 0;
                this.level = data.level || 1;
                this.streak = data.streak || 0;
                this.lastActiveDate = data.lastActiveDate || null;
                
                // Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´Ø±ÙØª
                this.lessonsCompleted = data.lessonsCompleted || 0;
                this.totalStudyTime = data.totalStudyTime || 0; // Ø¯Ù‚ÛŒÙ‚Ù‡
                this.totalExercises = data.totalExercises || 0;
                this.correctAnswers = data.correctAnswers || 0;
                
                // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§
                this.achievements = data.achievements || [];
                this.badges = data.badges || [];
                
                // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                this.settings = data.settings || {
                    dailyGoal: 30, // Ø¯Ù‚ÛŒÙ‚Ù‡
                    notifications: true,
                    soundEffects: true,
                    theme: 'light'
                };
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³Ø·Ø­
            static getRequiredXP(level) {
                // ÙØ±Ù…ÙˆÙ„: 100 * (level^1.5)
                return Math.floor(100 * Math.pow(level, 1.5));
            }

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP
            addXP(amount, source = 'exercise') {
                if (amount <= 0) return false;

                const oldLevel = this.level;
                this.experiencePoints += amount;

                // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­
                while (this.experiencePoints >= UserModel.getRequiredXP(this.level)) {
                    this.experiencePoints -= UserModel.getRequiredXP(this.level);
                    this.level++;
                }

                const leveledUp = this.level > oldLevel;
                
                // Ø«Ø¨Øª ÙØ¹Ø§Ù„ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡
                this.updateDailyStreak();

                return {
                    oldLevel,
                    newLevel: this.level,
                    leveledUp,
                    currentXP: this.experiencePoints,
                    requiredXP: UserModel.getRequiredXP(this.level),
                    xpAdded: amount
                };
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡
            updateDailyStreak() {
                const today = new Date().toDateString();
                const lastActive = this.lastActiveDate ? new Date(this.lastActiveDate).toDateString() : null;

                if (!lastActive) {
                    // Ø§ÙˆÙ„ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª
                    this.streak = 1;
                } else if (lastActive === today) {
                    // Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù…Ø±ÙˆØ² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡
                    // Ø§Ø³ØªØ±ÛŒÚ© ØªØºÛŒÛŒØ±ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                } else {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastActive === yesterday.toDateString()) {
                        // Ø¯ÛŒØ±ÙˆØ² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡ - Ø§Ø³ØªØ±ÛŒÚ© Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø±Ø¯
                        this.streak++;
                    } else {
                        // ÙˆÙ‚ÙÙ‡ Ø¯Ø± Ø§Ø³ØªØ±ÛŒÚ©
                        this.streak = 1;
                    }
                }

                this.lastActiveDate = new Date().toISOString();
                return this.streak;
            }

            // Ø«Ø¨Øª ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³
            completeLesson(lessonDuration, exerciseCount, correctAnswers) {
                this.lessonsCompleted++;
                this.totalStudyTime += lessonDuration;
                this.totalExercises += exerciseCount;
                this.correctAnswers += correctAnswers;

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù…Ù„Ú©Ø±Ø¯
                const accuracy = exerciseCount > 0 ? correctAnswers / exerciseCount : 0;
                const baseXP = 50;
                const durationBonus = Math.min(lessonDuration / 5, 20); // Ø­Ø¯Ø§Ú©Ø«Ø± 20 XP
                const accuracyBonus = Math.floor(accuracy * 30); // Ø­Ø¯Ø§Ú©Ø«Ø± 30 XP
                const streakBonus = this.streak * 2; // 2 XP Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±ÙˆØ² Ø§Ø³ØªØ±ÛŒÚ©

                const totalXP = baseXP + durationBonus + accuracyBonus + streakBonus;

                const xpResult = this.addXP(Math.floor(totalXP), 'lesson');
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§
                this.checkAchievements();

                return {
                    ...xpResult,
                    lessonStats: {
                        accuracy: Math.round(accuracy * 100),
                        duration: lessonDuration,
                        totalExercises: exerciseCount,
                        correctAnswers: correctAnswers
                    }
                };
            }

            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§
            checkAchievements() {
                const newAchievements = [];
                
                // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø³Ø·Ø­
                if (this.level >= 5 && !this.achievements.includes('level_5')) {
                    newAchievements.push('level_5');
                    this.achievements.push('level_5');
                }
                if (this.level >= 10 && !this.achievements.includes('level_10')) {
                    newAchievements.push('level_10');
                    this.achievements.push('level_10');
                }

                // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø¯Ø±Ø³â€ŒÙ‡Ø§
                if (this.lessonsCompleted >= 10 && !this.achievements.includes('lessons_10')) {
                    newAchievements.push('lessons_10');
                    this.achievements.push('lessons_10');
                }
                if (this.lessonsCompleted >= 50 && !this.achievements.includes('lessons_50')) {
                    newAchievements.push('lessons_50');
                    this.achievements.push('lessons_50');
                }

                // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø§Ø³ØªØ±ÛŒÚ©
                if (this.streak >= 7 && !this.achievements.includes('streak_7')) {
                    newAchievements.push('streak_7');
                    this.achievements.push('streak_7');
                }
                if (this.streak >= 30 && !this.achievements.includes('streak_30')) {
                    newAchievements.push('streak_30');
                    this.achievements.push('streak_30');
                }

                // Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¯Ù‚Øª
                if (this.totalExercises >= 100) {
                    const accuracy = this.correctAnswers / this.totalExercises;
                    if (accuracy >= 0.9 && !this.achievements.includes('accuracy_90')) {
                        newAchievements.push('accuracy_90');
                        this.achievements.push('accuracy_90');
                    }
                }

                return newAchievements;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ø±Ø® Ø¯Ù‚Øª
            getAccuracyRate() {
                if (this.totalExercises === 0) return 0;
                return Math.round((this.correctAnswers / this.totalExercises) * 100);
            }

            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø·Ø­ ÙØ¹Ù„ÛŒ
            getLevelInfo() {
                const currentXP = this.experiencePoints;
                const requiredXP = UserModel.getRequiredXP(this.level);
                const prevRequiredXP = UserModel.getRequiredXP(this.level - 1);
                const xpInLevel = currentXP;
                const xpForNextLevel = requiredXP - currentXP;
                const progress = (currentXP / requiredXP) * 100;

                return {
                    level: this.level,
                    currentXP,
                    requiredXP,
                    progress: Math.round(progress),
                    xpInLevel,
                    xpForNextLevel,
                    totalXP: this.calculateTotalXP()
                };
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù„ XP Ú©Ø³Ø¨ Ø´Ø¯Ù‡
            calculateTotalXP() {
                let total = this.experiencePoints;
                for (let i = 1; i < this.level; i++) {
                    total += UserModel.getRequiredXP(i);
                }
                return total;
            }

            // Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ù‡ Ù‡Ø¯Ù Ø±ÙˆØ²Ø§Ù†Ù‡
            getDailyGoalProgress() {
                const progress = (this.totalStudyTime / this.settings.dailyGoal) * 100;
                return Math.min(100, Math.round(progress));
            }

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
            validate() {
                const errors = [];

                if (!this.username || this.username.length < 3) {
                    errors.push('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }

                if (this.email && !this.isValidEmail(this.email)) {
                    errors.push('Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }

                if (this.level < 1) {
                    errors.push('Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø¨Ø§Ø´Ø¯');
                }

                if (this.experiencePoints < 0) {
                    errors.push('XP Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯');
                }

                return {
                    isValid: errors.length === 0,
                    errors
                };
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù†
            clone() {
                return new UserModel({
                    id: this.id,
                    username: this.username,
                    email: this.email,
                    experiencePoints: this.experiencePoints,
                    level: this.level,
                    streak: this.streak,
                    lessonsCompleted: this.lessonsCompleted,
                    totalStudyTime: this.totalStudyTime,
                    totalExercises: this.totalExercises,
                    correctAnswers: this.correctAnswers,
                    achievements: [...this.achievements],
                    badges: [...this.badges],
                    settings: { ...this.settings }
                });
            }

            // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¢Ø¨Ø¬Ú©Øª Ø³Ø§Ø¯Ù‡
            toJSON() {
                return {
                    id: this.id,
                    username: this.username,
                    email: this.email,
                    level: this.level,
                    experiencePoints: this.experiencePoints,
                    streak: this.streak,
                    lessonsCompleted: this.lessonsCompleted,
                    totalStudyTime: this.totalStudyTime,
                    accuracyRate: this.getAccuracyRate(),
                    achievements: this.achievements,
                    dailyGoalProgress: this.getDailyGoalProgress(),
                    levelInfo: this.getLevelInfo()
                };
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ User Model ====================
        const userModelTests = [
            // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
            {
                id: 'test1',
                title: 'Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡',
                group: 'basic',
                run: function() {
                    const user = new UserModel({
                        username: 'testuser',
                        email: 'test@example.com'
                    });

                    const validation = user.validate();

                    return {
                        passed: validation.isValid && 
                                user.username === 'testuser' &&
                                user.level === 1 &&
                                user.experiencePoints === 0,
                        message: validation.isValid ? 'âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø±',
                        details: {
                            username: user.username,
                            level: user.level,
                            xp: user.experiencePoints,
                            isValid: validation.isValid
                        }
                    };
                }
            },
            {
                id: 'test2',
                title: 'Ø§ÙØ²ÙˆØ¯Ù† XP Ù¾Ø§ÛŒÙ‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø³Ø·Ø­',
                group: 'basic',
                run: function() {
                    const user = new UserModel();
                    const result = user.addXP(50);

                    return {
                        passed: result.xpAdded === 50 && 
                                result.leveledUp === false &&
                                user.experiencePoints === 50,
                        message: result.xpAdded === 50 ? 'âœ… XP Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† XP',
                        details: {
                            xpAdded: result.xpAdded,
                            leveledUp: result.leveledUp,
                            currentXP: user.experiencePoints,
                            requiredXP: UserModel.getRequiredXP(user.level)
                        }
                    };
                }
            },
            {
                id: 'test3',
                title: 'Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­ Ø¨Ø§ XP Ú©Ø§ÙÛŒ',
                group: 'basic',
                run: function() {
                    const user = new UserModel();
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø·Ø­ 2
                    const xpNeeded = UserModel.getRequiredXP(1); // 100 XP
                    const result = user.addXP(xpNeeded);

                    return {
                        passed: result.leveledUp === true &&
                                user.level === 2 &&
                                user.experiencePoints === 0,
                        message: result.leveledUp ? 'âœ… Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­',
                        details: {
                            oldLevel: result.oldLevel,
                            newLevel: user.level,
                            xpAfterLevelUp: user.experiencePoints,
                            xpNeeded: xpNeeded
                        }
                    };
                }
            },
            {
                id: 'test4',
                title: 'Ø§Ø³ØªØ±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ±ÛŒÚ© ÙØ¹Ø§Ù„ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡',
                group: 'basic',
                run: function() {
                    const user = new UserModel();
                    
                    // Ø§ÙˆÙ„ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª
                    const streak1 = user.updateDailyStreak();
                    
                    // ÙØ¹Ø§Ù„ÛŒØª Ù‡Ù…Ø§Ù† Ø±ÙˆØ² (Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø³ØªØ±ÛŒÚ© ØªØºÛŒÛŒØ± Ú©Ù†Ø¯)
                    const streak2 = user.updateDailyStreak();

                    return {
                        passed: streak1 === 1 && streak2 === 1,
                        message: streak1 === 1 ? 'âœ… Ø§Ø³ØªØ±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³ØªØ±ÛŒÚ©',
                        details: {
                            firstStreak: streak1,
                            sameDayStreak: streak2,
                            lastActiveDate: user.lastActiveDate
                        }
                    };
                }
            },
            {
                id: 'test5',
                title: 'ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ Ùˆ XP',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                group: 'basic',
                run: function() {
                    const user = new UserModel();
                    user.streak = 3; // ØªÙ†Ø¸ÛŒÙ… Ø§Ø³ØªØ±ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªØ³Øª
                    
                    const result = user.completeLesson(30, 10, 8); // 30 Ø¯Ù‚ÛŒÙ‚Ù‡ØŒ Û±Û° ØªÙ…Ø±ÛŒÙ†ØŒ Û¸ ØµØ­ÛŒØ­

                    return {
                        passed: result.lessonStats.accuracy === 80 &&
                                user.lessonsCompleted === 1 &&
                                user.totalStudyTime === 30,
                        message: result.lessonStats.accuracy === 80 ? 
                                'âœ… ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                        details: {
                            lessonsCompleted: user.lessonsCompleted,
                            studyTime: user.totalStudyTime,
                            accuracy: result.lessonStats.accuracy + '%',
                            xpAdded: result.xpAdded,
                            leveledUp: result.leveledUp
                        }
                    };
                }
            },

            // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
            {
                id: 'test6',
                title: 'Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ø·Ø­ Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªÙˆØ§Ù„ÛŒ',
                group: 'advanced',
                run: function() {
                    const user = new UserModel();
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP Ø¨Ø±Ø§ÛŒ 3 Ø³Ø·Ø­
                    let totalXP = 0;
                    let levelUps = 0;
                    
                    for (let i = 1; i <= 3; i++) {
                        const xpNeeded = UserModel.getRequiredXP(i);
                        const result = user.addXP(xpNeeded);
                        totalXP += xpNeeded;
                        if (result.leveledUp) levelUps++;
                    }

                    const levelInfo = user.getLevelInfo();

                    return {
                        passed: user.level === 4 && 
                                levelUps === 3 &&
                                user.experiencePoints === 0 &&
                                levelInfo.progress === 0,
                        message: user.level === 4 ? 
                                'âœ… Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ÛŒ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ÛŒ',
                        details: {
                            finalLevel: user.level,
                            levelUps: levelUps,
                            currentXP: user.experiencePoints,
                            progress: levelInfo.progress + '%',
                            totalXPEarned: user.calculateTotalXP()
                        }
                    };
                }
            },
            {
                id: 'test7',
                title: 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø³Ø¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§',
                group: 'advanced',
                run: function() {
                    const user = new UserModel();
                    
                    // Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Ø³Ø·Ø­ 5 Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯
                    for (let i = 1; i <= 5; i++) {
                        user.addXP(UserModel.getRequiredXP(i));
                    }
                    
                    // ØªÚ©Ù…ÛŒÙ„ 10 Ø¯Ø±Ø³ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¯ÛŒÚ¯Ø±
                    for (let i = 0; i < 10; i++) {
                        user.completeLesson(15, 5, 4);
                    }

                    const hasLevelAchievement = user.achievements.includes('level_5');
                    const hasLessonsAchievement = user.achievements.includes('lessons_10');
                    const achievementCount = user.achievements.length;

                    return {
                        passed: hasLevelAchievement && 
                                hasLessonsAchievement &&
                                achievementCount >= 2,
                        message: hasLevelAchievement ? 
                                'âœ… Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø³Ø¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ø³Ø¨ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§',
                        details: {
                            achievements: user.achievements.join(', ') || 'Ù‡ÛŒÚ†',
                            achievementCount: achievementCount,
                            hasLevel5: hasLevelAchievement,
                            hasLessons10: hasLessonsAchievement
                        }
                    };
                }
            },
            {
                id: 'test8',
                title: 'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØµØ­ÛŒØ­ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±',
                group: 'advanced',
                run: function() {
                    const validUser = new UserModel({
                        username: 'validuser123',
                        email: 'valid@example.com'
                    });

                    const invalidUser = new UserModel({
                        username: 'ab', // Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡
                        email: 'invalid-email' // Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
                    });

                    const validResult = validUser.validate();
                    const invalidResult = invalidUser.validate();

                    return {
                        passed: validResult.isValid === true &&
                                invalidResult.isValid === false &&
                                invalidResult.errors.length >= 2,
                        message: validResult.isValid ? 
                                'âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ',
                        details: {
                            validUser: validResult.isValid,
                            invalidUserErrors: invalidResult.errors.length,
                            sampleErrors: invalidResult.errors.slice(0, 2)
                        }
                    };
                }
            },
            {
                id: 'test9',
                title: 'Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¹Ù…ÛŒÙ‚',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø¨Ø± Ø´ÛŒØ¡ Ø§ØµÙ„ÛŒ',
                group: 'advanced',
                run: function() {
                    const original = new UserModel({
                        username: 'original',
                        level: 5,
                        experiencePoints: 150
                    });

                    const clone = original.clone();
                    clone.username = 'cloned';
                    clone.addXP(100);

                    return {
                        passed: original.username === 'original' &&
                                clone.username === 'cloned' &&
                                original.level === 5 &&
                                clone.level > 5 &&
                                original.experiencePoints === 150,
                        message: original.username === 'original' ? 
                                'âœ… Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚',
                        details: {
                            originalUsername: original.username,
                            cloneUsername: clone.username,
                            originalLevel: original.level,
                            cloneLevel: clone.level,
                            originalXP: original.experiencePoints,
                            cloneXP: clone.experiencePoints
                        }
                    };
                }
            },
            {
                id: 'test10',
                title: 'ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø³ÛŒØ³ØªÙ…',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ ØªÙ…Ø§Ù… ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§',
                group: 'advanced',
                run: function() {
                    const user = new UserModel({
                        username: 'integration_test'
                    });

                    // 1. ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                    user.addXP(75);
                    user.updateDailyStreak();
                    const lessonResult = user.completeLesson(45, 15, 12);
                    
                    // 2. Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù…Ø§Ø±
                    const levelInfo = user.getLevelInfo();
                    const accuracy = user.getAccuracyRate();
                    const dailyProgress = user.getDailyGoalProgress();
                    
                    // 3. Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§
                    user.checkAchievements();
                    
                    // 4. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ JSON
                    const json = user.toJSON();

                    const allPassed = user.level > 1 &&
                                    user.lessonsCompleted === 1 &&
                                    user.totalStudyTime === 45 &&
                                    accuracy === 80 &&
                                    json.levelInfo &&
                                    json.achievements !== undefined;

                    return {
                        passed: allPassed,
                        message: allPassed ? 
                                'âœ… Ø³ÛŒØ³ØªÙ… User Model Ú©Ø§Ù…Ù„Ø§Ù‹ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø§Ø³Øª' : 
                                'âŒ Ù…Ø´Ú©Ù„ Ø¯Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø³ÛŒØ³ØªÙ…',
                        details: {
                            level: user.level,
                            lessonsCompleted: user.lessonsCompleted,
                            studyTime: user.totalStudyTime,
                            accuracy: accuracy + '%',
                            dailyProgress: dailyProgress + '%',
                            hasLevelInfo: !!json.levelInfo,
                            achievementCount: user.achievements.length
                        }
                    };
                }
            }
        ];

        // ==================== Test Runner ====================
        class UserModelTestRunner {
            constructor() {
                this.tests = userModelTests;
                this.totalTests = this.tests.length;
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                this.initializeUI();
            }

            initializeUI() {
                const basicContainer = document.getElementById('basicTests');
                const advancedContainer = document.getElementById('advancedTests');
                
                this.tests.forEach((test, index) => {
                    const container = test.group === 'basic' ? basicContainer : advancedContainer;
                    const testEl = document.createElement('div');
                    testEl.className = 'test-card';
                    testEl.id = `test-${test.id}`;
                    testEl.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.group === 'basic' ? index + 1 : index - 4}. ${test.title}</div>
                            <div class="test-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                        </div>
                        <div class="test-desc">${test.desc}</div>
                        <div class="test-details" id="details-${test.id}"></div>
                    `;
                    container.appendChild(testEl);
                });

                document.getElementById('runTests').addEventListener('click', () => this.runAllTests());
                document.getElementById('resetTests').addEventListener('click', () => this.resetTests());
            }

            async runAllTests() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.resetTests();
                
                this.log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ User Model Ùˆ Ø³ÛŒØ³ØªÙ… XP...', 'info');
                this.log('ØªØ³Øª Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø±ØŒ Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ùˆ XP', 'info');
                
                for (let i = 0; i < this.tests.length; i++) {
                    const test = this.tests[i];
                    await this.runSingleTest(test);
                    await this.delay(400);
                    
                    this.updatePreview(i + 1);
                }
                
                const successRate = Math.round((this.passed / this.totalTests) * 100);
                this.log(`ğŸ‰ ${this.passed}/${this.totalTests} ØªØ³Øª Ù…ÙˆÙÙ‚ (${successRate}%)`, 'success');
                this.isRunning = false;
                
                if (successRate >= 80) {
                    this.log('âœ… User Model Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!', 'success');
                } else {
                    this.log('âš ï¸ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§', 'warning');
                }
            }

            async runSingleTest(test) {
                const testEl = document.getElementById(`test-${test.id}`);
                const statusEl = testEl.querySelector('.test-status');
                const detailsEl = document.getElementById(`details-${test.id}`);
                
                testEl.classList.add('running');
                statusEl.className = 'test-status status-pending';
                statusEl.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                try {
                    const result = test.run();
                    
                    testEl.classList.remove('running');
                    if (result.passed) {
                        this.passed++;
                        testEl.classList.add('passed');
                        statusEl.className = 'test-status status-pass';
                        statusEl.textContent = 'Ù…ÙˆÙÙ‚';
                        this.log(`âœ… ${test.title}: ${result.message}`, 'success');
                    } else {
                        this.failed++;
                        testEl.classList.add('failed');
                        statusEl.className = 'test-status status-fail';
                        statusEl.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                        this.log(`âŒ ${test.title}: ${result.message}`, 'error');
                    }
                    
                    if (result.details) {
                        detailsEl.style.display = 'block';
                        let detailsText = '';
                        for (const [key, value] of Object.entries(result.details)) {
                            detailsText += `${key}: ${value}\n`;
                        }
                        detailsEl.textContent = detailsText;
                    }
                    
                } catch (error) {
                    testEl.classList.remove('running');
                    this.failed++;
                    testEl.classList.add('failed');
                    statusEl.className = 'test-status status-fail';
                    statusEl.textContent = 'Ø®Ø·Ø§';
                    this.log(`ğŸ’¥ ${test.title}: ${error.message}`, 'error');
                    detailsEl.style.display = 'block';
                    detailsEl.textContent = `Ø®Ø·Ø§: ${error.message}`;
                }
                
                this.updateStats();
            }

            updatePreview(testNumber) {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡
                const level = Math.min(10, Math.floor(testNumber / 2) + 1);
                const xp = Math.min(UserModel.getRequiredXP(level) - 1, testNumber * 15);
                const progress = (xp / UserModel.getRequiredXP(level)) * 100;
                const streak = Math.min(30, testNumber * 2);
                const achievements = Math.min(5, Math.floor(testNumber / 2));
                
                document.getElementById('currentLevel').textContent = level;
                document.getElementById('xpBar').style.width = `${progress}%`;
                document.getElementById('xpText').textContent = `${xp}/${UserModel.getRequiredXP(level)} XP`;
                document.getElementById('previewXP').textContent = xp;
                document.getElementById('previewStreak').textContent = streak;
                document.getElementById('previewAchievements').textContent = achievements;
            }

            updateStats() {
                document.getElementById('passedTests').textContent = this.passed;
                document.getElementById('failedTests').textContent = this.failed;
                const rate = Math.round((this.passed / this.totalTests) * 100);
                document.getElementById('successRate').textContent = `${rate}%`;
                
                const rateEl = document.getElementById('successRate').parentElement;
                if (rate >= 80) {
                    rateEl.style.background = '#d1fae5';
                    rateEl.style.color = '#065f46';
                } else if (rate >= 60) {
                    rateEl.style.background = '#fef3c7';
                    rateEl.style.color = '#92400e';
                } else {
                    rateEl.style.background = '#fee2e2';
                    rateEl.style.color = '#991b1b';
                }
            }

            log(message, type = 'info') {
                const consoleEl = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `console-line log-${type}`;
                
                const time = new Date().toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                line.textContent = `[${time}] ${message}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }

            resetTests() {
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                
                this.tests.forEach(test => {
                    const testEl = document.getElementById(`test-${test.id}`);
                    const statusEl = testEl.querySelector('.test-status');
                    const detailsEl = document.getElementById(`details-${test.id}`);
                    
                    testEl.className = 'test-card';
                    statusEl.className = 'test-status status-pending';
                    statusEl.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                    detailsEl.style.display = 'none';
                    detailsEl.textContent = '';
                });
                
                document.getElementById('consoleOutput').innerHTML = '';
                document.getElementById('currentLevel').textContent = '1';
                document.getElementById('xpBar').style.width = '0%';
                document.getElementById('xpText').textContent = '0/100 XP';
                document.getElementById('previewXP').textContent = '0';
                document.getElementById('previewStreak').textContent = '0';
                document.getElementById('previewAchievements').textContent = '0';
                
                this.updateStats();
                this.log('ğŸ”„ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ ====================
        document.addEventListener('DOMContentLoaded', () => {
            const runner = new UserModelTestRunner();
            runner.log('ğŸ”§ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ User Model Ùˆ Ø³ÛŒØ³ØªÙ… XP Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§', 'info');
            runner.log('10 ØªØ³Øª Ø´Ø§Ù…Ù„: XPØŒ LevelØŒ StreakØŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§', 'info');
            runner.log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯', 'info');
        });
    </script>
</body>
</html>
