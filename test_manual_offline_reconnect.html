<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ - Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: #f8f9fc;
            color: #2c3e50;
            padding: 16px;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(145deg, #1e88e5, #1565c0);
            color: white;
            padding: 24px 20px;
            border-radius: 28px;
            margin-bottom: 24px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            text-align: center;
        }
        h1 { font-size: 1.9rem; margin-bottom: 8px; }
        h2 { font-size: 1.2rem; font-weight: 400; opacity: 0.95; }
        .card {
            background: white;
            border-radius: 24px;
            padding: 22px;
            margin-bottom: 25px;
            box-shadow: 0 6px 14px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.03);
        }
        .scenario {
            background: #eef6ff;
            border-right: 6px solid #1e88e5;
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 20px;
        }
        .btn {
            background: #1e88e5;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin: 8px 4px;
            box-shadow: 0 4px 8px rgba(30,136,229,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            width: 100%;
        }
        .btn:hover { background: #0d47a1; transform: scale(0.98); }
        .btn.offline { background: #757575; box-shadow: none; }
        .btn.online { background: #43a047; }
        .btn.warning { background: #fb8c00; }
        .log-box {
            background: #1e1e2f;
            color: #e3f2fd;
            padding: 18px;
            border-radius: 18px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            direction: ltr;
            text-align: left;
            height: 220px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            box-shadow: inset 0 0 12px #00000055;
            margin-top: 20px;
        }
        .badge {
            display: inline-block;
            background: #ffb74d;
            padding: 6px 18px;
            border-radius: 50px;
            font-weight: bold;
            color: #3e2723;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        .success { color: #b9f6ca; background: #1b5e20; padding: 3px 12px; border-radius: 20px; }
        .fail { color: #ffcdd2; background: #b71c1c; padding: 3px 12px; border-radius: 20px; }
        .flex { display: flex; gap: 12px; flex-wrap: wrap; }
        hr { margin: 24px 0; border: 1px dashed #ccc; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“¶ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ÛŒÙ†ØªØ±Ù†Øª</h1>
        <h2>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ù‚Ø·Ø¹/ÙˆØµÙ„ Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</h2>
        <div style="margin-top: 12px; background: #ffffff22; padding: 8px; border-radius: 50px; font-size: 0.9rem;">
            âš¡ Ù¾Ø±ÙˆÚ˜Ù‡ Farsinglish - Ø§ÙˆÙ„ÙˆÛŒØª Û² (Ø¢ÙÙ„Ø§ÛŒÙ† Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ)
        </div>
    </div>

    <div class="card">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <span class="badge">ğŸ§ª Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø§ØµÙ„ÛŒ</span>
            <span id="connectionStatus" style="background: #78909c; color: white; padding: 8px 18px; border-radius: 30px; font-weight: bold;">â³ ÙˆØ¶Ø¹ÛŒØª: Ù†Ø§Ù…Ø´Ø®Øµ</span>
        </div>

        <!-- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ† -->
        <div class="scenario">
            <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 18px;">ğŸ“± Û±. Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡</h3>
            <div class="flex">
                <button id="goOnlineBtn" class="btn online" style="width: auto; flex: 1;">ğŸŸ¢ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´Ùˆ</button>
                <button id="goOfflineBtn" class="btn offline" style="width: auto; flex: 1;">ğŸ”´ Ø¢ÙÙ„Ø§ÛŒÙ† Ø´Ùˆ</button>
                <button id="simulateReconnectBtn" class="btn warning" style="width: auto; flex: 1;">ğŸ”„ Ù‚Ø·Ø¹ Ùˆ ÙˆØµÙ„ Ø³Ø±ÛŒØ¹</button>
            </div>
            <p style="margin-top: 16px; font-size: 0.95rem; color: #555;">
                âš ï¸ Ø§ÛŒÙ† ØªØ³Øª ÙˆØ§Ù‚Ø¹Ø§Ù‹ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø´Ù…Ø§ Ø±Ø§ Ù‚Ø·Ø¹ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯! Ø¨Ù„Ú©Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒâ€ŒØ´Ø¯Ù‡ Ø±Ø§ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
            </p>
        </div>

        <!-- Ø¹Ù…Ù„ÛŒØ§Øª Ø¢ÙÙ„Ø§ÛŒÙ† -->
        <div class="scenario" style="border-right-color: #fb8c00;">
            <h3>ğŸ“¥ Û². Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³ Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†</h3>
            <button id="saveLessonOfflineBtn" class="btn" style="background: #ff9800;">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¢ÙÙ„Ø§ÛŒÙ†)</button>
            <div id="offlineSaveResult" style="margin-top: 12px; padding: 12px; background: #fff3e0; border-radius: 12px; font-size: 0.95rem;">
                â³ Ù‡Ù†ÙˆØ² Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡.
            </div>
        </div>

        <!-- ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ -->
        <div class="scenario" style="border-right-color: #43a047;">
            <h3>ğŸ”„ Û³. ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ (Sync Queue)</h3>
            <button id="showSyncQueueBtn" class="btn" style="background: #2e7d32;">ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ ØµÙ Ø§Ù†ØªØ¸Ø§Ø±</button>
            <button id="forceSyncBtn" class="btn" style="background: #00897b;">âš¡ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø³ØªÛŒ</button>
            <div id="syncQueueDisplay" style="margin-top: 16px; background: #e8f5e9; padding: 16px; border-radius: 16px; direction: ltr; text-align: left; font-family: monospace;">
                <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÙˆÛŒØ§ -->
            </div>
        </div>

        <!-- Ø­Ù„ ØªØ¹Ø§Ø±Ø¶ (Conflict) -->
        <div class="scenario" style="border-right-color: #8e24aa;">
            <h3>âš–ï¸ Û´. Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ØªØ¹Ø§Ø±Ø¶ Ùˆ Ø­Ù„ Ø®ÙˆØ¯Ú©Ø§Ø±</h3>
            <button id="createConflictBtn" class="btn" style="background: #8e24aa;">ğŸ”„ Ø§ÛŒØ¬Ø§Ø¯ ØªØ¹Ø§Ø±Ø¶ (ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ù…Ø²Ù…Ø§Ù†)</button>
            <div id="conflictResult" style="margin-top: 12px; padding: 12px; background: #f3e5f5; border-radius: 12px;"></div>
        </div>

        <!-- Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ø²Ù†Ø¯Ù‡ -->
        <h3 style="margin-top: 30px; margin-bottom: 10px;">ğŸ“œ Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ (ÙˆØ±ÙˆØ¯ÛŒ/Ø®Ø±ÙˆØ¬ÛŒ)</h3>
        <div id="liveLog" class="log-box">
            [Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.
    â±ï¸ Ù…Ù†ØªØ¸Ø± Ø§Ù‚Ø¯Ø§Ù… Ø´Ù…Ø§...
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ Ø±ÛŒØ³Øª -->
        <hr>
        <button id="resetBtn" style="background: #b0bec5; color: black; box-shadow: none; margin-top: 8px;">ğŸ§¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ Ùˆ Ø±ÛŒØ³Øª</button>
    </div>

    <script>
        // ----------------------------------------------------------------------
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ†ØŒ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª reconnect
        // ----------------------------------------------------------------------

        (function() {
            // ---------- ÙˆØ¶Ø¹ÛŒØª Ø§ÙˆÙ„ÛŒÙ‡ ----------
            let isOnlineSimulated = true;   // ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (Ø±Ø§Ø¨Ø·Ù‡â€ŒØ§ÛŒ Ø¨Ø§ ÙˆØ§Ù‚Ø¹ÛŒØª Ù†Ø¯Ø§Ø±Ø¯)
            let lessonStorage = [];         // Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù…Ø­Ù„ÛŒ
            let syncQueue = [];            // Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            let syncHistory = [];          // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§
            let conflictCounter = 0;

            // Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ
            let lessonIdCounter = 101;

            // ---------- Ø¹Ù†Ø§ØµØ± DOM ----------
            const connectionStatusEl = document.getElementById('connectionStatus');
            const offlineSaveResult = document.getElementById('offlineSaveResult');
            const syncQueueDisplay = document.getElementById('syncQueueDisplay');
            const conflictResult = document.getElementById('conflictResult');
            const liveLog = document.getElementById('liveLog');

            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            const goOnlineBtn = document.getElementById('goOnlineBtn');
            const goOfflineBtn = document.getElementById('goOfflineBtn');
            const simulateReconnectBtn = document.getElementById('simulateReconnectBtn');
            const saveLessonOfflineBtn = document.getElementById('saveLessonOfflineBtn');
            const showSyncQueueBtn = document.getElementById('showSyncQueueBtn');
            const forceSyncBtn = document.getElementById('forceSyncBtn');
            const createConflictBtn = document.getElementById('createConflictBtn');
            const resetBtn = document.getElementById('resetBtn');

            // ---------- ØªÙˆØ§Ø¨Ø¹ Ù„Ø§Ú¯ ----------
            function addLog(message, type = 'info') {
                const now = new Date();
                const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
                let prefix = 'ğŸ“Œ';
                if (type === 'success') prefix = 'âœ…';
                if (type === 'error') prefix = 'âŒ';
                if (type === 'warning') prefix = 'âš ï¸';
                if (type === 'sync') prefix = 'ğŸ”„';
                if (type === 'offline') prefix = 'ğŸ“´';
                if (type === 'online') prefix = 'ğŸ“¶';
                
                const logLine = `[${timeStr}] ${prefix} ${message}`;
                liveLog.innerHTML += `\n${logLine}`;
                liveLog.scrollTop = liveLog.scrollHeight;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
                console.log(logLine);
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„
            function updateConnectionUI() {
                if (isOnlineSimulated) {
                    connectionStatusEl.innerHTML = 'ğŸŸ¢ ÙˆØ¶Ø¹ÛŒØª: Ø¢Ù†Ù„Ø§ÛŒÙ† (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)';
                    connectionStatusEl.style.background = '#2e7d32';
                } else {
                    connectionStatusEl.innerHTML = 'ğŸ”´ ÙˆØ¶Ø¹ÛŒØª: Ø¢ÙÙ„Ø§ÛŒÙ† (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)';
                    connectionStatusEl.style.background = '#c62828';
                }
                addLog(`ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡ Ø¨Ù‡ "${isOnlineSimulated ? 'Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'Ø¢ÙÙ„Ø§ÛŒÙ†'}" ØªØºÛŒÛŒØ± ÛŒØ§ÙØª`, isOnlineSimulated ? 'online' : 'offline');
            }

            // Ù†Ù…Ø§ÛŒØ´ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            function renderSyncQueue() {
                if (syncQueue.length === 0) {
                    syncQueueDisplay.innerHTML = '<span style="color: #2e7d32;">âœ… ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</span>';
                    return;
                }
                let html = `<strong>â³ ${syncQueue.length} Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± ØµÙ:</strong><br>`;
                syncQueue.forEach((item, idx) => {
                    html += `<span style="display:block; background:#c8e6c9; margin:6px 0; padding:8px; border-radius:10px;">ğŸ“¦ ${idx+1}. [Ø¯Ø±Ø³ ${item.lessonId}] ${item.title} - ÙˆØ¶Ø¹ÛŒØª: ${item.status} - ØªÙ„Ø§Ø´: ${item.retryCount||0}</span>`;
                });
                syncQueueDisplay.innerHTML = html;
            }

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¨Ø³ØªÙ‡ Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†)
            function createNewLesson(title = null) {
                const lessonTitle = title || `Ø¯Ø±Ø³ Ù†Ù…ÙˆÙ†Ù‡ ${lessonIdCounter}`;
                const newLesson = {
                    id: lessonIdCounter++,
                    title: lessonTitle,
                    progress: 0,
                    lastUpdated: new Date().toISOString(),
                    serverSynced: false,
                    version: 1
                };

                if (isOnlineSimulated) {
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ø± Ø³Ø±ÙˆØ±
                    lessonStorage.push({...newLesson, serverSynced: true});
                    addLog(`Ø¯Ø±Ø³ "${lessonTitle}" Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ø³Ø±ÙˆØ± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø¢Ù†Ù„Ø§ÛŒÙ†)`, 'success');
                    return { ...newLesson, serverSynced: true, saved: 'online' };
                } else {
                    // Ø¢ÙÙ„Ø§ÛŒÙ†: Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…Ø­Ù„ÛŒ + Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ ØµÙ
                    lessonStorage.push({...newLesson, serverSynced: false});
                    syncQueue.push({
                        id: `sync_${Date.now()}_${newLesson.id}`,
                        lessonId: newLesson.id,
                        title: newLesson.title,
                        action: 'CREATE',
                        data: newLesson,
                        timestamp: new Date().toISOString(),
                        status: 'pending',
                        retryCount: 0
                    });
                    addLog(`ğŸ“´ Ø¯Ø±Ø³ "${lessonTitle}" Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ù‡ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`, 'offline');
                    renderSyncQueue();
                    return { ...newLesson, serverSynced: false, saved: 'offline' };
                }
            }

            // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ (Ø¨Ø§ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚/Ù†Ø§Ù…ÙˆÙÙ‚)
            function attemptSync(force = false) {
                if (!isOnlineSimulated) {
                    addLog('ğŸ”´ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ØºÛŒØ±Ù…Ù…Ú©Ù†: Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ø§Ø³Øª', 'error');
                    return { success: false, reason: 'offline' };
                }

                if (syncQueue.length === 0) {
                    addLog('âœ… ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³ØªØŒ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù†ÛŒØ³Øª', 'success');
                    return { success: true, synced: 0 };
                }

                let syncedCount = 0;
                const itemsToRemove = [];

                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ ØªØ£Ø®ÛŒØ± Ù…ØµÙ†ÙˆØ¹ÛŒ
                addLog(`ğŸ”„ Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± (${syncQueue.length} Ù…ÙˆØ±Ø¯) ...`, 'sync');
                
                syncQueue.forEach((item, index) => {
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ³Øª reconnect)
                    if (item.lessonId === 999) { // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø®Ø§Øµ
                        item.retryCount = (item.retryCount || 0) + 1;
                        addLog(`âš ï¸ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±Ø³ ${item.lessonId} Ù†Ø§Ù…ÙˆÙÙ‚ (Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±) - ØªÙ„Ø§Ø´ ${item.retryCount}`, 'warning');
                        return;
                    }

                    // Ù…ÙˆÙÙ‚
                    const lesson = lessonStorage.find(l => l.id === item.lessonId);
                    if (lesson) {
                        lesson.serverSynced = true;
                        lesson.syncedAt = new Date().toISOString();
                    }
                    itemsToRemove.push(item);
                    syncedCount++;
                    addLog(`âœ… Ø¯Ø±Ø³ "${item.title}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯`, 'success');
                });

                // Ø­Ø°Ù Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                itemsToRemove.forEach(item => {
                    const idx = syncQueue.indexOf(item);
                    if (idx !== -1) syncQueue.splice(idx, 1);
                });

                renderSyncQueue();
                addLog(`ğŸ“Š Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${syncedCount} Ù…ÙˆÙÙ‚, ${syncQueue.length} Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡`, 'sync');
                return { success: true, synced: syncedCount, remaining: syncQueue.length };
            }

            // Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ÛŒÙ†ØªØ±Ù†Øª (Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯)
            function reconnectNetwork() {
                const wasOffline = !isOnlineSimulated;
                isOnlineSimulated = true;
                updateConnectionUI();
                
                if (wasOffline) {
                    addLog('ğŸ“¶ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯! Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±...', 'online');
                    // ØªØ£Ø®ÛŒØ± Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                    setTimeout(() => {
                        attemptSync();
                    }, 600);
                } else {
                    addLog('ğŸ“¶ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù‡Ù…Ú†Ù†Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† Ø§Ø³Øª (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)', 'online');
                }
            }

            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¹Ø§Ø±Ø¶ (ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ù…â€ŒØ²Ù…Ø§Ù†)
            function createConflictScenario() {
                conflictCounter++;
                const conflictLesson = {
                    id: 999, // Ø¢ÛŒØªÙ… Ø®Ø§Øµ
                    title: `Ø¯Ø±Ø³ Ø¨Ø§ ØªØ¹Ø§Ø±Ø¶ ${conflictCounter}`,
                    progress: 50,
                    localEdit: 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­Ù„ÛŒ: Ø³Ø·Ø­ Û²',
                    serverEdit: 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø±ÙˆØ±: Ø³Ø·Ø­ Û³',
                    timestamp: new Date().toISOString()
                };

                addLog('âš–ï¸ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ØªØ¹Ø§Ø±Ø¶ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯: ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ù…â€ŒØ²Ù…Ø§Ù† Ø¯Ø± Ø¯Ùˆ Ø¯Ø³ØªÚ¯Ø§Ù‡', 'warning');
                
                let resolutionStrategy = 'Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´ (Ø³Ø±ÙˆØ±) Ø§ÙˆÙ„ÙˆÛŒØª Ø¯Ø§Ø±Ø¯';
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø­Ù„ Ø®ÙˆØ¯Ú©Ø§Ø±
                const resolvedLesson = {
                    ...conflictLesson,
                    progress: 55,
                    conflictResolved: true,
                    strategy: 'server-wins'
                };

                conflictResult.innerHTML = `
                    <strong>ğŸ”€ ØªØ¹Ø§Ø±Ø¶ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡:</strong><br>
                    ğŸ“± Ø¯Ø³ØªÚ¯Ø§Ù‡ A: ${conflictLesson.localEdit}<br>
                    â˜ï¸ Ø³Ø±ÙˆØ±: ${conflictLesson.serverEdit}<br>
                    âœ… Ø±Ø§Ù‡Ú©Ø§Ø±: ${resolutionStrategy}<br>
                    ğŸ¯ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: Ù¾ÛŒØ´Ø±ÙØª = ÛµÛµÙª (Ø§Ø¯ØºØ§Ù… Ù‡ÙˆØ´Ù…Ù†Ø¯)
                `;
                
                // Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ ØµÙ (Ø¨Ø§ retry)
                syncQueue.push({
                    id: `conflict_${Date.now()}`,
                    lessonId: 999,
                    title: conflictLesson.title,
                    action: 'UPDATE',
                    status: 'pending',
                    retryCount: 0,
                    isConflict: true
                });
                renderSyncQueue();
            }

            // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø­Ø§Ù„Øª
            function resetAll() {
                isOnlineSimulated = true;
                lessonStorage = [];
                syncQueue = [];
                syncHistory = [];
                conflictCounter = 0;
                lessonIdCounter = 101;
                
                updateConnectionUI();
                renderSyncQueue();
                offlineSaveResult.innerHTML = 'â³ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡.';
                conflictResult.innerHTML = '';
                liveLog.innerHTML = '[Ø³ÛŒØ³ØªÙ…] Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯. Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ (Ø¢Ù†Ù„Ø§ÛŒÙ†) Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯.';
                addLog('ğŸ§¹ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
            }

            // ---------- Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ----------
            goOnlineBtn.addEventListener('click', () => {
                isOnlineSimulated = true;
                updateConnectionUI();
                // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡
                setTimeout(() => attemptSync(), 400);
            });

            goOfflineBtn.addEventListener('click', () => {
                isOnlineSimulated = false;
                updateConnectionUI();
            });

            simulateReconnectBtn.addEventListener('click', () => {
                // Ù‚Ø·Ø¹ Ùˆ ÙˆØµÙ„ Ø³Ø±ÛŒØ¹
                isOnlineSimulated = false;
                updateConnectionUI();
                addLog('ğŸ“´ Ù‚Ø·Ø¹ Ù…ÙˆÙ‚Øª Ø§ÛŒÙ†ØªØ±Ù†Øª (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)', 'offline');
                setTimeout(() => {
                    isOnlineSimulated = true;
                    updateConnectionUI();
                    addLog('ğŸ“¶ Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯ - Ø¢ØºØ§Ø² Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ', 'online');
                    setTimeout(() => attemptSync(), 500);
                }, 1200);
            });

            saveLessonOfflineBtn.addEventListener('click', () => {
                const newLesson = createNewLesson();
                if (newLesson.saved === 'offline') {
                    offlineSaveResult.innerHTML = `âœ… Ø¯Ø±Ø³ "${newLesson.title}" (Ø¢ÛŒØ¯ÛŒ: ${newLesson.id}) Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.<br>â³ Ø¯Ø± ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª.`;
                } else {
                    offlineSaveResult.innerHTML = `âœ… Ø¯Ø±Ø³ "${newLesson.title}" (Ø¢ÛŒØ¯ÛŒ: ${newLesson.id}) Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ø³Ø±ÙˆØ± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø¢Ù†Ù„Ø§ÛŒÙ†).`;
                }
            });

            showSyncQueueBtn.addEventListener('click', () => {
                renderSyncQueue();
                addLog('ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ', 'info');
            });

            forceSyncBtn.addEventListener('click', () => {
                attemptSync(true);
            });

            createConflictBtn.addEventListener('click', () => {
                createConflictScenario();
            });

            resetBtn.addEventListener('click', () => {
                resetAll();
            });

            // ---------- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ----------
            updateConnectionUI();
            renderSyncQueue();

            // Ø°Ø®ÛŒØ±Ù‡ ÛŒÚ© Ø¯Ø±Ø³ Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
            window.onload = function() {
                // Ø¯Ø±Ø³ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµÙ Ø®Ø§Ù„ÛŒ Ù†Ø¨Ø§Ø´Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                setTimeout(() => {
                    addLog('ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ³Øª: Ø±ÙˆÛŒ "Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¢ÙÙ„Ø§ÛŒÙ†)" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.', 'info');
                }, 500);
            };
        })();
    </script>

    <!-- ØªÙˆØ¶ÛŒØ­ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¯Ø³ØªÛŒ -->
    <div style="background: #fff9c4; border-radius: 20px; padding: 20px; margin-top: 10px; border: 1px solid #ffb300;">
        <span style="background: #ffb300; padding: 6px 18px; border-radius: 50px; color: black; font-weight: bold;">ğŸ§ª Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</span>
        <ol style="margin-top: 16px; padding-right: 20px; color: #3e2723;">
            <li style="margin-bottom: 10px;">â¶ Ø§Ø¨ØªØ¯Ø§ <strong>Â«Ø¢ÙÙ„Ø§ÛŒÙ† Ø´ÙˆÂ»</strong> Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ú†Ù†Ø¯ Ø¯Ø±Ø³ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.</li>
            <li style="margin-bottom: 10px;">â· ØµÙ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ â€” Ø¨Ø§ÛŒØ¯ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± ØµÙ Ø¸Ø§Ù‡Ø± Ø´ÙˆÙ†Ø¯.</li>
            <li style="margin-bottom: 10px;">â¸ <strong>Â«Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´ÙˆÂ»</strong> Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ â€” Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø§Ø¬Ø±Ø§ Ùˆ ØµÙ Ø®Ø§Ù„ÛŒ Ø´ÙˆØ¯.</li>
            <li style="margin-bottom: 10px;">â¹ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ù‚Ø·Ø¹/ÙˆØµÙ„ Ø³Ø±ÛŒØ¹ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯Ø› ØµÙ Ù¾Ø³ Ø§Ø² ÙˆØµÙ„ Ø´Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù…Ú¯Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
            <li style="margin-bottom: 10px;">âº Ø¯Ú©Ù…Ù‡ Â«Ø§ÛŒØ¬Ø§Ø¯ ØªØ¹Ø§Ø±Ø¶Â» Ø±ÙØªØ§Ø± Ù‡Ù…â€ŒØ²Ù…Ø§Ù†ÛŒ Ø±Ø§ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</li>
        </ol>
        <p style="font-weight: bold; margin-top: 6px;">âœ… Ù…Ø¹ÛŒØ§Ø± Ù‚Ø¨ÙˆÙ„ÛŒ: Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ÛŒÙ†ØªØ±Ù†ØªØŒ Ø¨Ø¯ÙˆÙ† Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù† Ø¯Ø§Ø¯Ù‡.</p>
    </div>
</body>
</html>
