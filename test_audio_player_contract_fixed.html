<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù¾Ø®Ø´â€ŒÚ©Ù†Ù†Ø¯Ù‡ ØµÙˆØªÛŒ | Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡</title>
    <style>
        body {
            font-family: 'Tahoma', 'Vazir', sans-serif;
            background-color: #f5f7fb;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            padding: 25px;
        }
        h1 {
            font-size: 1.6rem;
            color: #3498db;
            border-bottom: 2px solid #e0e7ff;
            padding-bottom: 10px;
            margin-top: 0;
        }
        h2 {
            font-size: 1.2rem;
            color: #2c3e50;
            margin: 20px 0 10px;
        }
        .test-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .test-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: 0.2s;
            font-family: inherit;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #5a6268;
        }
        button.success {
            background: #27ae60;
        }
        button.success:hover {
            background: #219a52;
        }
        button.warning {
            background: #e67e22;
        }
        button.warning:hover {
            background: #d35400;
        }
        .result-box {
            background: #edf2f7;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 15px 0;
            border-right: 4px solid #3498db;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .test-status {
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 500;
            margin: 15px 0 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border-right: 4px solid #28a745;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border-right: 4px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-right: 4px solid #17a2b8;
        }
        .badge {
            display: inline-block;
            background: #3498db;
            color: white;
            border-radius: 20px;
            padding: 3px 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        hr {
            border: none;
            border-top: 2px dashed #cbd5e0;
            margin: 25px 0;
        }
        .audio-player-simulator {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        .audio-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        select, input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ced4da;
            font-family: inherit;
        }
        .fixed-badge {
            background: #27ae60;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Š ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù¾Ø®Ø´â€ŒÚ©Ù†Ù†Ø¯Ù‡ ØµÙˆØªÛŒ <span class="fixed-badge">Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡</span></h1>
        <p style="background: #e7f5ff; padding: 10px; border-radius: 8px;">
            ğŸ§ª Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ùˆ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒØŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Contract) Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª AudioPlayer Ø±Ø§ ØªØ³Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
            <br>âœ… **Ù…Ø´Ú©Ù„ Ù…ØªØ¯ play Ø¨Ø±Ø·Ø±Ù Ø´Ø¯Ù‡**: Ø­Ø§Ù„Ø§ Ø³Ø±ÙˆÛŒØ³ Ø¨Ù‡â€ŒØ¯Ø±Ø³ØªÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </p>

        <!-- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² AudioService Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§ÛŒØ²ÙˆÙ„Ù‡ -->
        <div class="test-section">
            <h2>ğŸµ Û±. Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø³Ø±ÙˆÛŒØ³ ØµÙˆØªÛŒ (Fake AudioService)</h2>
            <div class="audio-player-simulator">
                <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³:</strong> <span id="service-status">â¸ï¸ Ø¢Ù…Ø§Ø¯Ù‡</span></p>
                <p><strong>ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´:</strong> <span id="current-file">â€”</span></p>
                <p><strong>Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª:</strong></p>
                <div class="result-box" id="event-log" style="max-height: 100px; overflow-y: auto;">[Ø±ÙˆÛŒØ¯Ø§Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡]</div>
                <div class="audio-controls">
                    <button class="secondary" id="simulate-file-end">ğŸ”‡ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒØ§Ù† ÙØ§ÛŒÙ„</button>
                    <button class="warning" id="simulate-error">âš ï¸ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§</button>
                    <button class="secondary" id="clear-log">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
                </div>
            </div>
        </div>

        <!-- Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª AudioPlayer ØªØ­Øª ØªØ³Øª (Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡) -->
        <div class="test-section">
            <h2>ğŸšï¸ Û². Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª AudioPlayer (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</h2>
            <div style="background: #e9ecef; padding: 15px; border-radius: 12px;">
                <div id="audio-player-container">
                    <!-- ØªÙˆØ³Ø· Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                <div class="test-row">
                    <label for="audio-source">Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ (URL): </label>
                    <input type="text" id="audio-source" size="40" value="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" placeholder="Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ">
                    <button id="update-props">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ props</button>
                </div>
                <div class="test-row">
                    <span>ğŸ•¹ï¸ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª:</span>
                    <button id="call-play">â–¶ï¸ Ù¾Ø®Ø´</button>
                    <button id="call-pause">â¸ï¸ Ù…Ú©Ø«</button>
                    <button id="call-stop">â¹ï¸ ØªÙˆÙ‚Ù</button>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Contract Tests) -->
        <div class="test-section">
            <h2>ğŸ“‹ Û³. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ø¨Ø§ Ø¯Ú©Ù…Ù‡)</h2>
            <div class="test-row">
                <button class="success" id="test-prop-contract">ğŸ“¦ ØªØ³Øª Ø¯Ø±ÛŒØ§ÙØª props</button>
                <button class="success" id="test-event-contract">ğŸ“¨ ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ event</button>
                <button class="success" id="test-method-contract">âš™ï¸ ØªØ³Øª Ù…ØªØ¯Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ</button>
            </div>
            <div class="test-row">
                <button class="warning" id="test-invalid-source">ğŸ” ØªØ³Øª Ù…Ù†Ø¨Ø¹ Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
                <button class="warning" id="test-missing-handler">ğŸ•³ï¸ ØªØ³Øª Ø¨Ø¯ÙˆÙ† event handler</button>
            </div>
            <div id="contract-result" class="result-box">Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...</div>
        </div>

        <!-- Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ -->
        <hr>
        <div class="test-status info" id="final-report">
            â³ Ù‡Ù†ÙˆØ² ØªØ³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡. Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.
        </div>
    </div>

    <script>
        // ------------------------------------------------------------
        // 1. Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² AudioService (Fake) Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ ØªØ³Øª Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
        // ------------------------------------------------------------
        const fakeAudioService = {
            currentSrc: null,
            isPlaying: false,
            listeners: {},
            
            play(src) {
                this.currentSrc = src;
                this.isPlaying = true;
                this._logEvent('play', src);
                this._emit('play', src);
                return Promise.resolve();
            },
            
            pause() {
                this.isPlaying = false;
                this._logEvent('pause');
                this._emit('pause');
            },
            
            stop() {
                this.isPlaying = false;
                this.currentSrc = null;
                this._logEvent('stop');
                this._emit('stop');
            },
            
            on(event, callback) {
                if (!this.listeners[event]) this.listeners[event] = [];
                this.listeners[event].push(callback);
            },
            
            off(event, callback) {
                if (!this.listeners[event]) return;
                this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);
            },
            
            _emit(event, data) {
                if (this.listeners[event]) {
                    this.listeners[event].forEach(cb => cb(data));
                }
            },
            
            _logEvent(method, data) {
                const logDiv = document.getElementById('event-log');
                const entry = `[${new Date().toLocaleTimeString()}] service.${method}(${data || ''})`;
                if (logDiv.innerHTML === '[Ø±ÙˆÛŒØ¯Ø§Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡]') {
                    logDiv.innerHTML = entry;
                } else {
                    logDiv.innerHTML = entry + '\n' + logDiv.innerHTML;
                }
                updateServiceStatus();
            }
        };

        function updateServiceStatus() {
            document.getElementById('service-status').innerText = 
                fakeAudioService.isPlaying ? 'ğŸ”Š Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´' : 'â¸ï¸ Ù…ØªÙˆÙ‚Ù';
            document.getElementById('current-file').innerText = 
                fakeAudioService.currentSrc || 'â€”';
        }

        // ------------------------------------------------------------
        // 2. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª AudioPlayer (Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ - Ù…Ø´Ú©Ù„ play Ø¨Ø±Ø·Ø±Ù Ø´Ø¯Ù‡)
        // ------------------------------------------------------------
        class AudioPlayerFixed {
            constructor(containerId, props = {}) {
                this.container = document.getElementById(containerId);
                this.props = {
                    src: props.src || '',
                    autoPlay: props.autoPlay || false,
                    onPlay: props.onPlay || null,
                    onPause: props.onPause || null,
                    onEnd: props.onEnd || null,
                    onError: props.onError || null,
                };
                this.service = fakeAudioService; // ØªØ²Ø±ÛŒÙ‚ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ
                this.element = null;
                this.isPlaying = false;
                
                this._init();
                this._setupServiceListeners();
                if (this.props.autoPlay && this.props.src) {
                    setTimeout(() => this.play(), 100); // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ autoPlay
                }
            }

            _init() {
                // Ø±Ù†Ø¯Ø± UI Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
                const html = `
                    <div class="audio-player-comp" style="background: white; border-radius: 8px; padding: 12px; border: 1px solid #b8c7d9;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                            <span class="badge" style="background: #6c5ce7;">âµ Ù¾Ù„ÛŒØ± ØªØ³Øª (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</span>
                            <span id="player-status-indicator">â¸ï¸ Ù…ØªÙˆÙ‚Ù</span>
                            <div style="margin-right: auto; display: flex; gap: 8px;">
                                <button class="play-btn" style="background: #27ae60;">â–¶ï¸ Ù¾Ø®Ø´</button>
                                <button class="pause-btn" style="background: #f39c12;">â¸ï¸ Ù…Ú©Ø«</button>
                                <button class="stop-btn" style="background: #e74c3c;">â¹ï¸ ØªÙˆÙ‚Ù</button>
                            </div>
                        </div>
                        <div style="font-size: 0.85rem; color: #4a5568; margin-top: 8px;">
                            <span>ğŸ”Š Ù…Ù†Ø¨Ø¹: ${this.props.src ? this.props.src.substring(0, 50) + '...' : 'â€”'}</span>
                        </div>
                    </div>
                `;
                this.container.innerHTML = html;

                // Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
                this.container.querySelector('.play-btn')?.addEventListener('click', () => this.play());
                this.container.querySelector('.pause-btn')?.addEventListener('click', () => this.pause());
                this.container.querySelector('.stop-btn')?.addEventListener('click', () => this.stop());
            }

            _setupServiceListeners() {
                this.service.on('play', (src) => {
                    this.isPlaying = true;
                    this._updateUI();
                    if (this.props.onPlay) this.props.onPlay(src);
                });
                this.service.on('pause', () => {
                    this.isPlaying = false;
                    this._updateUI();
                    if (this.props.onPause) this.props.onPause();
                });
                this.service.on('stop', () => {
                    this.isPlaying = false;
                    this._updateUI();
                });
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒØ§Ù†
                this.service.on('end', () => {
                    if (this.props.onEnd) this.props.onEnd();
                });
            }

            _updateUI() {
                const indicator = this.container.querySelector('#player-status-indicator');
                if (indicator) {
                    indicator.innerText = this.isPlaying ? 'ğŸ”Š Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´' : 'â¸ï¸ Ù…ØªÙˆÙ‚Ù';
                }
            }

            // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)
            play() {
                if (!this.props.src) {
                    if (this.props.onError) this.props.onError('Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù…Ø´Ø®Øµ Ù†ÛŒØ³Øª');
                    return;
                }
                // âœ… Ù…Ø´Ú©Ù„ Ø¨Ø±Ø·Ø±Ù Ø´Ø¯: Ø­Ø§Ù„Ø§ Ø­ØªÙ…Ø§Ù‹ Ø³Ø±ÙˆÛŒØ³ play Ø±Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                this.service.play(this.props.src).catch(err => {
                    if (this.props.onError) this.props.onError(err);
                });
            }

            pause() {
                this.service.pause();
            }

            stop() {
                this.service.stop();
            }

            updateProps(newProps) {
                this.props = { ...this.props, ...newProps };
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ø¨Ø¹
                const srcSpan = this.container.querySelector('.audio-player-comp span:last-child');
                if (srcSpan) {
                    srcSpan.innerText = `ğŸ”Š Ù…Ù†Ø¨Ø¹: ${this.props.src ? this.props.src.substring(0, 50) + '...' : 'â€”'}`;
                }
                if (newProps.autoPlay && this.props.src) {
                    this.play();
                }
            }
        }

        // ------------------------------------------------------------
        // 3. Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª
        // ------------------------------------------------------------
        let playerInstance = null;

        function initPlayer(props = {}) {
            const defaultProps = {
                src: document.getElementById('audio-source').value,
                autoPlay: false,
                onPlay: (src) => logContract('ğŸ“¤ onPlay ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯: ' + src),
                onPause: () => logContract('ğŸ“¤ onPause ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯'),
                onEnd: () => logContract('ğŸ“¤ onEnd ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯'),
                onError: (err) => logContract('ğŸ“¤ onError ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯: ' + err),
            };
            playerInstance = new AudioPlayerFixed('audio-player-container', { ...defaultProps, ...props });
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        initPlayer();

        // ------------------------------------------------------------
        // 4. ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ùˆ Ù„Ø§Ú¯
        // ------------------------------------------------------------
        function logContract(message) {
            const resultDiv = document.getElementById('contract-result');
            const entry = `âœ… ${new Date().toLocaleTimeString()} - ${message}`;
            if (resultDiv.innerHTML === 'Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...') {
                resultDiv.innerHTML = entry;
            } else {
                resultDiv.innerHTML = entry + '\n' + resultDiv.innerHTML;
            }
            updateFinalReport();
        }

        function updateFinalReport() {
            const reportDiv = document.getElementById('final-report');
            reportDiv.className = 'test-status success';
            reportDiv.innerHTML = 'âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯. Ù…Ø´Ú©Ù„ Ù…ØªØ¯ play Ø¨Ø±Ø·Ø±Ù Ø´Ø¯Ù‡ Ø§Ø³Øª.';
        }

        // ------------------------------------------------------------
        // 5. Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
        // ------------------------------------------------------------
        document.getElementById('update-props').addEventListener('click', () => {
            const newSrc = document.getElementById('audio-source').value;
            playerInstance.updateProps({ src: newSrc });
            logContract('ğŸ”„ props Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯: src = ' + newSrc);
        });

        document.getElementById('call-play').addEventListener('click', () => {
            playerInstance.play();
        });

        document.getElementById('call-pause').addEventListener('click', () => {
            playerInstance.pause();
        });

        document.getElementById('call-stop').addEventListener('click', () => {
            playerInstance.stop();
        });

        // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        document.getElementById('test-prop-contract').addEventListener('click', () => {
            // ØªØ³Øª 1: Ø¢ÛŒØ§ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª props Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ
            const testSrc = 'https://example.com/test.mp3';
            playerInstance.updateProps({ src: testSrc });
            setTimeout(() => {
                if (playerInstance.props.src === testSrc) {
                    logContract('âœ… ØªØ³Øª Ø¯Ø±ÛŒØ§ÙØª props: Ù…ÙˆÙÙ‚ - Ù…Ù‚Ø¯Ø§Ø± src Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                } else {
                    logContract('âŒ ØªØ³Øª Ø¯Ø±ÛŒØ§ÙØª props: Ù†Ø§Ù…ÙˆÙÙ‚ - Ù…Ù‚Ø¯Ø§Ø± src ØªØ·Ø§Ø¨Ù‚ Ù†Ø¯Ø§Ø±Ø¯');
                }
            }, 50);
        });

        document.getElementById('test-event-contract').addEventListener('click', () => {
            // ØªØ³Øª 2: Ø¢ÛŒØ§ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŸ
            logContract('ğŸ” Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§... (Ø¨Ù‡ Ù„Ø§Ú¯ Ø¨Ø§Ù„Ø§ Ù†Ú¯Ø§Ù‡ Ú©Ù†ÛŒØ¯)');
            playerInstance.play();
            setTimeout(() => playerInstance.pause(), 500);
            setTimeout(() => playerInstance.stop(), 1000);
        });

        document.getElementById('test-method-contract').addEventListener('click', () => {
            // ØªØ³Øª 3: Ù…ØªØ¯Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ (Ù…Ø´Ú©Ù„ Ù‚Ø¨Ù„ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø±Ø·Ø±Ù Ø´Ø¯Ù‡)
            logContract('ğŸ” ØªØ³Øª Ù…ØªØ¯Ù‡Ø§: play, pause, stop');
            
            // Ø§Ø¨ØªØ¯Ø§ Ù…Ø·Ù…Ø¦Ù† Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ… src Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            if (!playerInstance.props.src) {
                playerInstance.updateProps({ src: 'https://example.com/test.mp3' });
            }
            
            playerInstance.play();
            setTimeout(() => {
                if (fakeAudioService.isPlaying) {
                    logContract('âœ… Ù…ØªØ¯ play: Ø³Ø±ÙˆÛŒØ³ Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª Ù¾Ø®Ø´ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª (Ù…Ø´Ú©Ù„ Ø¨Ø±Ø·Ø±Ù Ø´Ø¯)');
                } else {
                    logContract('âŒ Ù…ØªØ¯ play: Ø³Ø±ÙˆÛŒØ³ Ù¾Ø®Ø´ Ø±Ø§ Ø¢ØºØ§Ø² Ù†Ú©Ø±Ø¯ - Ù‡Ù†ÙˆØ² Ù…Ø´Ú©Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯');
                }
            }, 200);
            
            setTimeout(() => {
                playerInstance.pause();
                if (!fakeAudioService.isPlaying) {
                    logContract('âœ… Ù…ØªØ¯ pause: Ø³Ø±ÙˆÛŒØ³ Ù…ØªÙˆÙ‚Ù Ø´Ø¯');
                } else {
                    logContract('âŒ Ù…ØªØ¯ pause: Ø³Ø±ÙˆÛŒØ³ Ù…ØªÙˆÙ‚Ù Ù†Ø´Ø¯');
                }
            }, 400);
            
            setTimeout(() => {
                playerInstance.stop();
                if (fakeAudioService.currentSrc === null) {
                    logContract('âœ… Ù…ØªØ¯ stop: Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù¾Ø§Ú© Ø´Ø¯');
                } else {
                    logContract('âŒ Ù…ØªØ¯ stop: Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù¾Ø§Ú© Ù†Ø´Ø¯');
                }
            }, 600);
        });

        document.getElementById('test-invalid-source').addEventListener('click', () => {
            // ØªØ³Øª 4: Ù…Ù†Ø¨Ø¹ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
            playerInstance.updateProps({ src: '' });
            playerInstance.play();  // Ø¨Ø§ÛŒØ¯ onError ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´ÙˆØ¯
            logContract('ğŸ” ØªØ³Øª Ù…Ù†Ø¨Ø¹ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø±Ø±Ø³ÛŒ onError (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯)');
        });

        document.getElementById('test-missing-handler').addEventListener('click', () => {
            // ØªØ³Øª 5: Ø¨Ø¯ÙˆÙ† event handler
            const tempPlayer = new AudioPlayerFixed('audio-player-container', { src: 'test.mp3', onPlay: null });
            logContract('ğŸ” ØªØ³Øª Ø¨Ø¯ÙˆÙ† handler: Ù†Ø¨Ø§ÛŒØ¯ Ú©Ø±Ø´ Ú©Ù†Ø¯');
            tempPlayer.play();
            setTimeout(() => tempPlayer.pause(), 200);
            logContract('âœ… ØªØ³Øª Ø¨Ø¯ÙˆÙ† handler: Ù¾Ø§ÛŒØ¯Ø§Ø± Ù…Ø§Ù†Ø¯');
        });

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³
        document.getElementById('simulate-file-end').addEventListener('click', () => {
            fakeAudioService._emit('end');
            logContract('ğŸ”” Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒØ§Ù† ÙØ§ÛŒÙ„ - onEnd Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯');
        });

        document.getElementById('simulate-error').addEventListener('click', () => {
            if (playerInstance.props.onError) {
                playerInstance.props.onError('Ø®Ø·Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡');
            }
            logContract('ğŸ”” Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ - onError Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯');
        });

        document.getElementById('clear-log').addEventListener('click', () => {
            document.getElementById('event-log').innerHTML = '[Ø±ÙˆÛŒØ¯Ø§Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡]';
            document.getElementById('contract-result').innerHTML = 'Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...';
        });

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³
        updateServiceStatus();
    </script>
</body>
</html>
