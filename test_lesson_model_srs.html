<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ùˆ Ù…Ø¯Ù„ Ø¯Ø±Ø³ - Farsinglish</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #fbbf24;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            padding: 25px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            border-color: #4f46e5;
            box-shadow: 0 12px 30px rgba(79, 70, 229, 0.2);
        }
        
        .test-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .test-desc {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .test-result {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .pass {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .fail {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .running {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 25px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #runAllTests {
            background: linear-gradient(to right, #10b981, #34d399);
            color: white;
        }
        
        #runAllTests:hover {
            background: linear-gradient(to right, #0da271, #2bb884);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        
        #resetTests {
            background: linear-gradient(to right, #ef4444, #f87171);
            color: white;
        }
        
        #resetTests:hover {
            background: linear-gradient(to right, #dc2626, #ef4444);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .console {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            margin: 0 25px 25px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            direction: ltr;
            text-align: left;
            border: 2px solid #334155;
        }
        
        .console-header {
            color: #fbbf24;
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .console-line {
            padding: 5px 0;
            border-bottom: 1px solid #334155;
        }
        
        .console-line.success {
            color: #34d399;
        }
        
        .console-line.error {
            color: #f87171;
        }
        
        .console-line.info {
            color: #60a5fa;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 2px solid #e2e8f0;
            background: #f8fafc;
        }
        
        @media (max-width: 768px) {
            .tests-grid {
                grid-template-columns: 1fr;
            }
            
            .test-stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
        
        .srs-visualization {
            background: linear-gradient(to right, #f8fafc, #f1f5f9);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 25px;
            border: 2px solid #e2e8f0;
        }
        
        .visual-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            position: relative;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 4px;
            background: #cbd5e1;
            transform: translateY(-50%);
        }
        
        .timeline-point {
            position: relative;
            text-align: center;
            z-index: 1;
        }
        
        .point-circle {
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid #94a3b8;
            border-radius: 50%;
            margin: 0 auto 10px;
            transition: all 0.3s ease;
        }
        
        .timeline-point.active .point-circle {
            background: #4f46e5;
            border-color: #4f46e5;
            transform: scale(1.2);
        }
        
        .point-label {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .review-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4f46e5;
        }
        
        .stat-text {
            font-size: 0.8rem;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ§ª ØªØ³Øª Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ùˆ Ù…Ø¯Ù„ Ø¯Ø±Ø³</h1>
            <div class="subtitle">Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ… Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ (Spaced Repetition System) | Farsinglish</div>
        </div>
        
        <div class="test-stats">
            <div class="stat-box">
                <div class="stat-value" id="totalTests">14</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Ù…ÛŒØ²Ø§Ù† Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
        </div>
        
        <div class="srs-visualization">
            <div class="visual-title">ğŸ“Š Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ (SRS)</div>
            <div class="timeline">
                <div class="timeline-point" id="review1">
                    <div class="point-circle"></div>
                    <div class="point-label">Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ±</div>
                </div>
                <div class="timeline-point" id="review2">
                    <div class="point-circle"></div>
                    <div class="point-label">Ù…Ø±ÙˆØ± Ø¯ÙˆÙ…</div>
                </div>
                <div class="timeline-point" id="review3">
                    <div class="point-circle"></div>
                    <div class="point-label">Ù…Ø±ÙˆØ± Ø³ÙˆÙ…</div>
                </div>
                <div class="timeline-point" id="review4">
                    <div class="point-circle"></div>
                    <div class="point-label">Ù…Ø±ÙˆØ± Ú†Ù‡Ø§Ø±Ù…</div>
                </div>
                <div class="timeline-point" id="review5">
                    <div class="point-circle"></div>
                    <div class="point-label">Ù…Ø±ÙˆØ± Ù¾Ù†Ø¬Ù…</div>
                </div>
            </div>
            <div class="review-stats">
                <div class="stat-item">
                    <div class="stat-number" id="interval1">20m</div>
                    <div class="stat-text">ÙØ§ØµÙ„Ù‡ Ø§ÙˆÙ„</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="interval2">1d</div>
                    <div class="stat-text">ÙØ§ØµÙ„Ù‡ Ø¯ÙˆÙ…</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="interval3">3d</div>
                    <div class="stat-text">ÙØ§ØµÙ„Ù‡ Ø³ÙˆÙ…</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="interval4">7d</div>
                    <div class="stat-text">ÙØ§ØµÙ„Ù‡ Ú†Ù‡Ø§Ø±Ù…</div>
                </div>
            </div>
        </div>
        
        <div class="tests-grid" id="testsContainer">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="console">
            <div class="console-header">ğŸ“ Ú©Ù†Ø³ÙˆÙ„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            <div id="consoleOutput"></div>
        </div>
        
        <div class="controls">
            <button id="runAllTests">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button id="resetTests">
                <span>ğŸ”„</span>
                Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
        
        <div class="footer">
            ØªØ³Øª Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ùˆ Ù…Ø¯Ù„ Ø¯Ø±Ø³ | ØªÙˆØ³Ø¹Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Farsinglish | Ø§Ø¬Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
        </div>
    </div>

    <script>
        // Ú©Ù„Ø§Ø³ LessonModel Ø¨Ø§ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ú©Ø§Ù…Ù„
        class LessonModel {
            constructor(data = {}) {
                this.id = data.id || this.generateId();
                this.title = data.title || '';
                this.description = data.description || '';
                this.content = data.content || '';
                this.vocabulary = data.vocabulary || [];
                this.exercises = data.exercises || [];
                this.difficulty = data.difficulty || 1; // 1-5
                this.duration = data.duration || 15; // Ø¯Ù‚ÛŒÙ‚Ù‡
                this.prerequisites = data.prerequisites || [];
                this.isLocked = data.isLocked || false;
                this.isCompleted = data.isCompleted || false;
                this.progress = data.progress || 0; // 0-100
                this.lastReviewed = data.lastReviewed || null;
                this.nextReview = data.nextReview || null;
                this.reviewCount = data.reviewCount || 0;
                this.easinessFactor = data.easinessFactor || 2.5; // Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø¯Ø± SRS
                this.reviewInterval = data.reviewInterval || 0; // ÙØ§ØµÙ„Ù‡ ØªØ§ Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ (Ø±ÙˆØ²)
                this.createdAt = data.createdAt || new Date().toISOString();
                this.updatedAt = data.updatedAt || new Date().toISOString();
            }

            generateId() {
                return 'lesson_' + Math.random().toString(36).substr(2, 9);
            }

            // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SM-2 (Spaced Repetition System)
            calculateNextReview(quality) {
                // Ú©ÛŒÙÛŒØª Ù¾Ø§Ø³Ø®: 0-5 (0=Ø¨Ø¯ØªØ±ÛŒÙ†ØŒ 5=Ø¨Ù‡ØªØ±ÛŒÙ†)
                if (quality < 0 || quality > 5) {
                    throw new Error('Ú©ÛŒÙÛŒØª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 0 ØªØ§ 5 Ø¨Ø§Ø´Ø¯');
                }

                if (this.reviewCount === 0) {
                    // Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ±
                    this.reviewInterval = 1;
                } else if (this.reviewCount === 1) {
                    // Ø¯ÙˆÙ…ÛŒÙ† Ù…Ø±ÙˆØ±
                    this.reviewInterval = 6;
                } else {
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ± Ø¨Ø§ ÙØ±Ù…ÙˆÙ„ SM-2
                    this.easinessFactor = this.calculateEasinessFactor(this.easinessFactor, quality);
                    this.reviewInterval = Math.round(this.reviewInterval * this.easinessFactor);
                }

                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ±
                if (this.reviewInterval > 365) this.reviewInterval = 365;
                if (this.reviewInterval < 1) this.reviewInterval = 1;

                this.reviewCount++;
                this.lastReviewed = new Date().toISOString();
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ§Ø±ÛŒØ® Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ
                const nextReviewDate = new Date();
                nextReviewDate.setDate(nextReviewDate.getDate() + this.reviewInterval);
                this.nextReview = nextReviewDate.toISOString();

                return {
                    nextReview: this.nextReview,
                    interval: this.reviewInterval,
                    easinessFactor: this.easinessFactor,
                    reviewCount: this.reviewCount
                };
            }

            calculateEasinessFactor(currentEF, quality) {
                let newEF = currentEF + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                return Math.max(1.3, Math.min(newEF, 2.5)); // Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ 1.3-2.5
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø±ÙˆØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ùˆ Ø§Ù‡Ù…ÛŒØª
            getReviewPriority() {
                if (!this.nextReview) return 999;
                
                const now = new Date();
                const reviewDate = new Date(this.nextReview);
                const hoursUntilReview = (reviewDate - now) / (1000 * 60 * 60);
                
                // Ø§Ú¯Ø± Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§
                if (hoursUntilReview <= 0) return 0;
                
                // Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø²Ø¯ÛŒÚ©ÛŒ Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø±ÙˆØ±Ù‡Ø§
                const priority = hoursUntilReview / (this.reviewCount + 1);
                return priority;
            }

            // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± Ø¯Ø§Ø±Ø¯
            needsReview() {
                if (!this.nextReview) return true;
                const now = new Date();
                const reviewDate = new Date(this.nextReview);
                return now >= reviewDate;
            }

            // ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³
            completeLesson(score) {
                this.isCompleted = true;
                this.progress = 100;
                this.updatedAt = new Date().toISOString();
                
                if (score >= 80) {
                    // Ø§Ú¯Ø± Ù†Ù…Ø±Ù‡ Ø®ÙˆØ¨ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ± Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
                    this.calculateNextReview(4); // Ú©ÛŒÙÛŒØª 4
                }
                
                return this.getProgressData();
            }

            // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
            updateProgress(newProgress) {
                this.progress = Math.max(0, Math.min(100, newProgress));
                this.updatedAt = new Date().toISOString();
                this.isCompleted = this.progress === 100;
                
                return this.getProgressData();
            }

            // Ù‚ÙÙ„/Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³
            toggleLock() {
                this.isLocked = !this.isLocked;
                this.updatedAt = new Date().toISOString();
                return this.isLocked;
            }

            // ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
            generateSmartExercises(count = 5) {
                const exercises = [];
                const now = new Date();
                
                // ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ
                for (let i = 0; i < count; i++) {
                    const exerciseType = this.determineExerciseType(i);
                    exercises.push({
                        id: `ex_${this.id}_${i}`,
                        type: exerciseType,
                        question: this.generateQuestion(exerciseType),
                        options: this.generateOptions(exerciseType),
                        correctAnswer: this.generateCorrectAnswer(exerciseType),
                        difficulty: this.difficulty + (i * 0.2),
                        timeLimit: this.calculateTimeLimit(exerciseType),
                        points: this.calculatePoints(exerciseType)
                    });
                }
                
                return exercises;
            }

            determineExerciseType(index) {
                const types = ['multiple-choice', 'fill-blank', 'matching', 'translation'];
                // Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø±ÙˆØ±Ù‡Ø§ Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
                const typeIndex = (this.reviewCount + index) % types.length;
                return types[typeIndex];
            }

            generateQuestion(type) {
                const vocab = this.vocabulary[Math.floor(Math.random() * this.vocabulary.length)];
                switch(type) {
                    case 'multiple-choice':
                        return `Ù…Ø¹Ù†ÛŒ Ú©Ù„Ù…Ù‡ "${vocab.english}" Ú†ÛŒØ³ØªØŸ`;
                    case 'fill-blank':
                        return `Ú©Ù„Ù…Ù‡ Ù…Ù†Ø§Ø³Ø¨ Ø±Ø§ Ø¯Ø± Ø¬Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯: "I ___ to school every day."`;
                    case 'matching':
                        return 'Ú©Ù„Ù…Ø§Øª Ø±Ø§ Ø¨Ø§ Ù…Ø¹Ø§Ø¯Ù„ ÙØ§Ø±Ø³ÛŒ Ø¢Ù†Ù‡Ø§ Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ù‡ÛŒØ¯';
                    case 'translation':
                        return `Ø¬Ù…Ù„Ù‡ "${vocab.example}" Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ØªØ±Ø¬Ù…Ù‡ Ú©Ù†ÛŒØ¯`;
                    default:
                        return 'Ø³ÙˆØ§Ù„ ØªÙ…Ø±ÛŒÙ†';
                }
            }

            generateOptions(type) {
                const options = ['Ú¯Ø²ÛŒÙ†Ù‡ Û±', 'Ú¯Ø²ÛŒÙ†Ù‡ Û²', 'Ú¯Ø²ÛŒÙ†Ù‡ Û³', 'Ú¯Ø²ÛŒÙ†Ù‡ Û´'];
                return options;
            }

            generateCorrectAnswer(type) {
                return 'Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­';
            }

            calculateTimeLimit(type) {
                const baseTime = 30; // Ø«Ø§Ù†ÛŒÙ‡
                switch(type) {
                    case 'multiple-choice': return baseTime;
                    case 'fill-blank': return baseTime + 15;
                    case 'matching': return baseTime + 30;
                    case 'translation': return baseTime + 45;
                    default: return baseTime;
                }
            }

            calculatePoints(type) {
                const basePoints = 10;
                switch(type) {
                    case 'multiple-choice': return basePoints;
                    case 'fill-blank': return basePoints * 1.5;
                    case 'matching': return basePoints * 2;
                    case 'translation': return basePoints * 2.5;
                    default: return basePoints;
                }
            }

            // Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØª
            getProgressData() {
                return {
                    progress: this.progress,
                    isCompleted: this.isCompleted,
                    lastReviewed: this.lastReviewed,
                    nextReview: this.nextReview,
                    reviewCount: this.reviewCount,
                    needsReview: this.needsReview(),
                    reviewPriority: this.getReviewPriority()
                };
            }

            // Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¹Ù…ÛŒÙ‚
            clone() {
                return new LessonModel({
                    id: this.id,
                    title: this.title,
                    description: this.description,
                    content: this.content,
                    vocabulary: [...this.vocabulary],
                    exercises: [...this.exercises],
                    difficulty: this.difficulty,
                    duration: this.duration,
                    prerequisites: [...this.prerequisites],
                    isLocked: this.isLocked,
                    isCompleted: this.isCompleted,
                    progress: this.progress,
                    lastReviewed: this.lastReviewed,
                    nextReview: this.nextReview,
                    reviewCount: this.reviewCount,
                    easinessFactor: this.easinessFactor,
                    reviewInterval: this.reviewInterval,
                    createdAt: this.createdAt,
                    updatedAt: this.updatedAt
                });
            }

            // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¢Ø¨Ø¬Ú©Øª Ø³Ø§Ø¯Ù‡
            toJSON() {
                return {
                    id: this.id,
                    title: this.title,
                    description: this.description,
                    content: this.content,
                    vocabulary: this.vocabulary,
                    exercises: this.exercises,
                    difficulty: this.difficulty,
                    duration: this.duration,
                    prerequisites: this.prerequisites,
                    isLocked: this.isLocked,
                    isCompleted: this.isCompleted,
                    progress: this.progress,
                    lastReviewed: this.lastReviewed,
                    nextReview: this.nextReview,
                    reviewCount: this.reviewCount,
                    easinessFactor: this.easinessFactor,
                    reviewInterval: this.reviewInterval,
                    createdAt: this.createdAt,
                    updatedAt: this.updatedAt,
                    needsReview: this.needsReview(),
                    reviewPriority: this.getReviewPriority()
                };
            }

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³
            validate() {
                const errors = [];
                
                if (!this.title || this.title.trim().length < 3) {
                    errors.push('Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }
                
                if (this.difficulty < 1 || this.difficulty > 5) {
                    errors.push('Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û± ØªØ§ Ûµ Ø¨Ø§Ø´Ø¯');
                }
                
                if (this.duration < 5 || this.duration > 120) {
                    errors.push('Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¯Ø±Ø³ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Ûµ ØªØ§ Û±Û²Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø§Ø´Ø¯');
                }
                
                if (this.progress < 0 || this.progress > 100) {
                    errors.push('Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û° ØªØ§ Û±Û°Û° Ø¨Ø§Ø´Ø¯');
                }
                
                if (this.easinessFactor < 1.3 || this.easinessFactor > 2.5) {
                    errors.push('Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û±.Û³ ØªØ§ Û².Ûµ Ø¨Ø§Ø´Ø¯');
                }
                
                return {
                    isValid: errors.length === 0,
                    errors: errors
                };
            }
        }

        // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ SRS Ùˆ LessonModel
        class LessonModelTests {
            constructor() {
                this.tests = [];
                this.results = [];
                this.totalTests = 0;
                this.passedTests = 0;
                this.failedTests = 0;
            }

            initializeTests() {
                this.tests = [
                    {
                        id: 'test1',
                        title: 'Ø³Ø§Ø®Øª Ù…Ø¯Ù„ Ø¯Ø±Ø³',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØµØ­ÛŒØ­ Ù…Ø¯Ù„ Ø¯Ø±Ø³ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡',
                        run: () => this.testLessonCreation()
                    },
                    {
                        id: 'test2',
                        title: 'Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS - Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ±',
                        description: 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø±',
                        run: () => this.testFirstReview()
                    },
                    {
                        id: 'test3',
                        title: 'Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS - Ù…Ø±ÙˆØ± Ø¯ÙˆÙ…',
                        description: 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ø¨Ø§ Ú©ÛŒÙÛŒØª Ù¾Ø§Ø³Ø® Ù…ØªÙØ§ÙˆØª',
                        run: () => this.testSecondReview()
                    },
                    {
                        id: 'test4',
                        title: 'Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS - Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØµØ­ÛŒØ­ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª (Easiness Factor)',
                        run: () => this.testEasinessFactor()
                    },
                    {
                        id: 'test5',
                        title: 'Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø±ÙˆØ±',
                        description: 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø±ÙˆØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø±ÙˆØ±Ù‡Ø§',
                        run: () => this.testReviewPriority()
                    },
                    {
                        id: 'test6',
                        title: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ±',
                        description: 'ØªØ´Ø®ÛŒØµ ØµØ­ÛŒØ­ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± Ø¯Ø±Ø³',
                        run: () => this.testNeedsReview()
                    },
                    {
                        id: 'test7',
                        title: 'ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù† Ø¯Ø±Ø³ Ùˆ ØªÙ†Ø¸ÛŒÙ… Ù…Ø±ÙˆØ± Ø§ÙˆÙ„',
                        run: () => this.testCompleteLesson()
                    },
                    {
                        id: 'test8',
                        title: 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³',
                        run: () => this.testUpdateProgress()
                    },
                    {
                        id: 'test9',
                        title: 'ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯',
                        description: 'ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÙˆØ¹ Ø¨Ø± Ø§Ø³Ø§Ø³ SRS',
                        run: () => this.testGenerateExercises()
                    },
                    {
                        id: 'test10',
                        title: 'Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¹Ù…ÛŒÙ‚',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø¨Ø± Ø´ÛŒØ¡ Ø§ØµÙ„ÛŒ',
                        run: () => this.testDeepClone()
                    },
                    {
                        id: 'test11',
                        title: 'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØµØ­ÛŒØ­ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³',
                        run: () => this.testValidation()
                    },
                    {
                        id: 'test12',
                        title: 'ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ JSON',
                        description: 'ØªØ¨Ø¯ÛŒÙ„ ØµØ­ÛŒØ­ Ù…Ø¯Ù„ Ø¨Ù‡ Ø¢Ø¨Ø¬Ú©Øª JSON',
                        run: () => this.testToJSON()
                    },
                    {
                        id: 'test13',
                        title: 'Ù‚ÙÙ„/Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‚ÙÙ„ Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³',
                        run: () => this.testToggleLock()
                    },
                    {
                        id: 'test14',
                        title: 'ØªÙˆØ§Ù„ÛŒ Ù…Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ§Ù„ÛŒ Ù…Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯ Ùˆ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ',
                        run: () => this.testReviewSequence()
                    }
                ];

                this.totalTests = this.tests.length;
                this.renderTests();
            }

            testLessonCreation() {
                const lesson = new LessonModel({
                    title: 'Ø¯Ø±Ø³ ØªØ³ØªÛŒ',
                    difficulty: 3,
                    duration: 30
                });

                const isValid = lesson.validate().isValid;
                const hasId = lesson.id.startsWith('lesson_');
                
                return {
                    passed: isValid && hasId,
                    message: isValid && hasId 
                        ? 'âœ… Ù…Ø¯Ù„ Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª Ù…Ø¯Ù„ Ø¯Ø±Ø³',
                    details: {
                        id: lesson.id,
                        title: lesson.title,
                        difficulty: lesson.difficulty,
                        isValid: isValid
                    }
                };
            }

            testFirstReview() {
                const lesson = new LessonModel();
                const result = lesson.calculateNextReview(4); // Ú©ÛŒÙÛŒØª 4

                const passed = result.interval === 1 && 
                             result.reviewCount === 1 && 
                             lesson.nextReview !== null;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ† Ù…Ø±ÙˆØ±',
                    details: {
                        interval: result.interval,
                        reviewCount: result.reviewCount,
                        nextReview: lesson.nextReview
                    }
                };
            }

            testSecondReview() {
                const lesson = new LessonModel();
                lesson.reviewCount = 1;
                lesson.reviewInterval = 1;
                lesson.easinessFactor = 2.5;

                const result = lesson.calculateNextReview(5); // Ú©ÛŒÙÛŒØª Ø¹Ø§Ù„ÛŒ

                const passed = result.interval === 6 && 
                             result.reviewCount === 2;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ù…Ø±ÙˆØ± Ø¯ÙˆÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø±ÙˆØ± Ø¯ÙˆÙ…',
                    details: {
                        interval: result.interval,
                        easinessFactor: result.easinessFactor
                    }
                };
            }

            testEasinessFactor() {
                const lesson = new LessonModel();
                
                // ØªØ³Øª Ú©Ø§Ù‡Ø´ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø¨Ø§ Ú©ÛŒÙÛŒØª Ù¾Ø§ÛŒÛŒÙ†
                const initialEF = 2.5;
                lesson.easinessFactor = initialEF;
                lesson.calculateNextReview(2); // Ú©ÛŒÙÛŒØª Ù¾Ø§ÛŒÛŒÙ†
                
                const passed = lesson.easinessFactor < initialEF && 
                             lesson.easinessFactor >= 1.3;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª ØµØ­ÛŒØ­ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª',
                    details: {
                        initialEF: initialEF,
                        newEF: lesson.easinessFactor,
                        change: (lesson.easinessFactor - initialEF).toFixed(3)
                    }
                };
            }

            testReviewPriority() {
                const lesson = new LessonModel();
                lesson.reviewCount = 3;
                lesson.nextReview = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(); // ÙØ±Ø¯Ø§

                const priority = lesson.getReviewPriority();
                const passed = priority > 0 && priority < 100;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø±ÙˆØ± ØµØ­ÛŒØ­ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÙˆÛŒØª Ù…Ø±ÙˆØ±',
                    details: {
                        priority: priority.toFixed(2),
                        reviewCount: lesson.reviewCount
                    }
                };
            }

            testNeedsReview() {
                const lesson1 = new LessonModel();
                lesson1.nextReview = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(); // Ø¯ÛŒØ±ÙˆØ²

                const lesson2 = new LessonModel();
                lesson2.nextReview = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(); // ÙØ±Ø¯Ø§

                const passed = lesson1.needsReview() === true && 
                             lesson2.needsReview() === false;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± ØµØ­ÛŒØ­ Ø§Ø³Øª'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ±',
                    details: {
                        pastReview: lesson1.needsReview(),
                        futureReview: lesson2.needsReview()
                    }
                };
            }

            testCompleteLesson() {
                const lesson = new LessonModel();
                const result = lesson.completeLesson(85);

                const passed = lesson.isCompleted === true &&
                             lesson.progress === 100 &&
                             result.progress === 100;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                    details: {
                        isCompleted: lesson.isCompleted,
                        progress: lesson.progress,
                        hasReview: lesson.nextReview !== null
                    }
                };
            }

            testUpdateProgress() {
                const lesson = new LessonModel();
                const result = lesson.updateProgress(75);

                const passed = lesson.progress === 75 &&
                             result.progress === 75 &&
                             lesson.isCompleted === false;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª',
                    details: {
                        progress: lesson.progress,
                        isCompleted: lesson.isCompleted
                    }
                };
            }

            testGenerateExercises() {
                const lesson = new LessonModel({
                    vocabulary: [
                        { english: 'hello', persian: 'Ø³Ù„Ø§Ù…', example: 'Hello world!' },
                        { english: 'good', persian: 'Ø®ÙˆØ¨', example: 'Good morning!' }
                    ]
                });

                const exercises = lesson.generateSmartExercises(3);
                const passed = exercises.length === 3 &&
                             exercises.every(ex => ex.id && ex.type && ex.question);

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§',
                    details: {
                        count: exercises.length,
                        types: [...new Set(exercises.map(ex => ex.type))],
                        hasTimeLimits: exercises.every(ex => ex.timeLimit > 0)
                    }
                };
            }

            testDeepClone() {
                const original = new LessonModel({
                    title: 'Ø¯Ø±Ø³ Ø§ØµÙ„ÛŒ',
                    progress: 50
                });

                const clone = original.clone();
                clone.title = 'Ø¯Ø±Ø³ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡';
                clone.updateProgress(75);

                const passed = original.title === 'Ø¯Ø±Ø³ Ø§ØµÙ„ÛŒ' &&
                             original.progress === 50 &&
                             clone.title === 'Ø¯Ø±Ø³ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡' &&
                             clone.progress === 75;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚',
                    details: {
                        originalTitle: original.title,
                        originalProgress: original.progress,
                        cloneTitle: clone.title,
                        cloneProgress: clone.progress
                    }
                };
            }

            testValidation() {
                const validLesson = new LessonModel({
                    title: 'Ø¯Ø±Ø³ Ù…Ø¹ØªØ¨Ø±',
                    difficulty: 3,
                    duration: 30
                });

                const invalidLesson = new LessonModel({
                    title: 'Ú©', // Ø¹Ù†ÙˆØ§Ù† Ú©ÙˆØªØ§Ù‡
                    difficulty: 10, // Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡
                    duration: 500 // Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡
                });

                const validResult = validLesson.validate();
                const invalidResult = invalidLesson.validate();

                const passed = validResult.isValid === true &&
                             invalidResult.isValid === false &&
                             invalidResult.errors.length > 0;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ',
                    details: {
                        valid: validResult.isValid,
                        invalidErrors: invalidResult.errors.length
                    }
                };
            }

            testToJSON() {
                const lesson = new LessonModel({
                    title: 'Ø¯Ø±Ø³ JSON',
                    difficulty: 2
                });

                lesson.calculateNextReview(4);
                const json = lesson.toJSON();

                const passed = json.title === 'Ø¯Ø±Ø³ JSON' &&
                             json.difficulty === 2 &&
                             json.needsReview !== undefined &&
                             json.reviewPriority !== undefined;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ JSON Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ JSON',
                    details: {
                        hasTitle: !!json.title,
                        hasNeedsReview: json.needsReview !== undefined,
                        hasReviewPriority: json.reviewPriority !== undefined
                    }
                };
            }

            testToggleLock() {
                const lesson = new LessonModel();
                const initialLockState = lesson.isLocked;
                const toggledState = lesson.toggleLock();
                const finalLockState = lesson.isLocked;

                const passed = initialLockState === false &&
                             toggledState === true &&
                             finalLockState === true;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… Ù‚ÙÙ„/Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù‚ÙÙ„/Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³',
                    details: {
                        initial: initialLockState,
                        afterToggle: finalLockState
                    }
                };
            }

            testReviewSequence() {
                const lesson = new LessonModel();
                const intervals = [];
                const qualities = [4, 5, 3, 4, 5]; // Ú©ÛŒÙÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù

                for (let i = 0; i < qualities.length; i++) {
                    const result = lesson.calculateNextReview(qualities[i]);
                    intervals.push(result.interval);
                }

                // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙØ²Ø§ÛŒØ´ ØªØ¯Ø±ÛŒØ¬ÛŒ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§
                let isIncreasing = true;
                for (let i = 1; i < intervals.length; i++) {
                    if (intervals[i] <= intervals[i - 1]) {
                        isIncreasing = false;
                        break;
                    }
                }

                const passed = isIncreasing && 
                             lesson.reviewCount === qualities.length &&
                             lesson.easinessFactor >= 1.3 && 
                             lesson.easinessFactor <= 2.5;

                return {
                    passed: passed,
                    message: passed 
                        ? 'âœ… ØªÙˆØ§Ù„ÛŒ Ù…Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯ ØµØ­ÛŒØ­ Ø§Ø³Øª'
                        : 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙˆØ§Ù„ÛŒ Ù…Ø±ÙˆØ±Ù‡Ø§',
                    details: {
                        intervals: intervals,
                        finalEF: lesson.easinessFactor.toFixed(2),
                        reviewCount: lesson.reviewCount
                    }
                };
            }

            renderTests() {
                const container = document.getElementById('testsContainer');
                container.innerHTML = '';

                this.tests.forEach((test, index) => {
                    const testCard = document.createElement('div');
                    testCard.className = 'test-card';
                    testCard.id = `card_${test.id}`;
                    
                    testCard.innerHTML = `
                        <div class="test-title">${index + 1}. ${test.title}</div>
                        <div class="test-desc">${test.description}</div>
                        <div class="test-result running" id="result_${test.id}">
                            <span>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...</span>
                            <span>â³</span>
                        </div>
                    `;
                    
                    container.appendChild(testCard);
                });

                this.updateStats();
            }

            async runTest(test) {
                const resultElement = document.getElementById(`result_${test.id}`);
                const cardElement = document.getElementById(`card_${test.id}`);
                
                resultElement.className = 'test-result running';
                resultElement.innerHTML = '<span>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...</span><span>â³</span>';
                
                try {
                    const result = test.run();
                    
                    if (result.passed) {
                        this.passedTests++;
                        resultElement.className = 'test-result pass';
                        resultElement.innerHTML = `<span>${result.message}</span><span>âœ…</span>`;
                        cardElement.style.borderColor = '#10b981';
                        
                        this.logToConsole(`âœ… ${test.title}: ${result.message}`, 'success');
                    } else {
                        this.failedTests++;
                        resultElement.className = 'test-result fail';
                        resultElement.innerHTML = `<span>${result.message}</span><span>âŒ</span>`;
                        cardElement.style.borderColor = '#ef4444';
                        
                        this.logToConsole(`âŒ ${test.title}: ${result.message}`, 'error');
                        if (result.details) {
                            this.logToConsole(`   Ø¬Ø²Ø¦ÛŒØ§Øª: ${JSON.stringify(result.details)}`, 'info');
                        }
                    }
                    
                    this.results.push({
                        test: test.title,
                        passed: result.passed,
                        message: result.message,
                        details: result.details
                    });
                    
                } catch (error) {
                    this.failedTests++;
                    resultElement.className = 'test-result fail';
                    resultElement.innerHTML = `<span>Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª: ${error.message}</span><span>ğŸ’¥</span>`;
                    cardElement.style.borderColor = '#ef4444';
                    
                    this.logToConsole(`ğŸ’¥ ${test.title}: Ø®Ø·Ø§ - ${error.message}`, 'error');
                }
                
                this.updateStats();
                this.updateVisualization();
            }

            async runAllTests() {
                this.passedTests = 0;
                this.failedTests = 0;
                this.results = [];
                
                this.logToConsole('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ SRS...', 'info');
                
                for (const test of this.tests) {
                    await this.runTest(test);
                    // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ±
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
                
                this.logToConsole(`ğŸ‰ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯! ${this.passedTests}/${this.totalTests} Ù…ÙˆÙÙ‚`, 'success');
            }

            updateStats() {
                document.getElementById('totalTests').textContent = this.totalTests;
                document.getElementById('passedTests').textContent = this.passedTests;
                document.getElementById('failedTests').textContent = this.failedTests;
                
                const successRate = this.totalTests > 0 ? Math.round((this.passedTests / this.totalTests) * 100) : 0;
                document.getElementById('successRate').textContent = `${successRate}%`;
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ú¯ Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª
                const successRateElement = document.getElementById('successRate').parentElement;
                if (successRate >= 80) {
                    successRateElement.style.background = '#d1fae5';
                    successRateElement.style.color = '#065f46';
                } else if (successRate >= 60) {
                    successRateElement.style.background = '#fef3c7';
                    successRateElement.style.color = '#92400e';
                } else {
                    successRateElement.style.background = '#fee2e2';
                    successRateElement.style.color = '#991b1b';
                }
            }

            updateVisualization() {
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§ÛŒÙ…â€ŒÙ„Ø§ÛŒÙ† Ù…Ø±ÙˆØ±
                const reviewPoints = ['review1', 'review2', 'review3', 'review4', 'review5'];
                const intervals = ['20m', '1d', '3d', '7d', '30d'];
                
                // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†Ù‚Ø§Ø· Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚
                const activePoints = Math.min(Math.floor(this.passedTests / 3), 5);
                
                reviewPoints.forEach((id, index) => {
                    const element = document.getElementById(id);
                    if (index < activePoints) {
                        element.classList.add('active');
                    } else {
                        element.classList.remove('active');
                    }
                });
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÙˆØ§ØµÙ„ Ø²Ù…Ø§Ù†ÛŒ
                intervals.forEach((interval, index) => {
                    const element = document.getElementById(`interval${index + 1}`);
                    if (element) {
                        element.textContent = interval;
                    }
                });
            }

            logToConsole(message, type = 'info') {
                const consoleOutput = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                
                const timestamp = new Date().toLocaleTimeString('fa-IR');
                line.textContent = `[${timestamp}] ${message}`;
                
                consoleOutput.appendChild(line);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }

            resetTests() {
                this.passedTests = 0;
                this.failedTests = 0;
                this.results = [];
                
                document.getElementById('consoleOutput').innerHTML = '';
                this.logToConsole('ğŸ”„ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
                
                this.renderTests();
                this.updateVisualization();
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø³ Ø§Ø² Ù„ÙˆØ¯ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', () => {
            const testRunner = new LessonModelTests();
            testRunner.initializeTests();
            
            document.getElementById('runAllTests').addEventListener('click', () => {
                testRunner.runAllTests();
            });
            
            document.getElementById('resetTests').addEventListener('click', () => {
                testRunner.resetTests();
            });
            
            // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø³ Ø§Ø² 1 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                testRunner.logToConsole('ğŸ”§ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯', 'success');
                testRunner.logToConsole('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯', 'info');
            }, 1000);
        });
    </script>
</body>
  </html>
