<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farsinglish - ØªØ³Øª Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
            color: #e3f2fd;
            min-height: 100vh;
            padding: 15px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto;
            background: rgba(25, 35, 65, 0.95);
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(100, 150, 255, 0.3);
        }
        h1 { 
            text-align: center; 
            margin-bottom: 20px;
            font-size: 1.6rem;
            color: #82b1ff;
        }
        .test-section { 
            margin: 15px 0;
            padding: 14px;
            background: rgba(40, 45, 80, 0.9);
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
        }
        .test-header { 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title { 
            font-size: 0.95rem; 
            font-weight: 600;
            color: #bb86fc;
        }
        .test-result { 
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .pass { background: #4caf50; }
        .fail { background: #f44336; }
        .details { 
            margin-top: 8px;
            padding: 10px;
            background: rgba(0, 0, 30, 0.7);
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.8rem;
            color: #a5d6a7;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: rgba(40, 45, 80, 0.9);
            border-radius: 8px;
            text-align: center;
            font-size: 0.95rem;
        }
        button {
            background: #2962ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin: 4px;
        }
        .controls { text-align: center; margin-top: 15px; }
        .simulation {
            margin: 20px 0;
            padding: 15px;
            background: rgba(50, 55, 90, 0.9);
            border-radius: 10px;
            border: 1px solid rgba(100, 150, 255, 0.4);
        }
        .sim-btn {
            background: rgba(66, 165, 245, 0.2);
            border: 1px solid #42a5f5;
            color: #90caf9;
            padding: 6px 12px;
            border-radius: 6px;
            margin: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .route-display {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 6px;
            margin: 8px 0;
            color: #ffd54f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§­ ØªØ³Øª Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ - Farsinglish</h1>
        
        <div class="simulation">
            <h3>ğŸ® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ</h3>
            <div id="sim-controls">
                <p>Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯:</p>
                <button onclick="initSimulation()">ğŸš€ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²</button>
            </div>
            <div class="route-display">
                Ù…Ø³ÛŒØ± ÙØ¹Ù„ÛŒ: <span id="current-route">/</span>
            </div>
            <div class="route-display">
                ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±: <span id="user-status">âŒ Ù„Ø§Ú¯ÛŒÙ† Ù†Ø´Ø¯Ù‡</span>
            </div>
        </div>
        
        <div id="test-results"></div>
        
        <div class="summary">
            <p id="summary-text">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ Û±Û° ØªØ³Øª Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ...</p>
        </div>
        
        <div class="controls">
            <button onclick="runAllTests()">â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="clearTests()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬</button>
        </div>
    </div>

    <script>
        // ==================== Simple Router (Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ùˆ Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ú¯) ====================
        class SimpleRouter {
            constructor() {
                this.routes = {
                    '/': { name: 'Ø®Ø§Ù†Ù‡', auth: false, roles: ['guest', 'user', 'admin'] },
                    '/login': { name: 'ÙˆØ±ÙˆØ¯', auth: false, roles: ['guest'] },
                    '/dashboard': { name: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', auth: true, roles: ['user', 'admin'] },
                    '/lessons': { name: 'Ø¯Ø±ÙˆØ³', auth: true, roles: ['user', 'admin'] },
                    '/profile': { name: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„', auth: true, roles: ['user', 'admin'] },
                    '/admin': { name: 'Ù…Ø¯ÛŒØ±ÛŒØª', auth: true, roles: ['admin'] },
                    '/404': { name: 'ÛŒØ§ÙØª Ù†Ø´Ø¯', auth: false, roles: ['guest', 'user', 'admin'] }
                };
                this.currentRoute = '/';
                this.history = [];
                this.isAuthenticated = false;
                this.userRole = 'guest';
                this.listeners = [];
            }
            
            navigate(path) {
                console.log(`ğŸ§­ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡: ${path}`);
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…Ø³ÛŒØ±
                if (!this.routes[path]) {
                    console.log(`âŒ Ù…Ø³ÛŒØ± ${path} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`);
                    this._changeRoute('/404', false);
                    return false;
                }
                
                const route = this.routes[path];
                
                // Guard: Ø§Ú¯Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø±ÙˆØ¯
                if (path === '/login' && this.isAuthenticated) {
                    console.log('ğŸ”’ Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡');
                    this._changeRoute('/dashboard', false);
                    return false;
                }
                
                // Guard: Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                if (route.auth && !this.isAuthenticated) {
                    console.log('ğŸ” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ†');
                    this._changeRoute('/login', false);
                    return false;
                }
                
                // Guard: Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
                if (!route.roles.includes(this.userRole)) {
                    console.log(`â›” Ù†Ù‚Ø´ ${this.userRole} Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª`);
                    this._changeRoute('/', false);
                    return false;
                }
                
                // Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚
                return this._changeRoute(path, true);
            }
            
            _changeRoute(newPath, success) {
                const oldPath = this.currentRoute;
                this.currentRoute = newPath;
                
                // Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
                if (success && oldPath !== newPath) {
                    this.history.push(oldPath);
                    if (this.history.length > 10) this.history.shift();
                }
                
                // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ listeners
                this.listeners.forEach(cb => cb({
                    from: oldPath,
                    to: newPath,
                    success,
                    user: this.userRole,
                    time: new Date().toLocaleTimeString()
                }));
                
                console.log(`ğŸ“ ${success ? 'âœ…' : 'âŒ'} ${oldPath} â†’ ${newPath}`);
                return success;
            }
            
            setAuth(auth, role = 'user') {
                this.isAuthenticated = auth;
                this.userRole = role;
                console.log(`ğŸ‘¤ ÙˆØ¶Ø¹ÛŒØª: ${auth ? 'Ù„Ø§Ú¯ÛŒÙ†' : 'Ù„Ø§Ú¯â€ŒØ§ÙˆØª'} (${role})`);
            }
            
            goBack() {
                if (this.history.length === 0) return false;
                const prev = this.history.pop();
                return this.navigate(prev);
            }
            
            onRouteChange(callback) {
                this.listeners.push(callback);
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø·Ù…Ø¦Ù† ====================
        const simpleTests = [
            {
                id: 1,
                title: "Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ù‡ Ø®Ø§Ù†Ù‡",
                run: () => {
                    const router = new SimpleRouter();
                    return router.navigate('/') && router.currentRoute === '/';
                }
            },
            {
                id: 2,
                title: "Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø¯ÙˆÙ† Ù„Ø§Ú¯ÛŒÙ†",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(false, 'guest');
                    const result = router.navigate('/dashboard');
                    return !result && router.currentRoute === '/login';
                }
            },
            {
                id: 3,
                title: "Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§ Ù„Ø§Ú¯ÛŒÙ†",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'user');
                    return router.navigate('/dashboard') && router.currentRoute === '/dashboard';
                }
            },
            {
                id: 4,
                title: "Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±Ø¯",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'user');
                    const result = router.navigate('/admin');
                    return !result && router.currentRoute === '/';
                }
            },
            {
                id: 5,
                title: "ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'user');
                    
                    router.navigate('/dashboard');
                    router.navigate('/lessons');
                    router.navigate('/profile');
                    
                    const historyOk = router.history.length === 3;
                    const back1 = router.goBack();
                    const route1 = router.currentRoute === '/lessons';
                    const back2 = router.goBack();
                    const route2 = router.currentRoute === '/dashboard';
                    
                    return historyOk && back1 && route1 && back2 && route2;
                }
            },
            {
                id: 6,
                title: "Ù…Ø³ÛŒØ± Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (404)",
                run: () => {
                    const router = new SimpleRouter();
                    const result = router.navigate('/invalid-path-123');
                    return !result && router.currentRoute === '/404';
                }
            },
            {
                id: 7,
                title: "Ù„Ø§Ú¯ÛŒÙ† Ø´Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø±ÙˆØ¯",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'user');
                    const result = router.navigate('/login');
                    return !result && router.currentRoute === '/dashboard';
                }
            },
            {
                id: 8,
                title: "Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ø¯",
                run: () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'admin');
                    return router.navigate('/admin') && router.currentRoute === '/admin';
                }
            },
            {
                id: 9,
                title: "Event Listeners Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯",
                run: () => {
                    return new Promise((resolve) => {
                        const router = new SimpleRouter();
                        let eventReceived = false;
                        
                        router.onRouteChange((event) => {
                            if (event.to === '/dashboard' && event.success) {
                                eventReceived = true;
                                resolve(true);
                            }
                        });
                        
                        router.setAuth(true, 'user');
                        router.navigate('/dashboard');
                        
                        setTimeout(() => resolve(eventReceived), 300);
                    });
                }
            },
            {
                id: 10,
                title: "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‡Ù…Ø²Ù…Ø§Ù† (Concurrent)",
                run: async () => {
                    const router = new SimpleRouter();
                    router.setAuth(true, 'user');
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ú†Ù†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø´Øª Ø³Ø± Ù‡Ù… (Ù†Ù‡ Ù‡Ù…Ø²Ù…Ø§Ù†)
                    const results = [];
                    results.push(router.navigate('/dashboard'));  // âœ… Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø´ÙˆØ¯
                    results.push(router.navigate('/lessons'));    // âœ… Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø´ÙˆØ¯
                    results.push(router.navigate('/profile'));    // âœ… Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø´ÙˆØ¯
                    
                    // Ù‡Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ù†Ø¯
                    const allSuccess = results.every(r => r === true);
                    const finalRoute = router.currentRoute; // Ø¢Ø®Ø±ÛŒÙ† Ù…Ø³ÛŒØ±
                    
                    return allSuccess && finalRoute === '/profile';
                }
            }
        ];

        // ==================== Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ Ø³Ø§Ø¯Ù‡ ====================
        let activeRouter = null;
        
        function initSimulation() {
            activeRouter = new SimpleRouter();
            const controls = document.getElementById('sim-controls');
            
            controls.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>Ú©Ù†ØªØ±Ù„ ÙˆØ¶Ø¹ÛŒØª:</strong><br>
                    <button class="sim-btn" onclick="simLoginUser()">ğŸ‘¤ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</button>
                    <button class="sim-btn" onclick="simLoginAdmin()">ğŸ‘‘ ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</button>
                    <button class="sim-btn" onclick="simLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ:</strong><br>
                    <button class="sim-btn" onclick="simNav('/')">ğŸ  Ø®Ø§Ù†Ù‡</button>
                    <button class="sim-btn" onclick="simNav('/login')">ğŸ” ÙˆØ±ÙˆØ¯</button>
                    <button class="sim-btn" onclick="simNav('/dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
                    <button class="sim-btn" onclick="simNav('/lessons')">ğŸ“š Ø¯Ø±ÙˆØ³</button>
                    <button class="sim-btn" onclick="simNav('/profile')">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
                    <button class="sim-btn" onclick="simNav('/admin')">âš™ï¸ Ø§Ø¯Ù…ÛŒÙ†</button>
                </div>
                <div>
                    <button class="sim-btn" onclick="simGoBack()">â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                    <button class="sim-btn" onclick="simNav('/invalid')">âŒ Ù…Ø³ÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
                </div>
            `;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† listener Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            activeRouter.onRouteChange(updateSimUI);
            
            updateSimUI();
            console.log('âœ… Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ÙØ¹Ø§Ù„ Ø´Ø¯');
        }
        
        function simLoginUser() {
            if (!activeRouter) return;
            activeRouter.setAuth(true, 'user');
            activeRouter.navigate('/dashboard');
        }
        
        function simLoginAdmin() {
            if (!activeRouter) return;
            activeRouter.setAuth(true, 'admin');
            activeRouter.navigate('/admin');
        }
        
        function simLogout() {
            if (!activeRouter) return;
            activeRouter.setAuth(false, 'guest');
            updateSimUI();
        }
        
        function simNav(path) {
            if (!activeRouter) return;
            activeRouter.navigate(path);
        }
        
        function simGoBack() {
            if (!activeRouter) return;
            activeRouter.goBack();
        }
        
        function updateSimUI() {
            if (!activeRouter) return;
            
            document.getElementById('current-route').textContent = activeRouter.currentRoute;
            
            const statusEl = document.getElementById('user-status');
            if (activeRouter.isAuthenticated) {
                statusEl.textContent = `âœ… Ù„Ø§Ú¯ÛŒÙ† (${activeRouter.userRole})`;
                statusEl.style.color = '#4caf50';
            } else {
                statusEl.textContent = 'âŒ Ù„Ø§Ú¯ÛŒÙ† Ù†Ø´Ø¯Ù‡';
                statusEl.style.color = '#f44336';
            }
        }

        // ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        let passedTests = 0;
        let failedTests = 0;

        async function runAllTests() {
            passedTests = 0;
            failedTests = 0;
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            for (const test of simpleTests) {
                const testDiv = document.createElement('div');
                testDiv.className = 'test-section';
                
                try {
                    const result = await test.run();
                    
                    const testResult = result ? 'pass' : 'fail';
                    const resultText = result ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚';
                    
                    if (result) passedTests++;
                    else failedTests++;
                    
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result ${testResult}">${resultText}</div>
                        </div>
                    `;
                    
                    console.log(`ØªØ³Øª ${test.id}: ${result ? 'âœ…' : 'âŒ'}`);
                    
                } catch (error) {
                    failedTests++;
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result fail">âŒ Ø®Ø·Ø§</div>
                        </div>
                        <div class="details">${error.message}</div>
                    `;
                    console.error(`Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª ${test.id}:`, error);
                }
                
                resultsDiv.appendChild(testDiv);
                updateSummary();
            }
        }

        function clearTests() {
            document.getElementById('test-results').innerHTML = '';
            passedTests = failedTests = 0;
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('summary-text');
            const total = simpleTests.length;
            const percentage = total > 0 ? Math.round((passedTests / total) * 100) : 0;
            
            let message = `âœ… ${passedTests} Ù…ÙˆÙÙ‚ | âŒ ${failedTests} Ù†Ø§Ù…ÙˆÙÙ‚ | ğŸ“Š ${percentage}% Ù‚Ø¨ÙˆÙ„ÛŒ`;
            
            if (percentage === 100) message += ' ğŸ†';
            else if (percentage >= 80) message += ' ğŸ‘';
            
            summary.textContent = message;
            summary.style.color = percentage === 100 ? '#4caf50' : 
                                 percentage >= 80 ? '#ff9800' : '#f44336';
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ³Øªâ€ŒÙ‡Ø§
        window.onload = () => {
            updateSummary();
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>
