<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ - Farsinglish</title>
    <style>
        * { box-sizing: border-box; font-family: Vazir, Tahoma, sans-serif; }
        body { background: #f0f2f5; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { margin: 0; font-size: 1.5rem; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50; }
        input, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: 0.3s; }
        input:focus { border-color: #3498db; outline: none; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; }
        button { flex: 1; min-width: 120px; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .log-panel { background: #1e272e; color: #00ff00; padding: 15px; border-radius: 10px; font-family: monospace; height: 200px; overflow-y: auto; font-size: 0.9rem; direction: ltr; text-align: left; margin-top: 15px; }
        .status-badge { display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 0.9rem; margin: 5px 0; }
        .status-online { background: #27ae60; color: white; }
        .status-offline { background: #7f8c8d; color: white; }
        .step-indicator { display: flex; margin: 20px 0; padding: 0; list-style: none; }
        .step { flex: 1; text-align: center; padding: 10px; background: #ecf0f1; margin: 0 5px; border-radius: 8px; color: #7f8c8d; }
        .step.active { background: #3498db; color: white; font-weight: bold; }
        .step.completed { background: #27ae60; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ (Login/Logout Flow)</h2>
            <p>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ ÙˆØ±ÙˆØ¯ØŒ Ø®Ø±ÙˆØ¬ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø´Ø³Øª</p>
        </div>

        <!-- Ù…Ø±Ø§Ø­Ù„ ØªØ³Øª -->
        <ul class="step-indicator" id="stepIndicator">
            <li class="step active" id="step1">Û±. Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</li>
            <li class="step" id="step2">Û². ÙˆØ±ÙˆØ¯</li>
            <li class="step" id="step3">Û³. Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</li>
            <li class="step" id="step4">Û´. Ø®Ø±ÙˆØ¬</li>
            <li class="step" id="step5">Ûµ. ÙˆØ±ÙˆØ¯ Ù…Ø¬Ø¯Ø¯</li>
        </ul>

        <!-- Ú©Ø§Ø±Øª ÙˆØ¶Ø¹ÛŒØª -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ</h3>
                <span class="status-badge status-online" id="authStatusDisplay">ÙˆØ¶Ø¹ÛŒØª: Ø¢ÙÙ„Ø§ÛŒÙ†</span>
            </div>
            <div id="userInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                <p>ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: <span id="displayUsername">ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡</span></p>
                <p>ğŸ”‘ ØªÙˆÚ©Ù†: <span id="displayToken">-</span></p>
                <p>â±ï¸ Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§: <span id="displayExpiry">-</span></p>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… -->
        <div class="card" id="registerCard">
            <h3>ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
            <div class="form-group">
                <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Û³-Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ±):</label>
                <input type="text" id="regUsername" placeholder="example" value="testuser">
            </div>
            <div class="form-group">
                <label>Ø§ÛŒÙ…ÛŒÙ„:</label>
                <input type="email" id="regEmail" placeholder="user@example.com" value="test@example.com">
            </div>
            <div class="form-group">
                <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±):</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" value="123456">
            </div>
            <button class="btn-primary" onclick="handleRegister()">ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
        </div>

        <!-- Ú©Ø§Ø±Øª ÙˆØ±ÙˆØ¯ -->
        <div class="card" id="loginCard">
            <h3>ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨</h3>
            <div class="form-group">
                <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø§ÛŒÙ…ÛŒÙ„:</label>
                <input type="text" id="loginUsername" placeholder="username or email" value="testuser">
            </div>
            <div class="form-group">
                <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" value="123456">
            </div>
            <div class="btn-group">
                <button class="btn-success" onclick="handleLogin()">ğŸ”“ ÙˆØ±ÙˆØ¯</button>
                <button class="btn-secondary" onclick="clearSession()">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ø´Ø³Øª</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯) -->
        <div class="card" id="dashboardCard" style="display: none;">
            <h3>ğŸ“‹ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ú©Ø§Ø±Ø¨Ø±</h3>
            <div style="background: #27ae60; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p>âœ… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯ÛŒØ¯</p>
            </div>
            <div class="btn-group">
                <button class="btn-danger" onclick="handleLogout()">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨</button>
                <button class="btn-warning" onclick="checkSession()">ğŸ”„ Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª</button>
                <button class="btn-secondary" onclick="refreshToken()">ğŸ”„ ØªÙ…Ø¯ÛŒØ¯ ØªÙˆÚ©Ù†</button>
            </div>
            <div style="margin-top: 15px;">
                <p>ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨:</p>
                <pre id="dashboardInfo" style="background: #f0f0f0; padding: 10px; border-radius: 5px;"></pre>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ -->
        <div class="btn-group">
            <button class="btn-warning" onclick="simulateExpiredToken()">â° Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†Ù‚Ø¶Ø§ÛŒ ØªÙˆÚ©Ù†</button>
            <button class="btn-secondary" onclick="clearAllData()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
        </div>

        <!-- Ù¾Ù†Ù„ Ù„Ø§Ú¯ -->
        <div class="card">
            <h3>ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ ØªØ³Øª</h3>
            <div class="log-panel" id="logPanel">
                â±ï¸ Ù…Ù†ØªØ¸Ø± Ø¹Ù…Ù„ÛŒØ§Øª...
            </div>
            <div style="margin-top: 10px;">
                <button class="btn-secondary" onclick="copyLogs()">ğŸ“‹ Ú©Ù¾ÛŒ Ù„Ø§Ú¯</button>
                <button class="btn-secondary" onclick="clearLogs()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
            </div>
        </div>
    </div>

    <script>
        // ---------- Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ----------
        class AuthService {
            constructor() {
                this.STORAGE_KEY = 'farsinglish_auth';
                this.USERS_KEY = 'farsinglish_users';
                this.currentUser = null;
                this.token = null;
                this.tokenExpiry = null;
                this.loadSession();
            }

            // Ù‡Ø´ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª)
            async hashPassword(password) {
                const msgBuffer = new TextEncoder().encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }

            // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            async register(username, email, password) {
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                if (!username || username.length < 3 || username.length > 20) {
                    throw new Error('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û³ ØªØ§ Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }
                if (!email || !email.includes('@') || !email.includes('.')) {
                    throw new Error('Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                }
                if (!password || password.length < 6) {
                    throw new Error('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }

                // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù†
                const users = this.getUsers();
                if (users[username]) {
                    throw new Error('Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
                }

                // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±
                const hashedPassword = await this.hashPassword(password);
                users[username] = {
                    username,
                    email,
                    password: hashedPassword,
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };
                localStorage.setItem(this.USERS_KEY, JSON.stringify(users));
                
                return { success: true, message: 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯' };
            }

            // ÙˆØ±ÙˆØ¯
            async login(identifier, password) {
                const users = this.getUsers();
                let foundUser = null;

                // Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø§ÛŒÙ…ÛŒÙ„
                for (let username in users) {
                    if (username === identifier || users[username].email === identifier) {
                        foundUser = users[username];
                        break;
                    }
                }

                if (!foundUser) {
                    throw new Error('Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }

                const hashedPassword = await this.hashPassword(password);
                if (hashedPassword !== foundUser.password) {
                    throw new Error('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                }

                // Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù†
                this.currentUser = foundUser;
                this.token = this.generateToken(foundUser.username);
                this.tokenExpiry = Date.now() + (60 * 60 * 1000); // 1 Ø³Ø§Ø¹Øª

                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯
                foundUser.lastLogin = new Date().toISOString();
                users[foundUser.username] = foundUser;
                localStorage.setItem(this.USERS_KEY, JSON.stringify(users));
                
                this.saveSession();
                return { success: true, user: foundUser, token: this.token };
            }

            // ØªÙˆÙ„ÛŒØ¯ ØªÙˆÚ©Ù† (JWT Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
            generateToken(username) {
                const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
                const payload = btoa(JSON.stringify({ 
                    username, 
                    iat: Date.now(),
                    exp: this.tokenExpiry,
                    jti: Math.random().toString(36).substring(2)
                }));
                const signature = btoa('fake-signature-for-testing');
                return `${header}.${payload}.${signature}`;
            }

            // Ø®Ø±ÙˆØ¬
            logout() {
                this.currentUser = null;
                this.token = null;
                this.tokenExpiry = null;
                localStorage.removeItem(this.STORAGE_KEY);
            }

            // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª
            checkSession() {
                if (!this.token || !this.tokenExpiry) return false;
                if (Date.now() > this.tokenExpiry) {
                    this.logout();
                    return false;
                }
                return true;
            }

            // ØªÙ…Ø¯ÛŒØ¯ ØªÙˆÚ©Ù†
            refreshToken() {
                if (!this.checkSession()) {
                    throw new Error('Ù†Ø´Ø³Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                }
                this.tokenExpiry = Date.now() + (60 * 60 * 1000);
                this.token = this.generateToken(this.currentUser.username);
                this.saveSession();
                return this.token;
            }

            // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø³Øª
            saveSession() {
                if (!this.currentUser || !this.token) return;
                const session = {
                    user: this.currentUser,
                    token: this.token,
                    expiry: this.tokenExpiry
                };
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(session));
            }

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø³Øª
            loadSession() {
                const saved = localStorage.getItem(this.STORAGE_KEY);
                if (saved) {
                    try {
                        const session = JSON.parse(saved);
                        this.currentUser = session.user;
                        this.token = session.token;
                        this.tokenExpiry = session.expiry;
                        if (Date.now() > this.tokenExpiry) {
                            this.logout();
                        }
                    } catch (e) {
                        this.logout();
                    }
                }
            }

            // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
            getUsers() {
                const users = localStorage.getItem(this.USERS_KEY);
                return users ? JSON.parse(users) : {};
            }

            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            clearAll() {
                this.logout();
                localStorage.removeItem(this.USERS_KEY);
                localStorage.removeItem(this.STORAGE_KEY);
            }
        }

        // ---------- Ù†Ù…ÙˆÙ†Ù‡ Ø§ØµÙ„ÛŒ ----------
        const auth = new AuthService();

        // ---------- ØªÙˆØ§Ø¨Ø¹ Ù„Ø§Ú¯ ----------
        function addLog(message, type = 'info') {
            const logPanel = document.getElementById('logPanel');
            const time = new Date().toLocaleTimeString('fa-IR');
            const emoji = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            logPanel.innerHTML += `<div>[${time}] ${emoji} ${message}</div>`;
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logPanel').innerHTML = 'â±ï¸ Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯...';
            addLog('Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯');
        }

        function copyLogs() {
            const logText = document.getElementById('logPanel').innerText;
            navigator.clipboard.writeText(logText);
            addLog('ğŸ“‹ Ù„Ø§Ú¯ Ú©Ù¾ÛŒ Ø´Ø¯');
        }

        // ---------- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ----------
        function updateUI() {
            const isLoggedIn = auth.checkSession();
            const statusEl = document.getElementById('authStatusDisplay');
            const userInfoEl = document.getElementById('displayUsername');
            const tokenEl = document.getElementById('displayToken');
            const expiryEl = document.getElementById('displayExpiry');

            if (isLoggedIn && auth.currentUser) {
                statusEl.className = 'status-badge status-online';
                statusEl.textContent = 'ÙˆØ¶Ø¹ÛŒØª: Ø¢Ù†Ù„Ø§ÛŒÙ†';
                userInfoEl.textContent = auth.currentUser.username;
                tokenEl.textContent = auth.token ? auth.token.substring(0, 20) + '...' : '-';
                const expiryDate = new Date(auth.tokenExpiry);
                expiryEl.textContent = expiryDate.toLocaleString('fa-IR');

                document.getElementById('registerCard').style.display = 'none';
                document.getElementById('loginCard').style.display = 'none';
                document.getElementById('dashboardCard').style.display = 'block';
                
                const dashboardInfo = document.getElementById('dashboardInfo');
                dashboardInfo.textContent = JSON.stringify({
                    username: auth.currentUser.username,
                    email: auth.currentUser.email,
                    lastLogin: auth.currentUser.lastLogin,
                    tokenExpiry: new Date(auth.tokenExpiry).toLocaleString('fa-IR')
                }, null, 2);

                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø±Ø§Ø­Ù„
                document.querySelectorAll('.step').forEach(s => s.className = 'step');
                document.getElementById('step3').className = 'step active';
                if (auth.currentUser.lastLogin) {
                    document.getElementById('step2').className = 'step completed';
                }
                document.getElementById('step1').className = 'step completed';
            } else {
                statusEl.className = 'status-badge status-offline';
                statusEl.textContent = 'ÙˆØ¶Ø¹ÛŒØª: Ø¢ÙÙ„Ø§ÛŒÙ†';
                userInfoEl.textContent = 'ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡';
                tokenEl.textContent = '-';
                expiryEl.textContent = '-';

                document.getElementById('registerCard').style.display = 'block';
                document.getElementById('loginCard').style.display = 'block';
                document.getElementById('dashboardCard').style.display = 'none';

                document.querySelectorAll('.step').forEach(s => s.className = 'step');
                document.getElementById('step1').className = 'step active';
            }
        }

        // ---------- ØªÙˆØ§Ø¨Ø¹ Ù‡Ù†Ø¯Ù„Ø± ----------
        async function handleRegister() {
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;

            try {
                addLog(`ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±: ${username}`, 'info');
                const result = await auth.register(username, email, password);
                addLog(`âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚: ${username}`, 'success');
                alert('âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: ${error.message}`, 'error');
                alert(`âŒ Ø®Ø·Ø§: ${error.message}`);
            }
        }

        async function handleLogin() {
            const identifier = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            try {
                addLog(`ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯: ${identifier}`, 'info');
                const result = await auth.login(identifier, password);
                addLog(`âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚: ${result.user.username}`, 'success');
                updateUI();
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ÛŒ ÙˆØ±ÙˆØ¯: ${error.message}`, 'error');
                alert(`âŒ Ø®Ø·Ø§: ${error.message}`);
            }
        }

        function handleLogout() {
            auth.logout();
            addLog('ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'warning');
            updateUI();
        }

        function clearSession() {
            auth.logout();
            addLog('ğŸ§¹ Ù†Ø´Ø³Øª Ù¾Ø§Ú© Ø´Ø¯', 'warning');
            updateUI();
        }

        function checkSession() {
            const isValid = auth.checkSession();
            if (isValid) {
                addLog('âœ… Ù†Ø´Ø³Øª Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'success');
                alert('âœ… Ù†Ø´Ø³Øª Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
            } else {
                addLog('âŒ Ù†Ø´Ø³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'error');
                alert('âŒ Ù†Ø´Ø³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
            }
            updateUI();
        }

        function refreshToken() {
            try {
                const newToken = auth.refreshToken();
                addLog('ğŸ”„ ØªÙˆÚ©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ…Ø¯ÛŒØ¯ Ø´Ø¯', 'success');
                updateUI();
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙ…Ø¯ÛŒØ¯ ØªÙˆÚ©Ù†: ${error.message}`, 'error`);
                alert(`âŒ Ø®Ø·Ø§: ${error.message}`);
            }
        }

        function simulateExpiredToken() {
            if (auth.tokenExpiry) {
                auth.tokenExpiry = Date.now() - 1000;
                auth.saveSession();
                addLog('â° Ø§Ù†Ù‚Ø¶Ø§ÛŒ ØªÙˆÚ©Ù† Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯', 'warning');
                checkSession();
            } else {
                addLog('âš ï¸ Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª', 'warning');
            }
        }

        function clearAllData() {
            auth.clearAll();
            addLog('ğŸ—‘ï¸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù¾Ø§Ú© Ø´Ø¯', 'warning');
            updateUI();
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            updateUI();
            addLog('ğŸš€ ØªØ³Øª Ø¬Ø±ÛŒØ§Ù† ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
            addLog('ğŸ‘† Ù…Ø±Ø§Ø­Ù„ Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯: Û±) Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Û²) ÙˆØ±ÙˆØ¯ Û³) Ø®Ø±ÙˆØ¬');
        };
    </script>
</body>
</html>
