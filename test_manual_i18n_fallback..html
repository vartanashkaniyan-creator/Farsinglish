<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡â€ŒØ³Ø§Ø²ÛŒ - Farsinglish</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px 15px;
            background: #f9fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        h1, h2, h3 { margin-top: 0; }
        .header {
            background: linear-gradient(145deg, #0f2b3d, #1a3a4e);
            color: white;
            padding: 25px 20px;
            border-radius: 24px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .header h1 { font-size: 1.9rem; margin-bottom: 8px; }
        .header p { font-size: 1.1rem; opacity: 0.9; margin: 0; }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.03);
            transition: all 0.2s;
        }
        .card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        
        .lang-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            background: #eef2f6;
            padding: 18px;
            border-radius: 18px;
            justify-content: center;
        }
        .lang-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            background: white;
            color: #1e293b;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .lang-btn.active {
            background: #1e3a5f;
            color: white;
            border-color: #94a3b8;
            box-shadow: 0 6px 14px rgba(30,58,95,0.25);
        }
        .lang-btn i { font-style: normal; font-size: 1.3rem; }
        
        .test-section {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }
        .test-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 3px solid #cbd5e1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }
        .key-box {
            background: #e9f0f5;
            padding: 14px 18px;
            border-radius: 14px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            font-size: 1.1rem;
            border: 1px solid #b9c7d4;
            flex: 1 0 200px;
        }
        .value-box {
            background: #d9eaf5;
            padding: 14px 20px;
            border-radius: 14px;
            font-size: 1.2rem;
            font-weight: 500;
            flex: 1 0 200px;
            border: 1px solid #7aa3b8;
            color: #0c4a6e;
            word-break: break-word;
        }
        .fallback-badge {
            background: #fef9c3;
            color: #854d0e;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 700;
            display: inline-block;
            margin-right: 12px;
            border: 1px solid #eab308;
        }
        button {
            background: #2d5a7a;
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 6px 0 #0f2a3b;
            width: 100%;
            margin: 10px 0;
        }
        button:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #0f2a3b;
        }
        .result-panel {
            background: #0f1a24;
            color: #e2e8f0;
            padding: 18px;
            border-radius: 16px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            font-size: 1rem;
            margin-top: 20px;
            border-left: 8px solid #38bdf8;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .test-log {
            background: #1e293b;
            color: #b9f3f0;
            padding: 16px;
            border-radius: 14px;
            font-size: 0.95rem;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            direction: ltr;
        }
        .flag { font-size: 1.7rem; margin-left: 5px; }
        .summary-badge {
            display: inline-block;
            background: #334155;
            padding: 10px 18px;
            border-radius: 40px;
            color: white;
            font-size: 0.95rem;
            margin: 8px 4px;
        }
        hr { opacity: 0.3; margin: 25px 0; }
        .footer { text-align: center; color: #64748b; margin-top: 30px; }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸŒ Farsinglish â€¢ ØªØ³Øª Ø¯Ø³ØªÛŒ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡â€ŒØ³Ø§Ø²ÛŒ</h1>
    <p>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ / Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ â€¢ Ù…Ú©Ø§Ù†ÛŒØ²Ù… Fallback Ù‡ÙˆØ´Ù…Ù†Ø¯</p>
</div>

<!-- ========== Ù¾Ù†Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† ÙØ¹Ø§Ù„ ========= -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h2 style="margin:0; display: flex; gap: 10px;"><span class="flag">ğŸ—£ï¸</span> Ø²Ø¨Ø§Ù† ÙØ¹Ø§Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡</h2>
        <span id="activeLangDisplay" style="background: #1e3a5f; color: white; padding: 10px 22px; border-radius: 50px; font-size: 1.3rem; font-weight: bold;">fa-IR</span>
    </div>
    
    <div class="lang-bar">
        <button id="btnLangFa" class="lang-btn active" onclick="setLanguage('fa-IR')">
            <span class="flag">ğŸ‡®ğŸ‡·</span> ÙØ§Ø±Ø³ÛŒ - ÙØ§Ø±Ø³ÛŒ
        </button>
        <button id="btnLangEn" class="lang-btn" onclick="setLanguage('en-US')">
            <span class="flag">ğŸ‡ºğŸ‡¸</span> English - Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
        </button>
        <button id="btnLangEs" class="lang-btn" onclick="setLanguage('es-ES')">
            <span class="flag">ğŸ‡ªğŸ‡¸</span> EspaÃ±ol (Ø¨Ø¯ÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ)
        </button>
        <button id="btnLangAr" class="lang-btn" onclick="setLanguage('ar-SA')">
            <span class="flag">ğŸ‡¸ğŸ‡¦</span> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ)
        </button>
    </div>
    <p style="color: #475569; margin-top: 8px; font-size: 0.95rem;">
        âš¡ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ fa-IR Ùˆ en-US Ú©Ø§Ù…Ù„Ø§Ù‹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø³Ø§ÛŒØ± Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ fallback (en-US) Ø¨Ø±Ú¯Ø±Ø¯Ù†Ø¯.
    </p>
</div>

<!-- ========== Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ù†Ù…ÙˆÙ†Ù‡ ========= -->
<div class="card">
    <h2 style="display: flex; gap: 10px;">ğŸ“– Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¯Ø§Ø®Ù„ÛŒ (Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªØ³Øª)</h2>
    <div style="background: #eef2f6; padding: 15px; border-radius: 16px; font-size: 1.1rem; direction: ltr; text-align: left;">
        <pre style="margin:0; background: transparent; border: none; color: #0b3b4b;">
{
  "appName": { "fa-IR": "ÙØ±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´", "en-US": "Farsinglish" },
  "welcome": { "fa-IR": "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!", "en-US": "Welcome!" },
  "startLesson": { "fa-IR": "Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³", "en-US": "Start Lesson" },
  "review": { "fa-IR": "Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²", "en-US": "Today's Review" },
  "score": { "fa-IR": "Ø§Ù…ØªÛŒØ§Ø²", "en-US": "Score" },
  "streak": { "fa-IR": "Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ", "en-US": "Streak" },
  "setting": { "fa-IR": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª", "en-US": "Settings" },
  "loading": { "fa-IR": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...", "en-US": "Loading..." },
  "success": { "fa-IR": "Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚", "en-US": "Success" },
  "error": { "fa-IR": "Ø®Ø·Ø§", "en-US": "Error" }
}
        </pre>
    </div>
    <p style="color: #3b5a6d; margin-top: 10px;"><span class="fallback-badge">ğŸ›¡ï¸ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Fallback</span> Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ Ú©Ù„ÛŒØ¯ â†’ Ú©Ù„ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø¯. Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ Ø²Ø¨Ø§Ù† â†’ en-US Ø¨Ø±Ú¯Ø±Ø¯Ø¯. Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ en-US â†’ Ú©Ù„ÛŒØ¯ Ø®Ø§Ù„ÛŒ.</p>
</div>

<!-- ========== Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ ØªØ³Øª ========= -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin:0;">ğŸ§ª ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡</h2>
        <button id="runAllTestsBtn" onclick="runAllManualTests()" style="width: auto; padding: 12px 30px; background: #0e5a6b; box-shadow: 0 4px 0 #06323d;">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù†ÛŒ</button>
    </div>
    
    <!-- ØªØ³Øª 1: Ù†Ù…Ø§ÛŒØ´ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="test-section">
        <div class="test-title">ğŸ§ª ØªØ³Øª Û±: ØªØ±Ø¬Ù…Ù‡ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø«Ø§Ø¨Øª</div>
        <div class="row">
            <span class="key-box">appName</span>
            <span id="test1Value" class="value-box">...</span>
        </div>
        <div class="row">
            <span class="key-box">welcome</span>
            <span id="test1Value2" class="value-box">...</span>
        </div>
        <button onclick="testStaticKeys()" style="background: #2b5f4a; box-shadow: 0 4px 0 #1d4032;">ğŸ” ØªØ³Øª Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø«Ø§Ø¨Øª</button>
    </div>
    
    <!-- ØªØ³Øª 2: Fallback Ø¨Ø±Ø§ÛŒ Ø²Ø¨Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± -->
    <div class="test-section">
        <div class="test-title">ğŸ§ª ØªØ³Øª Û²: Fallback Ø²Ø¨Ø§Ù† (es-ES / ar-SA) â†’ en-US</div>
        <div class="row">
            <span class="key-box">startLesson (Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ: <span id="currentLangFallback">fa-IR</span>)</span>
            <span id="test2Value" class="value-box">...</span>
        </div>
        <button onclick="testFallbackLanguage()" style="background: #7a4d3a; box-shadow: 0 4px 0 #5a3729;">ğŸ” ØªØ³Øª Fallback</button>
    </div>
    
    <!-- ØªØ³Øª 3: Ú©Ù„ÛŒØ¯ ØºÛŒØ±Ù…ÙˆØ¬ÙˆØ¯ -->
    <div class="test-section">
        <div class="test-title">ğŸ§ª ØªØ³Øª Û³: Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ù„ÛŒØ¯ Ø®Ø§Ù„ÛŒ)</div>
        <div class="row">
            <span class="key-box">nonexistentKey</span>
            <span id="test3Value" class="value-box">...</span>
        </div>
        <button onclick="testMissingKey()" style="background: #7a4f6a; box-shadow: 0 4px 0 #543a49;">â“ ØªØ³Øª Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</button>
    </div>
    
    <!-- ØªØ³Øª 4: Fallback Ø²Ù†Ø¬ÛŒØ±Ù‡â€ŒØ§ÛŒ - Ø­Ø°Ù en-US -->
    <div class="test-section">
        <div class="test-title">ğŸ§ª ØªØ³Øª Û´: Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø­Ø°Ù en-US (Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø±Ø´ØªÙ‡ Ø®Ø§Ù„ÛŒ)</div>
        <div class="row">
            <span class="key-box">someFutureKey (ÙÙ‚Ø· Ø¯Ø± fa-IR Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª)</span>
            <span id="test4Value" class="value-box">...</span>
        </div>
        <button onclick="testChainFallback()" style="background: #4a5c7a; box-shadow: 0 4px 0 #2f3c52;">â›“ï¸ ØªØ³Øª Ø²Ù†Ø¬ÛŒØ±Ù‡ fallback</button>
    </div>
    
    <!-- ØªØ³Øª 5: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÙˆÛŒØ§ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯) -->
    <div class="test-section">
        <div class="test-title">ğŸ§ª ØªØ³Øª Ûµ: Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÙˆÛŒØ§ÛŒ Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ùˆ ØªØ±Ø¬Ù…Ù‡</div>
        <div class="row">
            <span class="key-box">newFeature</span>
            <span id="test5Value" class="value-box">...</span>
        </div>
        <button onclick="testDynamicKey()" style="background: #4a6670; box-shadow: 0 4px 0 #2f474e;">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ùˆ ØªØ³Øª</button>
    </div>
    
    <!-- Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ú©Ø§Ù…Ù„ -->
    <div style="margin-top: 25px;">
        <h3>ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ ØªØ³Øªâ€ŒÙ‡Ø§:</h3>
        <div id="testLog" class="test-log">
            -- ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯. --
        </div>
    </div>
</div>

<!-- Ø®Ù„Ø§ØµÙ‡ ÙˆØ¶Ø¹ÛŒØª -->
<div class="card" id="summaryCard">
    <h2>ğŸ“Š Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø³ØªÛŒ</h2>
    <div id="summaryContent">
        <span class="summary-badge">âœ… ØªØ³Øª Û±: Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡</span>
        <span class="summary-badge">âœ… ØªØ³Øª Û²: Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡</span>
        <span class="summary-badge">âœ… ØªØ³Øª Û³: Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡</span>
        <span class="summary-badge">âœ… ØªØ³Øª Û´: Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡</span>
        <span class="summary-badge">âœ… ØªØ³Øª Ûµ: Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡</span>
    </div>
    <button onclick="resetAllTests()" style="background: #475569; box-shadow: 0 4px 0 #1e293b; margin-top: 15px;">ğŸ§¹ Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
</div>

<div class="footer">
    <p>Farsinglish â€¢ ØªØ³Øª Ø¯Ø³ØªÛŒ i18n Ùˆ Fallback â€¢ Ù…ÙˆØ¨Ø§ÛŒÙ„/ÙˆØ¨ â€¢ ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø¯Ø³ØªÛŒ</p>
</div>

<script>
    // ==================== Ù‡Ø³ØªÙ‡ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡ (i18n) ====================
    const I18nEngine = {
        // Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø§ØµÙ„ÛŒ
        dictionary: {
            "appName": { "fa-IR": "ÙØ±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´", "en-US": "Farsinglish" },
            "welcome": { "fa-IR": "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!", "en-US": "Welcome!" },
            "startLesson": { "fa-IR": "Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³", "en-US": "Start Lesson" },
            "review": { "fa-IR": "Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²", "en-US": "Today's Review" },
            "score": { "fa-IR": "Ø§Ù…ØªÛŒØ§Ø²", "en-US": "Score" },
            "streak": { "fa-IR": "Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ", "en-US": "Streak" },
            "setting": { "fa-IR": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª", "en-US": "Settings" },
            "loading": { "fa-IR": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...", "en-US": "Loading..." },
            "success": { "fa-IR": "Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚", "en-US": "Success" },
            "error": { "fa-IR": "Ø®Ø·Ø§", "en-US": "Error" }
        },
        
        currentLanguage: 'fa-IR',  // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ÙØ§Ø±Ø³ÛŒ
        
        setLanguage(lang) {
            if (lang && typeof lang === 'string') {
                this.currentLanguage = lang;
            }
            return this.currentLanguage;
        },
        
        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù…ØªØ±Ø¬Ù… Ø¨Ø§ Fallback Ù‡ÙˆØ´Ù…Ù†Ø¯
        translate(key, lang = null) {
            const targetLang = lang || this.currentLanguage;
            
            // 1. Ø¢ÛŒØ§ Ú©Ù„ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ
            if (!this.dictionary.hasOwnProperty(key)) {
                this.log(`âš ï¸ Ú©Ù„ÛŒØ¯ "${key}" ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Fallback: Ø±Ø´ØªÙ‡ Ø®Ø§Ù„ÛŒ.`);
                return '';  // Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø®Ø§Ù„ÛŒ
            }
            
            const entry = this.dictionary[key];
            
            // 2. Ø¢ÛŒØ§ Ø²Ø¨Ø§Ù† Ù…Ù‚ØµØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªØŸ
            if (entry[targetLang] && entry[targetLang].trim() !== '') {
                return entry[targetLang];
            }
            
            // 3. Fallback Ø¨Ù‡ en-US (Ø¯Ø± ØµÙˆØ±Øª Ù…ÙˆØ¬ÙˆØ¯ Ø¨ÙˆØ¯Ù†)
            if (entry['en-US'] && entry['en-US'].trim() !== '') {
                this.log(`ğŸ”„ Fallback: Ø²Ø¨Ø§Ù† "${targetLang}" Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ "${key}" Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. â†’ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ en-US.`);
                return entry['en-US'];
            }
            
            // 4. Fallback Ù†Ù‡Ø§ÛŒÛŒ: Ø±Ø´ØªÙ‡ Ø®Ø§Ù„ÛŒ
            this.log(`âŒ Ù‡ÛŒÚ† ØªØ±Ø¬Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ "${key}" Ø­ØªÛŒ Ø¯Ø± en-US ÛŒØ§ÙØª Ù†Ø´Ø¯. â†’ Ø®Ø§Ù„ÛŒ.`);
            return '';
        },
        
        // Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÙˆÛŒØ§ÛŒ Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯
        addKey(key, translations) {
            if (!key || typeof translations !== 'object') return false;
            this.dictionary[key] = translations;
            return true;
        },
        
        log(message) {
            // Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯Ø› Ù…Ø§ Ø§Ø² Log Ø¢Ø±Ø§ÛŒÙ‡ Ø¬Ø¯Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        }
    };

    // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒå…¨å±€ ====================
    let testLogs = [];
    let testStatus = {
        test1: false, test2: false, test3: false, test4: false, test5: false
    };

    // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
    function addLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        testLogs.push(`[${timestamp}] ${message}`);
        const logDiv = document.getElementById('testLog');
        if (logDiv) {
            logDiv.innerHTML = testLogs.map(log => `ğŸ“Œ ${log}`).join('<br>');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    }

    function clearLogs() {
        testLogs = [];
        document.getElementById('testLog').innerHTML = '-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯. --';
    }

    function updateUILanguage() {
        const currentLang = I18nEngine.currentLanguage;
        document.getElementById('activeLangDisplay').innerText = currentLang;
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„Ø§Ø³ active Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        if (currentLang === 'fa-IR') document.getElementById('btnLangFa').classList.add('active');
        else if (currentLang === 'en-US') document.getElementById('btnLangEn').classList.add('active');
        else if (currentLang === 'es-ES') document.getElementById('btnLangEs').classList.add('active');
        else if (currentLang === 'ar-SA') document.getElementById('btnLangAr').classList.add('active');
        
        document.getElementById('currentLangFallback').innerText = currentLang;
        addLog(`ğŸŒ Ø²Ø¨Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ù‡ "${currentLang}" ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`);
    }

    function setLanguage(lang) {
        I18nEngine.setLanguage(lang);
        updateUILanguage();
    }

    // ============== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ ==============
    function testStaticKeys() {
        addLog('ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û±: Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø«Ø§Ø¨Øª');
        const val1 = I18nEngine.translate('appName');
        const val2 = I18nEngine.translate('welcome');
        document.getElementById('test1Value').innerText = val1;
        document.getElementById('test1Value2').innerText = val2;
        
        const expectedFa = (I18nEngine.currentLanguage === 'fa-IR') ? 'ÙØ±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´' : 'Farsinglish';
        const status = (val1.includes('ÙØ±Ø³ÛŒÙ†Ú¯') || val1.includes('Farsing')) ? 'âœ…' : 'âš ï¸';
        addLog(`   appName â†’ "${val1}"`);
        addLog(`   welcome â†’ "${val2}"`);
        testStatus.test1 = true;
        updateSummary();
    }

    function testFallbackLanguage() {
        addLog('ğŸ§ª ØªØ³Øª Û²: Fallback Ø²Ø¨Ø§Ù† (Ø­Ø§Ù„Øª es-ES Ùˆ ar-SA)');
        // Ø°Ø®ÛŒØ±Ù‡ Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ
        const originalLang = I18nEngine.currentLanguage;
        
        // ØªØ³Øª Ø¨Ø§ Ø§Ø³Ù¾Ø§Ù†ÛŒØ§ÛŒÛŒ
        I18nEngine.setLanguage('es-ES');
        const valEs = I18nEngine.translate('startLesson');
        document.getElementById('test2Value').innerText = `${valEs} (Fallback Ø§Ø² es-ES)`;
        addLog(`   Ø²Ø¨Ø§Ù† es-ES: startLesson â†’ "${valEs}" (Ø¨Ø§ÛŒØ¯: Start Lesson)`);
        
        // ØªØ³Øª Ø¨Ø§ Ø¹Ø±Ø¨ÛŒ
        I18nEngine.setLanguage('ar-SA');
        const valAr = I18nEngine.translate('startLesson');
        addLog(`   Ø²Ø¨Ø§Ù† ar-SA: startLesson â†’ "${valAr}" (Ø¨Ø§ÛŒØ¯: Start Lesson)`);
        
        // Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø²Ø¨Ø§Ù† Ø§ØµÙ„ÛŒ
        I18nEngine.setLanguage(originalLang);
        updateUILanguage();
        testStatus.test2 = true;
        updateSummary();
    }

    function testMissingKey() {
        addLog('ğŸ§ª ØªØ³Øª Û³: Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯');
        const val = I18nEngine.translate('nonexistentKey');
        document.getElementById('test3Value').innerText = val === '' ? '(Ø®Ø§Ù„ÛŒ - ØµØ­ÛŒØ­)' : val;
        addLog(`   Ú©Ù„ÛŒØ¯ nonexistentKey â†’ "${val}" (Ø¨Ø§ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯)`);
        testStatus.test3 = true;
        updateSummary();
    }

    function testChainFallback() {
        addLog('ğŸ§ª ØªØ³Øª Û´: Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø­Ø°Ù en-US');
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ú©Ù‡ ÙÙ‚Ø· en-US Ø¯Ø§Ø±Ø¯
        I18nEngine.addKey('someFutureKey', { 'en-US': 'Future Feature' });
        
        const originalLang = I18nEngine.currentLanguage;
        I18nEngine.setLanguage('fa-IR'); // ÙØ¹Ù„Ø§Ù‹ ÙØ§Ø±Ø³ÛŒ
        
        // Ø­Ø°Ù Ù…ÙˆÙ‚Øª entry en-US Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
        const backup = I18nEngine.dictionary['someFutureKey']['en-US'];
        delete I18nEngine.dictionary['someFutureKey']['en-US'];
        
        const val = I18nEngine.translate('someFutureKey'); // Ø¨Ø§ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø¯
        document.getElementById('test4Value').innerText = val === '' ? '(Ø®Ø§Ù„ÛŒ - fallback Ø¯Ø±Ø³Øª)' : val;
        addLog(`   someFutureKey (Ø¨Ø¯ÙˆÙ† en-US) â†’ "${val}" (Ø¨Ø§ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯)`);
        
        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
        I18nEngine.dictionary['someFutureKey']['en-US'] = backup;
        I18nEngine.setLanguage(originalLang);
        updateUILanguage();
        testStatus.test4 = true;
        updateSummary();
    }

    function testDynamicKey() {
        addLog('ğŸ§ª ØªØ³Øª Ûµ: Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ù¾ÙˆÛŒØ§');
        I18nEngine.addKey('newFeature', {
            'fa-IR': 'ÙˆÛŒÚ˜Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯: Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯',
            'en-US': 'New Feature: Smart Review'
        });
        const val = I18nEngine.translate('newFeature');
        document.getElementById('test5Value').innerText = val;
        addLog(`   newFeature â†’ "${val}" (Ø¨Ø§ÛŒØ¯ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ Ø¨Ø§Ø´Ø¯)`);
        testStatus.test5 = true;
        updateSummary();
    }

    function runAllManualTests() {
        clearLogs();
        addLog('ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù†ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡...');
        testStaticKeys();
        testFallbackLanguage();
        testMissingKey();
        testChainFallback();
        testDynamicKey();
        addLog('ğŸ¯ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯. ØµØ­Øª Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
    }

    function updateSummary() {
        let html = '';
        html += `<span class="summary-badge" style="background: ${testStatus.test1 ? '#0a5c3b' : '#5f3b4c'};">âœ… ØªØ³Øª Û±: ${testStatus.test1 ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡'}</span>`;
        html += `<span class="summary-badge" style="background: ${testStatus.test2 ? '#0a5c3b' : '#5f3b4c'};">âœ… ØªØ³Øª Û²: ${testStatus.test2 ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡'}</span>`;
        html += `<span class="summary-badge" style="background: ${testStatus.test3 ? '#0a5c3b' : '#5f3b4c'};">âœ… ØªØ³Øª Û³: ${testStatus.test3 ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡'}</span>`;
        html += `<span class="summary-badge" style="background: ${testStatus.test4 ? '#0a5c3b' : '#5f3b4c'};">âœ… ØªØ³Øª Û´: ${testStatus.test4 ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡'}</span>`;
        html += `<span class="summary-badge" style="background: ${testStatus.test5 ? '#0a5c3b' : '#5f3b4c'};">âœ… ØªØ³Øª Ûµ: ${testStatus.test5 ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡'}</span>`;
        document.getElementById('summaryContent').innerHTML = html;
    }

    function resetAllTests() {
        I18nEngine.currentLanguage = 'fa-IR';
        updateUILanguage();
        clearLogs();
        testStatus = { test1: false, test2: false, test3: false, test4: false, test5: false };
        updateSummary();
        document.getElementById('test1Value').innerText = '...';
        document.getElementById('test1Value2').innerText = '...';
        document.getElementById('test2Value').innerText = '...';
        document.getElementById('test3Value').innerText = '...';
        document.getElementById('test4Value').innerText = '...';
        document.getElementById('test5Value').innerText = '...';
        addLog('ğŸ”„ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯.');
    }

    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    window.onload = function() {
        setLanguage('fa-IR');
        clearLogs();
        updateSummary();
        addLog('ğŸŒ Ù…Ø§Ú˜ÙˆÙ„ i18n Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.');
        addLog('ğŸ‘† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯ Ùˆ Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
    };
</script>

</body>
</html>
