<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>âœ… SRS SM-2 Master - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 28px;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .badge {
            background: #00b894;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .scenario-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        .status-pass { background: #00b894; color: white; padding: 5px 15px; border-radius: 50px; }
        .status-fail { background: #d63031; color: white; padding: 5px 15px; border-radius: 50px; }
        .status-pending { background: #fdcb6e; color: #2d3436; padding: 5px 15px; border-radius: 50px; }
        button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin: 5px;
        }
        button:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        .result-box {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            direction: ltr;
        }
        .summary-box {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  Farsinglish - SRS SM-2 Master</h1>
        <div style="text-align: center;">
            <span class="badge">âœ… ÙØ±Ù…ÙˆÙ„ SM-2 Ø¯Ù‚ÛŒÙ‚ (Anki/SuperMemo)</span>
        </div>

        <div id="scenarios-container"></div>
        
        <div style="display: flex; gap: 15px; margin: 25px 0;">
            <button onclick="resetAllScenarios()" style="flex: 1; background: #636e72;">ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡</button>
            <button onclick="exportLog()" style="flex: 1; background: #0984e3;">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯</button>
        </div>

        <div id="summary" class="summary-box">
            <h3>ğŸ“Š Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª</h3>
        </div>
        <div id="log-panel" style="background: rgba(0,0,0,0.5); border-radius: 15px; padding: 15px; margin-top: 20px; font-family: monospace; direction: ltr;"></div>
    </div>

    <script>
        // -------------------- Ú©Ù„Ø§Ø³ SRS Ø¨Ø§ ÙØ±Ù…ÙˆÙ„ SM-2 Ø¯Ù‚ÛŒÙ‚ --------------------
        class SRSScheduler {
            calculateNextReview(quality, repetitions, easeFactor, interval = 0) {
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                if (quality < 0 || quality > 5) throw new Error('Ú©ÛŒÙÛŒØª Û°-Ûµ');
                
                // Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª < 3)
                if (quality < 3) {
                    return {
                        interval: 1,
                        repetitions: 0,
                        easeFactor: Math.max(1.3, parseFloat((easeFactor - 0.2).toFixed(2)))
                    };
                }

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡
                let newInterval;
                if (repetitions === 0) newInterval = 1;
                else if (repetitions === 1) newInterval = 6;
                else newInterval = Math.round(interval * easeFactor);

                // ÙØ±Ù…ÙˆÙ„ SM-2 Ø¨Ø±Ø§ÛŒ EF (Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø·Ø§Ø¨Ù‚ Ù…Ø³ØªÙ†Ø¯Ø§Øª)
                let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                
                // Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ú¯Ø±Ø¯ Ú©Ø±Ø¯Ù†
                newEaseFactor = Math.max(1.3, Math.min(3.0, newEaseFactor));
                newEaseFactor = Math.round(newEaseFactor * 100) / 100;

                return {
                    interval: newInterval,
                    repetitions: repetitions + 1,
                    easeFactor: newEaseFactor
                };
            }
        }

        // -------------------- Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª (Ù…Ù‚Ø§Ø¯ÛŒØ± ØµØ­ÛŒØ­ SM-2) --------------------
        const scenarios = [
            { 
                id: 1, title: 'ğŸŒŸ Ø§ÙˆÙ„ÛŒÙ† Ù…ÙˆØ§Ø¬Ù‡Ù‡ - Ú©ÛŒÙÛŒØª Ûµ', 
                params: { q: 5, rep: 0, ef: 2.5, int: 0 },
                exp: { interval: 1, repetitions: 1, easeFactor: 2.60 }
            },
            { 
                id: 2, title: 'ğŸ“š Ù…Ø±ÙˆØ± Ø§ÙˆÙ„ - Ú©ÛŒÙÛŒØª Û´', 
                params: { q: 4, rep: 1, ef: 2.5, int: 1 },
                exp: { interval: 6, repetitions: 2, easeFactor: 2.50 }
            },
            { 
                id: 3, title: 'ğŸ”„ Ù…Ø±ÙˆØ± Ø¯ÙˆÙ… - Ú©ÛŒÙÛŒØª Ûµ', 
                params: { q: 5, rep: 2, ef: 2.5, int: 6 },
                exp: { interval: 15, repetitions: 3, easeFactor: 2.60 }
            },
            { 
                id: 4, title: 'âŒ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª - Ú©ÛŒÙÛŒØª Û±', 
                params: { q: 1, rep: 3, ef: 2.6, int: 15 },
                exp: { interval: 1, repetitions: 0, easeFactor: 2.40 }
            },
            { 
                id: 5, title: 'ğŸ”„ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø¬Ø¯Ø¯ - Ú©ÛŒÙÛŒØª Û³', 
                params: { q: 3, rep: 0, ef: 2.5, int: 0 },
                exp: { interval: 1, repetitions: 1, easeFactor: 2.36 }
            },
            { 
                id: 6, title: 'âš¡ Ù…Ø±ÙˆØ± Ø·ÙˆÙ„Ø§Ù†ÛŒ - Ú©ÛŒÙÛŒØª Ûµ', 
                params: { q: 5, rep: 10, ef: 2.8, int: 120 },
                exp: { interval: 336, repetitions: 11, easeFactor: 2.90 }
            },
            { 
                id: 7, title: 'ğŸ“‰ Ø§ÙØª Ú©ÛŒÙÛŒØª - Ú©ÛŒÙÛŒØª Û²', 
                params: { q: 2, rep: 5, ef: 2.7, int: 30 },
                exp: { interval: 1, repetitions: 0, easeFactor: 2.50 }
            },
            { 
                id: 8, title: 'ğŸ¯ Ù…Ø±ÙˆØ± Ù…Ø±Ø²ÛŒ - Ú©ÛŒÙÛŒØª Û³', 
                params: { q: 3, rep: 4, ef: 2.5, int: 20 },
                exp: { interval: 50, repetitions: 5, easeFactor: 2.36 }
            }
        ];

        const scheduler = new SRSScheduler();
        let logEntries = [];
        const STORAGE_KEY = 'srs_master_v1';

        // -------------------- Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª --------------------
        function saveStatus(id, passed) {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            data[id] = passed ? 'pass' : 'fail';
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function getStatus(id) {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            return data[id] || 'pending';
        }

        // -------------------- Ø±Ù†Ø¯Ø± --------------------
        function renderScenarios() {
            let html = '';
            scenarios.forEach(s => {
                const status = getStatus(s.id);
                let statusClass = 'status-pending';
                let statusText = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                if (status === 'pass') { statusClass = 'status-pass'; statusText = 'âœ… ØªØ£ÛŒÛŒØ¯'; }
                else if (status === 'fail') { statusClass = 'status-fail'; statusText = 'âŒ Ø®Ø·Ø§'; }

                html += `<div class="scenario-card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-size: 18px; font-weight: bold;">ğŸ§ª Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${s.id}: ${s.title}</span>
                        <span class="${statusClass}" id="status-${s.id}">${statusText}</span>
                    </div>
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; margin-bottom: 15px;">
                        <div>ğŸ“Š ÙˆØ±ÙˆØ¯ÛŒ: Ú©ÛŒÙÛŒØª=${s.params.q}, ØªÚ©Ø±Ø§Ø±=${s.params.rep}, EF=${s.params.ef}, ÙØ§ØµÙ„Ù‡=${s.params.int}</div>
                        <div style="color: #81ecec; margin-top: 5px;">ğŸ¯ Ø®Ø±ÙˆØ¬ÛŒ ØµØ­ÛŒØ­: ÙØ§ØµÙ„Ù‡=${s.exp.interval}, ØªÚ©Ø±Ø§Ø±=${s.exp.repetitions}, EF=${s.exp.easeFactor}</div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="runScenario(${s.id})" style="flex: 1;">âš¡ Ø§Ø¬Ø±Ø§</button>
                        <button onclick="verifyScenario(${s.id})" style="flex: 1; background: #00b894;">âœ“ ØªØ£ÛŒÛŒØ¯</button>
                        <button onclick="resetScenario(${s.id})" style="flex: 0.3; background: #636e72;">ğŸ”„</button>
                    </div>
                    <div id="result-${s.id}" class="result-box" style="display: none;"></div>
                </div>`;
            });
            document.getElementById('scenarios-container').innerHTML = html;
            updateSummary();
        }

        // -------------------- Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ --------------------
        window.runScenario = function(id) {
            const s = scenarios.find(x => x.id === id);
            const res = scheduler.calculateNextReview(s.params.q, s.params.rep, s.params.ef, s.params.int);
            
            const div = document.getElementById(`result-${id}`);
            div.style.display = 'block';
            div.innerHTML = `
                <div style="color: #00cec9; font-size: 18px; margin-bottom: 10px;">ğŸ“Œ Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡:</div>
                <div style="display: grid; grid-template-columns: repeat(3,1fr); gap: 10px;">
                    <div><span style="color: #aaa;">ÙØ§ØµÙ„Ù‡</span><br><span style="font-size: 32px; font-weight: bold;">${res.interval}</span></div>
                    <div><span style="color: #aaa;">ØªÚ©Ø±Ø§Ø±</span><br><span style="font-size: 32px; font-weight: bold;">${res.repetitions}</span></div>
                    <div><span style="color: #aaa;">EF</span><br><span style="font-size: 32px; font-weight: bold;">${res.easeFactor}</span></div>
                </div>
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <span style="color: ${res.interval === s.exp.interval ? '#00b894' : '#d63031'}">
                        ${res.interval === s.exp.interval ? 'âœ“' : 'âœ—'} ÙØ§ØµÙ„Ù‡: ${res.interval} (Ù‡Ø¯Ù: ${s.exp.interval})
                    </span><br>
                    <span style="color: ${res.easeFactor === s.exp.easeFactor ? '#00b894' : '#d63031'}">
                        ${res.easeFactor === s.exp.easeFactor ? 'âœ“' : 'âœ—'} EF: ${res.easeFactor} (Ù‡Ø¯Ù: ${s.exp.easeFactor})
                    </span>
                </div>
            `;
            addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: Ø§Ø¬Ø±Ø§ - ÙØ§ØµÙ„Ù‡=${res.interval}, EF=${res.easeFactor}`);
        };

        // -------------------- ØªØ£ÛŒÛŒØ¯ Ø³Ù†Ø§Ø±ÛŒÙˆ --------------------
        window.verifyScenario = function(id) {
            const s = scenarios.find(x => x.id === id);
            const res = scheduler.calculateNextReview(s.params.q, s.params.rep, s.params.ef, s.params.int);
            
            const intervalOK = res.interval === s.exp.interval;
            const repOK = res.repetitions === s.exp.repetitions;
            const efOK = res.easeFactor === s.exp.easeFactor;
            const passed = intervalOK && repOK && efOK;

            const statusEl = document.getElementById(`status-${id}`);
            statusEl.className = passed ? 'status-pass' : 'status-fail';
            statusEl.textContent = passed ? 'âœ… ØªØ£ÛŒÛŒØ¯' : 'âŒ Ø®Ø·Ø§';
            
            saveStatus(id, passed);
            
            if (passed) addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯`, 'success');
            else {
                let reason = [];
                if (!intervalOK) reason.push(`ÙØ§ØµÙ„Ù‡(${res.interval}â‰ ${s.exp.interval})`);
                if (!efOK) reason.push(`EF(${res.easeFactor}â‰ ${s.exp.easeFactor})`);
                addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: âŒ ${reason.join(', ')}`, 'error');
            }
            
            updateSummary();
        };

        window.resetScenario = function(id) {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            delete data[id];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            
            const statusEl = document.getElementById(`status-${id}`);
            statusEl.className = 'status-pending';
            statusEl.textContent = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
            
            document.getElementById(`result-${id}`).style.display = 'none';
            addLog(`Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ${id}: Ø±ÛŒØ³Øª Ø´Ø¯`);
            updateSummary();
        };

        window.resetAllScenarios = function() {
            localStorage.removeItem(STORAGE_KEY);
            renderScenarios();
            addLog('ğŸ”„ Ù‡Ù…Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯');
        };

        function updateSummary() {
            let passed = 0, total = scenarios.length;
            scenarios.forEach(s => { if (getStatus(s.id) === 'pass') passed++; });
            document.getElementById('summary').innerHTML = `
                <h3>ğŸ“Š Ù¾ÛŒØ´Ø±ÙØª: ${passed}/${total}</h3>
                <div style="background: rgba(0,0,0,0.3); height: 20px; border-radius: 10px; margin-top: 15px;">
                    <div style="background: #00b894; width: ${(passed/total)*100}%; height: 20px; border-radius: 10px;"></div>
                </div>
                ${passed === total ? '<h2 style="color: #00b894; margin-top: 15px;">ğŸ‰ ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù†Ø¯!</h2>' : ''}
            `;
        }

        function addLog(msg, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR');
            logEntries.push({ time, msg, type });
            const logHtml = logEntries.slice(-8).map(e => 
                `<div style="color: ${e.type === 'success' ? '#00b894' : e.type === 'error' ? '#d63031' : '#fdcb6e'}">[${e.time}] ${e.msg}</div>`
            ).join('');
            document.getElementById('log-panel').innerHTML = logHtml;
        }

        window.exportLog = function() {
            const text = logEntries.map(e => `[${e.time}] ${e.msg}`).join('\n');
            const blob = new Blob([text], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `srs-master-${Date.now()}.txt`;
            a.click();
            addLog('ğŸ“¥ Ù„Ø§Ú¯ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯');
        };

        window.onload = renderScenarios;
    </script>
</body>
</html>
