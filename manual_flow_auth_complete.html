<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª - Farsinglish</title>
    <style>
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f7fb;
            color: #1e293b;
            line-height: 1.6;
        }
        h1 {
            font-size: 1.8rem;
            color: #0f172a;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
            margin-bottom: 24px;
        }
        h2 {
            font-size: 1.3rem;
            margin-top: 28px;
            color: #334155;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            margin: 8px 8px 8px 0;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #2563eb;
        }
        button:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        button.secondary {
            background: white;
            color: #1e293b;
            border: 1px solid #cbd5e1;
        }
        button.secondary:hover {
            background: #f8fafc;
        }
        .console {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            direction: ltr;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            border: 2px solid #334155;
            margin-top: 16px;
        }
        .console .info { color: #7dd3fc; }
        .console .success { color: #86efac; }
        .console .error { color: #fca5a5; }
        .console .warn { color: #fde047; }
        .badge {
            display: inline-block;
            background: #e2e8f0;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 8px;
            color: #334155;
        }
        hr {
            border: none;
            border-top: 2px dashed #cbd5e1;
            margin: 24px 0;
        }
        .step {
            background: #f8fafc;
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            border-right: 4px solid #3b82f6;
        }
        .step.completed {
            border-right-color: #22c55e;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>ğŸ“± Farsinglish Â· ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h1>
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span><span class="badge">Ú¯Ø§Ù… Û± Ø§Ø² Ûµ</span> Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±</span>
            <span style="color: #64748b;">ğŸ§ª Û¶ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¯Ø³ØªÛŒ</span>
        </div>
    </div>

    <!-- ÙˆØ¶Ø¹ÛŒØª Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
            <h2 style="margin:0">ğŸ“‹ Ú©Ù†Ø³ÙˆÙ„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡</h2>
            <button class="secondary" onclick="clearLog()" style="padding:6px 16px">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
        </div>
        <div id="logConsole" class="console">
            [info] Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª...
        </div>
    </div>

    <!-- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ (Fake) Ø¨Ø±Ø§ÛŒ ØªØ³Øª -->
    <div class="card">
        <h2>ğŸ” Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h2>
        <p style="color: #475569;">Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ (Fake) Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø±ÙØªØ§Ø±ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù‚Ø§Ø¨Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ø§Ø±Ù†Ø¯.</p>
        <button onclick="runStep('init')">ğŸ” Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</button>
        <button onclick="runStep('register')" class="secondary">ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</button>
        <button onclick="runStep('login')">ğŸ”“ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± test</button>
        <button onclick="runStep('logout')">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨</button>
        <button onclick="runStep('session')">ğŸ‘¤ Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª Ø¬Ø§Ø±ÛŒ</button>
        <button onclick="runStep('protected')">ğŸ›¡ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø­Ø§ÙØ¸Øªâ€ŒØ´Ø¯Ù‡</button>
        <button onclick="runStep('reload')">ğŸ”„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯</button>
        <hr>
        <button onclick="runCompleteFlow()" style="background:#10b981; border-color:#059669;">âš¡ Ø§Ø¬Ø±Ø§ÛŒ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ (Ûµ Ú¯Ø§Ù…)</button>
        <button onclick="resetAll()" class="secondary" style="background:#fee2e2; color:#991b1b;">ğŸ”„ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø­Ø§ÙØ¸Ù‡</button>
    </div>

    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª -->
    <div class="card">
        <h2>ğŸ§­ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</h2>
        <div id="step1" class="step">Û±. Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡: Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
        <div id="step2" class="step">Û². Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
        <div id="step3" class="step">Û³. ÙˆØ±ÙˆØ¯: ØªÙˆÚ©Ù† JWT Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ø´Ø³Øª ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
        <div id="step4" class="step">Û´. Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø§Ø¹ØªØ¨Ø§Ø± ØªÙˆÚ©Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</div>
        <div id="step5" class="step">Ûµ. Ø®Ø±ÙˆØ¬: Ù†Ø´Ø³Øª Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØµÙØ­Ø§Øª Ù…Ø­Ø¯ÙˆØ¯ ØºÛŒØ±Ù…Ù…Ú©Ù† Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.</div>
        <div id="step6" class="step">Û¶. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯: Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ø´Ø³Øª.</div>
    </div>

    <script>
        // ---------- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Fake Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ (Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø³ØªÙ‚Ù„ØŒ Ø¨Ø¯ÙˆÙ† IO ÙˆØ§Ù‚Ø¹ÛŒ) ----------
        const fakeDB = {
            users: new Map(),
            sessions: new Map(),
            async get(key) { return this.users.get(key) || null; },
            async set(key, val) { this.users.set(key, val); return true; },
            async delete(key) { return this.users.delete(key); }
        };

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª (pure logic)
        class FakeAuthService {
            constructor() {
                this.currentUser = null;
                this.token = null;
                this.refreshToken = null;
                this.listeners = [];
            }

            // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡: Ø§Ú¯Ø± Ù†Ø´Ø³Øª Ù‚Ø¨Ù„ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø¨ÙˆØ¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù† (Ø§ÛŒÙ†Ø¬Ø§ Ø¬Ø¹Ù„ÛŒ)
            async init() {
                log('info', 'ğŸ”„ Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø´Ø¯');
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø´Ø³Øª Ø§Ø² localStorage (Ø¯Ø± ØªØ³Øª Ø¬Ø¹Ù„ÛŒ)
                const saved = localStorage.getItem('fake_session');
                if (saved) {
                    try {
                        const sess = JSON.parse(saved);
                        if (sess.token && sess.user) {
                            this.currentUser = sess.user;
                            this.token = sess.token;
                            log('success', 'âœ… Ù†Ø´Ø³Øª Ù‚Ø¨Ù„ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯: ' + sess.user.username);
                        } else localStorage.removeItem('fake_session');
                    } catch { localStorage.removeItem('fake_session'); }
                } else {
                    log('info', 'ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù† (Ø¨Ø¯ÙˆÙ† Ù†Ø´Ø³Øª)');
                }
                return { user: this.currentUser, token: this.token };
            }

            // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… (Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ)
            async register(username, password, email) {
                log('info', `ğŸ“ ØªÙ„Ø§Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: ${username} / ${email}`);
                // validation Ø³Ø§Ø¯Ù‡
                if (!username || username.length < 3) return { success: false, error: 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ø­Ø±Ù' };
                if (!password || password.length < 6) return { success: false, error: 'Ø±Ù…Ø² Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±' };
                if (!email || !email.includes('@')) return { success: false, error: 'Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±' };
                const exists = await fakeDB.get(username);
                if (exists) return { success: false, error: 'Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯' };

                const newUser = {
                    username,
                    passwordHash: 'fake_' + password + '_hash',  // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø´
                    email,
                    createdAt: new Date().toISOString()
                };
                await fakeDB.set(username, newUser);
                log('success', 'âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚: ' + username);
                return { success: true, user: { username, email } };
            }

            // ÙˆØ±ÙˆØ¯ (Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ø´ Ø¬Ø¹Ù„ÛŒ)
            async login(username, password) {
                log('info', `ğŸ”“ ØªÙ„Ø§Ø´ ÙˆØ±ÙˆØ¯: ${username}`);
                const user = await fakeDB.get(username);
                if (!user) return { success: false, error: 'Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯' };
                if (user.passwordHash !== ('fake_' + password + '_hash')) return { success: false, error: 'Ø±Ù…Ø² Ù†Ø§Ø¯Ø±Ø³Øª' };
                // ØªÙˆÙ„ÛŒØ¯ ØªÙˆÚ©Ù† Ø¬Ø¹Ù„ÛŒ (Ø¨Ø§ Ú©Ù„ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡)
                this.token = 'jwt_fake_' + Math.random().toString(36).substring(2);
                this.refreshToken = 'refresh_' + Math.random().toString(36).substring(2);
                this.currentUser = { username: user.username, email: user.email };
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ persistence
                localStorage.setItem('fake_session', JSON.stringify({ user: this.currentUser, token: this.token }));
                log('success', 'âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚. ØªÙˆÚ©Ù†: ' + this.token.substring(0,10)+'...');
                return { success: true, token: this.token, user: this.currentUser };
            }

            logout() {
                log('info', 'ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨');
                this.currentUser = null;
                this.token = null;
                this.refreshToken = null;
                localStorage.removeItem('fake_session');
                log('success', 'âœ… Ù†Ø´Ø³Øª Ù¾Ø§Ú© Ø´Ø¯');
                return true;
            }

            getSession() {
                if (this.currentUser && this.token) {
                    log('info', `ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ: ${this.currentUser.username} | ØªÙˆÚ©Ù† Ù…Ø¹ØªØ¨Ø±: ${this.token.substring(0,10)}...`);
                    return { user: this.currentUser, token: this.token };
                } else {
                    log('warn', 'âš ï¸ Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡');
                    return null;
                }
            }

            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø­Ø§ÙØ¸Øªâ€ŒØ´Ø¯Ù‡
            accessProtected() {
                if (this.currentUser && this.token) {
                    log('success', 'ğŸ›¡ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¬Ø§Ø² Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø­Ø§ÙØ¸Øªâ€ŒØ´Ø¯Ù‡ âœ…');
                    return true;
                } else {
                    log('error', 'ğŸš« Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²! Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
                    return false;
                }
            }
        }

        // ---------- Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ (Ø¬Ù‡Øª ØªØ³Øª Ø¯Ø³ØªÛŒ) ----------
        const auth = new FakeAuthService();

        // Ù„Ø§Ú¯ Ø¨Ù‡ Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ
        function log(level, message) {
            const consoleDiv = document.getElementById('logConsole');
            const entry = document.createElement('div');
            entry.className = level;
            const time = new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            entry.textContent = `[${time}] [${level}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logConsole').innerHTML = '[info] Ú©Ù†Ø³ÙˆÙ„ Ù¾Ø§Ú© Ø´Ø¯.';
            log('info', 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª...');
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø§Ù…â€ŒÙ‡Ø§
        function markStep(stepId) {
            const el = document.getElementById(stepId);
            if (el) el.classList.add('completed');
        }

        // Ø±ÛŒØ³Øª Ú¯Ø§Ù…â€ŒÙ‡Ø§
        function resetSteps() {
            for (let i=1; i<=6; i++) {
                const el = document.getElementById('step'+i);
                if (el) el.classList.remove('completed');
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø§ Ø¯Ú©Ù…Ù‡
        async function runStep(step) {
            try {
                if (step === 'init') {
                    resetSteps();
                    await auth.init();
                    markStep('step1');
                } else if (step === 'register') {
                    const res = await auth.register('testuser', '1234567', 'test@example.com');
                    if (res.success) markStep('step2');
                    else log('error', 'âŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ú©Ø³Øª: ' + res.error);
                } else if (step === 'login') {
                    const res = await auth.login('testuser', '1234567');
                    if (res.success) { markStep('step3'); markStep('step4'); }
                    else log('error', 'âŒ ÙˆØ±ÙˆØ¯ Ø´Ú©Ø³Øª: ' + res.error);
                } else if (step === 'logout') {
                    auth.logout();
                    markStep('step5');
                } else if (step === 'session') {
                    auth.getSession();
                } else if (step === 'protected') {
                    auth.accessProtected();
                } else if (step === 'reload') {
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡
                    log('warn', 'ğŸ”„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯... (localStorage Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)');
                    await auth.init();
                    markStep('step6');
                }
            } catch (e) {
                log('error', 'Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: ' + e.message);
            }
        }

        // Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± (Ûµ Ú¯Ø§Ù… Ù¾Ø´Øªâ€ŒØ³Ø±Ù‡Ù…)
        async function runCompleteFlow() {
            log('info', 'ğŸš€ Ø´Ø±ÙˆØ¹ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ ØªØ³Øª (Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… â†’ ÙˆØ±ÙˆØ¯ â†’ Ù†Ø´Ø³Øª â†’ Ø®Ø±ÙˆØ¬ â†’ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯)');
            resetSteps();
            // 1. init
            await auth.init();
            markStep('step1');
            // 2. Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            const reg = await auth.register('flowuser', 'pass1234', 'flow@example.com');
            if (!reg.success) { log('error', 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ø§Ù…ÙˆÙÙ‚'); return; }
            markStep('step2');
            // 3. ÙˆØ±ÙˆØ¯
            const loginRes = await auth.login('flowuser', 'pass1234');
            if (!loginRes.success) { log('error', 'ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚'); return; }
            markStep('step3');
            markStep('step4');
            // 4. Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª
            auth.getSession();
            // 5. Ø®Ø±ÙˆØ¬
            auth.logout();
            markStep('step5');
            // 6. Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ reload
            log('warn', 'ğŸ”„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡...');
            await auth.init();
            markStep('step6');
            log('success', 'âœ¨ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯ (Û¶ Ú¯Ø§Ù…)');
        }

        // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ (Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ)
        function resetAll() {
            fakeDB.users.clear();
            fakeDB.sessions.clear();
            auth.currentUser = null;
            auth.token = null;
            auth.refreshToken = null;
            localStorage.removeItem('fake_session');
            resetSteps();
            clearLog();
            log('info', 'ğŸ§¹ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ Ù¾Ø§Ú© Ø´Ø¯. ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù†Ù†Ø¯ Ù†Ùˆ Ø´Ø¯.');
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ (Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ú¯ÛŒ)
        (async () => {
            // Ø§ÙØ²ÙˆØ¯Ù† ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø±Ø§Ø­Øªâ€ŒØªØ±
            await fakeDB.set('testuser', { username: 'testuser', passwordHash: 'fake_1234567_hash', email: 'test@example.com' });
            log('info', 'ğŸ“¦ Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ testuser Ø¨Ø§ Ø±Ù…Ø² 1234567 Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.');
            await auth.init();
        })();

    </script>
</body>
</html>
