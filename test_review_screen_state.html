```html
<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª State ØµÙØ­Ù‡ Ù…Ø±ÙˆØ± (Review Screen State)</title>
    <style>
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            padding: 24px;
        }
        h1 {
            font-size: 1.8rem;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }
        h2 {
            font-size: 1.3rem;
            margin-top: 25px;
            color: #34495e;
        }
        .test-section {
            background: #f8fafd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }
        .state-panel {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            margin: 15px 0;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 200px;
            overflow-y: auto;
        }
        .button-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 30px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(52,152,219,0.3);
            border: 1px solid #2980b9;
            min-width: 120px;
            font-family: 'Vazir', 'Tahoma', sans-serif;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52,152,219,0.4);
        }
        button.secondary {
            background: #95a5a6;
            border-color: #7f8c8d;
            box-shadow: 0 2px 5px rgba(149,165,166,0.3);
        }
        button.secondary:hover {
            background: #7f8c8d;
        }
        button.success {
            background: #2ecc71;
            border-color: #27ae60;
            box-shadow: 0 2px 5px rgba(46,204,113,0.3);
        }
        button.success:hover {
            background: #27ae60;
        }
        button.warning {
            background: #f39c12;
            border-color: #e67e22;
            box-shadow: 0 2px 5px rgba(243,156,18,0.3);
        }
        button.warning:hover {
            background: #e67e22;
        }
        button.danger {
            background: #e74c3c;
            border-color: #c0392b;
            box-shadow: 0 2px 5px rgba(231,76,60,0.3);
        }
        button.danger:hover {
            background: #c0392b;
        }
        .test-result {
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            display: none;
        }
        .test-result.fail {
            background: #e74c3c;
        }
        .log-panel {
            background: #2d3748;
            color: #a0aec0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            direction: ltr;
            text-align: left;
            height: 150px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #4a5568;
        }
        .log-entry {
            color: #a0aec0;
            margin: 2px 0;
            border-bottom: 1px dotted #4a5568;
            padding: 2px 0;
        }
        .log-entry.debug { color: #63b3ed; }
        .log-entry.info { color: #68d391; }
        .log-entry.warn { color: #fbbf24; }
        .log-entry.error { color: #fc8181; }
        .badge {
            background: #3498db;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .flex-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 5px 0;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª State ØµÙØ­Ù‡ Ù…Ø±ÙˆØ± (Review Screen) <span class="badge">Ø¯Ø³ØªÛŒ + Ø¯Ú©Ù…Ù‡â€ŒØ§ÛŒ</span></h1>
        
        <!-- Ù†Ù…Ø§ÛŒØ´ State ÙØ¹Ù„ÛŒ -->
        <div class="test-section">
            <div class="flex-row" style="justify-content: space-between;">
                <h2>ğŸ“Š State ÙØ¹Ù„ÛŒ ØµÙØ­Ù‡ Ù…Ø±ÙˆØ±</h2>
                <div>
                    <button class="secondary" onclick="refreshStateDisplay()">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´</button>
                </div>
            </div>
            <div id="stateDisplay" class="state-panel">{
  "lessons": [],
  "currentLessonIndex": 0,
  "currentExerciseIndex": 0,
  "userAnswer": "",
  "showResult": false,
  "isCorrect": null,
  "loading": false,
  "error": null,
  "reviewComplete": false
}</div>
        </div>

        <!-- Ø¢Ù…Ø§Ø± -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="statLessons">0</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø³â€ŒÙ‡Ø§</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statCurrent">-</div>
                <div class="stat-label">Ø¯Ø±Ø³ ÙØ¹Ù„ÛŒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statExercise">-</div>
                <div class="stat-label">ØªÙ…Ø±ÛŒÙ† ÙØ¹Ù„ÛŒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statProgress">0%</div>
                <div class="stat-label">Ù¾ÛŒØ´Ø±ÙØª</div>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª State -->
        <div class="test-section">
            <h2>ğŸ® ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ State</h2>
            
            <div class="button-grid">
                <button onclick="testInitialState()">ğŸ†• Ø¨Ø±Ø±Ø³ÛŒ State Ø§ÙˆÙ„ÛŒÙ‡</button>
                <button onclick="testLoadLessons()">ğŸ“š Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§</button>
                <button onclick="testNextLesson()">â­ï¸ Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ</button>
                <button onclick="testPrevLesson()">â®ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„</button>
                <button onclick="testNextExercise()">â¡ï¸ ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ</button>
                <button onclick="testPrevExercise()">â¬…ï¸ ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ</button>
                <button onclick="testSubmitAnswer(true)">âœ… Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</button>
                <button onclick="testSubmitAnswer(false)">âŒ Ù¾Ø§Ø³Ø® ØºÙ„Ø·</button>
                <button onclick="testResetResult()">ğŸ”„ Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡</button>
                <button onclick="testSetLoading(true)">â³ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ loading</button>
                <button onclick="testSetLoading(false)">âœ… ØºÛŒØ±ÙØ¹Ø§Ù„ loading</button>
                <button onclick="testSetError()">âš ï¸ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§</button>
                <button onclick="testClearError()">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§</button>
                <button onclick="testCompleteReview()">ğŸ ØªÚ©Ù…ÛŒÙ„ Ù…Ø±ÙˆØ±</button>
                <button onclick="testResetState()">ğŸ”„ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ State</button>
            </div>

            <div style="margin-top: 20px;">
                <button class="success" onclick="runAllStateTests()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ State</button>
                <button class="secondary" onclick="clearLog()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
            </div>
        </div>

        <!-- Ù†ØªØ§ÛŒØ¬ ØªØ³Øª -->
        <div id="testResult" class="test-result">âœ… ØªØ³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ø³ Ø´Ø¯</div>

        <!-- Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ -->
        <div class="test-section">
            <h2>ğŸ“‹ Ù„Ø§Ú¯ ØªØºÛŒÛŒØ±Ø§Øª State</h2>
            <div id="logPanel" class="log-panel">
                <div class="log-entry info">â±ï¸ Ø¢Ù…Ø§Ø¯Ù‡â€ŒÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...</div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ReviewScreen State Manager ====================
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ State ØµÙØ­Ù‡ Ù…Ø±ÙˆØ± Ø¨Ø§ Ø§ØµÙˆÙ„ Immutability
        const ReviewScreenState = (() => {
            // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§
            const sampleLessons = [
                { id: 1, title: 'Ø¯Ø±Ø³ Û±: Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ', exercises: ['ØªÙ…Ø±ÛŒÙ† Û±-Û±', 'ØªÙ…Ø±ÛŒÙ† Û±-Û²', 'ØªÙ…Ø±ÛŒÙ† Û±-Û³'] },
                { id: 2, title: 'Ø¯Ø±Ø³ Û²: Ø§ÙØ¹Ø§Ù„', exercises: ['ØªÙ…Ø±ÛŒÙ† Û²-Û±', 'ØªÙ…Ø±ÛŒÙ† Û²-Û²'] },
                { id: 3, title: 'Ø¯Ø±Ø³ Û³: Ù„ØºØ§Øª', exercises: ['ØªÙ…Ø±ÛŒÙ† Û³-Û±', 'ØªÙ…Ø±ÛŒÙ† Û³-Û²', 'ØªÙ…Ø±ÛŒÙ† Û³-Û³', 'ØªÙ…Ø±ÛŒÙ† Û³-Û´'] },
                { id: 4, title: 'Ø¯Ø±Ø³ Û´: Ø§ØµØ·Ù„Ø§Ø­Ø§Øª', exercises: ['ØªÙ…Ø±ÛŒÙ† Û´-Û±'] }
            ];

            // State Ø§ÙˆÙ„ÛŒÙ‡ (immutable)
            let state = {
                lessons: [],  // Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ø®Ø§Ù„ÛŒ
                currentLessonIndex: 0,
                currentExerciseIndex: 0,
                userAnswer: "",
                showResult: false,
                isCorrect: null,
                loading: false,
                error: null,
                reviewComplete: false
            };

            // ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø±Ø§ÛŒ time travel (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
            const history = [];
            const maxHistory = 20;

            // Ø´Ù†ÙˆÙ†Ø¯Ú¯Ø§Ù† ØªØºÛŒÛŒØ±Ø§Øª
            const listeners = [];

            // ========== Ù…ØªØ¯Ù‡Ø§ÛŒ Ø®ØµÙˆØµÛŒ ==========
            function deepClone(obj) {
                return JSON.parse(JSON.stringify(obj));
            }

            function notifyListeners(prevState, newState, action) {
                listeners.forEach(listener => {
                    try {
                        listener(deepClone(prevState), deepClone(newState), action);
                    } catch (e) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± listener:', e);
                    }
                });
            }

            // ========== API Ø¹Ù…ÙˆÙ…ÛŒ ==========
            return {
                // Ø¯Ø±ÛŒØ§ÙØª Ú©Ù¾ÛŒ Ø§Ø² state (immutability)
                getState() {
                    return deepClone(state);
                },

                // ØªØºÛŒÛŒØ± state Ø¨Ø§ Ø§Ú©Ø´Ù† (Ù‡Ù…ÛŒØ´Ù‡ immutable)
                dispatch(action, payload) {
                    const prevState = deepClone(state);
                    
                    try {
                        switch(action) {
                            case 'SET_LESSONS':
                                state.lessons = payload ? deepClone(payload) : [];
                                state.currentLessonIndex = 0;
                                state.currentExerciseIndex = 0;
                                state.reviewComplete = false;
                                break;

                            case 'LOAD_SAMPLE_LESSONS':
                                state.lessons = deepClone(sampleLessons);
                                state.currentLessonIndex = 0;
                                state.currentExerciseIndex = 0;
                                state.reviewComplete = false;
                                break;

                            case 'NEXT_LESSON':
                                if (state.lessons.length === 0) break;
                                if (state.currentLessonIndex < state.lessons.length - 1) {
                                    state.currentLessonIndex++;
                                    state.currentExerciseIndex = 0;
                                    state.showResult = false;
                                    state.isCorrect = null;
                                }
                                break;

                            case 'PREV_LESSON':
                                if (state.lessons.length === 0) break;
                                if (state.currentLessonIndex > 0) {
                                    state.currentLessonIndex--;
                                    state.currentExerciseIndex = 0;
                                    state.showResult = false;
                                    state.isCorrect = null;
                                }
                                break;

                            case 'NEXT_EXERCISE':
                                if (state.lessons.length === 0) break;
                                const currentLesson = state.lessons[state.currentLessonIndex];
                                if (!currentLesson) break;
                                
                                if (state.currentExerciseIndex < currentLesson.exercises.length - 1) {
                                    state.currentExerciseIndex++;
                                    state.showResult = false;
                                    state.isCorrect = null;
                                    state.userAnswer = "";
                                } else {
                                    // Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø±ÛŒÙ† Ø±Ø³ÛŒØ¯Ù‡â€ŒØ§ÛŒÙ…
                                    if (state.currentLessonIndex === state.lessons.length - 1) {
                                        state.reviewComplete = true;
                                    }
                                }
                                break;

                            case 'PREV_EXERCISE':
                                if (state.lessons.length === 0) break;
                                if (state.currentExerciseIndex > 0) {
                                    state.currentExerciseIndex--;
                                    state.showResult = false;
                                    state.isCorrect = null;
                                    state.userAnswer = "";
                                }
                                break;

                            case 'SUBMIT_ANSWER':
                                state.userAnswer = payload?.answer || "";
                                state.isCorrect = payload?.isCorrect || false;
                                state.showResult = true;
                                break;

                            case 'RESET_RESULT':
                                state.showResult = false;
                                state.isCorrect = null;
                                state.userAnswer = "";
                                break;

                            case 'SET_LOADING':
                                state.loading = !!payload;
                                break;

                            case 'SET_ERROR':
                                state.error = payload || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡';
                                break;

                            case 'CLEAR_ERROR':
                                state.error = null;
                                break;

                            case 'COMPLETE_REVIEW':
                                state.reviewComplete = true;
                                break;

                            case 'RESET_STATE':
                                state = {
                                    lessons: [],
                                    currentLessonIndex: 0,
                                    currentExerciseIndex: 0,
                                    userAnswer: "",
                                    showResult: false,
                                    isCorrect: null,
                                    loading: false,
                                    error: null,
                                    reviewComplete: false
                                };
                                break;

                            default:
                                console.warn('Ø§Ú©Ø´Ù† Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡:', action);
                        }

                        // Ø«Ø¨Øª Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
                        history.push({ action, payload, state: deepClone(state) });
                        if (history.length > maxHistory) history.shift();

                        // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø´Ù†ÙˆÙ†Ø¯Ú¯Ø§Ù†
                        notifyListeners(prevState, deepClone(state), action);
                        
                        return true;
                    } catch (error) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± dispatch:', error);
                        return false;
                    }
                },

                // Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù†ÙˆÙ†Ø¯Ù‡
                subscribe(listener) {
                    listeners.push(listener);
                    return () => {
                        const index = listeners.indexOf(listener);
                        if (index > -1) listeners.splice(index, 1);
                    };
                },

                // Ø¯Ø±ÛŒØ§ÙØª ØªØ§Ø±ÛŒØ®Ú†Ù‡
                getHistory() {
                    return deepClone(history);
                }
            };
        })();

        // ==================== Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ ====================
        const TestLogger = {
            log(message, type = 'info') {
                const panel = document.getElementById('logPanel');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                panel.appendChild(entry);
                panel.scrollTop = panel.scrollHeight;
            },
            clear() {
                document.getElementById('logPanel').innerHTML = '<div class="log-entry info">â±ï¸ Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯...</div>';
            }
        };

        // ==================== Ù†Ù…Ø§ÛŒØ´ State ====================
        function refreshStateDisplay() {
            const state = ReviewScreenState.getState();
            document.getElementById('stateDisplay').textContent = JSON.stringify(state, null, 2);
            
            // Ø¢Ù…Ø§Ø±
            document.getElementById('statLessons').textContent = state.lessons.length;
            
            if (state.lessons.length > 0 && state.currentLessonIndex >= 0) {
                const lesson = state.lessons[state.currentLessonIndex];
                document.getElementById('statCurrent').textContent = lesson?.title || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                
                if (lesson) {
                    document.getElementById('statExercise').textContent = 
                        `ØªÙ…Ø±ÛŒÙ† ${state.currentExerciseIndex + 1} Ø§Ø² ${lesson.exercises.length}`;
                    
                    const progress = ((state.currentExerciseIndex + 1) / lesson.exercises.length) * 100;
                    document.getElementById('statProgress').textContent = Math.round(progress) + '%';
                }
            } else {
                document.getElementById('statCurrent').textContent = '-';
                document.getElementById('statExercise').textContent = '-';
                document.getElementById('statProgress').textContent = '0%';
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ State ====================
        function showResult(success, message) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.className = `test-result ${success ? 'success' : 'fail'}`;
            resultDiv.textContent = success ? `âœ… ${message}` : `âŒ ${message}`;
            
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 3000);
        }

        // ØªØ³Øª State Ø§ÙˆÙ„ÛŒÙ‡
        function testInitialState() {
            ReviewScreenState.dispatch('RESET_STATE');
            const state = ReviewScreenState.getState();
            
            if (state.lessons.length === 0 && 
                state.currentLessonIndex === 0 && 
                state.currentExerciseIndex === 0 &&
                state.loading === false &&
                state.error === null &&
                state.reviewComplete === false) {
                TestLogger.log('âœ… State Ø§ÙˆÙ„ÛŒÙ‡ ØµØ­ÛŒØ­ Ø§Ø³Øª', 'info');
                showResult(true, 'State Ø§ÙˆÙ„ÛŒÙ‡ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯');
            } else {
                TestLogger.log('âŒ State Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª', 'error');
                showResult(false, 'State Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§
        function testLoadLessons() {
            ReviewScreenState.dispatch('LOAD_SAMPLE_LESSONS');
            const state = ReviewScreenState.getState();
            
            if (state.lessons.length === 4) {
                TestLogger.log(`âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${state.lessons.length} Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª`, 'info');
                showResult(true, 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚');
            } else {
                TestLogger.log('âŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ
        function testNextLesson() {
            const before = ReviewScreenState.getState();
            if (before.lessons.length === 0) {
                TestLogger.log('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                showResult(false, 'Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            ReviewScreenState.dispatch('NEXT_LESSON');
            const after = ReviewScreenState.getState();
            
            if (before.currentLessonIndex < before.lessons.length - 1) {
                if (after.currentLessonIndex === before.currentLessonIndex + 1) {
                    TestLogger.log(`âœ… Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ: ${after.lessons[after.currentLessonIndex]?.title}`, 'info');
                    showResult(true, 'Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ Ù…ÙˆÙÙ‚');
                } else {
                    TestLogger.log('âŒ Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                    showResult(false, 'Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚');
                }
            } else {
                if (after.currentLessonIndex === before.currentLessonIndex) {
                    TestLogger.log('â„¹ï¸ Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø±Ø³ Ø§Ø³Øª - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯', 'debug');
                    showResult(true, 'Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø±Ø³ - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯');
                }
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„
        function testPrevLesson() {
            const before = ReviewScreenState.getState();
            if (before.lessons.length === 0) {
                TestLogger.log('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                showResult(false, 'Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            ReviewScreenState.dispatch('PREV_LESSON');
            const after = ReviewScreenState.getState();
            
            if (before.currentLessonIndex > 0) {
                if (after.currentLessonIndex === before.currentLessonIndex - 1) {
                    TestLogger.log(`âœ… Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„: ${after.lessons[after.currentLessonIndex]?.title}`, 'info');
                    showResult(true, 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„ Ù…ÙˆÙÙ‚');
                } else {
                    TestLogger.log('âŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                    showResult(false, 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„ Ù†Ø§Ù…ÙˆÙÙ‚');
                }
            } else {
                if (after.currentLessonIndex === 0) {
                    TestLogger.log('â„¹ï¸ Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø³ Ø§Ø³Øª - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯', 'debug');
                    showResult(true, 'Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø³ - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯');
                }
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ
        function testNextExercise() {
            const before = ReviewScreenState.getState();
            if (before.lessons.length === 0) {
                TestLogger.log('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                showResult(false, 'Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const currentLesson = before.lessons[before.currentLessonIndex];
            if (!currentLesson) return;
            
            ReviewScreenState.dispatch('NEXT_EXERCISE');
            const after = ReviewScreenState.getState();
            
            if (before.currentExerciseIndex < currentLesson.exercises.length - 1) {
                if (after.currentExerciseIndex === before.currentExerciseIndex + 1) {
                    TestLogger.log(`âœ… ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ: ${currentLesson.exercises[after.currentExerciseIndex]}`, 'info');
                    showResult(true, 'Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ Ù…ÙˆÙÙ‚');
                } else {
                    TestLogger.log('âŒ Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                    showResult(false, 'Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚');
                }
            } else {
                // Ø§Ú¯Ø± Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø±ÛŒÙ† Ø¨ÙˆØ¯ØŒ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒÙ… Ú©Ù‡ reviewComplete Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
                if (before.currentLessonIndex === before.lessons.length - 1) {
                    if (after.reviewComplete) {
                        TestLogger.log('âœ… Ù…Ø±ÙˆØ± Ú©Ø§Ù…Ù„ Ø´Ø¯', 'info');
                        showResult(true, 'Ù…Ø±ÙˆØ± Ú©Ø§Ù…Ù„ Ø´Ø¯');
                    }
                } else {
                    TestLogger.log('â„¹ï¸ Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø±ÛŒÙ† Ø¯Ø±Ø³ ÙØ¹Ù„ÛŒ - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯', 'debug');
                    showResult(true, 'Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø±ÛŒÙ† - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯');
                }
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ
        function testPrevExercise() {
            const before = ReviewScreenState.getState();
            if (before.lessons.length === 0) {
                TestLogger.log('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                showResult(false, 'Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            ReviewScreenState.dispatch('PREV_EXERCISE');
            const after = ReviewScreenState.getState();
            
            if (before.currentExerciseIndex > 0) {
                if (after.currentExerciseIndex === before.currentExerciseIndex - 1) {
                    TestLogger.log(`âœ… Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ: ${before.lessons[before.currentLessonIndex]?.exercises[after.currentExerciseIndex]}`, 'info');
                    showResult(true, 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ Ù…ÙˆÙÙ‚');
                } else {
                    TestLogger.log('âŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                    showResult(false, 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ù‚Ø¨Ù„ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚');
                }
            } else {
                TestLogger.log('â„¹ï¸ Ø§ÙˆÙ„ÛŒÙ† ØªÙ…Ø±ÛŒÙ† Ø§Ø³Øª - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯', 'debug');
                showResult(true, 'Ø§ÙˆÙ„ÛŒÙ† ØªÙ…Ø±ÛŒÙ† - ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø«Ø¨Øª Ù¾Ø§Ø³Ø®
        function testSubmitAnswer(isCorrect) {
            const before = ReviewScreenState.getState();
            if (before.lessons.length === 0) {
                TestLogger.log('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                showResult(false, 'Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            ReviewScreenState.dispatch('SUBMIT_ANSWER', {
                answer: isCorrect ? 'Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­' : 'Ù¾Ø§Ø³Ø® ØºÙ„Ø·',
                isCorrect: isCorrect
            });
            
            const after = ReviewScreenState.getState();
            
            if (after.showResult === true && after.isCorrect === isCorrect) {
                TestLogger.log(`âœ… Ø«Ø¨Øª Ù¾Ø§Ø³Ø® ${isCorrect ? 'ØµØ­ÛŒØ­' : 'ØºÙ„Ø·'} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª`, 'info');
                showResult(true, `Ù¾Ø§Ø³Ø® ${isCorrect ? 'ØµØ­ÛŒØ­' : 'ØºÙ„Ø·'} Ø«Ø¨Øª Ø´Ø¯`);
            } else {
                TestLogger.log('âŒ Ø«Ø¨Øª Ù¾Ø§Ø³Ø® Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ø«Ø¨Øª Ù¾Ø§Ø³Ø® Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡
        function testResetResult() {
            ReviewScreenState.dispatch('RESET_RESULT');
            const after = ReviewScreenState.getState();
            
            if (after.showResult === false && after.isCorrect === null && after.userAnswer === "") {
                TestLogger.log('âœ… Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª', 'info');
                showResult(true, 'Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡ Ù…ÙˆÙÙ‚');
            } else {
                TestLogger.log('âŒ Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡ Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª set loading
        function testSetLoading(loading) {
            ReviewScreenState.dispatch('SET_LOADING', loading);
            const after = ReviewScreenState.getState();
            
            if (after.loading === loading) {
                TestLogger.log(`âœ… ØªØºÛŒÛŒØ± loading Ø¨Ù‡ ${loading}`, 'info');
                showResult(true, `loading: ${loading}`);
            } else {
                TestLogger.log('âŒ ØªØºÛŒÛŒØ± loading Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'ØªØºÛŒÛŒØ± loading Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª set error
        function testSetError() {
            ReviewScreenState.dispatch('SET_ERROR', 'Ø®Ø·Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡');
            const after = ReviewScreenState.getState();
            
            if (after.error === 'Ø®Ø·Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡') {
                TestLogger.log('âœ… Ø®Ø·Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'info');
                showResult(true, 'Ø®Ø·Ø§ Ø«Ø¨Øª Ø´Ø¯');
            } else {
                TestLogger.log('âŒ Ø«Ø¨Øª Ø®Ø·Ø§ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ø«Ø¨Øª Ø®Ø·Ø§ Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª clear error
        function testClearError() {
            ReviewScreenState.dispatch('CLEAR_ERROR');
            const after = ReviewScreenState.getState();
            
            if (after.error === null) {
                TestLogger.log('âœ… Ø®Ø·Ø§ Ù¾Ø§Ú© Ø´Ø¯', 'info');
                showResult(true, 'Ø®Ø·Ø§ Ù¾Ø§Ú© Ø´Ø¯');
            } else {
                TestLogger.log('âŒ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª ØªÚ©Ù…ÛŒÙ„ Ù…Ø±ÙˆØ±
        function testCompleteReview() {
            ReviewScreenState.dispatch('COMPLETE_REVIEW');
            const after = ReviewScreenState.getState();
            
            if (after.reviewComplete === true) {
                TestLogger.log('âœ… Ù…Ø±ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯', 'info');
                showResult(true, 'Ù…Ø±ÙˆØ± ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯');
            } else {
                TestLogger.log('âŒ ØªÚ©Ù…ÛŒÙ„ Ù…Ø±ÙˆØ± Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'ØªÚ©Ù…ÛŒÙ„ Ù…Ø±ÙˆØ± Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // ØªØ³Øª Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ state
        function testResetState() {
            ReviewScreenState.dispatch('RESET_STATE');
            const after = ReviewScreenState.getState();
            
            if (after.lessons.length === 0 && after.currentLessonIndex === 0 && 
                after.currentExerciseIndex === 0 && after.error === null) {
                TestLogger.log('âœ… Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ state Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª', 'info');
                showResult(true, 'Ø±ÛŒØ³Øª state Ù…ÙˆÙÙ‚');
            } else {
                TestLogger.log('âŒ Ø±ÛŒØ³Øª state Ù†Ø§Ù…ÙˆÙÙ‚', 'error');
                showResult(false, 'Ø±ÛŒØ³Øª state Ù†Ø§Ù…ÙˆÙÙ‚');
            }
            refreshStateDisplay();
        }

        // Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨
        function runAllStateTests() {
            TestLogger.log('ğŸ§ª Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ State...', 'info');
            
            // 1. Ø±ÛŒØ³Øª state
            testResetState();
            
            // 2. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§
            setTimeout(() => {
                testLoadLessons();
                
                // 3. Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ
                setTimeout(() => {
                    testNextLesson();
                    
                    // 4. ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ
                    setTimeout(() => {
                        testNextExercise();
                        
                        // 5. Ø«Ø¨Øª Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                        setTimeout(() => {
                            testSubmitAnswer(true);
                            
                            // 6. Ø±ÛŒØ³Øª Ù†ØªÛŒØ¬Ù‡
                            setTimeout(() => {
                                testResetResult();
                                
                                // 7. Ø«Ø¨Øª Ù¾Ø§Ø³Ø® ØºÙ„Ø·
                                setTimeout(() => {
                                    testSubmitAnswer(false);
                                    
                                    // 8. ØªÙ…Ø±ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ
                                    setTimeout(() => {
                                        testNextExercise();
                                        
                                        // 9. Ø±ÙØªÙ† Ø¨Ù‡ Ø¯Ø±Ø³ Ù‚Ø¨Ù„
                                        setTimeout(() => {
                                            testPrevLesson();
                                            
                                            // 10. Ø±ÛŒØ³Øª Ù†Ù‡Ø§ÛŒÛŒ
                                            setTimeout(() => {
                                                testResetState();
                                                TestLogger.log('âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯', 'info');
                                                showResult(true, 'ØªÙ…Ø§Ù…ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø§Ø³ Ø´Ø¯Ù†Ø¯');
                                            }, 500);
                                        }, 500);
                                    }, 500);
                                }, 500);
                            }, 500);
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯
        function clearLog() {
            TestLogger.clear();
        }

        // Ø´Ù†ÙˆÙ†Ø¯Ù‡ ØªØºÛŒÛŒØ±Ø§Øª state Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯ Ø®ÙˆØ¯Ú©Ø§Ø±
        ReviewScreenState.subscribe((prev, next, action) => {
            TestLogger.log(`Ø§Ú©Ø´Ù†: ${action} - State ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`, 'debug');
        });

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            testInitialState();
            TestLogger.log('ğŸš€ ØµÙØ­Ù‡ ØªØ³Øª State Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'info');
        };
    </script>
</body>
</html>
```
