<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª User Model (Ù¾Ø§ÛŒÙ‡) - Farsinglish</title>
    <style>
        :root {
            --primary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 18px;
            background: var(--light);
            border-bottom: 3px solid #e2e8f0;
        }
        
        .stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.15);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 8px;
        }
        
        .xp-level-preview {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 20px;
            margin: 20px;
            border-radius: 12px;
            border: 3px solid #bae6fd;
        }
        
        .preview-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .level-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .level-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9, #38bdf8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .xp-bar-container {
            flex: 1;
            background: #e2e8f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(to right, #10b981, #34d399);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .xp-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--dark);
            line-height: 20px;
        }
        
        .test-area {
            padding: 20px;
        }
        
        .test-group {
            margin-bottom: 25px;
        }
        
        .group-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .test-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s;
            position: relative;
        }
        
        .test-card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.1);
        }
        
        .test-card.passed {
            border-color: var(--success);
            background: linear-gradient(to right, #f0fdf4, #ffffff);
        }
        
        .test-card.failed {
            border-color: var(--danger);
            background: linear-gradient(to right, #fef2f2, #ffffff);
        }
        
        .test-card.running {
            border-color: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { border-color: #f59e0b; }
            50% { border-color: #fbbf24; }
            100% { border-color: #f59e0b; }
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .test-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .test-desc {
            color: #64748b;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .test-details {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #475569;
            border-right: 4px solid var(--primary);
            display: none;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: var(--light);
            border-top: 3px solid #e2e8f0;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-run {
            background: linear-gradient(to right, #0ea5e9, #38bdf8);
            color: white;
        }
        
        .btn-run:hover {
            background: linear-gradient(to right, #0284c7, #0ea5e9);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
        }
        
        .btn-reset {
            background: linear-gradient(to right, #64748b, #94a3b8);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(to right, #475569, #64748b);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(100, 116, 139, 0.3);
        }
        
        .console {
            background: #1e293b;
            color: white;
            padding: 20px;
            margin: 0 20px 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #334155;
        }
        
        .console-header {
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .console-line {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
            line-height: 1.4;
        }
        
        .log-success { color: #34d399; }
        .log-error { color: #f87171; }
        .log-info { color: #60a5fa; }
        .log-warning { color: #fbbf24; }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
        }
        
        @media (max-width: 768px) {
            .tests-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .level-display {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ØªØ³Øª User Model (Ù¾Ø§ÛŒÙ‡)</h1>
            <p>ÙØ§ÛŒÙ„ Û± Ø§Ø² Û² | ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø³ÛŒØ³ØªÙ… XP</p>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalTests">5</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
        </div>
        
        <div class="xp-level-preview">
            <div class="preview-title">ğŸ† Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø³ÛŒØ³ØªÙ… XP</div>
            
            <div class="level-display">
                <div class="level-circle" id="currentLevel">1</div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="xpBar" style="width: 0%"></div>
                    <div class="xp-text" id="xpText">0/100 XP</div>
                </div>
            </div>
        </div>
        
        <div class="test-area">
            <div class="test-group">
                <div class="group-title">ğŸ‘¤ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ User Model</div>
                <div class="tests-grid" id="basicTests">
                    <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
            </div>
        </div>
        
        <div class="console">
            <div class="console-header">ğŸ“ Ú©Ù†Ø³ÙˆÙ„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            <div id="consoleOutput"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-run" id="runTests">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ Ûµ ØªØ³Øª Ù¾Ø§ÛŒÙ‡
            </button>
            <button class="btn btn-reset" id="resetTests">
                <span>ğŸ”„</span>
                Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
            </button>
        </div>
        
        <div class="footer">
            ÙØ§ÛŒÙ„ Û± Ø§Ø² Û² | ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ User Model | Farsinglish
        </div>
    </div>

    <script>
        // ==================== User Model Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ ====================
        class UserModel {
            constructor(data = {}) {
                this.id = data.id || 'user_' + Date.now();
                this.username = data.username || '';
                this.email = data.email || '';
                this.experiencePoints = data.experiencePoints || 0;
                this.level = data.level || 1;
                this.streak = data.streak || 0;
                this.lastActiveDate = data.lastActiveDate || null;
                this.lessonsCompleted = data.lessonsCompleted || 0;
                this.totalStudyTime = data.totalStudyTime || 0;
                this.totalExercises = data.totalExercises || 0;
                this.correctAnswers = data.correctAnswers || 0;
                this.achievements = data.achievements || [];
            }

            static getRequiredXP(level) {
                return Math.floor(100 * Math.pow(level, 1.5));
            }

            addXP(amount) {
                if (amount <= 0) return false;

                const oldLevel = this.level;
                this.experiencePoints += amount;

                while (this.experiencePoints >= UserModel.getRequiredXP(this.level)) {
                    this.experiencePoints -= UserModel.getRequiredXP(this.level);
                    this.level++;
                }

                const leveledUp = this.level > oldLevel;
                this.updateDailyStreak();

                return {
                    oldLevel,
                    newLevel: this.level,
                    leveledUp,
                    currentXP: this.experiencePoints,
                    requiredXP: UserModel.getRequiredXP(this.level),
                    xpAdded: amount
                };
            }

            updateDailyStreak() {
                const today = new Date().toDateString();
                const lastActive = this.lastActiveDate ? new Date(this.lastActiveDate).toDateString() : null;

                if (!lastActive) {
                    this.streak = 1;
                } else if (lastActive === today) {
                    // Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù…Ø±ÙˆØ² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡
                } else {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastActive === yesterday.toDateString()) {
                        this.streak++;
                    } else {
                        this.streak = 1;
                    }
                }

                this.lastActiveDate = new Date().toISOString();
                return this.streak;
            }

            completeLesson(lessonDuration, exerciseCount, correctAnswers) {
                this.lessonsCompleted++;
                this.totalStudyTime += lessonDuration;
                this.totalExercises += exerciseCount;
                this.correctAnswers += correctAnswers;

                const accuracy = exerciseCount > 0 ? correctAnswers / exerciseCount : 0;
                const baseXP = 50;
                const durationBonus = Math.min(lessonDuration / 5, 20);
                const accuracyBonus = Math.floor(accuracy * 30);
                const streakBonus = this.streak * 2;

                const totalXP = baseXP + durationBonus + accuracyBonus + streakBonus;

                const xpResult = this.addXP(Math.floor(totalXP));
                this.checkAchievements();

                return {
                    ...xpResult,
                    lessonStats: {
                        accuracy: Math.round(accuracy * 100),
                        duration: lessonDuration,
                        totalExercises: exerciseCount,
                        correctAnswers: correctAnswers
                    }
                };
            }

            checkAchievements() {
                const newAchievements = [];
                
                if (this.level >= 5 && !this.achievements.includes('level_5')) {
                    newAchievements.push('level_5');
                    this.achievements.push('level_5');
                }
                
                if (this.lessonsCompleted >= 10 && !this.achievements.includes('lessons_10')) {
                    newAchievements.push('lessons_10');
                    this.achievements.push('lessons_10');
                }

                return newAchievements;
            }

            validate() {
                const errors = [];

                if (!this.username || this.username.length < 3) {
                    errors.push('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }

                if (this.email && !this.isValidEmail(this.email)) {
                    errors.push('Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }

                if (this.level < 1) {
                    errors.push('Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø¨Ø§Ø´Ø¯');
                }

                if (this.experiencePoints < 0) {
                    errors.push('XP Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯');
                }

                return {
                    isValid: errors.length === 0,
                    errors
                };
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            getLevelInfo() {
                const currentXP = this.experiencePoints;
                const requiredXP = UserModel.getRequiredXP(this.level);
                const progress = (currentXP / requiredXP) * 100;

                return {
                    level: this.level,
                    currentXP,
                    requiredXP,
                    progress: Math.round(progress)
                };
            }
        }

        // ==================== Ûµ ØªØ³Øª Ù¾Ø§ÛŒÙ‡ ====================
        const basicTests = [
            {
                id: 'test1',
                title: 'Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡',
                run: function() {
                    const user = new UserModel({
                        username: 'testuser',
                        email: 'test@example.com'
                    });

                    const validation = user.validate();

                    return {
                        passed: validation.isValid && 
                                user.username === 'testuser' &&
                                user.level === 1 &&
                                user.experiencePoints === 0,
                        message: validation.isValid ? 'âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø±',
                        details: {
                            username: user.username,
                            level: user.level,
                            xp: user.experiencePoints,
                            isValid: validation.isValid
                        }
                    };
                }
            },
            {
                id: 'test2',
                title: 'Ø§ÙØ²ÙˆØ¯Ù† XP Ù¾Ø§ÛŒÙ‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø³Ø·Ø­',
                run: function() {
                    const user = new UserModel();
                    const result = user.addXP(50);

                    return {
                        passed: result.xpAdded === 50 && 
                                result.leveledUp === false &&
                                user.experiencePoints === 50,
                        message: result.xpAdded === 50 ? 'âœ… XP Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† XP',
                        details: {
                            xpAdded: result.xpAdded,
                            leveledUp: result.leveledUp,
                            currentXP: user.experiencePoints,
                            requiredXP: UserModel.getRequiredXP(user.level)
                        }
                    };
                }
            },
            {
                id: 'test3',
                title: 'Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­ Ø¨Ø§ XP Ú©Ø§ÙÛŒ',
                run: function() {
                    const user = new UserModel();
                    
                    const xpNeeded = UserModel.getRequiredXP(1);
                    const result = user.addXP(xpNeeded);

                    return {
                        passed: result.leveledUp === true &&
                                user.level === 2 &&
                                user.experiencePoints === 0,
                        message: result.leveledUp ? 'âœ… Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­',
                        details: {
                            oldLevel: result.oldLevel,
                            newLevel: user.level,
                            xpAfterLevelUp: user.experiencePoints,
                            xpNeeded: xpNeeded
                        }
                    };
                }
            },
            {
                id: 'test4',
                title: 'Ø§Ø³ØªØ±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ±ÛŒÚ© ÙØ¹Ø§Ù„ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡',
                run: function() {
                    const user = new UserModel();
                    
                    const streak1 = user.updateDailyStreak();
                    const streak2 = user.updateDailyStreak();

                    return {
                        passed: streak1 === 1 && streak2 === 1,
                        message: streak1 === 1 ? 'âœ… Ø§Ø³ØªØ±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³ØªØ±ÛŒÚ©',
                        details: {
                            firstStreak: streak1,
                            sameDayStreak: streak2,
                            lastActiveDate: user.lastActiveDate
                        }
                    };
                }
            },
            {
                id: 'test5',
                title: 'ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ Ùˆ XP',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                run: function() {
                    const user = new UserModel();
                    user.streak = 3;
                    
                    const result = user.completeLesson(30, 10, 8);

                    return {
                        passed: result.lessonStats.accuracy === 80 &&
                                user.lessonsCompleted === 1 &&
                                user.totalStudyTime === 30,
                        message: result.lessonStats.accuracy === 80 ? 
                                'âœ… ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³',
                        details: {
                            lessonsCompleted: user.lessonsCompleted,
                            studyTime: user.totalStudyTime,
                            accuracy: result.lessonStats.accuracy + '%',
                            xpAdded: result.xpAdded,
                            leveledUp: result.leveledUp
                        }
                    };
                }
            }
        ];

        // ==================== Test Runner ====================
        class UserModelTestRunner {
            constructor() {
                this.tests = basicTests;
                this.totalTests = this.tests.length;
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                this.initializeUI();
            }

            initializeUI() {
                const container = document.getElementById('basicTests');
                
                this.tests.forEach((test, index) => {
                    const testEl = document.createElement('div');
                    testEl.className = 'test-card';
                    testEl.id = `test-${test.id}`;
                    testEl.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${index + 1}. ${test.title}</div>
                            <div class="test-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                        </div>
                        <div class="test-desc">${test.desc}</div>
                        <div class="test-details" id="details-${test.id}"></div>
                    `;
                    container.appendChild(testEl);
                });

                document.getElementById('runTests').addEventListener('click', () => this.runAllTests());
                document.getElementById('resetTests').addEventListener('click', () => this.resetTests());
            }

            async runAllTests() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.resetTests();
                
                this.log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ User Model...', 'info');
                this.log('Ûµ ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡: Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø±ØŒ XPØŒ Ø³Ø·Ø­ØŒ Ø§Ø³ØªØ±ÛŒÚ©ØŒ Ø¯Ø±Ø³', 'info');
                
                for (let i = 0; i < this.tests.length; i++) {
                    const test = this.tests[i];
                    await this.runSingleTest(test);
                    await this.delay(400);
                    this.updatePreview(i + 1);
                }
                
                const successRate = Math.round((this.passed / this.totalTests) * 100);
                this.log(`ğŸ‰ ${this.passed}/${this.totalTests} ØªØ³Øª Ù…ÙˆÙÙ‚ (${successRate}%)`, 'success');
                this.isRunning = false;
                
                if (this.passed === this.totalTests) {
                    this.log('âœ… Ø¢Ù…Ø§Ø¯Ù‡ ÙØ§ÛŒÙ„ Û² (ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡)', 'success');
                }
            }

            async runSingleTest(test) {
                const testEl = document.getElementById(`test-${test.id}`);
                const statusEl = testEl.querySelector('.test-status');
                const detailsEl = document.getElementById(`details-${test.id}`);
                
                testEl.classList.add('running');
                statusEl.className = 'test-status status-pending';
                statusEl.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                try {
                    const result = test.run();
                    
                    testEl.classList.remove('running');
                    if (result.passed) {
                        this.passed++;
                        testEl.classList.add('passed');
                        statusEl.className = 'test-status status-pass';
                        statusEl.textContent = 'Ù…ÙˆÙÙ‚';
                        this.log(`âœ… ${test.title}: ${result.message}`, 'success');
                    } else {
                        this.failed++;
                        testEl.classList.add('failed');
                        statusEl.className = 'test-status status-fail';
                        statusEl.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                        this.log(`âŒ ${test.title}: ${result.message}`, 'error');
                    }
                    
                    if (result.details) {
                        detailsEl.style.display = 'block';
                        let detailsText = '';
                        for (const [key, value] of Object.entries(result.details)) {
                            detailsText += `${key}: ${value}\n`;
                        }
                        detailsEl.textContent = detailsText;
                    }
                    
                } catch (error) {
                    testEl.classList.remove('running');
                    this.failed++;
                    testEl.classList.add('failed');
                    statusEl.className = 'test-status status-fail';
                    statusEl.textContent = 'Ø®Ø·Ø§';
                    this.log(`ğŸ’¥ ${test.title}: ${error.message}`, 'error');
                }
                
                this.updateStats();
            }

            updatePreview(testNumber) {
                const level = Math.min(5, Math.floor(testNumber) + 1);
                const xp = Math.min(UserModel.getRequiredXP(level) - 1, testNumber * 20);
                const progress = (xp / UserModel.getRequiredXP(level)) * 100;
                
                document.getElementById('currentLevel').textContent = level;
                document.getElementById('xpBar').style.width = `${progress}%`;
                document.getElementById('xpText').textContent = `${xp}/${UserModel.getRequiredXP(level)} XP`;
            }

            updateStats() {
                document.getElementById('passedTests').textContent = this.passed;
                document.getElementById('failedTests').textContent = this.failed;
                const rate = Math.round((this.passed / this.totalTests) * 100);
                document.getElementById('successRate').textContent = `${rate}%`;
                
                const rateEl = document.getElementById('successRate').parentElement;
                if (rate >= 80) {
                    rateEl.style.background = '#d1fae5';
                    rateEl.style.color = '#065f46';
                } else if (rate >= 60) {
                    rateEl.style.background = '#fef3c7';
                    rateEl.style.color = '#92400e';
                } else {
                    rateEl.style.background = '#fee2e2';
                    rateEl.style.color = '#991b1b';
                }
            }

            log(message, type = 'info') {
                const consoleEl = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `console-line log-${type}`;
                
                const time = new Date().toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                line.textContent = `[${time}] ${message}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }

            resetTests() {
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                
                this.tests.forEach(test => {
                    const testEl = document.getElementById(`test-${test.id}`);
                    const statusEl = testEl.querySelector('.test-status');
                    const detailsEl = document.getElementById(`details-${test.id}`);
                    
                    testEl.className = 'test-card';
                    statusEl.className = 'test-status status-pending';
                    statusEl.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                    detailsEl.style.display = 'none';
                    detailsEl.textContent = '';
                });
                
                document.getElementById('consoleOutput').innerHTML = '';
                document.getElementById('currentLevel').textContent = '1';
                document.getElementById('xpBar').style.width = '0%';
                document.getElementById('xpText').textContent = '0/100 XP';
                
                this.updateStats();
                this.log('ğŸ”„ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ ====================
        document.addEventListener('DOMContentLoaded', () => {
            const runner = new UserModelTestRunner();
            runner.log('ğŸ”§ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ User Model Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§', 'info');
            runner.log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ Ûµ ØªØ³Øª Ù¾Ø§ÛŒÙ‡" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯', 'info');
        });
    </script>
</body>
</html>
