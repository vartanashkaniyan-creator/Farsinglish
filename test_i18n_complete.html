<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ú©Ø§Ù…Ù„ i18n + Fallback - Farsinglish</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: Tahoma, Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px 15px;
            background: #f5f7fb;
            color: #1e293b;
        }
        .header {
            background: linear-gradient(145deg, #0f2b3d, #1e3a5f);
            color: white;
            padding: 25px 20px;
            border-radius: 24px;
            margin-bottom: 25px;
            text-align: center;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 6px 14px rgba(0,0,0,0.06);
            border: 1px solid #e9eef2;
        }
        .lang-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        .lang-btn {
            padding: 14px 28px;
            border: 2px solid transparent;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            background: #eef2f6;
            color: #1e293b;
            cursor: pointer;
            transition: 0.2s;
        }
        .lang-btn.active {
            background: #1e3a5f;
            color: white;
            border-color: #ffb347;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-item {
            background: #f8fafc;
            padding: 18px;
            border-radius: 18px;
            border: 1px solid #dde7f0;
        }
        .key-badge {
            background: #334e68;
            color: white;
            padding: 6px 16px;
            border-radius: 30px;
            font-family: monospace;
            font-size: 0.95rem;
            display: inline-block;
            margin-bottom: 12px;
        }
        .value-box {
            background: #d9eaf5;
            padding: 12px 18px;
            border-radius: 14px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #0a4b6e;
            word-break: break-word;
            border: 1px solid #8ab3cf;
            margin: 10px 0;
        }
        button {
            background: #2d5a7a;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin: 6px;
            box-shadow: 0 3px 0 #0f2a3b;
            width: auto;
        }
        button:active {
            transform: translateY(3px);
            box-shadow: none;
        }
        .console {
            background: #0d1c26;
            color: #b3e5fc;
            padding: 18px;
            border-radius: 16px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            font-size: 0.95rem;
            max-height: 250px;
            overflow-y: auto;
            margin-top: 20px;
            border-left: 6px solid #4fc3f7;
        }
        .footer {
            text-align: center;
            color: #64748b;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #cbd5e1;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸŒ Farsinglish â€¢ i18n Ú©Ø§Ù…Ù„ + Fallback</h1>
    <p style="font-size:1.2rem;">Û¶ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ | ØªØ³Øª Ø¯Ø³ØªÛŒ | Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</p>
</div>

<!-- ===== Ù†ÙˆØ§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† ===== -->
<div class="card">
    <h2 style="margin-top:0; display:flex; align-items:center; gap:10px;">
        <span>ğŸ—£ï¸ Ø²Ø¨Ø§Ù† ÙØ¹Ø§Ù„:</span>
        <span id="activeLangDisplay" style="background:#1e3a5f; color:white; padding:8px 24px; border-radius:50px;">fa-IR</span>
    </h2>
    <div class="lang-bar">
        <button id="langFa" class="lang-btn active" onclick="setLanguage('fa-IR')">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ (fa-IR)</button>
        <button id="langEn" class="lang-btn" onclick="setLanguage('en-US')">ğŸ‡ºğŸ‡¸ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ (en-US)</button>
        <button id="langEs" class="lang-btn" onclick="setLanguage('es-ES')">ğŸ‡ªğŸ‡¸ Ø§Ø³Ù¾Ø§Ù†ÛŒØ§ÛŒÛŒ (es-ES)</button>
        <button id="langAr" class="lang-btn" onclick="setLanguage('ar-SA')">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÛŒ (ar-SA)</button>
        <button id="langFr" class="lang-btn" onclick="setLanguage('fr-FR')">ğŸ‡«ğŸ‡· ÙØ±Ø§Ù†Ø³ÙˆÛŒ (fr-FR)</button>
    </div>
    <p style="color:#475569;"><span style="background:#fef9c3; padding:4px 12px; border-radius:30px;">âš¡ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Fallback: Ø²Ø¨Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±/Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒâ€ŒÙ†Ø´Ø¯Ù‡ â†’ en-US â†’ Ø±Ø´ØªÙ‡ Ø®Ø§Ù„ÛŒ</span></p>
</div>

<!-- ===== Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ú©Ø§Ù…Ù„ ===== -->
<div class="card">
    <h3>ğŸ“– Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ù…Ø±Ø¬Ø¹ (Û²Û± Ú©Ù„ÛŒØ¯)</h3>
    <div style="background:#eef2f6; padding:15px; border-radius:16px; font-size:0.9rem; direction:ltr; text-align:left; max-height:200px; overflow-y:auto;">
        <pre style="margin:0; background:transparent; color:#0c4a6e;">{
  "appName": {"fa-IR":"ÙØ±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´", "en-US":"Farsinglish"},
  "welcome": {"fa-IR":"Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!", "en-US":"Welcome!"},
  "startLesson": {"fa-IR":"Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³", "en-US":"Start Lesson"},
  "review": {"fa-IR":"Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²", "en-US":"Today's Review"},
  "score": {"fa-IR":"Ø§Ù…ØªÛŒØ§Ø²", "en-US":"Score"},
  "streak": {"fa-IR":"Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ", "en-US":"Streak"},
  "settings": {"fa-IR":"ØªÙ†Ø¸ÛŒÙ…Ø§Øª", "en-US":"Settings"},
  "loading": {"fa-IR":"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...", "en-US":"Loading..."},
  "success": {"fa-IR":"Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚", "en-US":"Success"},
  "error": {"fa-IR":"Ø®Ø·Ø§", "en-US":"Error"},
  "noInternet": {"fa-IR":"Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª", "en-US":"No internet connection"},
  "retry": {"fa-IR":"ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯", "en-US":"Retry"},
  "cancel": {"fa-IR":"Ø§Ù†ØµØ±Ø§Ù", "en-US":"Cancel"},
  "save": {"fa-IR":"Ø°Ø®ÛŒØ±Ù‡", "en-US":"Save"},
  "delete": {"fa-IR":"Ø­Ø°Ù", "en-US":"Delete"},
  "edit": {"fa-IR":"ÙˆÛŒØ±Ø§ÛŒØ´", "en-US":"Edit"},
  "next": {"fa-IR":"Ø¨Ø¹Ø¯ÛŒ", "en-US":"Next"},
  "previous": {"fa-IR":"Ù‚Ø¨Ù„ÛŒ", "en-US":"Previous"},
  "done": {"fa-IR":"ØªÙ…Ø§Ù…", "en-US":"Done"},
  "help": {"fa-IR":"Ø±Ø§Ù‡Ù†Ù…Ø§", "en-US":"Help"},
  "about": {"fa-IR":"Ø¯Ø±Ø¨Ø§Ø±Ù‡", "en-US":"About"}
}</pre>
    </div>
</div>

<!-- ===== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Û¶ Ú¯Ø§Ù†Ù‡ ===== -->
<div class="test-grid">
    <!-- ØªØ³Øª Û±: ØªØ±Ø¬Ù…Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Û± - ØªØ±Ø¬Ù…Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…</span>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span class="key-badge" style="background:#2b5f4a;">appName</span>
            <span id="test1Value" class="value-box" style="margin:5px 0;">--</span>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
            <span class="key-badge" style="background:#2b5f4a;">welcome</span>
            <span id="test1bValue" class="value-box" style="margin:5px 0;">--</span>
        </div>
        <button onclick="testDirectTranslation()" style="width:100%;">ğŸ” Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û±</button>
    </div>

    <!-- ØªØ³Øª Û²: Fallback Ø²Ø¨Ø§Ù† -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Û² - Fallback Ø²Ø¨Ø§Ù†</span>
        <p style="margin:8px 0;">startLesson Ø¨Ø§ Ø²Ø¨Ø§Ù† es-ES:</p>
        <span id="test2Value" class="value-box">--</span>
        <button onclick="testLanguageFallback()" style="width:100%;">ğŸ”„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û²</button>
    </div>

    <!-- ØªØ³Øª Û³: Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Û³ - Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</span>
        <p style="margin:8px 0;">unknownKey999:</p>
        <span id="test3Value" class="value-box">--</span>
        <button onclick="testMissingKey()" style="width:100%;">â“ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û³</button>
    </div>

    <!-- ØªØ³Øª Û´: Ú©Ù„ÛŒØ¯ Ø¨Ø¯ÙˆÙ† ØªØ±Ø¬Ù…Ù‡ Ø¯Ø± en-US -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Û´ - Ø­Ø°Ù en-US</span>
        <p style="margin:8px 0;">futureFeature (Ø¨Ø¯ÙˆÙ† en-US):</p>
        <span id="test4Value" class="value-box">--</span>
        <button onclick="testNoEnglishFallback()" style="width:100%;">â›“ï¸ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û´</button>
    </div>

    <!-- ØªØ³Øª Ûµ: Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÙˆÛŒØ§ÛŒ Ú©Ù„ÛŒØ¯ -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Ûµ - Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</span>
        <p style="margin:8px 0;"> premiumFeature (Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡):</p>
        <span id="test5Value" class="value-box">--</span>
        <button onclick="testDynamicAddKey()" style="width:100%;">â• Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ûµ</button>
    </div>

    <!-- ØªØ³Øª Û¶: ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ùˆ ØªØ±Ø¬Ù…Ù‡ Ù‡Ù…Ø²Ù…Ø§Ù† -->
    <div class="test-item">
        <span class="key-badge">ğŸ§ª ØªØ³Øª Û¶ - Ú†Ø±Ø®Ø´ Ø²Ø¨Ø§Ù†</span>
        <p style="margin:8px 0;">Ú†Ù†Ø¯ Ú©Ù„ÛŒØ¯ Ù¾Ø³ Ø§Ø² ØªØºÛŒÛŒØ± Ø¨Ù‡ en-US:</p>
        <span id="test6Value" class="value-box">--</span>
        <button onclick="testLanguageRotation()" style="width:100%;">ğŸ”„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Û¶</button>
    </div>
</div>

<!-- ===== Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ùˆ Ú©Ù†Ø³ÙˆÙ„ ===== -->
<div class="card">
    <div style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:20px;">
        <button onclick="runAllTests()" style="background:#0e5a6b; flex:2;">ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
        <button onclick="resetAndClear()" style="background:#6c757d; flex:1;">ğŸ§¹ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„</button>
    </div>
    
    <h3>ğŸ“‹ Ú©Ù†Ø³ÙˆÙ„ Ú¯Ø²Ø§Ø±Ø´ (Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª)</h3>
    <div id="consoleLog" class="console">
        -- ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯ --
    </div>
</div>

<div class="footer">
    <p>âœ… Farsinglish - ØªØ³Øª Ø¯Ø³ØªÛŒ i18n Ùˆ Fallback | Û¶ Ø³Ù†Ø§Ø±ÛŒÙˆ | Ø¢Ù…Ø§Ø¯Ù‡ ØªØ£ÛŒÛŒØ¯</p>
</div>

<script>
    // -----------------------------------------------------------------
    // Ù‡Ø³ØªÙ‡ i18n Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø² Fallback
    // -----------------------------------------------------------------
    const I18n = {
        dictionary: {
            "appName": { "fa-IR": "ÙØ±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´", "en-US": "Farsinglish" },
            "welcome": { "fa-IR": "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!", "en-US": "Welcome!" },
            "startLesson": { "fa-IR": "Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³", "en-US": "Start Lesson" },
            "review": { "fa-IR": "Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²", "en-US": "Today's Review" },
            "score": { "fa-IR": "Ø§Ù…ØªÛŒØ§Ø²", "en-US": "Score" },
            "streak": { "fa-IR": "Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ", "en-US": "Streak" },
            "settings": { "fa-IR": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª", "en-US": "Settings" },
            "loading": { "fa-IR": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...", "en-US": "Loading..." },
            "success": { "fa-IR": "Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚", "en-US": "Success" },
            "error": { "fa-IR": "Ø®Ø·Ø§", "en-US": "Error" },
            "noInternet": { "fa-IR": "Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª", "en-US": "No internet connection" },
            "retry": { "fa-IR": "ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯", "en-US": "Retry" },
            "cancel": { "fa-IR": "Ø§Ù†ØµØ±Ø§Ù", "en-US": "Cancel" },
            "save": { "fa-IR": "Ø°Ø®ÛŒØ±Ù‡", "en-US": "Save" },
            "delete": { "fa-IR": "Ø­Ø°Ù", "en-US": "Delete" },
            "edit": { "fa-IR": "ÙˆÛŒØ±Ø§ÛŒØ´", "en-US": "Edit" },
            "next": { "fa-IR": "Ø¨Ø¹Ø¯ÛŒ", "en-US": "Next" },
            "previous": { "fa-IR": "Ù‚Ø¨Ù„ÛŒ", "en-US": "Previous" },
            "done": { "fa-IR": "ØªÙ…Ø§Ù…", "en-US": "Done" },
            "help": { "fa-IR": "Ø±Ø§Ù‡Ù†Ù…Ø§", "en-US": "Help" },
            "about": { "fa-IR": "Ø¯Ø±Ø¨Ø§Ø±Ù‡", "en-US": "About" }
        },

        currentLanguage: "fa-IR",

        setLanguage(lang) {
            if (lang && typeof lang === "string") {
                this.currentLanguage = lang;
            }
            return this.currentLanguage;
        },

        translate(key, lang = null) {
            const targetLang = lang || this.currentLanguage;

            // 1. Ú©Ù„ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
            if (!this.dictionary.hasOwnProperty(key)) {
                this.log(`âš ï¸ Ú©Ù„ÛŒØ¯ "${key}" ÛŒØ§ÙØª Ù†Ø´Ø¯ â†’ Ø±Ø´ØªÙ‡ Ø®Ø§Ù„ÛŒ`);
                return "";
            }

            const entry = this.dictionary[key];

            // 2. ØªØ±Ø¬Ù…Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…
            if (entry[targetLang] && entry[targetLang].trim() !== "") {
                return entry[targetLang];
            }

            // 3. Fallback Ø¨Ù‡ en-US
            if (entry["en-US"] && entry["en-US"].trim() !== "") {
                this.log(`ğŸ”„ Fallback: "${targetLang}" â†’ "en-US" Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ "${key}"`);
                return entry["en-US"];
            }

            // 4. Ù‡ÛŒÚ† ØªØ±Ø¬Ù…Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³Øª
            this.log(`âŒ Ù‡ÛŒÚ† ØªØ±Ø¬Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ "${key}" Ø­ØªÛŒ Ø¯Ø± en-US ÛŒØ§ÙØª Ù†Ø´Ø¯`);
            return "";
        },

        addKey(key, translations) {
            if (!key || typeof translations !== "object") return false;
            this.dictionary[key] = translations;
            this.log(`â• Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ "${key}" Ø¨Ø§ ${Object.keys(translations).length} ØªØ±Ø¬Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
            return true;
        },

        log(message) {
            if (window.testLogs) {
                const timestamp = new Date().toLocaleTimeString("fa-IR");
                window.testLogs.push(`[${timestamp}] ${message}`);
                this.updateConsole();
            }
        },

        updateConsole() {
            const consoleEl = document.getElementById("consoleLog");
            if (consoleEl && window.testLogs) {
                consoleEl.innerHTML = window.testLogs.map(msg => `ğŸ“Œ ${msg}`).join("<br>");
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }
        }
    };

    // -----------------------------------------------------------------
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
    // -----------------------------------------------------------------
    window.testLogs = [];
    window.I18n = I18n;

    // -----------------------------------------------------------------
    // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
    // -----------------------------------------------------------------
    function addLog(message) {
        const timestamp = new Date().toLocaleTimeString("fa-IR");
        window.testLogs.push(`[${timestamp}] ${message}`);
        I18n.updateConsole();
    }

    function clearLogs() {
        window.testLogs = [];
        const consoleEl = document.getElementById("consoleLog");
        if (consoleEl) consoleEl.innerHTML = "-- Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø§Ú© Ø´Ø¯ --";
    }

    function setLanguage(lang) {
        I18n.setLanguage(lang);
        document.getElementById("activeLangDisplay").innerText = lang;

        // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        document.querySelectorAll(".lang-btn").forEach(btn => btn.classList.remove("active"));
        if (lang === "fa-IR") document.getElementById("langFa").classList.add("active");
        else if (lang === "en-US") document.getElementById("langEn").classList.add("active");
        else if (lang === "es-ES") document.getElementById("langEs").classList.add("active");
        else if (lang === "ar-SA") document.getElementById("langAr").classList.add("active");
        else if (lang === "fr-FR") document.getElementById("langFr").classList.add("active");

        addLog(`ğŸŒ Ø²Ø¨Ø§Ù† Ø¨Ù‡ "${lang}" ØªØºÛŒÛŒØ± ÛŒØ§ÙØª`);
    }

    // -----------------------------------------------------------------
    // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Û¶ Ú¯Ø§Ù†Ù‡
    // -----------------------------------------------------------------
    function testDirectTranslation() {
        addLog("ğŸ§ª ØªØ³Øª Û±: ØªØ±Ø¬Ù…Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… (Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ: " + I18n.currentLanguage + ")");
        const val1 = I18n.translate("appName");
        const val2 = I18n.translate("welcome");
        document.getElementById("test1Value").innerText = val1;
        document.getElementById("test1bValue").innerText = val2;
        addLog(`   appName â†’ "${val1}"`);
        addLog(`   welcome â†’ "${val2}"`);
    }

    function testLanguageFallback() {
        addLog("ğŸ§ª ØªØ³Øª Û²: Fallback Ø²Ø¨Ø§Ù† (es-ES)");
        const original = I18n.currentLanguage;
        I18n.setLanguage("es-ES");
        const val = I18n.translate("startLesson");
        document.getElementById("test2Value").innerText = val + " (Fallback Ø§Ø² es-ES)";
        addLog(`   startLesson Ø¨Ø§ es-ES â†’ "${val}" (Ø¨Ø§ÛŒØ¯: Start Lesson)`);
        I18n.setLanguage(original);
        setLanguage(original);
    }

    function testMissingKey() {
        addLog("ğŸ§ª ØªØ³Øª Û³: Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯");
        const val = I18n.translate("unknownKey999");
        document.getElementById("test3Value").innerText = val === "" ? "(Ø®Ø§Ù„ÛŒ - ØµØ­ÛŒØ­)" : val;
        addLog(`   unknownKey999 â†’ "${val}" (Ø¨Ø§ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯)`);
    }

    function testNoEnglishFallback() {
        addLog("ğŸ§ª ØªØ³Øª Û´: Ú©Ù„ÛŒØ¯ Ø¨Ø¯ÙˆÙ† en-US");
        I18n.addKey("futureFeature", { "fa-IR": "ÙˆÛŒÚ˜Ú¯ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡" });
        const original = I18n.currentLanguage;
        I18n.setLanguage("fa-IR");
        const val = I18n.translate("futureFeature");
        document.getElementById("test4Value").innerText = val;
        addLog(`   futureFeature (ÙÙ‚Ø· ÙØ§Ø±Ø³ÛŒ) â†’ "${val}" (Ø¨Ø§ÛŒØ¯: "ÙˆÛŒÚ˜Ú¯ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡")`);
        
        // ØªØ³Øª Ø¨Ø¯ÙˆÙ† en-US
        I18n.setLanguage("fr-FR");
        const val2 = I18n.translate("futureFeature");
        addLog(`   futureFeature Ø¨Ø§ fr-FR (Ø¨Ø¯ÙˆÙ† en-US) â†’ "${val2}" (Ø¨Ø§ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯)`);
        I18n.setLanguage(original);
        setLanguage(original);
    }

    function testDynamicAddKey() {
        addLog("ğŸ§ª ØªØ³Øª Ûµ: Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÙˆÛŒØ§ÛŒ Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯");
        I18n.addKey("premiumFeature", {
            "fa-IR": "ÙˆÛŒÚ˜Ú¯ÛŒ ÙˆÛŒÚ˜Ù‡: Ù…Ø±ÙˆØ± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ",
            "en-US": "Premium: Pro Review"
        });
        const val = I18n.translate("premiumFeature");
        document.getElementById("test5Value").innerText = val;
        addLog(`   premiumFeature â†’ "${val}"`);
    }

    function testLanguageRotation() {
        addLog("ğŸ§ª ØªØ³Øª Û¶: Ú†Ø±Ø®Ø´ Ø²Ø¨Ø§Ù† Ùˆ ØªØ±Ø¬Ù…Ù‡ Ù‡Ù…Ø²Ù…Ø§Ù†");
        const original = I18n.currentLanguage;
        
        I18n.setLanguage("en-US");
        const enVal = I18n.translate("streak");
        
        I18n.setLanguage("fa-IR");
        const faVal = I18n.translate("streak");
        
        document.getElementById("test6Value").innerHTML = `en-US: "${enVal}"<br>fa-IR: "${faVal}"`;
        addLog(`   streak Ø¯Ø± en-US â†’ "${enVal}"`);
        addLog(`   streak Ø¯Ø± fa-IR â†’ "${faVal}"`);
        
        I18n.setLanguage(original);
        setLanguage(original);
    }

    function runAllTests() {
        clearLogs();
        addLog("ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Û¶ ØªØ³Øª i18n");
        
        setLanguage("fa-IR");
        testDirectTranslation();
        testLanguageFallback();
        testMissingKey();
        testNoEnglishFallback();
        testDynamicAddKey();
        testLanguageRotation();
        
        addLog("âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯ - Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯");
    }

    function resetAndClear() {
        clearLogs();
        setLanguage("fa-IR");
        
        // Ø±ÛŒØ³Øª Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´
        document.getElementById("test1Value").innerText = "--";
        document.getElementById("test1bValue").innerText = "--";
        document.getElementById("test2Value").innerText = "--";
        document.getElementById("test3Value").innerText = "--";
        document.getElementById("test4Value").innerText = "--";
        document.getElementById("test5Value").innerText = "--";
        document.getElementById("test6Value").innerHTML = "--";
        
        addLog("ğŸ§¹ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯ - Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯");
    }

    // -----------------------------------------------------------------
    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    // -----------------------------------------------------------------
    window.onload = function() {
        setLanguage("fa-IR");
        clearLogs();
        addLog("ğŸŒ Ø³ÛŒØ³ØªÙ… i18n Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª - Û²Û± Ú©Ù„ÛŒØ¯ ØªØ±Ø¬Ù…Ù‡ - Û¶ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ØªØ³Øª");
        addLog("ğŸ‘† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯");
    };
</script>

</body>
</html>
