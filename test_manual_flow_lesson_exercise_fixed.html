<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø³ - Ù†Ø³Ø®Ù‡ Ø³Ø±ÛŒØ¹ | Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Vazir', 'Segoe UI', sans-serif;
            background: #f0f3f5;
            padding: 16px;
            min-height: 100vh;
        }
        .container { max-width: 700px; margin: 0 auto; }
        .header {
            background: #1a3b5c;
            color: white;
            padding: 20px;
            border-radius: 24px;
            margin-bottom: 20px;
        }
        .btn {
            border: none;
            background: #2e7d5e;
            color: white;
            padding: 14px 20px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
            border-bottom: 4px solid #1e4f3a;
            transition: 0.05s;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            transform: scale(0.98);
            border-bottom-width: 2px;
        }
        .btn.orange { background: #e67e22; border-bottom-color: #b85e1a; }
        .btn.blue { background: #2980b9; border-bottom-color: #1c5a7a; }
        .btn.purple { background: #8e44ad; border-bottom-color: #6c3483; }
        .card {
            background: white;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .log-console {
            background: #0a1a1f;
            color: #b0e0e6;
            font-family: monospace;
            padding: 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .flex-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .flex-row .btn { width: auto; flex: 1; }
        input {
            width: 100%;
            padding: 14px;
            border-radius: 40px;
            border: 2px solid #ddd;
            font-size: 1rem;
            margin: 8px 0;
        }
        .step {
            display: inline-block;
            padding: 8px 16px;
            background: #ecf0f1;
            border-radius: 40px;
            margin: 4px;
            font-size: 0.9rem;
        }
        .step.active { background: #ffb74d; color: black; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">

    <div class="header">
        <h1 style="font-size: 1.6rem;">âš¡ ØªØ³Øª Ø³Ø±ÛŒØ¹ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø³</h1>
        <p>âœ… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡ - Farsinglish</p>
    </div>

    <!-- ÙˆØ¶Ø¹ÛŒØª Ù…Ø±Ø§Ø­Ù„ -->
    <div class="card" style="padding: 16px;">
        <div id="stepContainer">
            <span class="step active" id="step1">ğŸ“˜ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³</span>
            <span class="step" id="step2">âœï¸ ØªÙ…Ø±ÛŒÙ†</span>
            <span class="step" id="step3">ğŸ“¨ Ù¾Ø§Ø³Ø®</span>
            <span class="step" id="step4">ğŸ“Š Ù†ØªÛŒØ¬Ù‡ SRS</span>
        </div>
    </div>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ - Ø¨Ø¯ÙˆÙ† onclick Ø¯Ø± HTML -->
    <div class="card">
        <h3>ğŸ¯ Û±. Ø³Ù†Ø§Ø±ÛŒÙˆ</h3>
        <div class="flex-row">
            <button class="btn orange" id="btnScenario1">âœ… Ø¹Ø§Ù„ÛŒ (Ú©ÛŒÙÛŒØª Ûµ)</button>
            <button class="btn blue" id="btnScenario2">ğŸ‘ Ø®ÙˆØ¨ (Ú©ÛŒÙÛŒØª Û´)</button>
            <button class="btn purple" id="btnScenario3">âš ï¸ Ø¶Ø¹ÛŒÙ (Ú©ÛŒÙÛŒØª Û²)</button>
        </div>
        <div class="flex-row">
            <button class="btn" style="background:#16a085;" id="btnScenario4">ğŸ”„ Ù…Ø±ÙˆØ± Ù…Ø¬Ø¯Ø¯</button>
            <button class="btn gray" id="btnReset">ğŸ”„ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„</button>
        </div>
    </div>

    <!-- Ø¯Ø±Ø³ Ùˆ ØªÙ…Ø±ÛŒÙ† -->
    <div class="card">
        <h3>ğŸ“– Û². Ø¯Ø±Ø³ Ø¬Ø§Ø±ÛŒ</h3>
        <div style="background: #f8f9fa; padding: 16px; border-radius: 16px;">
            <div style="display: flex; justify-content: space-between;">
                <span id="lessonTitle">Ø¯Ø±Ø³ Ûµ: Ø§ÙØ¹Ø§Ù„</span>
                <span id="cardProgress" style="background: #3498db; color: white; padding: 6px 16px; border-radius: 40px;">Û± Ø§Ø² Û´</span>
            </div>
            <div style="margin-top: 16px; font-size: 1.3rem; direction: ltr; text-align: center;" id="questionDisplay">"run" â†’ ØŸ</div>
            <div style="margin-top: 8px; color: #27ae60; display: none;" id="correctAnswerDisplay">Ù¾Ø§Ø³Ø®: Ø¯ÙˆÛŒØ¯Ù†</div>
        </div>
    </div>

    <!-- Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ -->
    <div class="card">
        <h3>âœï¸ Û³. Ù¾Ø§Ø³Ø®</h3>
        <input type="text" id="answerInput" placeholder="Ù¾Ø§Ø³Ø® Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." value="Ø¯ÙˆÛŒØ¯Ù†">
        <div class="flex-row">
            <button class="btn" id="btnSubmitAnswer">ğŸ“¨ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®</button>
            <button class="btn" style="background:#7f8c8d;" id="btnRandomAnswer">ğŸ² ØªØµØ§Ø¯ÙÛŒ</button>
            <button class="btn" style="background:#95a5a6;" id="btnSkip">â­ï¸ Ø±Ø¯ Ú©Ø±Ø¯Ù†</button>
        </div>
    </div>

    <!-- Ù†ØªÛŒØ¬Ù‡ SRS -->
    <div class="card" id="resultCard">
        <h3>ğŸ“Š Û´. Ù†ØªÛŒØ¬Ù‡</h3>
        <div id="srsResult" style="min-height: 80px; background: #fef9e7; padding: 16px; border-radius: 16px;">
            ğŸ‘ˆ Ù¾Ø³ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®ØŒ Ù†ØªÛŒØ¬Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </div>
    </div>

    <!-- Ù„Ø§Ú¯ -->
    <div class="log-console" id="logPanel">
        <div style="color: #f1c40f;">ğŸ“‹ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</div>
        <div id="logContent">âœ… Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.</div>
    </div>
</div>

<script>
    // ---------- Ù…Ø¯Ù„ SRS ----------
    const SRS = {
        calculate(quality, reps, ef, interval = 1) {
            if (quality < 3) {
                return { interval: 1, reps: 0, ef: Math.max(1.3, ef - 0.2) };
            }
            let newInterval;
            if (reps === 0) newInterval = 1;
            else if (reps === 1) newInterval = 6;
            else newInterval = Math.round(interval * ef);
            let newEf = ef + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
            newEf = Math.max(1.3, Math.min(3.0, newEf));
            return { interval: newInterval, reps: reps + 1, ef: newEf };
        }
    };

    // ---------- Ø¯Ø§Ø¯Ù‡ ----------
    const lesson = {
        id: 'L5',
        title: 'Ø¯Ø±Ø³ Ûµ: Ø§ÙØ¹Ø§Ù„ Ø±ÙˆØ²Ù…Ø±Ù‡',
        cards: [
            { id: 1, front: 'run', back: 'Ø¯ÙˆÛŒØ¯Ù†' },
            { id: 2, front: 'eat', back: 'Ø®ÙˆØ±Ø¯Ù†' },
            { id: 3, front: 'drink', back: 'Ù†ÙˆØ´ÛŒØ¯Ù†' },
            { id: 4, front: 'sleep', back: 'Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†' }
        ]
    };

    // ---------- state ----------
    const state = {
        currentIndex: 0,
        total: 4,
        reps: 0,
        ef: 2.5,
        interval: 1,
        results: [],
        scenario: 'Ù¾ÛŒØ´â€ŒÙØ±Ø¶'
    };

    // Ù„Ø§Ú¯
    const logEl = document.getElementById('logContent');
    function log(msg) {
        const div = document.createElement('div');
        div.textContent = `${new Date().toLocaleTimeString('fa-IR')} - ${msg}`;
        logEl.appendChild(div);
        logEl.scrollTop = logEl.scrollHeight;
    }

    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
    function updateUI() {
        const card = lesson.cards[state.currentIndex];
        document.getElementById('lessonTitle').textContent = lesson.title;
        document.getElementById('cardProgress').textContent = `${state.currentIndex + 1} Ø§Ø² ${state.total}`;
        document.getElementById('questionDisplay').textContent = `"${card.front}" â†’ ØŸ`;
        document.getElementById('correctAnswerDisplay').textContent = `Ù¾Ø§Ø³Ø®: ${card.back}`;
        
        // Ø¢Ù¾Ø¯ÛŒØª Ù…Ø±Ø§Ø­Ù„
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('step1').classList.add('active');
        document.getElementById('step2').classList.add('active');
        if (state.results.length > state.currentIndex) {
            document.getElementById('step3').classList.add('active');
            document.getElementById('step4').classList.add('active');
        }
    }

    // Ø±ÛŒØ³Øª
    function reset() {
        state.currentIndex = 0;
        state.reps = 0;
        state.ef = 2.5;
        state.interval = 1;
        state.results = [];
        document.getElementById('answerInput').value = 'Ø¯ÙˆÛŒØ¯Ù†';
        document.getElementById('srsResult').innerHTML = 'ğŸ‘ˆ Ù¾Ø³ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®ØŒ Ù†ØªÛŒØ¬Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.';
        updateUI();
        log('ğŸ”„ Ø±ÛŒØ³Øª Ø´Ø¯');
    }

    // Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
    function submitAnswer() {
        const card = lesson.cards[state.currentIndex];
        const userAnswer = document.getElementById('answerInput').value.trim();
        const isCorrect = userAnswer.toLowerCase() === card.back.toLowerCase();
        
        let quality = 1;
        if (isCorrect) {
            if (state.scenario.includes('Ø¹Ø§Ù„ÛŒ')) quality = 5;
            else if (state.scenario.includes('Ø®ÙˆØ¨')) quality = 4;
            else if (state.scenario.includes('Ø¶Ø¹ÛŒÙ')) quality = 2;
            else quality = 4;
        }

        const srsResult = SRS.calculate(quality, state.reps, state.ef, state.interval);
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡
        state.results.push({
            cardId: card.id,
            answer: userAnswer,
            correct: isCorrect,
            quality,
            srs: srsResult
        });
        
        state.reps = srsResult.reps;
        state.ef = srsResult.ef;
        state.interval = srsResult.interval;

        // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
        document.getElementById('srsResult').innerHTML = `
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
                <span style="color: ${isCorrect ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                    ${isCorrect ? 'âœ“ ØµØ­ÛŒØ­' : 'âœ— ØºÙ„Ø·'}
                </span>
                <span>Ú©ÛŒÙÛŒØª: ${quality}</span>
                <span>ğŸ“… ÙØ§ØµÙ„Ù‡: ${srsResult.interval} Ø±ÙˆØ²</span>
                <span>ğŸ”„ ØªÚ©Ø±Ø§Ø±: ${srsResult.reps}</span>
                <span>ğŸ“Š EF: ${srsResult.ef.toFixed(2)}</span>
            </div>
        `;

        log(`ğŸ“¨ Ù¾Ø§Ø³Ø®: "${userAnswer}" - ${isCorrect ? 'âœ“' : 'âœ—'} - Ú©ÛŒÙÛŒØª ${quality} - ÙØ§ØµÙ„Ù‡ ${srsResult.interval} Ø±ÙˆØ²`);

        // Ø­Ø±Ú©Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¨Ø¹Ø¯ÛŒ
        if (state.currentIndex < state.total - 1) {
            state.currentIndex++;
            updateUI();
            document.getElementById('answerInput').value = lesson.cards[state.currentIndex].back;
        } else {
            log('ğŸ Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ø´Ø¯!');
        }
    }

    // ---------- Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (ÛŒÚ©Ø¨Ø§Ø±) ----------
    function initButtons() {
        // Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§
        document.getElementById('btnScenario1').onclick = () => { reset(); state.scenario = 'Ø¹Ø§Ù„ÛŒ'; log('ğŸ”¥ Ø³Ù†Ø§Ø±ÛŒÙˆ: Ù¾Ø§Ø³Ø® Ø¹Ø§Ù„ÛŒ'); };
        document.getElementById('btnScenario2').onclick = () => { reset(); state.scenario = 'Ø®ÙˆØ¨'; log('ğŸ‘ Ø³Ù†Ø§Ø±ÛŒÙˆ: Ù¾Ø§Ø³Ø® Ø®ÙˆØ¨'); };
        document.getElementById('btnScenario3').onclick = () => { reset(); state.scenario = 'Ø¶Ø¹ÛŒÙ'; log('âš ï¸ Ø³Ù†Ø§Ø±ÛŒÙˆ: Ù¾Ø§Ø³Ø® Ø¶Ø¹ÛŒÙ'); };
        document.getElementById('btnScenario4').onclick = () => { reset(); state.scenario = 'Ù…Ø±ÙˆØ±'; log('ğŸ”„ Ø³Ù†Ø§Ø±ÛŒÙˆ: Ù…Ø±ÙˆØ± Ù…Ø¬Ø¯Ø¯'); };
        document.getElementById('btnReset').onclick = () => { reset(); };
        
        // Ù¾Ø§Ø³Ø®
        document.getElementById('btnSubmitAnswer').onclick = () => { submitAnswer(); };
        document.getElementById('btnRandomAnswer').onclick = () => {
            const answers = ['Ø¯ÙˆÛŒØ¯Ù†', 'Ø®ÙˆØ±Ø¯Ù†', 'Ù†ÙˆØ´ÛŒØ¯Ù†', 'Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†', 'Ø¯ÙˆÛŒØ¯', 'run'];
            document.getElementById('answerInput').value = answers[Math.floor(Math.random() * answers.length)];
        };
        document.getElementById('btnSkip').onclick = () => {
            if (state.currentIndex < state.total - 1) {
                state.currentIndex++;
                updateUI();
                document.getElementById('answerInput').value = lesson.cards[state.currentIndex].back;
                log(`â­ï¸ Ø±Ø¯ Ø´Ø¯ â†’ Ú©Ø§Ø±Øª ${state.currentIndex + 1}`);
            }
        };
    }

    // Ø´Ø±ÙˆØ¹
    window.onload = () => {
        initButtons();
        reset();
        log('âš¡ Ù†Ø³Ø®Ù‡ Ø³Ø±ÛŒØ¹ - Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯Ù†Ø¯');
    };
</script>
</body>
</html>
