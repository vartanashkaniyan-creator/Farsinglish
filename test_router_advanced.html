<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farsinglish - ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #311b92 0%, #4527a0 100%);
            color: #ede7f6;
            min-height: 100vh;
            padding: 15px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto;
            background: rgba(40, 35, 80, 0.95);
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(120, 144, 156, 0.3);
        }
        h1 { 
            text-align: center; 
            margin-bottom: 20px;
            font-size: 1.6rem;
            color: #b388ff;
        }
        .test-section { 
            margin: 15px 0;
            padding: 14px;
            background: rgba(50, 45, 90, 0.9);
            border-radius: 8px;
            border-left: 4px solid #7c4dff;
        }
        .test-header { 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title { 
            font-size: 0.95rem; 
            font-weight: 600;
            color: #ffab91;
        }
        .test-result { 
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .pass { background: linear-gradient(45deg, #00e676, #00c853); }
        .fail { background: linear-gradient(45deg, #ff5252, #d50000); }
        .details { 
            margin-top: 8px;
            padding: 10px;
            background: rgba(30, 25, 60, 0.8);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #cfd8dc;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: rgba(50, 45, 90, 0.9);
            border-radius: 8px;
            text-align: center;
            font-size: 0.95rem;
        }
        button {
            background: linear-gradient(45deg, #6200ea, #7c4dff);
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        .controls { text-align: center; margin-top: 15px; }
        .simulation {
            margin: 20px 0;
            padding: 15px;
            background: rgba(60, 55, 100, 0.9);
            border-radius: 10px;
            border: 1px dashed rgba(179, 136, 255, 0.4);
        }
        .sim-btn {
            background: rgba(124, 77, 255, 0.2);
            border: 1px solid #7c4dff;
            color: #b388ff;
            padding: 6px 12px;
            border-radius: 6px;
            margin: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .route-display {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 6px;
            margin: 10px 0;
            color: #ffd54f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ - Û¶ ØªØ³Øª</h1>
        
        <div class="simulation">
            <h3>ğŸ® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ</h3>
            <div id="sim-controls"></div>
            <div class="route-display">
                Ù…Ø³ÛŒØ± ÙØ¹Ù„ÛŒ: <span id="current-route">/</span>
            </div>
            <div class="route-display">
                ÙˆØ¶Ø¹ÛŒØª: <span id="user-status">Ù…Ù‡Ù…Ø§Ù†</span>
            </div>
        </div>
        
        <div id="test-results"></div>
        
        <div class="summary">
            <p id="summary-text">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡...</p>
        </div>
        
        <div class="controls">
            <button onclick="runAllTests()">ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="runSimulation()">ğŸ® ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²</button>
            <button onclick="clearTests()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
        </div>
    </div>

    <script>
        // ==================== Advanced Router ====================
        class AdvancedRouter {
            constructor() {
                this.routes = new Map();
                this.currentRoute = '/';
                this.history = [];
                this.isAuthenticated = false;
                this.userRole = 'guest';
                this.routeListeners = [];
                this.maxHistory = 20;
                
                this.initRoutes();
            }
            
            initRoutes() {
                const routes = {
                    '/': { name: 'Ø®Ø§Ù†Ù‡', auth: false, roles: ['guest', 'user', 'admin'] },
                    '/login': { name: 'ÙˆØ±ÙˆØ¯', auth: false, roles: ['guest'] },
                    '/register': { name: 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…', auth: false, roles: ['guest'] },
                    '/dashboard': { name: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', auth: true, roles: ['user', 'admin'] },
                    '/lessons': { name: 'Ø¯Ø±ÙˆØ³', auth: true, roles: ['user', 'admin'] },
                    '/profile': { name: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„', auth: true, roles: ['user', 'admin'] },
                    '/admin': { name: 'Ù…Ø¯ÛŒØ±ÛŒØª', auth: true, roles: ['admin'] },
                    '/premium': { name: 'ÙˆÛŒÚ˜Ù‡', auth: true, roles: ['premium', 'admin'] },
                    '/404': { name: 'ÛŒØ§ÙØª Ù†Ø´Ø¯', auth: false, roles: ['guest', 'user', 'admin'] }
                };
                
                Object.entries(routes).forEach(([path, config]) => {
                    this.routes.set(path, config);
                });
            }
            
            async navigate(toPath, options = {}) {
                // Ø§Ú¯Ø± Ù…Ø³ÛŒØ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
                if (!this.routes.has(toPath)) {
                    console.warn(`â›” Ù…Ø³ÛŒØ± ${toPath} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`);
                    this._changeRoute('/404', toPath, false);
                    return false;
                }
                
                const route = this.routes.get(toPath);
                
                // 1. Ø¨Ø±Ø±Ø³ÛŒ Guard Ù…Ù‡Ù…Ø§Ù†
                if ((toPath === '/login' || toPath === '/register') && this.isAuthenticated) {
                    console.log('ğŸ”’ Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ØŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø±ÙˆØ¯');
                    this._changeRoute('/dashboard', toPath, false);
                    return false;
                }
                
                // 2. Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                if (route.auth && !this.isAuthenticated) {
                    console.log('ğŸ” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ†');
                    this._changeRoute('/login', toPath, false);
                    return false;
                }
                
                // 3. Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
                if (route.roles && !route.roles.includes(this.userRole)) {
                    console.log(`ğŸš« Ù†Ù‚Ø´ ${this.userRole} Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª`);
                    this._changeRoute('/', toPath, false);
                    return false;
                }
                
                // 4. Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚
                return this._changeRoute(toPath, this.currentRoute, true, options);
            }
            
            _changeRoute(newPath, fromPath, success, options = {}) {
                const oldRoute = this.currentRoute;
                this.currentRoute = newPath;
                
                // Ù…Ø¯ÛŒØ±ÛŒØª ØªØ§Ø±ÛŒØ®Ú†Ù‡
                if (success && !options.replace && oldRoute !== newPath) {
                    this.history.push(oldRoute);
                    if (this.history.length > this.maxHistory) {
                        this.history.shift();
                    }
                }
                
                // Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ù‡ listeners
                this._notifyListeners({
                    from: fromPath,
                    to: newPath,
                    success,
                    timestamp: Date.now(),
                    userRole: this.userRole
                });
                
                console.log(`ğŸ“ ${success ? 'âœ…' : 'âŒ'} ${fromPath} â†’ ${newPath}`);
                return success;
            }
            
            // ========== Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==========
            
            goBack(steps = 1) {
                if (this.history.length === 0) return false;
                
                const targetIndex = Math.max(0, this.history.length - steps);
                const targetRoute = this.history[targetIndex];
                
                // Ø­Ø°Ù Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡
                this.history.splice(targetIndex, this.history.length - targetIndex);
                
                return this.navigate(targetRoute, { replace: true });
            }
            
            goForward() {
                // Ø¯Ø± Ø§ÛŒÙ† Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ØŒ forward ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ separate forward stack Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                return false;
            }
            
            addRoute(path, config) {
                if (this.routes.has(path)) return false;
                
                this.routes.set(path, {
                    name: 'Ù…Ø³ÛŒØ± Ø¬Ø¯ÛŒØ¯',
                    auth: false,
                    roles: ['guest', 'user', 'admin'],
                    ...config
                });
                
                this._notifyListeners({
                    type: 'ROUTE_ADDED',
                    path,
                    timestamp: Date.now()
                });
                
                return true;
            }
            
            removeRoute(path) {
                if (['/', '/404', '/login'].includes(path)) return false;
                
                const removed = this.routes.delete(path);
                if (removed) {
                    this._notifyListeners({
                        type: 'ROUTE_REMOVED',
                        path,
                        timestamp: Date.now()
                    });
                }
                
                return removed;
            }
            
            // ========== Ù…Ø¯ÛŒØ±ÛŒØª Listeners ==========
            
            onRouteChange(callback) {
                this.routeListeners.push(callback);
                return () => {
                    const index = this.routeListeners.indexOf(callback);
                    if (index > -1) this.routeListeners.splice(index, 1);
                };
            }
            
            _notifyListeners(data) {
                this.routeListeners.forEach(listener => {
                    try {
                        listener(data);
                    } catch (error) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± listener:', error);
                    }
                });
            }
            
            // ========== Utility Methods ==========
            
            setAuth(authenticated, role = 'user') {
                this.isAuthenticated = authenticated;
                this.userRole = role;
                console.log(`ğŸ‘¤ ÙˆØ¶Ø¹ÛŒØª: ${authenticated ? 'Ù„Ø§Ú¯ÛŒÙ†' : 'Ù„Ø§Ú¯â€ŒØ§ÙˆØª'} | Ù†Ù‚Ø´: ${role}`);
            }
            
            getRouteInfo(path) {
                return this.routes.get(path) || null;
            }
            
            getHistory() {
                return [...this.history];
            }
            
            clearHistory() {
                this.history = [];
                return true;
            }
            
            // ========== Route Parameters ==========
            
            parsePathWithParams(template, params) {
                let path = template;
                for (const [key, value] of Object.entries(params)) {
                    path = path.replace(`:${key}`, encodeURIComponent(value));
                }
                return path;
            }
            
            extractParams(template, actualPath) {
                const params = {};
                const templateParts = template.split('/');
                const actualParts = actualPath.split('/');
                
                if (templateParts.length !== actualParts.length) return null;
                
                for (let i = 0; i < templateParts.length; i++) {
                    if (templateParts[i].startsWith(':')) {
                        const paramName = templateParts[i].substring(1);
                        params[paramName] = decodeURIComponent(actualParts[i]);
                    } else if (templateParts[i] !== actualParts[i]) {
                        return null;
                    }
                }
                
                return params;
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ====================
        const advancedTests = [
            {
                id: 1,
                title: "Ø³ÛŒØ³ØªÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ (Event Listeners)",
                run: async () => {
                    return new Promise((resolve) => {
                        const router = new AdvancedRouter();
                        let eventReceived = false;
                        
                        const unsubscribe = router.onRouteChange((event) => {
                            if (event.to === '/dashboard' && event.success) {
                                eventReceived = true;
                                unsubscribe();
                                resolve(eventReceived);
                            }
                        });
                        
                        router.setAuth(true, 'user');
                        router.navigate('/dashboard');
                        
                        setTimeout(() => resolve(false), 1000);
                    });
                }
            },
            {
                id: 2,
                title: "Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù…Ø³ÛŒØ± - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø³Ø§Ø®Øª",
                run: async () => {
                    const router = new AdvancedRouter();
                    
                    // Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ± Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±
                    router.addRoute('/lesson/:lessonId', {
                        name: 'Ø¯Ø±Ø³',
                        auth: true,
                        roles: ['user', 'admin']
                    });
                    
                    // Ø³Ø§Ø®Øª Ù…Ø³ÛŒØ± Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±
                    const constructed = router.parsePathWithParams(
                        '/lesson/:lessonId', 
                        { lessonId: '123-ÙØ§Ø±Ø³ÛŒ' }
                    );
                    
                    const isCorrect = constructed === '/lesson/123-%D9%81%D8%A7%D8%B1%D8%B3%DB%8C';
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
                    const params = router.extractParams(
                        '/lesson/:lessonId',
                        '/lesson/123-%D9%81%D8%A7%D8%B1%D8%B3%DB%8C'
                    );
                    
                    const hasParam = params && params.lessonId === '123-ÙØ§Ø±Ø³ÛŒ';
                    
                    return isCorrect && hasParam;
                }
            },
            {
                id: 3,
                title: "ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‡Ù…Ø²Ù…Ø§Ù† (Concurrent Navigation)",
                run: async () => {
                    const router = new AdvancedRouter();
                    router.setAuth(true, 'user');
                    
                    // Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†
                    const promises = [
                        router.navigate('/dashboard'),
                        router.navigate('/lessons'),
                        router.navigate('/profile')
                    ];
                    
                    const results = await Promise.all(promises);
                    
                    // ÙÙ‚Ø· ÛŒÚ©ÛŒ Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯ (Ø¢Ø®Ø±ÛŒÙ†)
                    const successCount = results.filter(r => r).length;
                    const finalRoute = router.currentRoute;
                    
                    return successCount === 1 && finalRoute === '/profile';
                }
            },
            {
                id: 4,
                title: "Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",
                run: async () => {
                    const router = new AdvancedRouter();
                    router.setAuth(true, 'user');
                    
                    // ÛŒÚ© Ù…Ø³ÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø±
                    await router.navigate('/invalid-route');
                    const is404 = router.currentRoute === '/404';
                    
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ù‡ Ù…Ø³ÛŒØ± Ù…Ø¹ØªØ¨Ø±
                    await router.navigate('/dashboard');
                    const recovered = router.currentRoute === '/dashboard';
                    
                    // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§ÛŒØ¯ ØµØ­ÛŒØ­ Ø¨Ø§Ø´Ø¯
                    const historyValid = router.history.includes('/404');
                    
                    return is404 && recovered && historyValid;
                }
            },
            {
                id: 5,
                title: "ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ Ø­Ø¬Ù… Ø²ÛŒØ§Ø¯",
                run: async () => {
                    const router = new AdvancedRouter();
                    router.setAuth(true, 'user');
                    
                    const startTime = Date.now();
                    const iterations = 50;
                    
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø³Ø±ÛŒØ¹ Ù…Ø³ÛŒØ±
                    for (let i = 0; i < iterations; i++) {
                        await router.navigate('/dashboard');
                        await router.navigate('/lessons');
                    }
                    
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ performance
                    const isPerformant = duration < 2000; // Ú©Ù…ØªØ± Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ memory (ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø¨Ø²Ø±Ú¯ Ø´ÙˆØ¯)
                    const historySize = router.history.length;
                    const historyValid = historySize <= router.maxHistory;
                    
                    return isPerformant && historyValid;
                }
            },
            {
                id: 6,
                title: "Ø­Ø°Ù Ù…Ø³ÛŒØ± Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©",
                run: async () => {
                    const router = new AdvancedRouter();
                    
                    // Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ± Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
                    const added = router.addRoute('/custom/:id', {
                        name: 'Ø³ÙØ§Ø±Ø´ÛŒ',
                        auth: false,
                        roles: ['guest', 'user']
                    });
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯
                    const exists = router.routes.has('/custom/:id');
                    
                    // Ø­Ø°Ù
                    const removed = router.removeRoute('/custom/:id');
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯
                    const notExists = !router.routes.has('/custom/:id');
                    
                    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù…Ø³ÛŒØ± Ø³ÛŒØ³ØªÙ…ÛŒ
                    const cannotRemoveSystem = !router.removeRoute('/');
                    
                    return added && exists && removed && notExists && cannotRemoveSystem;
                }
            }
        ];

        // ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        let passedTests = 0;
        let failedTests = 0;

        async function runAllTests() {
            passedTests = 0;
            failedTests = 0;
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            for (const test of advancedTests) {
                try {
                    const result = await test.run();
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-section';
                    
                    const testResult = result ? 'pass' : 'fail';
                    const resultText = result ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚';
                    
                    if (result) passedTests++;
                    else failedTests++;
                    
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result ${testResult}">${resultText}</div>
                        </div>
                    `;
                    
                    resultsDiv.appendChild(testDiv);
                    
                } catch (error) {
                    failedTests++;
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-section';
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result fail">âŒ Ø®Ø·Ø§</div>
                        </div>
                        <div class="details">${error.message}</div>
                    `;
                    resultsDiv.appendChild(testDiv);
                }
                
                updateSummary();
            }
        }

        // ==================== Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ ====================
        function runSimulation() {
            const router = new AdvancedRouter();
            const controls = document.getElementById('sim-controls');
            
            controls.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <button class="sim-btn" onclick="simLogin('user')">ğŸ‘¤ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</button>
                    <button class="sim-btn" onclick="simLogin('admin')">ğŸ‘‘ ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</button>
                    <button class="sim-btn" onclick="simLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
                </div>
                <div>
                    <button class="sim-btn" onclick="simNavigate('/')">ğŸ  Ø®Ø§Ù†Ù‡</button>
                    <button class="sim-btn" onclick="simNavigate('/login')">ğŸ” ÙˆØ±ÙˆØ¯</button>
                    <button class="sim-btn" onclick="simNavigate('/dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
                    <button class="sim-btn" onclick="simNavigate('/lessons')">ğŸ“š Ø¯Ø±ÙˆØ³</button>
                    <button class="sim-btn" onclick="simNavigate('/admin')">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª</button>
                    <button class="sim-btn" onclick="simNavigate('/invalid')">âŒ Ù…Ø³ÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø±</button>
                </div>
                <div style="margin-top: 10px;">
                    <button class="sim-btn" onclick="simGoBack()">â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                    <button class="sim-btn" onclick="simAddRoute()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ±</button>
                </div>
            `;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆØªØ± Ø¯Ø± window Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² ØªÙˆØ§Ø¨Ø¹
            window.simRouter = router;
            
            // listener Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            router.onRouteChange((event) => {
                updateSimulationUI();
                console.log('Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ:', event);
            });
            
            updateSimulationUI();
        }
        
        function simLogin(role) {
            window.simRouter.setAuth(true, role);
            updateSimulationUI();
        }
        
        function simLogout() {
            window.simRouter.setAuth(false, 'guest');
            updateSimulationUI();
        }
        
        async function simNavigate(path) {
            await window.simRouter.navigate(path);
            updateSimulationUI();
        }
        
        function simGoBack() {
            window.simRouter.goBack();
            updateSimulationUI();
        }
        
        function simAddRoute() {
            const path = `/custom-${Date.now()}`;
            window.simRouter.addRoute(path, {
                name: 'Ù…Ø³ÛŒØ± Ø³ÙØ§Ø±Ø´ÛŒ',
                auth: false
            });
            console.log(`Ù…Ø³ÛŒØ± ${path} Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
        }
        
        function updateSimulationUI() {
            const router = window.simRouter;
            if (!router) return;
            
            document.getElementById('current-route').textContent = router.currentRoute;
            
            const status = router.isAuthenticated 
                ? `âœ… Ù„Ø§Ú¯ÛŒÙ† (${router.userRole})` 
                : 'âŒ Ù…Ù‡Ù…Ø§Ù†';
            document.getElementById('user-status').textContent = status;
        }

        function clearTests() {
            document.getElementById('test-results').innerHTML = '';
            passedTests = failedTests = 0;
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('summary-text');
            const total = advancedTests.length;
            const percentage = total > 0 ? Math.round((passedTests / total) * 100) : 0;
            
            summary.innerHTML = `
                <strong>Ù†ØªÛŒØ¬Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡:</strong><br>
                âœ… ${passedTests} Ù…ÙˆÙÙ‚ | âŒ ${failedTests} Ù†Ø§Ù…ÙˆÙÙ‚ | ğŸ“Š ${percentage}% Ù‚Ø¨ÙˆÙ„ÛŒ
                ${percentage === 100 ? 'ğŸ† Ø¹Ø§Ù„ÛŒ!' : percentage >= 80 ? 'ğŸ‘ Ø®ÙˆØ¨' : 'âš ï¸ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯'}
            `;
            
            summary.style.color = percentage === 100 ? '#00e676' : 
                                 percentage >= 80 ? '#ffd600' : '#ff5252';
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
        window.onload = () => {
            updateSummary();
            setTimeout(() => {
                runAllTests();
                runSimulation();
            }, 500);
        };
    </script>
</body>
</html>
