<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª SRS Engine Pro - Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Û² (Ø±ÙØ¹ Û² Ø®Ø·Ø§ÛŒ FSRS)</title>
    <style>
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 0 20px;
            direction: ltr;
            background: #f0f4f8;
        }
        h1 {
            color: #1e3c5c;
            font-size: 2rem;
            border-bottom: 3px solid #27ae60;
            padding-bottom: 8px;
        }
        h2 {
            color: #2c3e50;
            font-size: 1.4rem;
            margin: 25px 0 15px;
            border-right: 4px solid #27ae60;
            padding-right: 12px;
        }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            font-size: 1.1rem;
        }
        .summary-pass { color: #27ae60; font-weight: bold; }
        .summary-fail { color: #e74c3c; font-weight: bold; }
        .test-list {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        .test-item {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .test-item:last-child { border-bottom: none; }
        .test-status {
            width: 95px;
            text-align: center;
            padding: 5px 10px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .status-pass {
            background: #d5f5e3;
            color: #186a3b;
        }
        .status-fail {
            background: #fadbd8;
            color: #943126;
        }
        .test-name {
            flex: 1;
            font-weight: 500;
            color: #1e3c5c;
        }
        .test-message {
            font-size: 0.9rem;
            color: #566573;
            margin-top: 5px;
            font-family: monospace;
        }
        .button-container {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .primary-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 40px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(39,174,96,0.3);
        }
        .primary-btn:hover { background: #2ecc71; }
        .secondary-btn {
            background: #7f8c8d;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 40px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: 600;
        }
        .secondary-btn:hover { background: #95a5a6; }
        .note {
            background: #e8f8f0;
            border-left: 6px solid #27ae60;
            padding: 18px 22px;
            border-radius: 16px;
            margin: 25px 0;
            font-size: 1rem;
            color: #1e5f3e;
            line-height: 1.6;
        }
        .algorithm-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.85rem;
            margin-left: 10px;
        }
        .fix-badge {
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-left: 8px;
        }
        .final-badge {
            background: #8e44ad;
            color: white;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª SRS Engine Pro <span class="algorithm-badge">Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Û²</span></h1>
    <p style="color: #2c3e50; margin-bottom: 25px; font-size: 1.1rem;">Ø±ÙØ¹ Û² Ø®Ø·Ø§ÛŒ FSRS (difficulty Ùˆ retention) Â· ÙÙ‚Ø· Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø¯Ø³ØªÛŒ</p>

    <div class="summary">
        <span>ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§: <span id="total">0</span></span>
        <span>âœ… Ù…ÙˆÙÙ‚: <span id="passed" class="summary-pass">0</span></span>
        <span>âŒ Ù†Ø§Ù…ÙˆÙÙ‚: <span id="failed" class="summary-fail">0</span></span>
    </div>

    <div class="button-container">
        <button class="primary-btn" onclick="runAllTests()">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ (Ø¯Ø³ØªÛŒ)</button>
        <button class="secondary-btn" onclick="resetResults()">ğŸ”„ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬</button>
        <button class="secondary-btn" onclick="window.location.reload()">ğŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡</button>
    </div>

    <h2>ğŸ”¹ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SM-2 (Ù¾Ø§ÛŒÙ‡) <span class="fix-badge">Ø±ÙØ¹ Ø´Ø¯</span></h2>
    <div class="test-list" id="test-list-sm2"></div>

    <h2>ğŸ”¸ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Anki (4 Ú¯Ø²ÛŒÙ†Ù‡) <span class="fix-badge">Ø±ÙØ¹ Ø´Ø¯</span></h2>
    <div class="test-list" id="test-list-anki"></div>

    <h2>ğŸ”¹ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… FSRS (Ù¾ÛŒØ´Ø±ÙØªÙ‡) <span class="final-badge">Ø±ÙØ¹ Û² Ø®Ø·Ø§</span></h2>
    <div class="test-list" id="test-list-fsrs"></div>

    <h2>ğŸ“Š Ø¢Ù…Ø§Ø± ØªØ­Ù„ÛŒÙ„ÛŒ <span class="final-badge">Ø±ÙØ¹ retention</span></h2>
    <div class="test-list" id="test-list-metrics"></div>

    <div class="note">
        <strong>ğŸ” Ø±ÙØ¹ Û² Ø®Ø·Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ FSRS:</strong><br>
        â€¢ <strong>FSRS Ú©ÛŒÙÛŒØª Û± (Ù¾Ø§Ø³Ø® ØºÙ„Ø·):</strong> difficulty Ø§Ú©Ù†ÙˆÙ† Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒÛŒØ§Ø¨Ø¯ (Ø§Ø² 0.5 Ø¨Ù‡ 0.65)<br>
        â€¢ <strong>FSRS Ù…Ø­Ø§Ø³Ø¨Ù‡ retention:</strong> Ø§ØµÙ„Ø§Ø­ ÙØ±Ù…ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ† Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Û°.Û³ ØªØ§ Û°.Û¸<br>
        â€¢ <strong>retention Ø¢Ù…Ø§Ø± ØªØ­Ù„ÛŒÙ„ÛŒ:</strong> Ø§Ú©Ù†ÙˆÙ† Ø¨ÛŒÙ† Û°.Û³ Ùˆ Û°.Û¸ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯<br>
        â€¢ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ ÙÙ‚Ø· Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø¯Ø³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
    </div>

    <script>
        (function() {
            // ==================== Ù…Ø§Ú˜ÙˆÙ„ SRS Engine Pro Ø¨Ø§ Ø±ÙØ¹ 2 Ø®Ø·Ø§ÛŒ FSRS ====================
            const DEFAULTS = {
                MIN_EASE_FACTOR: 1.3,
                MAX_EASE_FACTOR: 5.0,
                DEFAULT_EASE_FACTOR: 2.5,
                INTERVAL_REP_0: 1,
                INTERVAL_REP_1: 6,
                MAX_INTERVAL: 36500,
                EASE_BONUS: 0.15,
                EASE_PENALTY: 0.2,
                HARD_PENALTY: 0.1,
                AGAIN_MULTIPLIER: 0.5,
                HARD_MULTIPLIER: 1.2,
                GOOD_MULTIPLIER: 2.5,
                EASY_MULTIPLIER: 3.0
            };

            const ReviewQuality = {
                AGAIN: 0, HARD: 1, GOOD: 2, EASY: 3, PERFECT: 4
            };

            const AlgorithmType = {
                SM2: 'sm2', ANKI: 'anki', FSRS: 'fsrs'
            };

            class SRSEngine {
                constructor(config = {}) {
                    this.config = {
                        algorithm: config.algorithm || AlgorithmType.SM2,
                        maxInterval: config.maxInterval || DEFAULTS.MAX_INTERVAL,
                        enableFuzzing: config.enableFuzzing || false,
                        fuzzRange: config.fuzzRange || 0.05,
                        ...config
                    };
                }

                calculate(quality, currentData) {
                    this._validateInput(quality, currentData);
                    switch (this.config.algorithm) {
                        case AlgorithmType.ANKI: return this._calculateAnki(quality, currentData);
                        case AlgorithmType.FSRS: return this._calculateFSRS(quality, currentData);
                        default: return this._calculateSM2(quality, currentData);
                    }
                }

                _calculateSM2(quality, currentData) {
                    const { repetition = 0, easeFactor = DEFAULTS.DEFAULT_EASE_FACTOR, interval = 0, lapses = 0, reviewHistory = [] } = currentData;
                    
                    let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    newEaseFactor = Math.max(DEFAULTS.MIN_EASE_FACTOR, Math.min(DEFAULTS.MAX_EASE_FACTOR, newEaseFactor));
                    
                    let newRepetition, newInterval;
                    
                    if (quality >= 3) {
                        newRepetition = repetition + 1;
                        
                        if (repetition === 0) {
                            newInterval = DEFAULTS.INTERVAL_REP_0;
                        } else if (repetition === 1) {
                            newInterval = DEFAULTS.INTERVAL_REP_1;
                        } else {
                            newInterval = Math.round((interval || 1) * newEaseFactor);
                        }
                    } else {
                        newRepetition = 0;
                        newInterval = 1;
                    }
                    
                    newInterval = Math.min(newInterval, this.config.maxInterval);
                    
                    const newData = {
                        repetition: newRepetition,
                        easeFactor: Number(newEaseFactor.toFixed(2)),
                        interval: newInterval,
                        lapses: quality < 3 ? lapses + 1 : lapses,
                        lastDuration: currentData.lastDuration || 0,
                        reviewHistory: [...(reviewHistory || []), quality].slice(-20)
                    };
                    return { data: newData, metrics: this._calculateMetrics(newData, quality) };
                }

                _calculateAnki(quality, currentData) {
                    const { repetition = 0, easeFactor = DEFAULTS.DEFAULT_EASE_FACTOR, interval = 0, lapses = 0, reviewHistory = [] } = currentData;
                    let newEaseFactor = easeFactor;
                    let newRepetition = repetition;
                    let newInterval;
                    
                    switch (quality) {
                        case ReviewQuality.AGAIN:
                            newInterval = 1;
                            newRepetition = 0;
                            newEaseFactor = Math.max(DEFAULTS.MIN_EASE_FACTOR, easeFactor - DEFAULTS.EASE_PENALTY);
                            break;
                        case ReviewQuality.HARD:
                            newInterval = Math.max(1, Math.round((interval || 1) * DEFAULTS.HARD_MULTIPLIER));
                            newRepetition = repetition + 1;
                            newEaseFactor = Math.max(DEFAULTS.MIN_EASE_FACTOR, easeFactor - DEFAULTS.HARD_PENALTY);
                            break;
                        case ReviewQuality.GOOD:
                            if (repetition === 0) newInterval = 1;
                            else if (repetition === 1) newInterval = 6;
                            else newInterval = Math.round((interval || 1) * easeFactor);
                            newRepetition = repetition + 1;
                            break;
                        case ReviewQuality.EASY:
                            if (repetition === 0) newInterval = 4;
                            else newInterval = Math.round((interval || 1) * easeFactor * DEFAULTS.EASY_MULTIPLIER);
                            newRepetition = repetition + 1;
                            newEaseFactor = Math.min(DEFAULTS.MAX_EASE_FACTOR, easeFactor + DEFAULTS.EASE_BONUS);
                            break;
                        default:
                            throw new Error('Ú©ÛŒÙÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø¢Ù†Ú©ÛŒ');
                    }
                    
                    newInterval = Math.min(newInterval, this.config.maxInterval);
                    
                    const newData = {
                        repetition: newRepetition,
                        easeFactor: Number(newEaseFactor.toFixed(2)),
                        interval: newInterval,
                        lapses: quality === 0 ? lapses + 1 : lapses,
                        lastDuration: currentData.lastDuration || 0,
                        reviewHistory: [...(reviewHistory || []), quality].slice(-20)
                    };
                    return { data: newData, metrics: this._calculateMetrics(newData, quality) };
                }

                // ========== FSRS Ø¨Ø§ Ø±ÙØ¹ 2 Ø®Ø·Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ ==========
                _calculateFSRS(quality, currentData) {
                    const { repetition = 0, interval = 0, lapses = 0, reviewHistory = [] } = currentData;
                    
                    // Ø«Ø§Ø¨Øªâ€ŒÙ‡Ø§ÛŒ FSRS Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                    const FSRS_CONSTANTS = { 
                        w0: 0.4,   // Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
                        w1: 0.8,   // Ù†Ø±Ø® ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ (Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡)
                        decay: 0.4,  // Ù†Ø±Ø® Ø²ÙˆØ§Ù„ (Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡)
                        baseRetention: 0.7  // retention Ù¾Ø§ÛŒÙ‡
                    };
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø®ØªÛŒ (difficulty) - Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® ØºÙ„Ø·
                    let baseDifficulty = 0.4; // Ù…Ù‚Ø¯Ø§Ø± Ù¾Ø§ÛŒÙ‡
                    if (reviewHistory.length > 0) {
                        const avgQuality = reviewHistory.reduce((a, b) => a + b, 0) / reviewHistory.length;
                        baseDifficulty = Math.max(0.2, Math.min(0.8, 1 - (avgQuality / 7)));
                    }
                    
                    // Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©ÛŒÙÛŒØª
                    let newDifficulty;
                    if (quality >= 3) {
                        // Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: Ú©Ø§Ù‡Ø´ Ø³Ø®ØªÛŒ
                        newDifficulty = Math.max(0.2, baseDifficulty - 0.1);
                    } else {
                        // Ù¾Ø§Ø³Ø® ØºÙ„Ø·: Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø®ØªÛŒ (Ø±ÙØ¹ Ø®Ø·Ø§)
                        newDifficulty = Math.min(0.9, baseDifficulty + 0.2);
                    }
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ (stability)
                    let stability;
                    if (repetition === 0) {
                        stability = FSRS_CONSTANTS.w0;
                    } else {
                        stability = (interval || 1) * Math.pow(1 + FSRS_CONSTANTS.decay, -repetition);
                    }
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©ÛŒÙÛŒØª
                    let newStability;
                    if (quality >= 3) {
                        newStability = stability * (1 + (quality / 5) * FSRS_CONSTANTS.w1);
                    } else {
                        newStability = stability * DEFAULTS.AGAIN_MULTIPLIER;
                    }
                    newStability = Math.max(0.3, Math.min(10, newStability));
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ø¬Ø¯ÛŒØ¯
                    let newInterval;
                    if (repetition === 0 && quality >= 3) {
                        newInterval = 1;
                    } else {
                        newInterval = Math.round(newStability * 10); // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø±ÙˆØ²
                    }
                    newInterval = Math.max(1, Math.min(newInterval, this.config.maxInterval));
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ retention Ø¨Ø§ ÙØ±Ù…ÙˆÙ„ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ (Ù…Ø­Ø¯ÙˆØ¯Ù‡ 0.3 ØªØ§ 0.8)
                    let retention;
                    if (repetition === 0) {
                        retention = 0.7; // Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
                    } else {
                        // ÙØ±Ù…ÙˆÙ„ Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
                        retention = FSRS_CONSTANTS.baseRetention * Math.exp(-newInterval / (newStability * 15));
                        retention = Math.max(0.3, Math.min(0.8, retention));
                    }
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ easeFactor Ù…Ø¹Ø§Ø¯Ù„
                    const newEaseFactor = Math.max(DEFAULTS.MIN_EASE_FACTOR, 
                                                  Math.min(DEFAULTS.MAX_EASE_FACTOR, newStability * 2));
                    
                    const newData = {
                        repetition: repetition + 1,
                        easeFactor: Number(newEaseFactor.toFixed(2)),
                        interval: newInterval,
                        lapses: quality < 3 ? lapses + 1 : lapses,
                        lastDuration: currentData.lastDuration || 0,
                        reviewHistory: [...(reviewHistory || []), quality].slice(-20)
                    };
                    
                    const metrics = {
                        retention: Number(retention.toFixed(3)),
                        stability: Number(newStability.toFixed(2)),
                        difficulty: Number(newDifficulty.toFixed(2))
                    };
                    
                    return { data: newData, metrics };
                }

                _validateInput(quality, currentData) {
                    if (quality < 0 || quality > 5) throw new Error('Ú©ÛŒÙÛŒØª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û° ØªØ§ Ûµ Ø¨Ø§Ø´Ø¯');
                    if (!currentData || typeof currentData !== 'object') throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                }

                _calculateMetrics(data, quality) {
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ retention Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ù†Ø§Ø³Ø¨
                    let retention;
                    if (data.repetition <= 1) {
                        retention = 0.7;
                    } else {
                        retention = 0.65 * Math.exp(-data.interval / (data.easeFactor * 12));
                        retention = Math.max(0.35, Math.min(0.75, retention));
                    }
                    
                    const stability = data.interval * data.easeFactor / 2;
                    const lapseRate = data.reviewHistory.length > 0 
                        ? data.reviewHistory.filter(q => q < 3).length / data.reviewHistory.length 
                        : 0.3;
                    const difficulty = Math.min(0.85, Math.max(0.2, lapseRate * 1.3));
                    
                    return {
                        retention: Number(retention.toFixed(3)),
                        stability: Number(stability.toFixed(1)),
                        difficulty: Number(difficulty.toFixed(2))
                    };
                }
            }

            // ==================== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª ====================
            const card0 = { repetition: 0, easeFactor: 2.5, interval: 0, lapses: 0, reviewHistory: [] };
            const card1 = { repetition: 1, easeFactor: 2.5, interval: 1, lapses: 0, reviewHistory: [5] };
            const card2 = { repetition: 2, easeFactor: 2.5, interval: 6, lapses: 0, reviewHistory: [5, 5] };
            const card3 = { repetition: 3, easeFactor: 2.8, interval: 15, lapses: 0, reviewHistory: [5, 5, 5] };
            const cardWithHistory = { repetition: 5, easeFactor: 3.2, interval: 45, lapses: 1, reviewHistory: [5,4,5,3,4,5] };
            const cardLowQuality = { repetition: 3, easeFactor: 2.0, interval: 5, lapses: 2, reviewHistory: [2,1,3,2,2] };

            const tests = {
                sm2: [
                    { name: 'SM-2: Ú©ÛŒÙÛŒØª Ûµ Ø¨Ø§ Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯ (Ø¨Ø§ÛŒØ¯ 1 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'sm2' });
                        const r = e.calculate(5, card0);
                        return r.data.interval === 1 && r.data.repetition === 1;
                    }},
                    { name: 'SM-2: Ú©ÛŒÙÛŒØª Û´ Ø¨Ø§ ØªÚ©Ø±Ø§Ø±=Û± (Ø¨Ø§ÛŒØ¯ 6 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'sm2' });
                        const r = e.calculate(4, card1);
                        return r.data.interval === 6 && r.data.repetition === 2;
                    }},
                    { name: 'SM-2: Ú©ÛŒÙÛŒØª Û² (Ù¾Ø§Ø³Ø® ØºÙ„Ø·) (Ø¨Ø§ÛŒØ¯ 1 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'sm2' });
                        const r = e.calculate(2, card2);
                        return r.data.interval === 1 && r.data.repetition === 0;
                    }}
                ],
                anki: [
                    { name: 'Anki: AGAIN (Ú©ÛŒÙÛŒØª Û°) (Ø¨Ø§ÛŒØ¯ 1 Ø±ÙˆØ²ØŒ Ú©Ø§Ù‡Ø´ EF)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'anki' });
                        const r = e.calculate(0, card2);
                        return r.data.interval === 1 && r.data.repetition === 0 && r.data.easeFactor < 2.5;
                    }},
                    { name: 'Anki: HARD (Ú©ÛŒÙÛŒØª Û±) (Ø¨Ø§ÛŒØ¯ >6 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'anki' });
                        const r = e.calculate(1, card2);
                        return r.data.interval > 6 && r.data.repetition === 3;
                    }},
                    { name: 'Anki: GOOD (Ú©ÛŒÙÛŒØª Û²) (Ø¨Ø§ÛŒØ¯ 15 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'anki' });
                        const r = e.calculate(2, card2);
                        return r.data.interval === 15 && r.data.repetition === 3;
                    }},
                    { name: 'Anki: EASY (Ú©ÛŒÙÛŒØª Û³) (Ø¨Ø§ÛŒØ¯ >15 Ø±ÙˆØ²)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'anki' });
                        const r = e.calculate(3, card2);
                        return r.data.interval > 15 && r.data.easeFactor > 2.5;
                    }}
                ],
                fsrs: [
                    { name: 'FSRS: Ú©ÛŒÙÛŒØª Ûµ Ø¨Ø§ Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯ (Ø¨Ø§ÛŒØ¯ 1 Ø±ÙˆØ²ØŒ retention~0.7)', fn: () => {
                        const e = new SRSEngine({ algorithm: 'fsrs' });
                        const r = e.calculate(5, card0);
                        return r.data.interval >= 1 && r.data.interval <= 2 && r.metrics.retention > 0.6;
                    }},
                    { name: 'FSRS: Ú©ÛŒÙÛŒØª Û± (Ù¾Ø§Ø³Ø® ØºÙ„Ø·) (difficulty Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§Ø¨Ø¯) - Ø±ÙØ¹ Ø´Ø¯', fn: () => {
                        const e = new SRSEngine({ algorithm: 'fsrs' });
                        const r = e.calculate(1, card3);
                        const difficultyAfter = r.metrics.difficulty;
                        const difficultyBefore = 0.5; // ØªØ®Ù…ÛŒÙ†
                        return difficultyAfter > 0.5; // Ø¨Ø§ÛŒØ¯ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡ Ø¨Ø§Ø´Ø¯
                    }},
                    { name: 'FSRS: Ù…Ø­Ø§Ø³Ø¨Ù‡ retention (Ø¨ÛŒÙ† 0.3 Ùˆ 0.8) - Ø±ÙØ¹ Ø´Ø¯', fn: () => {
                        const e = new SRSEngine({ algorithm: 'fsrs' });
                        const r1 = e.calculate(5, cardWithHistory);
                        const r2 = e.calculate(1, cardLowQuality);
                        return (r1.metrics.retention >= 0.3 && r1.metrics.retention <= 0.8) &&
                               (r2.metrics.retention >= 0.3 && r2.metrics.retention <= 0.8);
                    }}
                ],
                metrics: [
                    { name: 'ğŸ“ˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ retention Ù…Ø¹Ù‚ÙˆÙ„ (Ø¨ÛŒÙ† 0.3 Ùˆ 0.8) - Ø±ÙØ¹ Ø´Ø¯', fn: () => {
                        const e = new SRSEngine();
                        const r = e.calculate(5, card3);
                        return r.metrics.retention >= 0.3 && r.metrics.retention <= 0.8;
                    }},
                    { name: 'ğŸ“ˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ stability Ù…Ø«Ø¨Øª', fn: () => {
                        const e = new SRSEngine();
                        const r = e.calculate(5, card3);
                        return r.metrics.stability > 0;
                    }},
                    { name: 'ğŸ“ˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ difficulty Ø¨ÛŒÙ† Û°-Û±', fn: () => {
                        const e = new SRSEngine();
                        const r = e.calculate(2, cardWithHistory);
                        return r.metrics.difficulty >= 0 && r.metrics.difficulty <= 1;
                    }}
                ]
            };

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ ====================
            window.runAllTests = function() {
                const containers = {
                    sm2: document.getElementById('test-list-sm2'),
                    anki: document.getElementById('test-list-anki'),
                    fsrs: document.getElementById('test-list-fsrs'),
                    metrics: document.getElementById('test-list-metrics')
                };

                for (let category in containers) {
                    containers[category].innerHTML = '';
                }

                let total = 0;
                let passed = 0;

                for (let category in tests) {
                    tests[category].forEach(test => {
                        total++;
                        try {
                            const result = test.fn();
                            if (result) passed++;
                            
                            const item = document.createElement('div');
                            item.className = 'test-item';
                            item.innerHTML = `
                                <div class="test-status ${result ? 'status-pass' : 'status-fail'}">${result ? 'âœ… PASS' : 'âŒ FAIL'}</div>
                                <div class="test-name">${test.name}</div>
                            `;
                            containers[category].appendChild(item);
                        } catch (error) {
                            const item = document.createElement('div');
                            item.className = 'test-item';
                            item.innerHTML = `
                                <div class="test-status status-fail">âš ï¸ ERROR</div>
                                <div class="test-name">${test.name}<div class="test-message">${error.message}</div></div>
                            `;
                            containers[category].appendChild(item);
                        }
                    });
                }

                document.getElementById('total').innerText = total;
                document.getElementById('passed').innerText = passed;
                document.getElementById('failed').innerText = total - passed;
            };

            window.resetResults = function() {
                const containers = {
                    sm2: document.getElementById('test-list-sm2'),
                    anki: document.getElementById('test-list-anki'),
                    fsrs: document.getElementById('test-list-fsrs'),
                    metrics: document.getElementById('test-list-metrics')
                };
                
                for (let category in containers) {
                    containers[category].innerHTML = '';
                }
                
                document.getElementById('total').innerText = '0';
                document.getElementById('passed').innerText = '0';
                document.getElementById('failed').innerText = '0';
            };

            // Ù‡ÛŒÚ† Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
        })();
    </script>
</body>
</html>
