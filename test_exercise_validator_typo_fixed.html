<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ - Ø±ÙØ¹ Ù…Ø´Ú©Ù„ ØªØ§ÛŒÙ¾Ùˆ - Farsinglish</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: ltr; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        h1 { color: #2c3e50; text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .test-case { background: #f8f9fa; border-left: 4px solid #27ae60; padding: 15px; margin: 15px 0; font-family: 'Courier New', monospace; border-radius: 0 8px 8px 0; }
        .passed { background: #d4edda; border-left-color: #28a745; }
        .failed { background: #f8d7da; border-left-color: #dc3545; }
        .btn-run { background: #3498db; color: white; border: none; padding: 12px 30px; font-size: 18px; border-radius: 50px; cursor: pointer; display: block; margin: 20px auto; }
        .btn-test { background: #27ae60; color: white; border: none; padding: 5px 15px; border-radius: 20px; cursor: pointer; margin: 5px; }
        .manual-section { background: #fff3cd; padding: 20px; border-radius: 12px; margin: 30px 0; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Ù„Ø¨Ù‡ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ - Ø±ÙØ¹ Ù…Ø´Ú©Ù„ ØªØ´Ø®ØµÛŒ ØªØ§ÛŒÙ¾Ùˆ</h1>
    
    <button class="btn-run" id="runAllBtn">â–¶ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§</button>

    <div id="results"></div>

    <script>
        (function() {
            // ==================== Ù…Ø§Ú˜ÙˆÙ„ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ø§ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù„ÙˆÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† Ø¯Ù‚ÛŒÙ‚ ====================
            const ExerciseValidator = {
                validate: function(answer, exercise, type) {
                    if (exercise === null || exercise === undefined) return { valid: false, error: 'exercise_required' };
                    if (typeof exercise !== 'object') return { valid: false, error: 'invalid_exercise' };
                    
                    const exerciseType = type || exercise.type;
                    if (!exerciseType) return { valid: false, error: 'unknown_exercise_type' };
                    
                    if (answer === null || answer === undefined) {
                        if (exerciseType === 'pronunciation') return { valid: true, simulated: true };
                        return { valid: false, error: 'answer_required' };
                    }
                    
                    switch(exerciseType) {
                        case 'fill-blank': return this.validateFillBlank(answer, exercise);
                        default: return { valid: false, error: 'unknown_exercise_type' };
                    }
                },

                validateFillBlank: function(answer, exercise) {
                    if (typeof answer !== 'string') return { valid: false, error: 'answer_must_be_string' };
                    
                    const trimmedAnswer = answer.trim();
                    if (trimmedAnswer === '') return { valid: false, error: 'empty_answer' };
                    if (!exercise.correctAnswer) return { valid: false, error: 'no_correct_answer' };
                    
                    const normalizedAnswer = trimmedAnswer.toLowerCase();
                    const normalizedCorrect = exercise.correctAnswer.trim().toLowerCase();
                    
                    const isExactMatch = (normalizedAnswer === normalizedCorrect);
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¨Ø§Ù‡Øª Ù„ÙˆÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† Ø¯Ù‚ÛŒÙ‚
                    const similarity = this.levenshteinSimilarity(normalizedAnswer, normalizedCorrect);
                    
                    // Ø¢Ø³ØªØ§Ù†Ù‡ Ø´Ø¨Ø§Ù‡Øª Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÙ¾ÙˆÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø² (80%)
                    const isSimilar = similarity >= 0.8;
                    
                    // Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
                    console.log(`Compare: "${normalizedAnswer}" vs "${normalizedCorrect}" = ${similarity}`);
                    
                    return { 
                        valid: true, 
                        correct: isExactMatch,
                        similar: isSimilar,
                        similarity: similarity,
                        normalizedAnswer: normalizedAnswer
                    };
                },

                // Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù„ÙˆÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ†
                levenshteinDistance: function(a, b) {
                    if (a.length === 0) return b.length;
                    if (b.length === 0) return a.length;
                    
                    const matrix = [];
                    
                    for (let i = 0; i <= b.length; i++) matrix[i] = [i];
                    for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
                    
                    for (let i = 1; i <= b.length; i++) {
                        for (let j = 1; j <= a.length; j++) {
                            const cost = a[j-1] === b[i-1] ? 0 : 1;
                            matrix[i][j] = Math.min(
                                matrix[i-1][j] + 1,
                                matrix[i][j-1] + 1,
                                matrix[i-1][j-1] + cost
                            );
                        }
                    }
                    
                    return matrix[b.length][a.length];
                },

                levenshteinSimilarity: function(a, b) {
                    if (!a || !b) return 0;
                    const distance = this.levenshteinDistance(a, b);
                    const maxLength = Math.max(a.length, b.length);
                    if (maxLength === 0) return 1;
                    return 1 - (distance / maxLength);
                }
            };

            // ==================== ØªØ³Øª ØªØ§ÛŒÙ¾Ùˆ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø®ØªÙ„Ù ====================
            const typoTests = [
                {
                    name: 'ØªØ³Øª 1: "helo" vs "hello" (ÛŒÚ© Ø­Ø±Ù Ú©Ù…)',
                    input: { answer: 'helo', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 2: "helloo" vs "hello" (ÛŒÚ© Ø­Ø±Ù Ø§Ø¶Ø§ÙÙ‡)',
                    input: { answer: 'helloo', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 3: "hillo" vs "hello" (ÛŒÚ© Ø­Ø±Ù Ù…ØªÙØ§ÙˆØª)',
                    input: { answer: 'hillo', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 4: "HELO" (Ø­Ø±ÙˆÙ Ø¨Ø²Ø±Ú¯) vs "hello"',
                    input: { answer: 'HELO', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 5: "  helo  " (Ø¨Ø§ ÙØ§ØµÙ„Ù‡) vs "hello"',
                    input: { answer: '  helo  ', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 6: "hello" Ø¯Ù‚ÛŒÙ‚ vs "hello"',
                    input: { answer: 'hello', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,
                    expectedCorrect: true
                },
                {
                    name: 'ØªØ³Øª 7: "xyz" (Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…ØªÙØ§ÙˆØª) vs "hello"',
                    input: { answer: 'xyz', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: false,
                    expectedCorrect: false
                },
                {
                    name: 'ØªØ³Øª 8: "hell" (Ø´Ø¨Ø§Ù‡Øª 80%) vs "hello"',
                    input: { answer: 'hell', exercise: { type: 'fill-blank', correctAnswer: 'hello' } },
                    expectedSimilar: true,  // 4/5 = 0.8
                    expectedCorrect: false
                }
            ];

            function runTest(test) {
                try {
                    const result = ExerciseValidator.validate(test.input.answer, test.input.exercise);
                    
                    let passed = true;
                    if (test.expectedSimilar !== undefined && result.similar !== test.expectedSimilar) passed = false;
                    if (test.expectedCorrect !== undefined && result.correct !== test.expectedCorrect) passed = false;
                    
                    return { passed, result, error: null };
                } catch (error) {
                    return { passed: false, result: null, error: error.message };
                }
            }

            function displayResults() {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                
                let passedCount = 0;
                
                typoTests.forEach((test, index) => {
                    const { passed, result, error } = runTest(test);
                    if (passed) passedCount++;
                    
                    const testDiv = document.createElement('div');
                    testDiv.className = `test-case ${passed ? 'passed' : 'failed'}`;
                    
                    let similarityText = '';
                    if (result && result.similarity !== undefined) {
                        similarityText = `<br><small>Ø´Ø¨Ø§Ù‡Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡: ${(result.similarity * 100).toFixed(1)}%</small>`;
                    }
                    
                    testDiv.innerHTML = `
                        <strong>${test.name}</strong><br>
                        <small>ÙˆØ±ÙˆØ¯ÛŒ: "${test.input.answer}" | ØµØ­ÛŒØ­: "${test.input.exercise.correctAnswer}"</small><br>
                        ${error ? `<small style="color:red;">Ø®Ø·Ø§: ${error}</small>` : `<small>Ø®Ø±ÙˆØ¬ÛŒ: ${JSON.stringify(result)}</small>`}
                        ${similarityText}
                        <br><strong style="color: ${passed ? 'green' : 'red'}">${passed ? 'âœ“ Ù¾Ø§Ø³' : 'âœ— Ø´Ú©Ø³Øª'}</strong>
                    `;
                    
                    resultsDiv.appendChild(testDiv);
                });
                
                const summaryDiv = document.createElement('div');
                summaryDiv.style.marginTop = '20px';
                summaryDiv.style.padding = '20px';
                summaryDiv.style.background = '#2c3e50';
                summaryDiv.style.color = 'white';
                summaryDiv.style.borderRadius = '12px';
                summaryDiv.innerHTML = `
                    <h3>ğŸ“Š Ù†ØªÛŒØ¬Ù‡: ${passedCount} / ${typoTests.length}</h3>
                    <div style="font-size: 24px;">${passedCount === typoTests.length ? 'âœ… Ù‡Ù…Ù‡ Ù¾Ø§Ø³ Ø´Ø¯Ù†Ø¯' : 'âš ï¸ Ø¨Ø±Ø®ÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù†Ø¯'}</div>
                `;
                resultsDiv.appendChild(summaryDiv);
            }

            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ
            const manualDiv = document.createElement('div');
            manualDiv.className = 'manual-section';
            manualDiv.innerHTML = '<h3>ğŸ® Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</h3>';
            
            typoTests.forEach((test, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn-test';
                btn.textContent = `ØªØ³Øª ${index + 1}`;
                btn.onclick = () => {
                    const result = ExerciseValidator.validate(test.input.answer, test.input.exercise);
                    alert(`Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª ${index + 1}:\n${JSON.stringify(result, null, 2)}`);
                };
                manualDiv.appendChild(btn);
            });
            
            document.body.insertBefore(manualDiv, document.getElementById('results'));

            window.onload = displayResults;
            document.getElementById('runAllBtn').addEventListener('click', displayResults);
        })();
    </script>
</body>
</html>
