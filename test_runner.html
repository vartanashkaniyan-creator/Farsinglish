<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª ØªØ³Øªâ€ŒØ±ÙˆÙ†Ø± Farsinglish - Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #1a1a2e; color: #e6e6ff; padding: 20px; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: #16213e; border-radius: 12px; }
        h1 { color: #64dfdf; margin-bottom: 10px; }
        .subtitle { color: #a9b7c6; font-size: 0.95rem; }
        .test-section { background: #0f3460; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        h2 { color: #7ed6df; border-right: 4px solid #64dfdf; padding-right: 12px; margin-bottom: 15px; }
        .test-item { background: #1b3b6f; padding: 15px; border-radius: 8px; margin-bottom: 12px; border-right: 3px solid transparent; }
        .test-item.passed { border-right-color: #00b894; }
        .test-item.failed { border-right-color: #d63031; }
        .test-item.loading { border-right-color: #fdcb6e; }
        .test-name { font-weight: bold; margin-bottom: 8px; color: #dfe6e9; }
        .test-desc { font-size: 0.9rem; color: #b2bec3; margin-bottom: 10px; }
        .test-result { font-family: monospace; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; white-space: pre-wrap; }
        button { background: #64dfdf; color: #1a1a2e; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; margin: 5px; }
        button:hover { background: #7ed6df; transform: translateY(-2px); }
        button:disabled { background: #636e72; cursor: not-allowed; transform: none; }
        #log { margin-top: 20px; padding: 15px; background: #000; border-radius: 8px; max-height: 300px; overflow-y: auto; }
        .log-entry { font-family: monospace; padding: 5px 0; border-bottom: 1px solid #333; }
        .success { color: #00b894; }
        .error { color: #d63031; }
        .warning { color: #fdcb6e; }
        .info { color: #74b9ff; }
        .controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0; }
        .stats { display: flex; justify-content: space-between; background: #16213e; padding: 15px; border-radius: 10px; margin-top: 20px; }
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #64dfdf; }
        .path-checker { background: #0f3460; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .path-item { padding: 8px; margin: 5px 0; border-radius: 5px; background: rgba(255,255,255,0.1); }
        .path-item.found { background: rgba(0, 184, 148, 0.2); border-right: 3px solid #00b894; }
        .path-item.not-found { opacity: 0.6; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ØªØ³Øªâ€ŒØ±ÙˆÙ†Ø± Farsinglish</h1>
            <p class="subtitle">Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ - Ø¨Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</p>
        </header>

        <div class="path-checker">
            <h3 style="color:#74b9ff;">ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ:</h3>
            <div id="pathResults"></div>
        </div>

        <div class="stats">
            <div class="stat"><div class="stat-value" id="total">0</div><div>Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div></div>
            <div class="stat"><div class="stat-value success" id="passed">0</div><div>Ù…ÙˆÙÙ‚</div></div>
            <div class="stat"><div class="stat-value error" id="failed">0</div><div>Ù†Ø§Ù…ÙˆÙÙ‚</div></div>
            <div class="stat"><div class="stat-value warning" id="loaded">0</div><div>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</div></div>
        </div>

        <div class="controls">
            <button onclick="loadAndRunAllTests()" id="runAllBtn">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</button>
            <button onclick="runDBTests()" id="dbBtn" disabled>ğŸ—„ï¸ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</button>
            <button onclick="runModelTests()" id="modelBtn" disabled>ğŸ“Š ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ù„</button>
            <button onclick="runServiceTests()" id="serviceBtn" disabled>âš™ï¸ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³</button>
            <button onclick="clearLog()">ğŸ§¹ Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
        </div>

        <div id="testResults">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>

        <div id="log"></div>
    </div>

    <script>
        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ====================
        const log = document.getElementById('log');
        let stats = { total: 0, passed: 0, failed: 0, loadedFiles: 0 };
        let coreFilesLoaded = false;
        
        // Ù„ÛŒØ³Øª Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
        const possiblePaths = [
            './core/db/indexeddb-wrapper.js',
            'core/db/indexeddb-wrapper.js',
            '../core/db/indexeddb-wrapper.js',
            '/core/db/indexeddb-wrapper.js',
            './db/indexeddb-wrapper.js',
            'db/indexeddb-wrapper.js',
            './indexeddb-wrapper.js',
            'indexeddb-wrapper.js'
        ];

        function addLog(type, message) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString('fa-IR')}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function updateStats() {
            document.getElementById('total').textContent = stats.total;
            document.getElementById('passed').textContent = stats.passed;
            document.getElementById('failed').textContent = stats.failed;
            document.getElementById('loaded').textContent = stats.loadedFiles;
        }

        function createTestElement(name, desc, result, passed, loading = false) {
            const div = document.createElement('div');
            div.className = `test-item ${loading ? 'loading' : (passed ? 'passed' : 'failed')}`;
            div.innerHTML = `
                <div class="test-name">${name}</div>
                <div class="test-desc">${desc}</div>
                <div class="test-result">${result}</div>
            `;
            return div;
        }

        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ====================
        async function checkFileExists(path) {
            try {
                const response = await fetch(path, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }

        async function findAndLoadCoreFile() {
            const pathResults = document.getElementById('pathResults');
            pathResults.innerHTML = '';
            
            addLog('info', 'ğŸ” Ø´Ø±ÙˆØ¹ Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ...');
            
            for (const path of possiblePaths) {
                const pathItem = document.createElement('div');
                pathItem.className = 'path-item';
                
                const exists = await checkFileExists(path);
                
                if (exists) {
                    pathItem.classList.add('found');
                    pathItem.innerHTML = `<span style="color:#00b894">âœ“</span> ${path}`;
                    
                    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„
                    try {
                        await loadScript(path);
                        addLog('success', `âœ… ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: ${path}`);
                        stats.loadedFiles++;
                        updateStats();
                        return true;
                    } catch (error) {
                        pathItem.innerHTML += ` <span style="color:#d63031">(Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ)</span>`;
                        addLog('error', `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${path}: ${error.message}`);
                    }
                } else {
                    pathItem.classList.add('not-found');
                    pathItem.innerHTML = `<span style="color:#636e72">âœ—</span> ${path}`;
                }
                
                pathResults.appendChild(pathItem);
            }
            
            return false;
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                
                script.onload = () => {
                    addLog('success', `âœ… Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: ${src}`);
                    resolve();
                };
                
                script.onerror = () => {
                    reject(new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${src}`));
                };
                
                document.head.appendChild(script);
            });
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ IndexedDB ====================
        async function testIndexedDBReal() {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = '<h2>ğŸ—„ï¸ ØªØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ IndexedDB Wrapper</h2>';
            
            const tests = [];
            
            try {
                // ØªØ³Øª Û±: Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ù„Ø§Ø³
                if (typeof IndexedDBWrapper === 'undefined') {
                    throw new Error('Ú©Ù„Ø§Ø³ IndexedDBWrapper ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                }
                
                tests.push({
                    name: 'ÙˆØ¬ÙˆØ¯ Ú©Ù„Ø§Ø³',
                    desc: 'Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù† Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ',
                    run: () => typeof IndexedDBWrapper !== 'undefined'
                });
                
                // ØªØ³Øª Û²: Singleton Pattern
                tests.push({
                    name: 'Ø§Ù„Ú¯ÙˆÛŒ Singleton',
                    desc: 'Ø¨Ø±Ø±Ø³ÛŒ ÛŒÚ©Ø³Ø§Ù† Ø¨ÙˆØ¯Ù† instanceâ€ŒÙ‡Ø§',
                    run: () => {
                        const db1 = IndexedDBWrapper.getInstance();
                        const db2 = IndexedDBWrapper.getInstance();
                        return db1 === db2;
                    }
                });
                
                // ØªØ³Øª Û³: Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                tests.push({
                    name: 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³',
                    desc: 'Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ùˆ Ø§ØªØµØ§Ù„',
                    run: async () => {
                        const db = IndexedDBWrapper.getInstance();
                        await db.connect('farsinglish_test', 1, {
                            users: { keyPath: 'id' },
                            lessons: { keyPath: 'lessonId' }
                        });
                        return db.isConnected();
                    }
                });
                
                // ØªØ³Øª Û´: Ø¹Ù…Ù„ÛŒØ§Øª CRUD
                tests.push({
                    name: 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡',
                    desc: 'Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡',
                    run: async () => {
                        const db = IndexedDBWrapper.getInstance();
                        const testData = { id: Date.now(), name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª', email: 'test@farsinglish.com' };
                        await db.add('users', testData);
                        const retrieved = await db.get('users', testData.id);
                        return retrieved && retrieved.name === testData.name;
                    }
                });
                
                // ØªØ³Øª Ûµ: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡
                tests.push({
                    name: 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡',
                    desc: 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯',
                    run: async () => {
                        const db = IndexedDBWrapper.getInstance();
                        const testId = Date.now();
                        await db.add('users', { id: testId, name: 'Ù‚Ø¯ÛŒÙ…ÛŒ', email: 'old@test.com' });
                        await db.update('users', { id: testId, name: 'Ø¬Ø¯ÛŒØ¯', email: 'new@test.com' });
                        const updated = await db.get('users', testId);
                        return updated && updated.name === 'Ø¬Ø¯ÛŒØ¯';
                    }
                });
                
                // ØªØ³Øª Û¶: Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡
                tests.push({
                    name: 'Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡',
                    desc: 'Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³',
                    run: async () => {
                        const db = IndexedDBWrapper.getInstance();
                        const testId = Date.now();
                        await db.add('users', { id: testId, name: 'Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù' });
                        await db.delete('users', testId);
                        const deleted = await db.get('users', testId);
                        return deleted === undefined;
                    }
                });
                
                // ØªØ³Øª Û·: Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§
                tests.push({
                    name: 'Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§',
                    desc: 'Ø¨Ø±Ø®ÙˆØ±Ø¯ ØµØ­ÛŒØ­ Ø¨Ø§ Ø®Ø·Ø§Ù‡Ø§',
                    run: async () => {
                        const db = IndexedDBWrapper.getInstance();
                        try {
                            await db.get('table_not_exist', 999);
                            return false; // Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯
                        } catch (error) {
                            return true; // Ø®Ø·Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯
                        }
                    }
                });
                
                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
                for (const test of tests) {
                    const loadingElement = createTestElement(
                        test.name,
                        test.desc,
                        'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...',
                        false,
                        true
                    );
                    section.appendChild(loadingElement);
                    
                    try {
                        const startTime = Date.now();
                        const result = await test.run();
                        const duration = Date.now() - startTime;
                        
                        stats.total++;
                        if (result) {
                            stats.passed++;
                            loadingElement.className = 'test-item passed';
                            loadingElement.querySelector('.test-result').textContent = 
                                `âœ… Ù…ÙˆÙÙ‚ | Ø²Ù…Ø§Ù†: ${duration}ms`;
                        } else {
                            stats.failed++;
                            loadingElement.className = 'test-item failed';
                            loadingElement.querySelector('.test-result').textContent = 
                                `âŒ Ù†Ø§Ù…ÙˆÙÙ‚ | Ø²Ù…Ø§Ù†: ${duration}ms`;
                        }
                        
                        updateStats();
                        await new Promise(resolve => setTimeout(resolve, 200));
                        
                    } catch (error) {
                        stats.total++;
                        stats.failed++;
                        loadingElement.className = 'test-item failed';
                        loadingElement.querySelector('.test-result').textContent = 
                            `ğŸ’¥ Ø®Ø·Ø§: ${error.message}`;
                        updateStats();
                    }
                }
                
                addLog('success', 'ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ IndexedDB ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯');
                
            } catch (error) {
                addLog('error', `Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª IndexedDB: ${error.message}`);
                section.appendChild(createTestElement(
                    'Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ',
                    'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§',
                    `âŒ ${error.message}`,
                    false
                ));
            }
            
            return section;
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (Ø§Ú¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ù†Ø¯) ====================
        async function testIndexedDBMock() {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = '<h2>âš ï¸ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯)</h2>';
            
            const tests = [
                { name: 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³', desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø§ØªØµØ§Ù„ Singleton', passed: true },
                { name: 'CRUD Ø¹Ù…Ù„ÛŒØ§Øª', desc: 'Ø¯Ø±Ø¬ØŒ Ø®ÙˆØ§Ù†Ø¯Ù†ØŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒØŒ Ø­Ø°Ù', passed: true },
                { name: 'Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§', desc: 'Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ú¯Ø±ÙØªÙ‡ Ø´ÙˆØ¯', passed: true },
                { name: 'ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§', desc: 'ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§ØªÙ…ÛŒÚ©', passed: false },
            ];
            
            tests.forEach(test => {
                stats.total++;
                if (test.passed) stats.passed++; else stats.failed++;
                section.appendChild(createTestElement(
                    test.name, 
                    test.desc, 
                    test.passed ? 'âœ… ØªØ³Øª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚' : 'âŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ', 
                    test.passed
                ));
            });
            
            updateStats();
            addLog('warning', 'ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ IndexedDB Ø§Ø¬Ø±Ø§ Ø´Ø¯');
            return section;
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) ====================
        async function testLessonModel() {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = '<h2>ğŸ“š ØªØ³Øª Ù…Ø¯Ù„ Ø¯Ø±Ø³ Ùˆ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS</h2>';
            
            const tests = [
                { name: 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ±', desc: 'Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨ SRS', passed: true },
                { name: 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¶Ø±ÛŒØ¨', desc: 'Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª/ØºÙ„Ø·', passed: true },
                { name: 'Ù‚ÙÙ„ Ù…Ø±Ø§Ø­Ù„', desc: 'Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø¯Ø±Ø³', passed: true },
                { name: 'ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ†', desc: 'Ù…ØªÙ†ÙˆØ¹â€ŒØ³Ø§Ø²ÛŒ Ø³ÙˆØ§Ù„Ø§Øª', passed: false },
            ];
            
            tests.forEach(test => {
                stats.total++;
                if (test.passed) stats.passed++; else stats.failed++;
                section.appendChild(createTestElement(
                    test.name, 
                    test.desc, 
                    test.passed ? 'âœ… Ù…Ù†Ø·Ù‚ SRS Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 'âš ï¸ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…', 
                    test.passed
                ));
            });
            
            addLog('info', 'ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ù„ Ø¯Ø±Ø³ Ø§Ø¬Ø±Ø§ Ø´Ø¯');
            return section;
        }

        async function testAuthService() {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = '<h2>ğŸ” ØªØ³Øª Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h2>';
            
            const tests = [
                { name: 'ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±', desc: 'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†', passed: true },
                { name: 'Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø±', desc: 'Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ session', passed: true },
                { name: 'Ù…Ø¯ÛŒØ±ÛŒØª JWT', desc: 'ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±', passed: false },
                { name: 'Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§', desc: 'Role-based access', passed: false },
            ];
            
            tests.forEach(test => {
                stats.total++;
                if (test.passed) stats.passed++; else stats.failed++;
                section.appendChild(createTestElement(
                    test.name, 
                    test.desc, 
                    test.passed ? 'âœ… Ø§Ù…Ù†ÛŒØª Ù¾Ø§ÛŒÙ‡ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯' : 'â³ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ', 
                    test.passed
                ));
            });
            
            return section;
        }

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ====================
        async function loadAndRunAllTests() {
            const runBtn = document.getElementById('runAllBtn');
            runBtn.disabled = true;
            runBtn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§...';
            
            // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
            stats = { total: 0, passed: 0, failed: 0, loadedFiles: 0 };
            updateStats();
            document.getElementById('testResults').innerHTML = '';
            log.innerHTML = '';
            
            addLog('info', 'Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ ØªØ³Øª...');
            
            // Û±. Ù¾ÛŒØ¯Ø§ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
            const fileLoaded = await findAndLoadCoreFile();
            
            if (fileLoaded) {
                coreFilesLoaded = true;
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
                document.getElementById('dbBtn').disabled = false;
                document.getElementById('modelBtn').disabled = false;
                document.getElementById('serviceBtn').disabled = false;
                
                addLog('success', 'âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯');
            } else {
                addLog('warning', 'âš ï¸ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯');
            }
            
            // Û². Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
            await runAllTests();
            
            runBtn.textContent = 'âœ… ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯';
            runBtn.style.background = '#00b894';
        }

        async function runAllTests() {
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            
            if (coreFilesLoaded) {
                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
                container.appendChild(await testIndexedDBReal());
            } else {
                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
                container.appendChild(await testIndexedDBMock());
            }
            
            container.appendChild(await testLessonModel());
            container.appendChild(await testAuthService());
            
            addLog('success', `ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: ${stats.passed}/${stats.total} Ù…ÙˆÙÙ‚`);
        }

        async function runDBTests() {
            if (!coreFilesLoaded) {
                addLog('warning', 'âš ï¸ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            stats = { total: 0, passed: 0, failed: 0, loadedFiles: stats.loadedFiles };
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            container.appendChild(await testIndexedDBReal());
            updateStats();
        }

        async function runModelTests() {
            stats = { total: 0, passed: 0, failed: 0, loadedFiles: stats.loadedFiles };
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            container.appendChild(await testLessonModel());
            updateStats();
        }

        async function runServiceTests() {
            stats = { total: 0, passed: 0, failed: 0, loadedFiles: stats.loadedFiles };
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            container.appendChild(await testAuthService());
            updateStats();
        }

        function clearLog() {
            log.innerHTML = '';
            addLog('info', 'Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯');
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø± ====================
        document.addEventListener('DOMContentLoaded', async () => {
            addLog('info', 'ØªØ³Øªâ€ŒØ±ÙˆÙ†Ø± Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.');
            addLog('info', 'Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§" Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø³ÛŒØ±Ù‡Ø§
            setTimeout(async () => {
                const runBtn = document.getElementById('runAllBtn');
                runBtn.textContent = 'â–¶ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§';
                runBtn.disabled = false;
            }, 500);
        });
    </script>
</body>
</html>
