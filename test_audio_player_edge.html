<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Audio Player</title>
    <style>
        body {
            font-family: Vazir, Tahoma, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 15px;
            background: #f5f5f5;
        }
        h1 {
            font-size: 1.5rem;
            color: #2c3e50;
            text-align: center;
        }
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-title {
            font-weight: bold;
            color: #27ae60;
            border-right: 4px solid #27ae60;
            padding-right: 10px;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .scenario-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .scenario-title {
            font-weight: 600;
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 8px;
            margin-bottom: 8px;
            transition: background 0.2s;
            font-family: Vazir, Tahoma, sans-serif;
        }
        button:hover {
            background: #2980b9;
        }
        button.danger {
            background: #e74c3c;
        }
        button.danger:hover {
            background: #c0392b;
        }
        button.success {
            background: #27ae60;
        }
        button.success:hover {
            background: #2ecc71;
        }
        .log-panel {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            padding: 12px;
            border-radius: 8px;
            height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
            margin-top: 15px;
            direction: ltr;
            text-align: left;
        }
        .log-entry {
            border-bottom: 1px solid #333;
            padding: 4px 0;
            margin: 0;
        }
        .log-warn {
            color: #f39c12;
        }
        .log-error {
            color: #e74c3c;
        }
        .log-info {
            color: #3498db;
        }
        .log-success {
            color: #2ecc71;
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            background: #ecf0f1;
        }
        .status-playing {
            background: #2ecc71;
            color: white;
        }
        .status-stopped {
            background: #95a5a6;
            color: white;
        }
        .status-error {
            background: #e74c3c;
            color: white;
        }
        hr {
            border: none;
            border-top: 1px dashed #ccc;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸµ ØªØ³Øª Ø¯Ø³ØªÛŒ Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Audio Player</h1>
    <p>Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ùˆ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ØŒ Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù¾Ø®Ø´ ØµØ¯Ø§ Ø±Ø§ ØªØ³Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>

    <!-- Audio Player ØªØ³ØªÛŒ (Ù…Ø®ÙÛŒ) -->
    <audio id="testAudio" style="display: none;"></audio>

    <div class="test-container">
        <h2 class="test-title">ğŸ”´ Û±. Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ</h2>
        
        <div class="scenario-box">
            <div class="scenario-title">ğŸ“ Ø³Ù†Ø§Ø±ÛŒÙˆ A: Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Û´Û°Û´)</div>
            <div class="flex-row">
                <button onclick="testInvalidSource404()">â–¶ï¸ Ù¾Ø®Ø´ ÙØ§ÛŒÙ„ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</button>
                <button onclick="resetAudio()" class="danger">ğŸ”„ ØªÙˆÙ‚Ù Ùˆ Ø±ÛŒØ³Øª</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ø®Ø·Ø§ÛŒ Û´Û°Û´ Ø¯Ø± Ù„Ø§Ú¯ Ø¸Ø§Ù‡Ø± Ø´ÙˆØ¯ØŒ Status Ø¨Ù‡ Error ØªØºÛŒÛŒØ± Ú©Ù†Ø¯.</small></p>
        </div>

        <div class="scenario-box">
            <div class="scenario-title">ğŸ”— Ø³Ù†Ø§Ø±ÛŒÙˆ B: ÙØ±Ù…Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒâ€ŒÙ†Ø´Ø¯Ù‡</div>
            <div class="flex-row">
                <button onclick="testUnsupportedFormat()">â–¶ï¸ Ù¾Ø®Ø´ ÙØ§ÛŒÙ„ Ø¨Ø§ ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± (MP3 Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† WAV)</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ø±ÙˆÛŒØ¯Ø§Ø¯ error Ø¨Ø§ Ú©Ø¯ Ù…Ø¯ÛŒØ§ ÙØ±Ù…Øª Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡.</small></p>
        </div>

        <div class="scenario-box">
            <div class="scenario-title">ğŸŒ Ø³Ù†Ø§Ø±ÛŒÙˆ C: Ù…Ù†Ø¨Ø¹ Ø®Ø§Ù„ÛŒ / undefined</div>
            <div class="flex-row">
                <button onclick="testEmptySource()">â–¶ï¸ Ù¾Ø®Ø´ Ø¨Ø§ Ù…Ù†Ø¨Ø¹ Ø®Ø§Ù„ÛŒ</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ø®Ø·Ø§ÛŒ "Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡" Ø¯Ø± Ù„Ø§Ú¯.</small></p>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">ğŸ”„ Û². Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ù‡Ù…â€ŒØ²Ù…Ø§Ù†</h2>
        
        <div class="scenario-box">
            <div class="scenario-title">âš¡ Ø³Ù†Ø§Ø±ÛŒÙˆ D: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ play Ù¾Ø´Øª Ø³Ø± Ù‡Ù…</div>
            <div class="flex-row">
                <button onclick="testRapidPlay()" class="success">â–¶ï¸â–¶ï¸ Ù¾Ø®Ø´ Ø³Ø±ÛŒØ¹ (Ûµ Ø¨Ø§Ø±)</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: ÙÙ‚Ø· ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø®Ø´ Ø´ÙˆØ¯ØŒ Ø®Ø·Ø§ÛŒ Ù‡Ù…â€ŒØ²Ù…Ø§Ù†ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±Ø¯Ø¯.</small></p>
        </div>

        <div class="scenario-box">
            <div class="scenario-title">ğŸ›‘ Ø³Ù†Ø§Ø±ÛŒÙˆ E: stop Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„</div>
            <div class="flex-row">
                <button onclick="testStopBeforeLoad()">â–¶ï¸ Ù¾Ø®Ø´ Ùˆ ØªÙˆÙ‚Ù ÙÙˆØ±ÛŒ</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: abort Ø´ÙˆØ¯ØŒ Ø®Ø·Ø§ÛŒ Unexpected State Ø±Ø® Ù†Ø¯Ù‡Ø¯.</small></p>
        </div>

        <div class="scenario-box">
            <div class="scenario-title">ğŸ” Ø³Ù†Ø§Ø±ÛŒÙˆ F: ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹ Ø­ÛŒÙ† Ù¾Ø®Ø´</div>
            <div class="flex-row">
                <button onclick="testChangeSourceWhilePlaying()">ğŸ”€ ØªØºÛŒÛŒØ± Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ù…Ù†Ø¨Ø¹</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ù…Ù†Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ù„ÙˆØ¯ Ø´ÙˆØ¯ØŒ Ù¾Ø®Ø´ Ù‚Ø¨Ù„ÛŒ Ù…ØªÙˆÙ‚Ù Ú¯Ø±Ø¯Ø¯.</small></p>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">ğŸ“‰ Û³. Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡</h2>
        
        <div class="scenario-box">
            <div class="scenario-title">ğŸ“´ Ø³Ù†Ø§Ø±ÛŒÙˆ G: Ù‚Ø·Ø¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø´Ø¨Ú©Ù‡ Ø­ÛŒÙ† Ù¾Ø®Ø´ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)</div>
            <div class="flex-row">
                <button onclick="testNetworkInterrupt()">ğŸŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø·Ø¹ Ø´Ø¨Ú©Ù‡</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ø±ÙˆÛŒØ¯Ø§Ø¯ stalled ÛŒØ§ error Ø¨Ø§ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡.</small></p>
        </div>

        <div class="scenario-box">
            <div class="scenario-title">â±ï¸ Ø³Ù†Ø§Ø±ÛŒÙˆ H: timeout Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</div>
            <div class="flex-row">
                <button onclick="testLoadTimeout()">â° Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª</button>
            </div>
            <p><small>Ø¨Ø§ÛŒØ¯: Ù¾Ø³ Ø§Ø² Û³ Ø«Ø§Ù†ÛŒÙ‡ Ø®Ø·Ø§ÛŒ timeout Ø¯Ø± Ù„Ø§Ú¯ Ø¸Ø§Ù‡Ø± Ø´ÙˆØ¯.</small></p>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">ğŸ§ª Û´. ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Audio Player</h2>
        <div class="flex-row">
            <span class="status-badge" id="playbackStatus">â¹ï¸ Ù…ØªÙˆÙ‚Ù</span>
            <span class="status-badge" id="srcStatus">ğŸ“ Ù…Ù†Ø¨Ø¹: Ù†Ø¯Ø§Ø±Ø¯</span>
        </div>
        <div class="log-panel" id="logPanel">
            <div class="log-entry log-info">âœ… Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ</div>
        </div>
        <hr>
        <button onclick="clearLog()" class="danger">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
        <button onclick="playValidSample()" class="success">ğŸ”Š Ù¾Ø®Ø´ Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ù„Ù… (ØªØ³Øª Ù…Ø«Ø¨Øª)</button>
    </div>

    <script>
        // Audio Element
        const audio = document.getElementById('testAudio');
        const logPanel = document.getElementById('logPanel');
        const playbackStatus = document.getElementById('playbackStatus');
        const srcStatus = document.getElementById('srcStatus');

        // Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
        const VALID_SAMPLE = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
        const INVALID_SAMPLE = 'https://example.com/non-existent-file.mp3';
        const UNSUPPORTED_SAMPLE = 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVA'; // Base64 Ø®Ø±Ø§Ø¨

        // Helper: Ù„Ø§Ú¯
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
        function updateStatus() {
            if (audio.error) {
                playbackStatus.textContent = 'âŒ Ø®Ø·Ø§';
                playbackStatus.className = 'status-badge status-error';
            } else if (!audio.paused) {
                playbackStatus.textContent = 'â–¶ï¸ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´';
                playbackStatus.className = 'status-badge status-playing';
            } else {
                playbackStatus.textContent = 'â¹ï¸ Ù…ØªÙˆÙ‚Ù';
                playbackStatus.className = 'status-badge status-stopped';
            }
            srcStatus.textContent = `ğŸ“ Ù…Ù†Ø¨Ø¹: ${audio.src ? audio.src.substring(0, 30) + '...' : 'Ù†Ø¯Ø§Ø±Ø¯'}`;
        }

        // Reset audio
        function resetAudio() {
            audio.pause();
            audio.removeAttribute('src');
            audio.load();
            addLog('ğŸ”„ Ø±ÛŒØ³Øª Ø´Ø¯', 'info');
            updateStatus();
        }

        // Clear log
        function clearLog() {
            logPanel.innerHTML = '<div class="log-entry log-info">âœ… Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯</div>';
        }

        // ØªØ³Øª 1: Ù…Ù†Ø¨Ø¹ Ù†Ø§Ù…Ø¹ØªØ¨Ø± 404
        function testInvalidSource404() {
            addLog('ğŸ§ª ØªØ³Øª: Ù…Ù†Ø¨Ø¹ Ù†Ø§Ù…Ø¹ØªØ¨Ø± 404', 'info');
            audio.src = INVALID_SAMPLE;
            audio.load();
            audio.play().catch(e => {
                addLog(`âŒ Ø®Ø·Ø§: ${e.message}`, 'error');
            });
            updateStatus();
        }

        // ØªØ³Øª 2: ÙØ±Ù…Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒâ€ŒÙ†Ø´Ø¯Ù‡
        function testUnsupportedFormat() {
            addLog('ğŸ§ª ØªØ³Øª: ÙØ±Ù…Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒâ€ŒÙ†Ø´Ø¯Ù‡', 'info');
            audio.src = UNSUPPORTED_SAMPLE;
            audio.load();
            audio.play().catch(e => {
                addLog(`âŒ Ø®Ø·Ø§: ${e.message} (Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±)`, 'error');
            });
            updateStatus();
        }

        // ØªØ³Øª 3: Ù…Ù†Ø¨Ø¹ Ø®Ø§Ù„ÛŒ
        function testEmptySource() {
            addLog('ğŸ§ª ØªØ³Øª: Ù…Ù†Ø¨Ø¹ Ø®Ø§Ù„ÛŒ', 'info');
            audio.src = '';
            audio.load();
            audio.play().catch(e => {
                addLog(`âŒ Ø®Ø·Ø§: Ù…Ù†Ø¨Ø¹ ØµÙˆØªÛŒ Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡`, 'error');
            });
            updateStatus();
        }

        // ØªØ³Øª 4: Ù¾Ø®Ø´ Ø³Ø±ÛŒØ¹ Ù¾Ø´Øª Ø³Ø± Ù‡Ù…
        function testRapidPlay() {
            addLog('ğŸ§ª ØªØ³Øª: Ûµ Ø¨Ø§Ø± ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ play Ù¾Ø´Øª Ø³Ø± Ù‡Ù…', 'warn');
            audio.src = VALID_SAMPLE;
            audio.load();
            for (let i = 0; i < 5; i++) {
                audio.play().catch(e => {
                    addLog(`âš ï¸ ØªÙ„Ø§Ø´ ${i+1}: Ø¹Ù…Ù„ÛŒØ§Øª Ù‡Ù…â€ŒØ²Ù…Ø§Ù† - ${e.message}`, 'warn');
                });
            }
            updateStatus();
        }

        // ØªØ³Øª 5: ØªÙˆÙ‚Ù Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„
        function testStopBeforeLoad() {
            addLog('ğŸ§ª ØªØ³Øª: ØªÙˆÙ‚Ù Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„', 'info');
            audio.src = VALID_SAMPLE;
            audio.load();
            audio.pause(); // ØªÙˆÙ‚Ù ÙÙˆØ±ÛŒ
            audio.play().catch(e => {
                addLog(`âœ… Ø®Ø·Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±: ${e.message}`, 'info');
            });
            updateStatus();
        }

        // ØªØ³Øª 6: ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹ Ø­ÛŒÙ† Ù¾Ø®Ø´
        function testChangeSourceWhilePlaying() {
            addLog('ğŸ§ª ØªØ³Øª: ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹ Ø­ÛŒÙ† Ù¾Ø®Ø´', 'info');
            audio.src = VALID_SAMPLE;
            audio.play().then(() => {
                addLog('ğŸµ Ù¾Ø®Ø´ Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ø´Ø¯', 'success');
                setTimeout(() => {
                    audio.src = VALID_SAMPLE + '?change=true'; // ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹
                    audio.load();
                    audio.play().catch(e => addLog(`âœ… ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯`, 'info'));
                }, 1000);
            }).catch(e => addLog(`âŒ Ø®Ø·Ø§: ${e.message}`, 'error'));
            updateStatus();
        }

        // ØªØ³Øª 7: Ù‚Ø·Ø¹ Ø´Ø¨Ú©Ù‡ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
        function testNetworkInterrupt() {
            addLog('ğŸ§ª ØªØ³Øª: Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø·Ø¹ Ø´Ø¨Ú©Ù‡', 'warn');
            audio.src = VALID_SAMPLE;
            audio.load();
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø·Ø¹ Ø´Ø¨Ú©Ù‡ Ø¨Ø§ timeout
            setTimeout(() => {
                // Ø§ÛŒÙ† ÛŒÚ© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªØ› Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ Ø´Ø¨Ú©Ù‡ Ù‚Ø·Ø¹ Ø´ÙˆØ¯
                addLog('âš ï¸ Ø±ÙˆÛŒØ¯Ø§Ø¯ stalled Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯ (Ù‚Ø·Ø¹ Ø´Ø¨Ú©Ù‡)', 'warn');
            }, 2000);
            updateStatus();
        }

        // ØªØ³Øª 8: ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        function testLoadTimeout() {
            addLog('ğŸ§ª ØªØ³Øª: Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ', 'info');
            audio.src = INVALID_SAMPLE; // ÛŒÚ© Ù…Ù†Ø¨Ø¹ Ú©Ù†Ø¯ ÛŒØ§ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯
            audio.load();
            let timeout = setTimeout(() => {
                addLog('â° ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ Ø§Ø² Û³ Ø«Ø§Ù†ÛŒÙ‡ Ø·ÙˆÙ„ Ú©Ø´ÛŒØ¯', 'error');
            }, 3000);
            audio.addEventListener('canplay', () => {
                clearTimeout(timeout);
                addLog('âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯ (ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ù„ØºÙˆ Ø´Ø¯)', 'success');
            }, { once: true });
            updateStatus();
        }

        // ØªØ³Øª Ù…Ø«Ø¨Øª: Ù¾Ø®Ø´ Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ù„Ù…
        function playValidSample() {
            addLog('ğŸ”Š ØªØ³Øª Ù…Ø«Ø¨Øª: Ù¾Ø®Ø´ Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ù„Ù…', 'success');
            audio.src = VALID_SAMPLE;
            audio.load();
            audio.play().catch(e => addLog(`âŒ Ø®Ø·Ø§: ${e.message}`, 'error'));
            updateStatus();
        }

        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ HTML5 Audio
        audio.addEventListener('play', () => {
            addLog('ğŸµ Ø±ÙˆÛŒØ¯Ø§Ø¯ play', 'success');
            updateStatus();
        });
        audio.addEventListener('pause', () => {
            addLog('â¸ï¸ Ø±ÙˆÛŒØ¯Ø§Ø¯ pause', 'info');
            updateStatus();
        });
        audio.addEventListener('ended', () => {
            addLog('ğŸ Ù¾Ø®Ø´ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯', 'info');
            updateStatus();
        });
        audio.addEventListener('error', (e) => {
            addLog(`âŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ error: ${audio.error ? audio.error.message : 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡'}`, 'error');
            updateStatus();
        });
        audio.addEventListener('abort', () => {
            addLog('ğŸ›‘ Ø±ÙˆÛŒØ¯Ø§Ø¯ abort (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ØºÙˆ Ø´Ø¯)', 'warn');
            updateStatus();
        });
        audio.addEventListener('stalled', () => {
            addLog('âš ï¸ Ø±ÙˆÛŒØ¯Ø§Ø¯ stalled (Ù‚Ø·Ø¹ Ù…ÙˆÙ‚Øª Ø¯Ø§Ø¯Ù‡)', 'warn');
        });
        audio.addEventListener('suspend', () => {
            addLog('ğŸ’¤ Ø±ÙˆÛŒØ¯Ø§Ø¯ suspend (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯)', 'info');
        });

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
        function saveState() {
            localStorage.setItem('audioTestState', JSON.stringify({
                src: audio.src,
                paused: audio.paused,
                currentTime: audio.currentTime,
                error: audio.error ? audio.error.message : null
            }));
            addLog('ğŸ’¾ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'info');
        }

        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² localStorage
        function loadState() {
            const state = localStorage.getItem('audioTestState');
            if (state) {
                try {
                    const parsed = JSON.parse(state);
                    addLog(`ğŸ“‚ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª: ${parsed.src}`, 'info');
                } catch (e) {
                    addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª`, 'error');
                }
            } else {
                addLog(`â„¹ï¸ Ù‡ÛŒÚ† ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'info');
            }
        }

        // ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        window.saveState = saveState;
        window.loadState = loadState;

        // Ø±ÛŒØ³Øª Ø§ÙˆÙ„ÛŒÙ‡
        resetAudio();
        addLog('ğŸ¯ Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Audio Player. Ù„Ø·ÙØ§Ù‹ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø±Ø§ ÛŒÚ©ÛŒâ€ŒÛŒÚ©ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.', 'info');

    </script>
</body>
</html>
