<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farsinglish - Unit Test: Exercise Validator (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0b3d3f 0%, #1c5a5c 100%);
            color: #e0f2f1;
            padding: 20px;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto;
            background: rgba(20, 50, 55, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 { text-align: center; color: #b2dfdb; border-bottom: 2px solid #4db6ac; padding-bottom: 10px; }
        .suite {
            background: rgba(38, 80, 85, 0.8);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            border-right: 6px solid #009688;
        }
        .test-case {
            background: rgba(30, 60, 65, 0.9);
            margin: 12px 0;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #ffb300;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            color: #ffe082;
        }
        .pass { background: #2e7d32; color: white; padding: 2px 12px; border-radius: 20px; }
        .fail { background: #c62828; color: white; padding: 2px 12px; border-radius: 20px; }
        .summary {
            background: #004d40;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1rem;
            margin-top: 25px;
        }
        button {
            background: #00695c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            margin: 8px;
            font-weight: 600;
        }
        button:hover { background: #00897b; }
        .controls { text-align: center; margin: 20px 0; }
        .manual-btn {
            background: #ff8f00;
            padding: 12px 24px;
            font-size: 1.1rem;
        }
        .log {
            background: #1e3a3f;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            color: #b9f6ca;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Exercise Validator â€“ Ø§ØµÙ„Ø§Ø­ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ</h1>
        <p style="text-align:center; color:#b2dfdb;">âœ… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (Ù‡Ø± Ø¯Ú©Ù…Ù‡ Ù…Ø®ØªØµ ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆ)</p>

        <div class="suite">
            <h2>âœ… Multiple Choice</h2>
            <div id="tests-mc"></div>
            <button onclick="ManualTests.testMultipleChoice()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú†Ù‡Ø§Ø±Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ</button>
        </div>

        <div class="suite">
            <h2>ğŸ“ Fill in the Blank</h2>
            <div id="tests-fb"></div>
            <button onclick="ManualTests.testFillBlank()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø§ÛŒâ€ŒØ®Ø§Ù„ÛŒ</button>
        </div>

        <div class="suite">
            <h2>ğŸŒ Translation (Ø§ØµÙ„Ø§Ø­ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ)</h2>
            <div id="tests-tl"></div>
            <button onclick="ManualTests.testTranslation()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ + ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ</button>
        </div>

        <div class="suite">
            <h2>ğŸ¤ Pronunciation</h2>
            <div id="tests-pr"></div>
            <button onclick="ManualTests.testPronunciation()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ„ÙØ¸</button>
        </div>

        <div class="suite">
            <h2>ğŸ”— Integration (Mock DB)</h2>
            <div id="tests-integration"></div>
            <button onclick="ManualTests.testIntegration()">ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ</button>
        </div>

        <div class="summary" id="summary-box">
            â Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
        </div>

        <div class="controls">
            <button class="manual-btn" onclick="ManualTests.runAllManual()">ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="ManualTests.reset()">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
        </div>

        <div class="log" id="log-panel">
            ğŸ“‹ Ù„Ø§Ú¯ ØªØ³Øªâ€ŒÙ‡Ø§
        </div>
    </div>

    <script>
        // ==================== Exercise Validator (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡) ====================
        class ExerciseValidator {
            // Ú†Ù‡Ø§Ø±Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ
            static validateMultipleChoice(userAnswer, correctIndex, choices) {
                if (!Array.isArray(choices) || choices.length === 0) return false;
                if (typeof userAnswer !== 'number' || userAnswer < 0 || userAnswer >= choices.length) return false;
                if (typeof correctIndex !== 'number' || correctIndex < 0 || correctIndex >= choices.length) return false;
                return userAnswer === correctIndex;
            }

            // Ø¬Ø§ÛŒâ€ŒØ®Ø§Ù„ÛŒ
            static validateFillBlank(userAnswer, correctAnswer, caseInsensitive = true, trimSpaces = true) {
                if (typeof userAnswer !== 'string' || typeof correctAnswer !== 'string') return false;
                let u = userAnswer;
                let c = correctAnswer;
                if (trimSpaces) { u = u.trim(); c = c.trim(); }
                if (caseInsensitive) { u = u.toLowerCase(); c = c.toLowerCase(); }
                return u === c;
            }

            // ========== ØªØ±Ø¬Ù…Ù‡ Ø¨Ø§ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡) ==========
            static validateTranslation(userAnswer, expectedAnswer, direction = 'en2fa', tolerance = 0) {
                if (typeof userAnswer !== 'string' || typeof expectedAnswer !== 'string') return false;
                
                const u = userAnswer.trim().toLowerCase();
                const e = expectedAnswer.trim().toLowerCase();
                
                // ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÛŒÙ‚
                if (u === e) return true;
                
                // ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ tolerance
                if (tolerance > 0) {
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ†
                    const distance = this.levenshteinDistance(u, e);
                    return distance <= tolerance;
                }
                
                return false;
            }

            // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… ÙØ§ØµÙ„Ù‡ Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ† (Ø¨Ø±Ø§ÛŒ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ)
            static levenshteinDistance(a, b) {
                const matrix = [];
                for (let i = 0; i <= b.length; i++) matrix[i] = [i];
                for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
                
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        if (b.charAt(i-1) === a.charAt(j-1)) {
                            matrix[i][j] = matrix[i-1][j-1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i-1][j-1] + 1,
                                matrix[i][j-1] + 1,
                                matrix[i-1][j] + 1
                            );
                        }
                    }
                }
                return matrix[b.length][a.length];
            }

            // ØªÙ„ÙØ¸
            static validatePronunciation(userPhonetic, correctPhoneticList) {
                if (typeof userPhonetic !== 'string' || !Array.isArray(correctPhoneticList)) return false;
                const normalizedUser = userPhonetic.trim().replace(/[\/\s]/g, '');
                return correctPhoneticList.some(p => 
                    p.trim().replace(/[\/\s]/g, '') === normalizedUser
                );
            }
        }

        // ==================== Mock DB ====================
        class MockLessonDB {
            constructor() {
                this.lessons = new Map();
                this.progress = new Map();
            }
            async saveLesson(lesson) { this.lessons.set(lesson.id, lesson); return { success: true }; }
            async getLesson(id) { return this.lessons.get(id) || null; }
            async saveProgress(userId, progress) { this.progress.set(userId, progress); return { success: true }; }
            async getProgress(userId) { return this.progress.get(userId) || null; }
        }

        // ==================== Lesson Service ====================
        class LessonService {
            constructor(db) { this.db = db; }
            async submitExerciseResult(lessonId, userId, type, answer, correctData) {
                let isValid = false;
                switch (type) {
                    case 'multiple-choice':
                        isValid = ExerciseValidator.validateMultipleChoice(answer, correctData.correctIndex, correctData.choices);
                        break;
                    case 'fill-blank':
                        isValid = ExerciseValidator.validateFillBlank(answer, correctData.correctAnswer);
                        break;
                    case 'translation':
                        isValid = ExerciseValidator.validateTranslation(answer, correctData.correctAnswer, correctData.direction, correctData.tolerance || 0);
                        break;
                    case 'pronunciation':
                        isValid = ExerciseValidator.validatePronunciation(answer, correctData.phoneticList);
                        break;
                }
                await this.db.saveProgress(userId, { lessonId, type, isValid, timestamp: Date.now() });
                return { success: true, isValid };
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ ====================
        const ManualTests = {
            log(message) {
                const panel = document.getElementById('log-panel');
                panel.innerHTML += `<br>ğŸ”¹ ${message}`;
                panel.scrollTop = panel.scrollHeight;
                console.log(message);
            },

            clearContainer(id) {
                const el = document.getElementById(id);
                if (el) el.innerHTML = '';
            },

            addResult(containerId, testName, passed, expected, actual, details = '') {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const div = document.createElement('div');
                div.className = 'test-case';
                div.innerHTML = `
                    <div class="test-header">
                        <span>${testName}</span>
                        <span class="${passed ? 'pass' : 'fail'}">${passed ? 'âœ” PASS' : 'âœ˜ FAIL'}</span>
                    </div>
                    <div style="font-size:0.85rem; margin-top:6px; color:#b2dfdb;">
                        ğŸ“Œ Ø§Ù†ØªØ¸Ø§Ø±: ${expected} | Ø¯Ø±ÛŒØ§ÙØª: ${actual}
                        ${details ? `<br>ğŸ” ${details}` : ''}
                    </div>
                `;
                container.appendChild(div);
                
                const status = passed ? 'âœ…' : 'âŒ';
                this.log(`${status} ${testName} â€” ${passed ? 'Ù…ÙˆÙÙ‚' : 'Ù†Ø§Ù…ÙˆÙÙ‚'} (Ø§Ù†ØªØ¸Ø§Ø±: ${expected}, Ø¯Ø±ÛŒØ§ÙØª: ${actual})`);
            },

            // ===== Multiple Choice =====
            testMultipleChoice() {
                this.clearContainer('tests-mc');
                this.log('ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú†Ù‡Ø§Ø±Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ');
                
                // ØªØ³Øª 1: Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                const r1 = ExerciseValidator.validateMultipleChoice(2, 2, ['cat','dog','bird','fish']);
                this.addResult('tests-mc', 'MC-01: Ø§Ù†ØªØ®Ø§Ø¨ ØµØ­ÛŒØ­', r1 === true, true, r1);
                
                // ØªØ³Øª 2: Ù¾Ø§Ø³Ø® ØºÙ„Ø·
                const r2 = ExerciseValidator.validateMultipleChoice(0, 2, ['cat','dog','bird','fish']);
                this.addResult('tests-mc', 'MC-02: Ø§Ù†ØªØ®Ø§Ø¨ ØºÙ„Ø·', r2 === false, false, r2);
                
                // ØªØ³Øª 3: Ø§Ù†Ø¯ÛŒØ³ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡
                const r3 = ExerciseValidator.validateMultipleChoice(5, 2, ['cat','dog','bird','fish']);
                this.addResult('tests-mc', 'MC-03: Ø§Ù†Ø¯ÛŒØ³ Ù†Ø§Ù…Ø¹ØªØ¨Ø±', r3 === false, false, r3);
            },

            // ===== Fill Blank =====
            testFillBlank() {
                this.clearContainer('tests-fb');
                this.log('ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø§ÛŒâ€ŒØ®Ø§Ù„ÛŒ');
                
                const r1 = ExerciseValidator.validateFillBlank('book', 'book');
                this.addResult('tests-fb', 'FB-01: ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„', r1 === true, true, r1);
                
                const r2 = ExerciseValidator.validateFillBlank('Book', 'book');
                this.addResult('tests-fb', 'FB-02: Ø¨Ø²Ø±Ú¯/Ú©ÙˆÚ†Ú© Ù†Ù…Ø§', r2 === true, true, r2);
                
                const r3 = ExerciseValidator.validateFillBlank('  book  ', 'book');
                this.addResult('tests-fb', 'FB-03: Ø­Ø°Ù ÙØ§ØµÙ„Ù‡', r3 === true, true, r3);
                
                const r4 = ExerciseValidator.validateFillBlank('cat', 'book');
                this.addResult('tests-fb', 'FB-04: Ù¾Ø§Ø³Ø® ØºÙ„Ø·', r4 === false, false, r4);
            },

            // ===== Translation Ø¨Ø§ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡) =====
            testTranslation() {
                this.clearContainer('tests-tl');
                this.log('ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ + ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ');
                
                // ØªØ³Øª 1: ØªØ±Ø¬Ù…Ù‡ Ø¯Ù‚ÛŒÙ‚
                const r1 = ExerciseValidator.validateTranslation('Ú©ØªØ§Ø¨', 'Ú©ØªØ§Ø¨', 'fa2en', 0);
                this.addResult('tests-tl', 'TL-01: ØªØ±Ø¬Ù…Ù‡ Ø¯Ù‚ÛŒÙ‚', r1 === true, true, r1);
                
                // ØªØ³Øª 2: ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ - "Ú©Øª" vs "Ú©ØªØ§Ø¨" (ÙØ§ØµÙ„Ù‡ Û²)
                const r2 = ExerciseValidator.validateTranslation('Ú©Øª', 'Ú©ØªØ§Ø¨', 'fa2en', 2);
                this.addResult('tests-tl', 'TL-02: ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ tolerance=2', r2 === true, true, r2, 'Ú©Øª â†’ Ú©ØªØ§Ø¨ (ÙØ§ØµÙ„Ù‡ Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ†: Û²)');
                
                // ØªØ³Øª 3: ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ - "Ú©Ø§Ø¨" vs "Ú©ØªØ§Ø¨" (ÙØ§ØµÙ„Ù‡ Û±)
                const r3 = ExerciseValidator.validateTranslation('Ú©Ø§Ø¨', 'Ú©ØªØ§Ø¨', 'fa2en', 1);
                this.addResult('tests-tl', 'TL-03: ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ tolerance=1', r3 === true, true, r3, 'Ú©Ø§Ø¨ â†’ Ú©ØªØ§Ø¨ (ÙØ§ØµÙ„Ù‡ Ù„ÙˆÙ†Ø§Ø´ØªØ§ÛŒÙ†: Û±)');
                
                // ØªØ³Øª 4: Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ tolerance
                const r4 = ExerciseValidator.validateTranslation('Ú©Øª', 'Ú©ØªØ§Ø¨', 'fa2en', 1);
                this.addResult('tests-tl', 'TL-04: Ø®Ø§Ø±Ø¬ Ø§Ø² tolerance', r4 === false, false, r4, 'Ú©Øª â†’ Ú©ØªØ§Ø¨ (ÙØ§ØµÙ„Ù‡ Û² > tolerance=1)');
                
                // ØªØ³Øª 5: Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
                const r5 = ExerciseValidator.validateTranslation('water', 'Ø¢Ø¨', 'en2fa', 0);
                this.addResult('tests-tl', 'TL-05: ØªØ±Ø¬Ù…Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒâ†’ÙØ§Ø±Ø³ÛŒ', r5 === false, false, r5, 'water != Ø¢Ø¨');
            },

            // ===== Pronunciation =====
            testPronunciation() {
                this.clearContainer('tests-pr');
                this.log('ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ„ÙØ¸');
                
                const phoneticList = ['/hÉ™ËˆloÊŠ/', '/hÉ›ËˆloÊŠ/', '/hÉ™ËˆlÉ™ÊŠ/'];
                
                const r1 = ExerciseValidator.validatePronunciation('/hÉ™ËˆloÊŠ/', phoneticList);
                this.addResult('tests-pr', 'PR-01: ØªÙ„ÙØ¸ ØµØ­ÛŒØ­', r1 === true, true, r1);
                
                const r2 = ExerciseValidator.validatePronunciation('  /hÉ™ËˆloÊŠ/  ', phoneticList);
                this.addResult('tests-pr', 'PR-02: ÙØ§ØµÙ„Ù‡ Ø§Ø¶Ø§ÙÛŒ', r2 === true, true, r2);
                
                const r3 = ExerciseValidator.validatePronunciation('/bÃ¦d/', phoneticList);
                this.addResult('tests-pr', 'PR-03: ØªÙ„ÙØ¸ ØºÙ„Ø·', r3 === false, false, r3);
            },

            // ===== Integration =====
            async testIntegration() {
                this.clearContainer('tests-integration');
                this.log('ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¨Ø§ Mock DB');
                
                const mockDb = new MockLessonDB();
                const lessonService = new LessonService(mockDb);
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø³
                await mockDb.saveLesson({ id: 'L101', title: 'Ø­ÛŒÙˆØ§Ù†Ø§Øª' });
                
                // ØªØ³Øª Ú†Ù‡Ø§Ø±Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ
                const correctData = {
                    correctIndex: 1,
                    choices: ['Ú¯Ø±Ø¨Ù‡', 'Ø³Ú¯', 'Ù¾Ø±Ù†Ø¯Ù‡', 'Ù…Ø§Ù‡ÛŒ']
                };
                
                const result = await lessonService.submitExerciseResult(
                    'L101', 'user-001', 'multiple-choice', 1, correctData
                );
                
                this.addResult('tests-integration', 'INT-01: Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ ØªÙ…Ø±ÛŒÙ†', 
                    result.success === true && result.isValid === true, true, result.isValid);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Mock
                const progress = await mockDb.getProgress('user-001');
                this.addResult('tests-integration', 'INT-02: Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³',
                    progress && progress.lessonId === 'L101' && progress.isValid === true, true, !!progress);
                
                // ØªØ³Øª ØªØ±Ø¬Ù…Ù‡ Ø¨Ø§ ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ
                const transData = {
                    correctAnswer: 'Ú©ØªØ§Ø¨',
                    direction: 'fa2en',
                    tolerance: 1
                };
                
                const transResult = await lessonService.submitExerciseResult(
                    'L101', 'user-001', 'translation', 'Ú©Ø§Ø¨', transData
                );
                
                this.addResult('tests-integration', 'INT-03: ØºÙ„Ø·â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù„Ø§ÛŒÛŒ Ø¯Ø± Integration',
                    transResult.success === true && transResult.isValid === true, true, transResult.isValid,
                    'Ú©Ø§Ø¨ â†’ Ú©ØªØ§Ø¨ (tolerance=1)');
            },

            // Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
            async runAllManual() {
                this.reset();
                this.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§');
                this.testMultipleChoice();
                this.testFillBlank();
                this.testTranslation();
                this.testPronunciation();
                await this.testIntegration();
                this.log('ğŸ¯ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯');
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡
                const passElements = document.querySelectorAll('.pass');
                const failElements = document.querySelectorAll('.fail');
                document.getElementById('summary-box').innerHTML = `
                    âœ… Ù…ÙˆÙÙ‚: ${passElements.length} &nbsp;&nbsp; 
                    âŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failElements.length} &nbsp;&nbsp;
                    ğŸ§ª Ù…Ø¬Ù…ÙˆØ¹: ${passElements.length + failElements.length}
                `;
            },

            reset() {
                ['tests-mc', 'tests-fb', 'tests-tl', 'tests-pr', 'tests-integration']
                    .forEach(id => this.clearContainer(id));
                document.getElementById('log-panel').innerHTML = 'ğŸ“‹ Ù„Ø§Ú¯ ØªØ³Øªâ€ŒÙ‡Ø§';
                document.getElementById('summary-box').innerHTML = 'â Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯';
            }
        };

        // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ - Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø³ØªÛŒ
        window.onload = () => {
            console.log('âœ… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯ - Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
        };
    </script>
</body>
</html>
