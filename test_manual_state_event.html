<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ State Event - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Vazir', sans-serif;
            background: #f8fafc;
            color: #1e293b;
            padding: 16px;
            line-height: 1.6;
        }
        .container { max-width: 700px; margin: 0 auto; }
        h1, h2, h3 { margin-bottom: 12px; }
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            border-radius: 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            text-align: center;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .flex { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        button {
            background: #2563eb;
            border: none;
            color: white;
            padding: 14px 22px;
            border-radius: 40px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 4px 6px rgba(37,99,235,0.2);
            border: 1px solid rgba(255,255,255,0.2);
            flex: 1 1 auto;
        }
        button:hover { background: #1d4ed8; transform: translateY(-2px); }
        button.secondary { background: #64748b; box-shadow: 0 4px 6px rgba(100,116,139,0.2); }
        button.success { background: #0e9f6e; }
        button.warning { background: #e07c3c; }
        .event-log {
            background: #0f172a;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            padding: 16px;
            border-radius: 16px;
            height: 200px;
            overflow-y: auto;
            font-size: 14px;
            direction: ltr;
            text-align: left;
            margin-top: 16px;
        }
        .badge {
            background: #e2e8f0;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
        }
        .state-view {
            background: #dbeafe;
            border-radius: 16px;
            padding: 16px;
            border: 2px solid #bfdbfe;
            font-family: monospace;
            direction: ltr;
            text-align: left;
            word-break: break-word;
        }
        .test-step { border-bottom: 2px dashed #cbd5e1; padding-bottom: 20px; margin-bottom: 20px; }
        .counter { font-size: 48px; font-weight: bold; color: #1e3c72; text-align: center; }
        hr { margin: 20px 0; border: 1px solid #e2e8f0; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ State & Event</h1>
        <p>ØªØºÛŒÛŒØ± state Ø¨Ø§ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ â€¢ Idempotency â€¢ Event Bus</p>
    </div>

    <!-- Ù†Ù…Ø§ÛŒØ´ State Ø¬Ø§Ø±ÛŒ -->
    <div class="card">
        <div class="flex" style="justify-content: space-between;">
            <h2>ğŸ“Œ State Ø¬Ø§Ø±ÛŒ</h2>
            <span class="badge" id="eventCountBadge">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§: Û°</span>
        </div>
        <div id="currentStateDisplay" class="state-view">
            { "user": null, "lessons": [], "loading": false, "error": null }
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Û±: Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± -->
    <div class="card test-step">
        <h2>ğŸ”¹ Û±. Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± (User Events)</h2>
        <p>Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù† = dispatch Ø±ÙˆÛŒØ¯Ø§Ø¯ â†’ ØªØºÛŒÛŒØ± state</p>
        <div class="flex" style="margin: 16px 0;">
            <button id="btnLogin" class="success">ğŸ” Ø±ÙˆÛŒØ¯Ø§Ø¯: ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</button>
            <button id="btnLogout" class="secondary">ğŸšª Ø±ÙˆÛŒØ¯Ø§Ø¯: Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="flex">
            <button id="btnStartLesson">ğŸ“˜ Ø±ÙˆÛŒØ¯Ø§Ø¯: Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ Û±</button>
            <button id="btnFinishLesson">âœ… Ø±ÙˆÛŒØ¯Ø§Ø¯: Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³</button>
        </div>
        <div class="flex" style="margin-top: 12px;">
            <button id="btnError" class="warning">âš ï¸ Ø±ÙˆÛŒØ¯Ø§Ø¯: Ø®Ø·Ø§ (Ø´Ø¨Ú©Ù‡)</button>
            <button id="btnClearError">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§</button>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Û²: ØªØ³Øª Idempotency (Ù‡Ù…â€ŒØªÙˆØ§Ù†ÛŒ) -->
    <div class="card test-step">
        <h2>ğŸ”¹ Û². ØªØ³Øª Idempotency (Ù‡Ù…â€ŒØªÙˆØ§Ù†ÛŒ)</h2>
        <p>Ø§Ø±Ø³Ø§Ù„ Ú†Ù†Ø¯Ø¨Ø§Ø±Û€ ÛŒÚ© Ø±ÙˆÛŒØ¯Ø§Ø¯ ÛŒÚ©Ø³Ø§Ù† â†’ state ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± ØªØºÛŒÛŒØ± Ú©Ù†Ø¯</p>
        <div class="flex">
            <button id="btnIncrement">ğŸ”¢ Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ (Ûµ Ø¨Ø§Ø± ØªØ³Øª Ú©Ù†ÛŒØ¯)</button>
            <button id="btnIncrementOnce">ğŸ¯ Ø§ÙØ²Ø§ÛŒØ´ ÛŒÚ©Ø¨Ø§Ø± (Ø§ÛŒÙ…Ù¾ÙˆØªÙ†Øª)</button>
        </div>
        <div style="margin-top: 16px;">
            <span class="badge" style="background: #1e3c72; color: white;">Ù…Ù‚Ø¯Ø§Ø± Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡:</span>
            <span id="counterValue" style="font-size: 32px; font-weight: bold; margin-right: 8px;">Û°</span>
        </div>
        <p style="color: #475569; font-size: 14px; margin-top: 8px;">
            * Ø¯Ú©Ù…Ù‡ Ø³Ù…Øª Ú†Ù¾ Ù‡Ø± Ø¨Ø§Ø± Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ (ØºÛŒØ± ÛŒÚ©Ø³Ø§Ù†)ØŒ Ø¯Ú©Ù…Ù‡ Ø³Ù…Øª Ø±Ø§Ø³Øª ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø­ØªÛŒ Ø§Ú¯Ø± Ú†Ù†Ø¯Ø¨Ø§Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
        </p>
    </div>

    <!-- Ø¨Ø®Ø´ Û³: Event Bus / Multi-listener -->
    <div class="card test-step">
        <h2>ğŸ”¹ Û³. Event Bus (Ø´Ù†ÙˆÙ†Ø¯Ú¯Ø§Ù† Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡)</h2>
        <p>Ø¨Ø§ Ù‡Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ØŒ Ú†Ù†Ø¯ÛŒÙ† ØªØ§Ø¨Ø¹ (listener) ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´ÙˆÙ†Ø¯.</p>
        <div class="flex">
            <button id="btnNotifyAll">ğŸ“¢ Ø§Ø±Ø³Ø§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯ "NOTIFY_ALL"</button>
            <button id="btnResetLog">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
        </div>
        <p style="margin-top: 8px;">ğŸ“‹ Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§:</p>
        <div id="eventLog" class="event-log">
            -- Ù…Ù†ØªØ¸Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ --
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Û´: Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± (Async) -->
    <div class="card">
        <h2>ğŸ”¹ Û´. Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù‡Ù…Ø²Ù…Ø§Ù†</h2>
        <p>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ (loading) Ø¨Ø§ ØªØ£Ø®ÛŒØ±</p>
        <div class="flex">
            <button id="btnAsyncLoad">â³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³ (Û³ Ø«Ø§Ù†ÛŒÙ‡)</button>
            <button id="btnCancelLoad">âœ–ï¸ Ù„ØºÙˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
        </div>
        <div id="loadingIndicator" style="margin-top: 12px; display: none;">
            <span style="color: #2563eb;">â±ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
        </div>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ reset Ú©Ù„ÛŒ -->
    <div style="margin: 30px 0; text-align: center;">
        <button id="btnResetState" style="background: #ef4444; width: auto; padding: 12px 40px;">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ State</button>
    </div>
</div>

<script>
    // -------------------- Û±. State Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ø­ÙˆØ± (Event-driven State) --------------------
    const initialState = {
        user: null,
        currentLesson: null,
        completedLessons: [],
        loading: false,
        error: null,
        counter: 0,
        lastEvent: null,
        eventHistory: []
    };

    // State Ø¬Ø§Ø±ÛŒ
    let currentState = { ...initialState, eventHistory: [] };

    // Ù„ÛŒØ³Øª Ø´Ù†ÙˆÙ†Ø¯Ú¯Ø§Ù† (Listeners)
    const listeners = [];

    // ---------- ØªØ§Ø¨Ø¹ ØªØºÛŒÛŒØ± state (dispatch) ----------
    function dispatchEvent(eventType, payload = {}) {
        // Û±. Ø«Ø¨Øª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
        const event = {
            type: eventType,
            payload,
            timestamp: new Date().toISOString(),
            id: crypto.randomUUID ? crypto.randomUUID() : Date.now() + Math.random()
        };

        // Û². Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆÛŒØ¯Ø§Ø¯ (Reducer)
        let newState = { ...currentState, lastEvent: event };
        newState.eventHistory = [event, ...currentState.eventHistory].slice(0, 20); // Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Û²Û° Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¢Ø®Ø±

        switch (eventType) {
            case 'USER_LOGIN':
                newState.user = payload.user || { name: 'Ø¹Ù„ÛŒ', id: 1, level: 5 };
                newState.error = null;
                break;
            case 'USER_LOGOUT':
                newState.user = null;
                newState.currentLesson = null;
                break;
            case 'LESSON_START':
                newState.currentLesson = payload.lessonId || 1;
                newState.loading = false;
                newState.error = null;
                break;
            case 'LESSON_FINISH':
                if (newState.currentLesson && !newState.completedLessons.includes(newState.currentLesson)) {
                    newState.completedLessons = [...newState.completedLessons, newState.currentLesson];
                }
                newState.currentLesson = null;
                break;
            case 'ERROR_OCCURRED':
                newState.error = payload.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡';
                newState.loading = false;
                break;
            case 'CLEAR_ERROR':
                newState.error = null;
                break;
            case 'INCREMENT_COUNTER':
                newState.counter += 1;
                break;
            case 'INCREMENT_ONCE':
                // idempotent: ÙÙ‚Ø· Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± 0 Ø¨ÙˆØ¯ Ø§ÙØ²Ø§ÛŒØ´ Ø¨Ø¯Ù‡
                if (newState.counter === 0) newState.counter += 1;
                break;
            case 'ASYNC_LOAD_START':
                newState.loading = true;
                newState.error = null;
                break;
            case 'ASYNC_LOAD_SUCCESS':
                newState.loading = false;
                newState.currentLesson = payload.lessonId || 2;
                break;
            case 'ASYNC_LOAD_CANCEL':
            case 'ASYNC_LOAD_FAIL':
                newState.loading = false;
                if (eventType === 'ASYNC_LOAD_FAIL') newState.error = payload.error || 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚';
                break;
            case 'NOTIFY_ALL':
                // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Event Bus - Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± state
                break;
            case 'RESET_STATE':
                newState = { ...initialState, eventHistory: [] };
                break;
            default: break;
        }

        // Û³. Ø§Ø¹Ù…Ø§Ù„ state Ø¬Ø¯ÛŒØ¯
        currentState = newState;

        // Û´. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
        updateUI();

        // Ûµ. Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ù‡ Ù‡Ù…Ù‡ Ø´Ù†ÙˆÙ†Ø¯Ú¯Ø§Ù†
        listeners.forEach(listener => {
            try { listener(eventType, currentState, event); } catch(e) { console.error(e); }
        });

        // Û¶. Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„Ø§Ú¯ (Ø¨Ø±Ø§ÛŒ Event Bus)
        if (eventType === 'NOTIFY_ALL' || payload.log !== false) {
            addToLog(event);
        }

        return event;
    }

    // ---------- Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù†ÙˆÙ†Ø¯Ù‡ ----------
    function addListener(callback) {
        listeners.push(callback);
        return () => listeners.filter(l => l !== callback); // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ
    }

    // ---------- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ----------
    function updateUI() {
        // Ù†Ù…Ø§ÛŒØ´ state
        const displayState = {
            user: currentState.user,
            currentLesson: currentState.currentLesson,
            completed: currentState.completedLessons.length,
            loading: currentState.loading,
            error: currentState.error,
            counter: currentState.counter
        };
        document.getElementById('currentStateDisplay').innerHTML = 
            JSON.stringify(displayState, null, 2).replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');

        // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡
        document.getElementById('counterValue').innerText = currentState.counter;
        document.getElementById('eventCountBadge').innerHTML = `Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§: ${currentState.eventHistory.length}`;

        // Ù†Ø´Ø§Ù†Ú¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        const loadingEl = document.getElementById('loadingIndicator');
        if (currentState.loading) {
            loadingEl.style.display = 'block';
        } else {
            loadingEl.style.display = 'none';
        }
    }

    // ---------- Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ----------
    function addToLog(event) {
        const logEl = document.getElementById('eventLog');
        const time = new Date(event.timestamp).toLocaleTimeString('fa-IR');
        const line = document.createElement('div');
        line.style.marginBottom = '6px';
        line.style.borderBottom = '1px solid #334155';
        line.style.paddingBottom = '4px';
        line.innerHTML = `<span style="color:#94a3b8;">[${time}]</span> <span style="color:#facc15;">${event.type}</span> <span style="color:#7dd3fc;">${JSON.stringify(event.payload)}</span>`;
        logEl.appendChild(line);
        logEl.scrollTop = logEl.scrollHeight;
    }

    // ---------- Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯ ----------
    function clearLog() {
        document.getElementById('eventLog').innerHTML = '-- Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯ --';
    }

    // ---------- Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡ (Ø«Ø¨Øª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ) ----------
    addListener((type, state, event) => {
        // Ø§ÛŒÙ† Ø´Ù†ÙˆÙ†Ø¯Ù‡ ØµØ±ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªØ³Øª (Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ú©Ø§Ø±ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…)
        // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø¨ÛŒÙ†ÛŒØ¯
        console.log(`[Event] ${type}`, event.payload);
    });

    // -------------------- Û². Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ --------------------
    window.onload = function() {
        // ÙˆØ±ÙˆØ¯ / Ø®Ø±ÙˆØ¬
        document.getElementById('btnLogin').addEventListener('click', () => dispatchEvent('USER_LOGIN', { user: { name: 'Ø¹Ù„ÛŒ', id: 1, level: 7 } }));
        document.getElementById('btnLogout').addEventListener('click', () => dispatchEvent('USER_LOGOUT'));

        // Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³
        document.getElementById('btnStartLesson').addEventListener('click', () => dispatchEvent('LESSON_START', { lessonId: 1 }));
        document.getElementById('btnFinishLesson').addEventListener('click', () => dispatchEvent('LESSON_FINISH'));

        // Ø®Ø·Ø§
        document.getElementById('btnError').addEventListener('click', () => dispatchEvent('ERROR_OCCURRED', { error: 'Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù‚Ø·Ø¹ Ø§Ø³Øª' }));
        document.getElementById('btnClearError').addEventListener('click', () => dispatchEvent('CLEAR_ERROR'));

        // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ (idempotency)
        document.getElementById('btnIncrement').addEventListener('click', () => dispatchEvent('INCREMENT_COUNTER'));
        document.getElementById('btnIncrementOnce').addEventListener('click', () => dispatchEvent('INCREMENT_ONCE'));

        // Event Bus
        document.getElementById('btnNotifyAll').addEventListener('click', () => {
            dispatchEvent('NOTIFY_ALL', { message: 'Ø§Ø¹Ù„Ø§Ù† Ù‡Ù…Ú¯Ø§Ù†ÛŒ', log: true });
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù„Ø§Ú¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ
            addToLog({ type: 'NOTIFY_ALL', payload: { message: 'Ø§Ø¹Ù„Ø§Ù† Ù‡Ù…Ú¯Ø§Ù†ÛŒ' }, timestamp: new Date().toISOString() });
        });
        document.getElementById('btnResetLog').addEventListener('click', clearLog);

        // Async
        let timeoutId = null;
        document.getElementById('btnAsyncLoad').addEventListener('click', () => {
            if (timeoutId) clearTimeout(timeoutId);
            dispatchEvent('ASYNC_LOAD_START');
            timeoutId = setTimeout(() => {
                dispatchEvent('ASYNC_LOAD_SUCCESS', { lessonId: 5, log: true });
                timeoutId = null;
            }, 3000);
        });
        document.getElementById('btnCancelLoad').addEventListener('click', () => {
            if (timeoutId) {
                clearTimeout(timeoutId);
                timeoutId = null;
                dispatchEvent('ASYNC_LOAD_CANCEL');
            }
        });

        // Reset
        document.getElementById('btnResetState').addEventListener('click', () => {
            dispatchEvent('RESET_STATE');
            clearLog();
        });

        // State Ø§ÙˆÙ„ÛŒÙ‡
        updateUI();
    };

    // -------------------- Û³. ØªØ³Øª idempotency Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ --------------------
    // (Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ú†Ù†Ø¯Ø¨Ø§Ø± Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù† Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
</script>

<!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ -->
<div class="card" style="background: #f1f5f9; margin-top: 20px;">
    <h3>ğŸ“‹ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</h3>
    <ul style="margin-right: 20px;">
        <li>âœ… <strong>Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±</strong> - Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ â†’ state ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ØŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ù†Ù…Ø§ÛŒØ´ ÛŒØ§Ø¨Ø¯.</li>
        <li>âœ… <strong>Idempotency</strong> - Ø¯Ú©Ù…Ù‡ "Ø§ÙØ²Ø§ÛŒØ´ ÛŒÚ©Ø¨Ø§Ø±" Ø±Ø§ Ú†Ù†Ø¯ Ø¨Ø§Ø± Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ø¨Ø²Ù†ÛŒØ¯ â†’ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ ÙÙ‚Ø· Û± Ø´ÙˆØ¯.</li>
        <li>âœ… <strong>Event Bus</strong> - Ø¯Ú©Ù…Ù‡ "Ø§Ø±Ø³Ø§Ù„ NOTIFY_ALL" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ â†’ Ø¯Ø± Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø«Ø¨Øª Ø´ÙˆØ¯.</li>
        <li>âœ… <strong>Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Async</strong> - Ø¯Ú©Ù…Ù‡ "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³" â†’ state.loading = true ØŒ Ø¨Ø¹Ø¯ Û³ Ø«Ø§Ù†ÛŒÙ‡ Ø¯Ø±Ø³ Ø³Øª Ø´ÙˆØ¯.</li>
        <li>âœ… <strong>Ù„ØºÙˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</strong> - Ø¯Ø± Ø­ÛŒÙ† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒØŒ Ø¯Ú©Ù…Ù‡ Ù„ØºÙˆ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ â†’ loading false Ø¨Ù…Ø§Ù†Ø¯.</li>
        <li>âœ… <strong>Ø¹Ø¯Ù… ØªØºÛŒÛŒØ± state Ø§ØµÙ„ÛŒ</strong> - Ø¨Ø§ Ù‡Ø± Ú©Ù„ÛŒÚ© state Ù‚Ø¨Ù„ÛŒ ØªØºÛŒÛŒØ± Ù†Ú©Ù†Ø¯ (immutability).</li>
    </ul>
    <p style="color: #2563eb; margin-top: 12px;">âœ… Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ø³ØªÛŒ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒØ§ÛŒ Ø§Ø³Øª. ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ State/Event Ø±Ø§ Ù¾ÙˆØ´Ø´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
</div>

</body>
</html>
