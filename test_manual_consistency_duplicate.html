<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ: Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 5px; }
        .success { background: #27ae60; }
        .danger { background: #e74c3c; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; font-family: monospace; }
        .badge { padding: 5px 10px; border-radius: 4px; color: white; font-size: 12px; }
        .badge-blue { background: #3498db; }
        .badge-green { background: #27ae60; }
        .badge-red { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ—ƒï¸ Farsinglish - ØªØ³Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ</h1>
        <h3>Consistency & Duplicate Prevention</h3>
    </div>

    <div class="card">
        <h2>ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØªØ§Ø¨ÛŒØ³</h2>
        <div id="dbStatus" style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
            â³ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ IndexedDB...
        </div>
    </div>

    <div class="card">
        <h2>ğŸ§ª Û±. ØªØ³Øª Unique Constraint - Ø¯Ø±Ø³</h2>
        <p>Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¨Ø§ ID ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ Ø´ÙˆØ¯</p>
        <button onclick="testDuplicateLessonId()" class="success">â–¶ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø§ÙˆÙ„</button>
        <button onclick="testDuplicateLessonIdDuplicate()" class="danger">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ</button>
    </div>

    <div class="card">
        <h2>ğŸ§ª Û². ØªØ³Øª Unique Constraint - Ú©Ø§Ø±Ø¨Ø±</h2>
        <p>Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ Ø´ÙˆØ¯</p>
        <button onclick="testDuplicateUserEmail()" class="success">â–¶ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø§ÙˆÙ„</button>
        <button onclick="testDuplicateUserEmailDuplicate()" class="danger">ğŸ“§ Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ</button>
    </div>

    <div class="card">
        <h2>ğŸ§ª Û³. ØªØ³Øª Bulk Insert Ø¨Ø§ Ú©Ù„ÛŒØ¯ ØªÚ©Ø±Ø§Ø±ÛŒ</h2>
        <p>Ø§ÙØ²ÙˆØ¯Ù† Ú†Ù†Ø¯ÛŒÙ† Ø¯Ø±Ø³ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø§ ID ØªÚ©Ø±Ø§Ø±ÛŒ - ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ÛŒØ¯ Ú©Ø§Ù…Ù„ Ø±Ø¯ Ø´ÙˆØ¯</p>
        <button onclick="testBulkInsertWithDuplicate()" class="danger">ğŸ“¦ Bulk Insert ØªÚ©Ø±Ø§Ø±ÛŒ</button>
    </div>

    <div class="card">
        <h2>ğŸ§ª Û´. ØªØ³Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø¯ÙˆÙ† Ø§ÛŒØ¬Ø§Ø¯ duplicate</h2>
        <p>Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± ID - Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯</p>
        <button onclick="testUpdateWithoutDuplicate()" class="success">âœï¸ Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø±Ø³</button>
    </div>

    <div class="card">
        <h2>ğŸ“œ Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h2>
        <div id="logContainer" class="log">
            <p>â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...</p>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ“Š Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h2>
        <div id="summary"></div>
        <button onclick="clearDatabase()" class="danger">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³</button>
        <button onclick="initDB()" style="background: #95a5a6;">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
    </div>

    <script>
        // ---------- ØªÙ†Ø¸ÛŒÙ…Ø§Øª IndexedDB ----------
        const DB_NAME = 'FarsinglishTestDB';
        const DB_VERSION = 1;
        const LESSON_STORE = 'lessons';
        const USER_STORE = 'users';

        let db = null;
        const logEntries = [];
        const testResults = [];

        // ---------- Ù„Ø§Ú¯ ----------
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR');
            logEntries.push({ time, message, type });
            renderLog();
        }

        function renderLog() {
            const container = document.getElementById('logContainer');
            let html = '';
            logEntries.slice(-15).forEach(entry => {
                const color = entry.type === 'success' ? '#27ae60' : entry.type === 'error' ? '#e74c3c' : '#3498db';
                html += `<p style="border-bottom: 1px solid #eee; padding: 5px; margin: 0;"><span style="color: ${color}; font-weight: bold;">[${entry.time}]</span> ${entry.message}</p>`;
            });
            container.innerHTML = html || '<p>ğŸ“­ Ù„Ø§Ú¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</p>';
        }

        // ---------- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ----------
        function initDB() {
            return new Promise((resolve, reject) => {
                addLog('ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ IndexedDB...');
                
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Ø§Ø³ØªÙˆØ± Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø§ Ú©Ù„ÛŒØ¯ lessonId
                    if (!db.objectStoreNames.contains(LESSON_STORE)) {
                        const lessonStore = db.createObjectStore(LESSON_STORE, { keyPath: 'id' });
                        lessonStore.createIndex('title', 'title', { unique: false });
                        addLog('âœ… Ø§Ø³ØªÙˆØ± Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ (Ú©Ù„ÛŒØ¯: id)');
                    }
                    
                    // Ø§Ø³ØªÙˆØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ú©Ù„ÛŒØ¯ userId Ùˆ Ø§ÛŒÙ†Ø¯Ú©Ø³ ÛŒÚ©ØªØ§ Ø±ÙˆÛŒ Ø§ÛŒÙ…ÛŒÙ„
                    if (!db.objectStoreNames.contains(USER_STORE)) {
                        const userStore = db.createObjectStore(USER_STORE, { keyPath: 'id', autoIncrement: true });
                        userStore.createIndex('email', 'email', { unique: true }); // Unique Constraint Ø±ÙˆÛŒ Ø§ÛŒÙ…ÛŒÙ„
                        userStore.createIndex('username', 'username', { unique: false });
                        addLog('âœ… Ø§Ø³ØªÙˆØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ + Ø§ÛŒÙ†Ø¯Ú©Ø³ ÛŒÚ©ØªØ§ Ø±ÙˆÛŒ Ø§ÛŒÙ…ÛŒÙ„');
                    }
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    addLog('âœ… Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯', 'success');
                    document.getElementById('dbStatus').innerHTML = 'âœ… Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ø§Ù„ Ø§Ø³Øª - Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª';
                    resolve(db);
                };
                
                request.onerror = (event) => {
                    addLog('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³: ' + event.target.error, 'error');
                    reject(event.target.error);
                };
            });
        }

        // ---------- Û±. ØªØ³Øª Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ ----------
        async function testDuplicateLessonId() {
            const lesson = {
                id: 'lesson-101',
                title: 'Ø¯Ø±Ø³ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ',
                level: 1,
                createdAt: new Date()
            };
            
            try {
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                
                await new Promise((resolve, reject) => {
                    const request = store.add(lesson);
                    request.onsuccess = () => {
                        addLog('âœ… Ø¯Ø±Ø³ Ø¨Ø§ ID: ' + lesson.id + ' Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø§ÙˆÙ„', result: 'Ù…ÙˆÙÙ‚', id: lesson.id });
                        resolve();
                    };
                    request.onerror = () => {
                        addLog('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³: ' + request.error, 'error');
                        reject(request.error);
                    };
                });
            } catch(e) {
                addLog('âŒ Ø§Ø³ØªØ«Ù†Ø§: ' + e, 'error');
            }
            updateSummary();
        }

        async function testDuplicateLessonIdDuplicate() {
            const duplicateLesson = {
                id: 'lesson-101', // ID ØªÚ©Ø±Ø§Ø±ÛŒ
                title: 'Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ',
                level: 2
            };
            
            try {
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                
                await new Promise((resolve, reject) => {
                    const request = store.add(duplicateLesson);
                    request.onsuccess = () => {
                        addLog('âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! (Ù…Ø´Ú©Ù„)', 'error');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù†Ø§Ù…ÙˆÙÙ‚ (Ø¯Ø§Ø¯Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯)', id: duplicateLesson.id });
                        resolve();
                    };
                    request.onerror = (e) => {
                        addLog('âœ… ØªØ³Øª Ù…ÙˆÙÙ‚: Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ Ø±Ø¯ Ø´Ø¯ - ' + e.target.error, 'success');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù…ÙˆÙÙ‚ (Ø±Ø¯ Ø´Ø¯)', error: e.target.error.name });
                        resolve();
                    };
                });
            } catch(e) {
                addLog('âœ… ØªØ³Øª Ù…ÙˆÙÙ‚: Ø®Ø·Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
            }
            updateSummary();
        }

        // ---------- Û². ØªØ³Øª Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ (Unique Index) ----------
        async function testDuplicateUserEmail() {
            const user = {
                name: 'Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ',
                email: 'ali@example.com',
                username: 'ali_r'
            };
            
            try {
                const tx = db.transaction(USER_STORE, 'readwrite');
                const store = tx.objectStore(USER_STORE);
                
                await new Promise((resolve, reject) => {
                    const request = store.add(user);
                    request.onsuccess = () => {
                        addLog('âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ ' + user.email + ' Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø§ÙˆÙ„', result: 'Ù…ÙˆÙÙ‚', email: user.email });
                        resolve();
                    };
                    request.onerror = () => reject(request.error);
                });
            } catch(e) {
                addLog('âŒ Ø®Ø·Ø§: ' + e, 'error');
            }
            updateSummary();
        }

        async function testDuplicateUserEmailDuplicate() {
            const duplicateUser = {
                name: 'Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ',
                email: 'ali@example.com', // Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ
                username: 'ali_m'
            };
            
            try {
                const tx = db.transaction(USER_STORE, 'readwrite');
                const store = tx.objectStore(USER_STORE);
                
                await new Promise((resolve, reject) => {
                    const request = store.add(duplicateUser);
                    request.onsuccess = () => {
                        addLog('âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! (Ù…Ø´Ú©Ù„)', 'error');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù†Ø§Ù…ÙˆÙÙ‚ (Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯)' });
                        resolve();
                    };
                    request.onerror = (e) => {
                        addLog('âœ… ØªØ³Øª Ù…ÙˆÙÙ‚: Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø±Ø¯ Ø´Ø¯ - ' + e.target.error, 'success');
                        testResults.push({ test: 'Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ…ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù…ÙˆÙÙ‚ (Ø±Ø¯ Ø´Ø¯)', error: e.target.error.name });
                        resolve();
                    };
                });
            } catch(e) {
                addLog('âœ… ØªØ³Øª Ù…ÙˆÙÙ‚: Ø®Ø·Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
            }
            updateSummary();
        }

        // ---------- Û³. ØªØ³Øª Bulk Insert Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ ----------
        async function testBulkInsertWithDuplicate() {
            const lessons = [
                { id: 'bulk-1', title: 'Ø¯Ø±Ø³ ÛŒÚ©', level: 1 },
                { id: 'bulk-2', title: 'Ø¯Ø±Ø³ Ø¯Ùˆ', level: 1 },
                { id: 'lesson-101', title: 'Ø¯Ø±Ø³ ØªÚ©Ø±Ø§Ø±ÛŒ', level: 2 }, // ØªÚ©Ø±Ø§Ø±ÛŒ
                { id: 'bulk-3', title: 'Ø¯Ø±Ø³ Ø³Ù‡', level: 1 }
            ];
            
            addLog('ğŸ”„ Ø´Ø±ÙˆØ¹ Bulk Insert Ø¨Ø§ Û´ Ø¯Ø±Ø³ (ÛŒÚ©ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ)...');
            
            const tx = db.transaction(LESSON_STORE, 'readwrite');
            const store = tx.objectStore(LESSON_STORE);
            
            try {
                for (const lesson of lessons) {
                    await new Promise((resolve, reject) => {
                        const request = store.add(lesson);
                        request.onsuccess = resolve;
                        request.onerror = () => reject(request.error);
                    });
                }
                
                addLog('âš ï¸ Ù‡Ù…Ù‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯! (ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ Ù…ÛŒâ€ŒØ´Ø¯)', 'error');
                testResults.push({ test: 'Bulk Insert Ø¨Ø§ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù†Ø§Ù…ÙˆÙÙ‚ (ØªØ±Ø§Ú©Ù†Ø´ Ú©Ø§Ù…Ù„ Ø´Ø¯)' });
            } catch(e) {
                addLog('âœ… ØªØ³Øª Ù…ÙˆÙÙ‚: ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ Ø±Ø¯ Ø´Ø¯', 'success');
                testResults.push({ test: 'Bulk Insert Ø¨Ø§ ØªÚ©Ø±Ø§Ø±ÛŒ', result: 'Ù…ÙˆÙÙ‚ (ØªØ±Ø§Ú©Ù†Ø´ Ù„ØºÙˆ Ø´Ø¯)', error: e.message });
            }
            updateSummary();
        }

        // ---------- Û´. ØªØ³Øª Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø¯ÙˆÙ† Ø§ÛŒØ¬Ø§Ø¯ duplicate ----------
        async function testUpdateWithoutDuplicate() {
            try {
                const tx = db.transaction(LESSON_STORE, 'readwrite');
                const store = tx.objectStore(LESSON_STORE);
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø³ Ù…ÙˆØ¬ÙˆØ¯
                const getRequest = store.get('lesson-101');
                getRequest.onsuccess = () => {
                    const lesson = getRequest.result;
                    if (lesson) {
                        lesson.title = 'Ø¯Ø±Ø³ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ - ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡';
                        lesson.level = 3;
                        
                        const updateRequest = store.put(lesson); // put Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª
                        updateRequest.onsuccess = () => {
                            addLog('âœ… Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯ (Ø¨Ø¯ÙˆÙ† duplicate)', 'success');
                            testResults.push({ test: 'Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø±Ø³', result: 'Ù…ÙˆÙÙ‚' });
                            updateSummary();
                        };
                    } else {
                        addLog('âŒ Ø¯Ø±Ø³ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                    }
                };
            } catch(e) {
                addLog('âŒ Ø®Ø·Ø§: ' + e, 'error');
            }
        }

        // ---------- Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ----------
        async function clearDatabase() {
            const request = indexedDB.deleteDatabase(DB_NAME);
            request.onsuccess = () => {
                addLog('ğŸ—‘ï¸ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù¾Ø§Ú© Ø´Ø¯', 'success');
                testResults.length = 0;
                initDB();
                updateSummary();
            };
        }

        // ---------- Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§ ----------
        function updateSummary() {
            const summary = document.getElementById('summary');
            const success = testResults.filter(t => t.result.includes('Ù…ÙˆÙÙ‚')).length;
            const failed = testResults.filter(t => t.result.includes('Ù†Ø§Ù…ÙˆÙÙ‚')).length;
            
            summary.innerHTML = `
                <p>âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: ${success}</p>
                <p>âŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed}</p>
                <p>ğŸ“‹ Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§: ${testResults.length}</p>
                <hr>
                <pre style="background: #34495e; color: white; padding: 10px; border-radius: 5px;">${JSON.stringify(testResults.slice(-5), null, 2)}</pre>
            `;
        }

        // ---------- Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ----------
        window.onload = async function() {
            await initDB();
            addLog('ğŸš€ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Consistency', 'success');
        };
    </script>
</body>
</html>
