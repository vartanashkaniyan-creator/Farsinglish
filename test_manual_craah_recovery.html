<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø´ - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(145deg, #1a2634 0%, #0f1419 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #e6e9f0;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 32px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            font-size: 1.9rem;
            font-weight: 600;
            color: #ffd966;
            text-shadow: 0 2px 5px rgba(255,217,102,0.2);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .badge {
            background: #ff6b4a;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            display: inline-block;
            margin-bottom: 25px;
            box-shadow: 0 5px 0 #902e1e;
        }
        .card {
            background: rgba(10, 15, 22, 0.8);
            border-radius: 24px;
            padding: 22px;
            margin-bottom: 25px;
            border: 1px solid #3a4a5a;
            box-shadow: 0 8px 0 #0b0e11;
        }
        .scenario {
            background: #1e2a36;
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 20px;
            border-right: 8px solid #ffaa5e;
        }
        button {
            background: #3b8cbf;
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 16px 24px;
            border-radius: 50px;
            width: 100%;
            margin: 12px 0;
            box-shadow: 0 9px 0 #1f4e6b;
            transition: 0.08s linear;
            border: 1px solid #7fc1e0;
            cursor: pointer;
        }
        button:active {
            transform: translateY(8px);
            box-shadow: 0 2px 0 #1f4e6b;
        }
        .danger-btn {
            background: #c44536;
            box-shadow: 0 9px 0 #712b21;
            border-color: #ff8a7a;
        }
        .success-btn {
            background: #2e7d5e;
            box-shadow: 0 9px 0 #1a4633;
            border-color: #7ec8a6;
        }
        pre {
            background: #0d1117;
            padding: 16px;
            border-radius: 16px;
            border-left: 6px solid #ffaa5e;
            color: #b9f3ff;
            font-size: 0.95rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 15px;
            direction: ltr;
            text-align: left;
        }
        .state-view {
            background: #0f1a1f;
            border-radius: 18px;
            padding: 18px;
            border: 1px solid #3f6a7a;
            font-family: 'Courier New', monospace;
        }
        .footer {
            margin-top: 25px;
            font-size: 0.85rem;
            color: #a0b8cc;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø³ Ø§Ø² Ú©Ø±Ø´</h1>
    <div class="badge">ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ Â· Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Crash & Recovery</div>
    
    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ Û±: Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 style="color: #ffb980; font-size: 1.6rem;">ğŸ“¦ Û±. Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø³Øª (Session)</h2>
            <span id="sessionBadge1" style="background: #3a3f4a; padding: 8px 16px; border-radius: 30px;">ÙˆØ¶Ø¹ÛŒØª: --</span>
        </div>
        <div class="scenario">
            <p style="font-size: 1.1rem; margin-bottom: 10px;">ğŸ”¹ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø±Ø³ Û·: Â«Ø­Ø±ÙˆÙ Ø§Ø¶Ø§ÙÙ‡Â» Ø§Ø³Øª.</p>
            <p>âœ… Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡: Û¸ Ø§Ø² Û±Û²</p>
            <p>â³ Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: Û´:Û²Û²</p>
        </div>
        <button id="simulateCrash1" class="danger-btn">ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ (Session)</button>
        <button id="recoverSession" class="success-btn">ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ú©Ø±Ø´ (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±)</button>
        <div id="sessionOutput" class="state-view" style="margin-top: 20px;">
            â¸ï¸ Ù…Ù†ØªØ¸Ø± Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ...
        </div>
    </div>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ Û²: Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø§Ø¦Ù…ÛŒ (IndexedDB) -->
    <div class="card">
        <div style="display: flex; justify-content: space-between;">
            <h2 style="color: #a6e3a1; font-size: 1.6rem;">ğŸ—‚ï¸ Û². Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± (IndexedDB)</h2>
            <span id="dbBadge" style="background: #2e5c4b; padding: 8px 16px; border-radius: 30px;">Ø¢ÙÙ„Ø§ÛŒÙ†</span>
        </div>
        <p style="margin: 15px 0;">ğŸ“š Ø¯Ø±Ø³ Â«Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡Â» - Ø³Ø·Ø­ Û²</p>
        <p>ğŸ’¯ Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: Û¸ÛµÙª Â· Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: Û³ Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±</p>
        <button id="simulateCrash2" class="danger-btn">âš ï¸ Ù‚Ø·Ø¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ + Ø®Ø§Ù…ÙˆØ´ÛŒ</button>
        <button id="recoverFromDB" class="success-btn">ğŸ“€ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…Ø­Ù„ÛŒ</button>
        <div id="dbOutput" class="state-view">â³ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª</div>
    </div>

    <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ Û³: Ø¨Ø§Ø²Ú¯Ø´Øª Ù¾Ø³ Ø§Ø² Low Memory / Background Kill -->
    <div class="card">
        <h2 style="color: #f6c2b3; font-size: 1.6rem;">ğŸ“± Û³. Ú©Ø´ØªÙ‡ Ø´Ø¯Ù† ØªÙˆØ³Ø· Ø³ÛŒØ³ØªÙ… (Low Memory)</h2>
        <p style="background: #2c1a1f; padding: 14px; border-radius: 16px;">âš¡ Ø­Ø§ÙØ¸Ù‡ Ù¾Ø§ÛŒÛŒÙ† Â· Ø§Ù¾ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯</p>
        <button id="simulateLowMemory" class="danger-btn">ğŸ§  Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Low Memory Kill</button>
        <button id="restoreAfterKill" class="success-btn">ğŸ“‚ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ú©Ø±Ø´</button>
        <div id="memoryOutput" style="margin-top: 18px; background: #1e272b; padding: 14px; border-radius: 18px;">
            Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡: <span id="lastScreenSpan">â€”</span>
        </div>
    </div>

    <!-- Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ -->
    <div style="margin-top: 30px; background: #202c33; border-radius: 28px; padding: 22px;">
        <h3 style="color: #ffcf8a;">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h3>
        <pre id="recoveryLog" style="height: 150px; overflow-y: auto;">[Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.</pre>
        <button id="clearLog" style="background: #4a5c66; box-shadow: 0 9px 0 #2f3b42;">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
    </div>
</div>

<script>
    (function() {
        "use strict";

        // ---------- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ----------
        const STORAGE_KEYS = {
            SESSION_LESSON: 'crashTest_sessionLesson',
            SESSION_PROGRESS: 'crashTest_progress',
            DB_LESSON: 'crashTest_dbLesson',
            LAST_SCREEN: 'crashTest_lastScreen'
        };

        // ---- Ø³Ù†Ø§Ø±ÛŒÙˆ Û± : Session Storage ----
        function saveSessionState() {
            const state = {
                lessonId: 7,
                title: 'Ø­Ø±ÙˆÙ Ø§Ø¶Ø§ÙÙ‡',
                answered: 8,
                total: 12,
                timeLeft: '4:22',
                timestamp: Date.now()
            };
            sessionStorage.setItem(STORAGE_KEYS.SESSION_LESSON, JSON.stringify(state));
            document.getElementById('sessionOutput').innerText = 'ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯:\n' + JSON.stringify(state, null, 2);
            document.getElementById('sessionBadge1').innerHTML = 'âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡';
            document.getElementById('sessionBadge1').style.background = '#1d6f42';
            logEvent('Session state Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø¯Ø±Ø³ Û·)');
        }

        function loadSessionState() {
            const data = sessionStorage.getItem(STORAGE_KEYS.SESSION_LESSON);
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    document.getElementById('sessionOutput').innerHTML = 'âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚ Ø§Ø² SessionStorage:<br>' + 
                        `ğŸ“– Ø¯Ø±Ø³: ${parsed.title} | Ù¾Ø§Ø³Ø®: ${parsed.answered}/${parsed.total} | Ø²Ù…Ø§Ù†: ${parsed.timeLeft}`;
                    document.getElementById('sessionBadge1').innerHTML = 'ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯';
                    document.getElementById('sessionBadge1').style.background = '#285f8a';
                    logEvent('Session Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯ - Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø±Ø³');
                } catch(e) {
                    document.getElementById('sessionOutput').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ';
                }
            } else {
                document.getElementById('sessionOutput').innerText = 'âš ï¸ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§Ø¨ØªØ¯Ø§ Ú©Ø±Ø´ Ø±Ø§ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯.';
                logEvent('Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ: Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡ session ÛŒØ§ÙØª Ù†Ø´Ø¯');
            }
        }

        // ---- Ø³Ù†Ø§Ø±ÛŒÙˆ Û² : IndexedDB Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ ----
        function saveToDBMock() {
            const progress = {
                lessonName: 'Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡',
                level: 2,
                score: 85,
                nextReviewDays: 3,
                lastPracticed: new Date().toISOString()
            };
            localStorage.setItem(STORAGE_KEYS.DB_LESSON, JSON.stringify(progress));
            document.getElementById('dbOutput').innerText = 'ğŸ“€ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± IndexedDB (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²):\n' + JSON.stringify(progress, null, 2);
            document.getElementById('dbBadge').innerHTML = 'âœ… Ø¯Ø§Ø¯Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø±';
            document.getElementById('dbBadge').style.background = '#1f6e4a';
            logEvent('Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³ Ø¯Ø± IndexedDB Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        function recoverFromDB() {
            const data = localStorage.getItem(STORAGE_KEYS.DB_LESSON);
            if (data) {
                const p = JSON.parse(data);
                document.getElementById('dbOutput').innerHTML = 'â™»ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…Ø­Ù„ÛŒ:<br>' +
                    `ğŸ“• ${p.lessonName} | Ø³Ø·Ø­ ${p.level} | Ù†Ù…Ø±Ù‡ ${p.score}% | Ù…Ø±ÙˆØ±: ${p.nextReviewDays} Ø±ÙˆØ²`;
                document.getElementById('dbBadge').innerHTML = 'ğŸ“€ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯';
                document.getElementById('dbBadge').style.background = '#3a6ea5';
                logEvent('IndexedDB Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯ - ' + p.lessonName);
            } else {
                document.getElementById('dbOutput').innerText = 'â›” Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!';
                logEvent('Ø´Ú©Ø³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ: Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ù„ÛŒ');
            }
        }

        // ---- Ø³Ù†Ø§Ø±ÛŒÙˆ Û³ : Low memory / Last screen ----
        function simulateLowMemoryKill() {
            const screenInfo = 'ØµÙØ­Ù‡ ØªÙ…Ø±ÛŒÙ†: ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øªâ€ŒÙ‡Ø§ - Ú©Ø§Ø±Øª Û±Û´ Ø§Ø² Û²Û°';
            localStorage.setItem(STORAGE_KEYS.LAST_SCREEN, screenInfo);
            document.getElementById('lastScreenSpan').innerText = screenInfo;
            document.getElementById('memoryOutput').style.background = '#3a2a2a';
            logEvent('âš ï¸ low memory kill Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯. Ø¢Ø®Ø±ÛŒÙ† ØµÙØ­Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
        }

        function restoreLastScreen() {
            const last = localStorage.getItem(STORAGE_KEYS.LAST_SCREEN);
            if (last) {
                document.getElementById('lastScreenSpan').innerText = last + ' (Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ)';
                document.getElementById('memoryOutput').style.background = '#1e4a3b';
                logEvent('Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡: ' + last);
            } else {
                document.getElementById('lastScreenSpan').innerText = 'ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶)';
                logEvent('ØµÙØ­Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù¾Ø³ Ø§Ø² Ú©Ø±Ø´');
            }
        }

        // ---- Ù„Ø§Ú¯ Ù…Ø±Ú©Ø²ÛŒ ----
        function logEvent(msg) {
            const logEl = document.getElementById('recoveryLog');
            const time = new Date().toLocaleTimeString('fa-IR', { hour12: false });
            logEl.innerHTML += `\n[${time}] ${msg}`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            document.getElementById('recoveryLog').innerHTML = '[Ø³ÛŒØ³ØªÙ…] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯.';
            logEvent('ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¢ØºØ§Ø² Ø´Ø¯');
        }

        // ---- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ----
        function init() {
            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û±
            document.getElementById('simulateCrash1').addEventListener('click', function() {
                saveSessionState();
                logEvent('ğŸ’¥ Ú©Ø±Ø´ session Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯ (Ø¯Ø§Ø¯Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯)');
            });
            document.getElementById('recoverSession').addEventListener('click', function() {
                loadSessionState();
            });

            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û²
            document.getElementById('simulateCrash2').addEventListener('click', function() {
                saveToDBMock();
                logEvent('âš¡ Ù‚Ø·Ø¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ù‚ -> Ø¯Ø§Ø¯Ù‡ Ø¯Ø± IndexedDB');
            });
            document.getElementById('recoverFromDB').addEventListener('click', function() {
                recoverFromDB();
            });

            // Ø³Ù†Ø§Ø±ÛŒÙˆ Û³
            document.getElementById('simulateLowMemory').addEventListener('click', function() {
                simulateLowMemoryKill();
            });
            document.getElementById('restoreAfterKill').addEventListener('click', function() {
                restoreLastScreen();
            });

            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯
            document.getElementById('clearLog').addEventListener('click', function() {
                clearLog();
            });

            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø¯Ù‡ Ø¯Ø± start
            if (localStorage.getItem(STORAGE_KEYS.DB_LESSON)) {
                document.getElementById('dbBadge').innerHTML = 'ğŸ“¦ Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯';
                document.getElementById('dbBadge').style.background = '#3a5f6e';
            }
            logEvent('ğŸš€ ØµÙØ­Ù‡ ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø´ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.');
        }

        window.onload = init;
    })();
</script>
<div class="footer">
    âš¡ ØªØ³Øª Ø¯Ø³ØªÛŒ Â· Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´ØŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Session/LocalStorage Â· Ù‡Ø± Ø¯Ú©Ù…Ù‡ ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆ
</div>
</body>
</html>
