<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª SRS Scheduler - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .test-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .test-pass { border-right: 5px solid #27ae60; }
        .test-fail { border-right: 5px solid #e74c3c; }
        .test-pending { border-right: 5px solid #f39c12; }
        button { background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 14px; }
        .summary { background: #34495e; color: white; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§  Farsinglish - ØªØ³Øª Ù‡Ø³ØªÙ‡ SRS</h1>
        <h2>Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ (SM-2)</h2>
    </div>

    <div id="test-container"></div>
    <button onclick="runTests()">â–¶ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§</button>
    <div id="summary" class="summary"></div>

    <script>
        // -------------------- Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ SRS Scheduler --------------------
        class SRSScheduler {
            constructor() {
                this.defaultEaseFactor = 2.5;
                this.minEaseFactor = 1.3;
                this.maxEaseFactor = 3.0;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©ÛŒÙÛŒØª Ù¾Ø§Ø³Ø® (0-5)
            calculateNextReview(quality, repetitions, easeFactor, interval = 0) {
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
                if (quality < 0 || quality > 5) throw new Error('Ú©ÛŒÙÛŒØª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û° ØªØ§ Ûµ Ø¨Ø§Ø´Ø¯');
                if (repetitions < 0) throw new Error('ØªÚ©Ø±Ø§Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯');
                
                // Ú©ÛŒÙÛŒØª Ú©Ù…ØªØ± Ø§Ø² 3 = Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª
                if (quality < 3) {
                    return {
                        interval: 1,
                        repetitions: 0,
                        easeFactor: Math.max(this.minEaseFactor, easeFactor - 0.2)
                    };
                }

                // Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª
                let newInterval;
                if (repetitions === 0) {
                    newInterval = 1;
                } else if (repetitions === 1) {
                    newInterval = 6;
                } else {
                    newInterval = Math.round(interval * easeFactor);
                }

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø¬Ø¯ÛŒØ¯
                let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                newEaseFactor = Math.max(this.minEaseFactor, Math.min(this.maxEaseFactor, newEaseFactor));

                return {
                    interval: newInterval,
                    repetitions: repetitions + 1,
                    easeFactor: newEaseFactor
                };
            }

            // ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ±
            needsReview(lastReviewDate, currentDate, interval) {
                const daysPassed = Math.floor((currentDate - lastReviewDate) / (1000 * 60 * 60 * 24));
                return daysPassed >= interval;
            }

            // Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±ÙˆØ³ Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±
            prioritizeReviews(items) {
                return [...items].sort((a, b) => {
                    // Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ Ù…ÙˆØ§Ø±Ø¯ÛŒ Ú©Ù‡ ÙØ§ØµÙ„Ù‡ Ú©Ù…ØªØ±ÛŒ Ø¯Ø§Ø±Ù†Ø¯
                    const aOverdue = a.daysOverdue || 0;
                    const bOverdue = b.daysOverdue || 0;
                    return bOverdue - aOverdue;
                });
            }
        }

        // -------------------- Ø³ÛŒØ³ØªÙ… ØªØ³Øª --------------------
        const TestRunner = {
            results: [],
            
            assert: function(description, expected, actual, tolerance = 0) {
                let passed;
                if (typeof expected === 'number' && tolerance > 0) {
                    passed = Math.abs(expected - actual) <= tolerance;
                } else {
                    passed = expected === actual;
                }
                
                this.results.push({
                    description,
                    expected,
                    actual,
                    passed,
                    time: new Date().toLocaleTimeString('fa-IR')
                });
                
                return passed;
            },
            
            reset: function() {
                this.results = [];
            },
            
            getStats: function() {
                const total = this.results.length;
                const passed = this.results.filter(r => r.passed).length;
                return { total, passed, failed: total - passed };
            }
        };

        // -------------------- ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ SRS --------------------
        function runTests() {
            TestRunner.reset();
            const scheduler = new SRSScheduler();

            // --- ØªØ³Øª 1: Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª 0) ---
            const result1 = scheduler.calculateNextReview(0, 5, 2.5, 10);
            TestRunner.assert(
                'Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª: ÙØ§ØµÙ„Ù‡ Ø¨Ù‡ Û± Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯',
                1, result1.interval
            );
            TestRunner.assert(
                'Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª: ØªÚ©Ø±Ø§Ø± Ø¨Ù‡ Û° Ø¨Ø±Ø³Ø¯',
                0, result1.repetitions
            );
            TestRunner.assert(
                'Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª: Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯',
                2.3, result1.easeFactor, 0.01
            );

            // --- ØªØ³Øª 2: Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª 5) ---
            const result2 = scheduler.calculateNextReview(5, 0, 2.5);
            TestRunner.assert(
                'Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: ÙØ§ØµÙ„Ù‡ Û± Ø±ÙˆØ²',
                1, result2.interval
            );
            TestRunner.assert(
                'Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: ØªÚ©Ø±Ø§Ø± Û±',
                1, result2.repetitions
            );

            // --- ØªØ³Øª 3: Ø¯ÙˆÙ…ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª 4) ---
            const result3 = scheduler.calculateNextReview(4, 1, 2.5, 1);
            TestRunner.assert(
                'Ø¯ÙˆÙ…ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: ÙØ§ØµÙ„Ù‡ Û¶ Ø±ÙˆØ²',
                6, result3.interval
            );

            // --- ØªØ³Øª 4: Ù¾Ø§Ø³Ø® Ø¹Ø§Ù„ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ú†Ù†Ø¯ ØªÚ©Ø±Ø§Ø± ---
            const result4 = scheduler.calculateNextReview(5, 3, 2.5, 20);
            TestRunner.assert(
                'Ù¾Ø§Ø³Ø® Ø¹Ø§Ù„ÛŒ: ÙØ§ØµÙ„Ù‡ = ÙØ§ØµÙ„Ù‡ ÙØ¹Ù„ÛŒ Ã— Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª',
                50, result4.interval
            );

            // --- ØªØ³Øª 5: Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª ---
            const result5 = scheduler.calculateNextReview(5, 10, 3.5, 100);
            TestRunner.assert(
                'Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø§Ø² Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨ÛŒØ´ØªØ± Ù†Ø´ÙˆØ¯',
                3.0, result5.easeFactor, 0.01
            );

            // --- ØªØ³Øª 6: ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± ---
            const today = new Date('2026-02-12');
            const lastWeek = new Date('2026-02-05');
            TestRunner.assert(
                'ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± (Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ØŒ ÙØ§ØµÙ„Ù‡ Ûµ Ø±ÙˆØ²)',
                true, scheduler.needsReview(lastWeek, today, 5)
            );
            TestRunner.assert(
                'Ø¹Ø¯Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ± (Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ØŒ ÙØ§ØµÙ„Ù‡ Û±Û° Ø±ÙˆØ²)',
                false, scheduler.needsReview(lastWeek, today, 10)
            );

            // --- ØªØ³Øª 7: Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø±ÙˆØ± ---
            const items = [
                { id: 1, daysOverdue: 2 },
                { id: 2, daysOverdue: 5 },
                { id: 3, daysOverdue: 0 }
            ];
            const prioritized = scheduler.prioritizeReviews(items);
            TestRunner.assert(
                'Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† ØªØ£Ø®ÛŒØ±',
                5, prioritized[0].daysOverdue
            );

            // --- ØªØ³Øª 8: Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ---
            try {
                scheduler.calculateNextReview(6, 1, 2.5);
                TestRunner.assert('Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©ÛŒÙÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø±', 'Ø®Ø·Ø§', 'Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø§');
            } catch(e) {
                TestRunner.assert('Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©ÛŒÙÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø±', true, e.message.includes('Û° ØªØ§ Ûµ'));
            }

            // --- ØªØ³Øª 9: Ú©ÛŒÙÛŒØª Ù…Ø±Ø²ÛŒ 3 ---
            const result9 = scheduler.calculateNextReview(3, 2, 2.5, 10);
            TestRunner.assert(
                'Ú©ÛŒÙÛŒØª Û³ (Ù…Ø±Ø² Ù‚Ø¨ÙˆÙ„ÛŒ): ÙØ§ØµÙ„Ù‡ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§Ø¨Ø¯',
                25, result9.interval
            );

            // --- ØªØ³Øª 10: Ú©Ø§Ù‡Ø´ ØªØ¯Ø±ÛŒØ¬ÛŒ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª ---
            let ef = 2.5;
            for(let i = 0; i < 3; i++) {
                const res = scheduler.calculateNextReview(2, 1, ef, 1);
                ef = res.easeFactor;
            }
            TestRunner.assert(
                'Ú©Ø§Ù‡Ø´ ØªØ¯Ø±ÛŒØ¬ÛŒ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª Ø¯Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¶Ø¹ÛŒÙ',
                1.9, ef, 0.1
            );

            // --- Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ ---
            displayResults();
        }

        function displayResults() {
            const container = document.getElementById('test-container');
            const summary = document.getElementById('summary');
            const stats = TestRunner.getStats();
            
            let html = '';
            TestRunner.results.forEach((result, index) => {
                html += `
                    <div class="test-card ${result.passed ? 'test-pass' : 'test-fail'}">
                        <h4>ğŸ§ª ØªØ³Øª ${index + 1}: ${result.description}</h4>
                        <p>âœ… ÙˆØ¶Ø¹ÛŒØª: ${result.passed ? 'Ù…ÙˆÙÙ‚' : 'Ù†Ø§Ù…ÙˆÙÙ‚'}</p>
                        <p>ğŸ“Œ Ø®Ø±ÙˆØ¬ÛŒ: ${JSON.stringify(result.actual)}</p>
                        <p>ğŸ¯ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±: ${JSON.stringify(result.expected)}</p>
                        <small>â±ï¸ ${result.time}</small>
                    </div>
                `;
            });

            container.innerHTML = html;
            summary.innerHTML = `
                <h3>ğŸ“Š Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
                <p>âœ… Ù…ÙˆÙÙ‚: ${stats.passed} | âŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${stats.failed} | ğŸ“‹ Ú©Ù„: ${stats.total}</p>
                <p>â° ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')} - Ø³Ø§Ø¹Øª: ${new Date().toLocaleTimeString('fa-IR')}</p>
                <p>${stats.failed === 0 ? 'ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø±Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù†Ø¯' : 'âš ï¸ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯'}</p>
            `;
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        window.onload = function() {
            runTests();
        };
    </script>
</body>
</html>
