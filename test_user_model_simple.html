<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª User Model (Ù¾ÛŒØ´Ø±ÙØªÙ‡)</title>
    <style>
        body {
            font-family: system-ui;
            padding: 20px;
            direction: rtl;
            background: #f0f9ff;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e40af;
            text-align: center;
            margin-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 20px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        .stat-box {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            min-width: 100px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e40af;
        }
        .stat-label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }
        .test-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        .test-card.passed {
            border-color: #10b981;
            background: #f0fdf4;
        }
        .test-card.failed {
            border-color: #ef4444;
            background: #fef2f2;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title {
            font-weight: 600;
            color: #1e293b;
        }
        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-pass {
            background: #d1fae5;
            color: #065f46;
        }
        .status-fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .test-desc {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            background: #3b82f6;
            color: white;
        }
        button:hover {
            background: #2563eb;
        }
        .console {
            background: #1e293b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-success { color: #34d399; }
        .log-error { color: #f87171; }
        .log-info { color: #60a5fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª User Model (Ù¾ÛŒØ´Ø±ÙØªÙ‡)</h1>
        <div class="subtitle">ÙØ§ÛŒÙ„ Û² Ø§Ø² Û² - ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ XP Ùˆ Ú©Ù„ÙˆÙ†</div>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalTests">5</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
        </div>
        
        <div id="testsContainer"></div>
        
        <div class="controls">
            <button id="runTests">Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button id="resetTests">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
        </div>
        
        <div class="console">
            <div>ğŸ“ Ú©Ù†Ø³ÙˆÙ„ ØªØ³Øªâ€ŒÙ‡Ø§:</div>
            <div id="consoleOutput"></div>
        </div>
    </div>

    <script>
        // ==================== User Model Ø³Ø§Ø¯Ù‡ ====================
        class SimpleUserModel {
            constructor(data = {}) {
                this.username = data.username || '';
                this.level = data.level || 1;
                this.xp = data.xp || 0;
                this.achievements = data.achievements || [];
            }

            static getRequiredXP(level) {
                return Math.floor(100 * Math.pow(level, 1.5));
            }

            addXP(amount) {
                if (amount <= 0) return false;

                const oldLevel = this.level;
                this.xp += amount;

                while (this.xp >= SimpleUserModel.getRequiredXP(this.level)) {
                    this.xp -= SimpleUserModel.getRequiredXP(this.level);
                    this.level++;
                }

                return {
                    oldLevel,
                    newLevel: this.level,
                    leveledUp: this.level > oldLevel,
                    xpAdded: amount
                };
            }

            clone() {
                return new SimpleUserModel({
                    username: this.username,
                    level: this.level,
                    xp: this.xp,
                    achievements: [...this.achievements]
                });
            }

            validate() {
                if (!this.username || this.username.length < 3) {
                    return { isValid: false, error: 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©ÙˆØªØ§Ù‡' };
                }
                if (this.level < 1) {
                    return { isValid: false, error: 'Ø³Ø·Ø­ Ù†Ø§Ù…Ø¹ØªØ¨Ø±' };
                }
                return { isValid: true };
            }
        }

        // ==================== Ûµ ØªØ³Øª Ø§ØµÙ„ÛŒ ====================
        const tests = [
            {
                id: 1,
                title: 'Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Û³ Ø³Ø·Ø­ Ù…ØªÙˆØ§Ù„ÛŒ',
                run: () => {
                    const user = new SimpleUserModel();
                    let levelUps = 0;
                    
                    for (let i = 1; i <= 3; i++) {
                        const result = user.addXP(SimpleUserModel.getRequiredXP(i));
                        if (result.leveledUp) levelUps++;
                    }

                    return {
                        passed: user.level === 4 && levelUps === 3,
                        message: user.level === 4 ? 'âœ… Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ÛŒ ØµØ­ÛŒØ­' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªÙ‚Ø§',
                        details: `Ø³Ø·Ø­ Ù†Ù‡Ø§ÛŒÛŒ: ${user.level} (Ø§Ù†ØªØ¸Ø§Ø±: Û´)`
                    };
                }
            },
            {
                id: 2,
                title: 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø³Ø¨ Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø³Ø·Ø­ Ûµ',
                run: () => {
                    const user = new SimpleUserModel();
                    user.achievements = [];
                    
                    for (let i = 1; i <= 5; i++) {
                        user.addXP(SimpleUserModel.getRequiredXP(i));
                    }

                    const hasAchievement = user.level >= 5;

                    return {
                        passed: hasAchievement,
                        message: hasAchievement ? 'âœ… Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø³Ø·Ø­ Ûµ Ú©Ø³Ø¨ Ø´Ø¯' : 'âŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ú©Ø³Ø¨ Ù†Ø´Ø¯',
                        details: `Ø³Ø·Ø­: ${user.level}`
                    };
                }
            },
            {
                id: 3,
                title: 'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
                run: () => {
                    const valid = new SimpleUserModel({ username: 'user123' });
                    const invalid = new SimpleUserModel({ username: 'ab' });

                    const validResult = valid.validate();
                    const invalidResult = invalid.validate();

                    return {
                        passed: validResult.isValid && !invalidResult.isValid,
                        message: validResult.isValid ? 'âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØµØ­ÛŒØ­' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ',
                        details: `Ù…Ø¹ØªØ¨Ø±: ${validResult.isValid}, Ù†Ø§Ù…Ø¹ØªØ¨Ø±: ${!invalidResult.isValid}`
                    };
                }
            },
            {
                id: 4,
                title: 'Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† (Ø³Ø§Ø¯Ù‡)',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ù…Ø³ØªÙ‚Ù„',
                run: () => {
                    const original = new SimpleUserModel({
                        username: 'user1',
                        level: 3,
                        xp: 80
                    });

                    const clone = original.clone();
                    
                    clone.username = 'user2';
                    clone.addXP(30);

                    const originalCorrect = 
                        original.username === 'user1' && 
                        original.xp === 80;
                    
                    const cloneCorrect = 
                        clone.username === 'user2' && 
                        clone.xp === 110;

                    return {
                        passed: originalCorrect && cloneCorrect,
                        message: originalCorrect ? 'âœ… Ú©Ù„ÙˆÙ† Ù…ÙˆÙÙ‚' : 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„ÙˆÙ†',
                        details: `Ø§ØµÙ„ÛŒ: ${original.xp} XP, Ú©Ù„ÙˆÙ†: ${clone.xp} XP`
                    };
                }
            },
            {
                id: 5,
                title: 'ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø³ÛŒØ³ØªÙ…',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„ÛŒ',
                run: () => {
                    const user = new SimpleUserModel({ username: 'test' });
                    
                    const xpResult = user.addXP(75);
                    const validation = user.validate();

                    const allPassed = 
                        xpResult.xpAdded === 75 &&
                        validation.isValid &&
                        user.level >= 1;

                    return {
                        passed: allPassed,
                        message: allPassed ? 'âœ… Ø³ÛŒØ³ØªÙ… ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø§Ø³Øª' : 'âŒ Ù…Ø´Ú©Ù„ Ø¯Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ',
                        details: `Ø³Ø·Ø­: ${user.level}, XP: ${user.xp}`
                    };
                }
            }
        ];

        // ==================== Test Runner Ø³Ø§Ø¯Ù‡ ====================
        class SimpleTestRunner {
            constructor() {
                this.passed = 0;
                this.failed = 0;
                this.initialize();
            }

            initialize() {
                // Ø§ÛŒØ¬Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± ØµÙØ­Ù‡
                const container = document.getElementById('testsContainer');
                tests.forEach(test => {
                    const card = document.createElement('div');
                    card.className = 'test-card';
                    card.id = `test-${test.id}`;
                    card.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                        </div>
                        <div class="test-desc">${test.desc}</div>
                    `;
                    container.appendChild(card);
                });

                document.getElementById('runTests').addEventListener('click', () => this.runAll());
                document.getElementById('resetTests').addEventListener('click', () => this.reset());
            }

            async runAll() {
                this.reset();
                this.log('Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§...', 'info');
                
                for (const test of tests) {
                    await this.runTest(test);
                    await this.delay(300);
                }
                
                const rate = Math.round((this.passed / tests.length) * 100);
                this.log(`Ù¾Ø§ÛŒØ§Ù† ØªØ³Øªâ€ŒÙ‡Ø§: ${this.passed}/${tests.length} Ù…ÙˆÙÙ‚ (${rate}%)`, 
                        rate >= 80 ? 'success' : 'error');
            }

            async runTest(test) {
                const card = document.getElementById(`test-${test.id}`);
                const status = card.querySelector('.test-status');
                
                card.className = 'test-card';
                status.className = 'test-status status-pending';
                status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                try {
                    const result = test.run();
                    
                    if (result.passed) {
                        this.passed++;
                        card.classList.add('passed');
                        status.className = 'test-status status-pass';
                        status.textContent = 'Ù…ÙˆÙÙ‚';
                        this.log(`âœ… ${test.title}: ${result.message}`, 'success');
                    } else {
                        this.failed++;
                        card.classList.add('failed');
                        status.className = 'test-status status-fail';
                        status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                        this.log(`âŒ ${test.title}: ${result.message}`, 'error');
                    }
                    
                } catch (error) {
                    this.failed++;
                    card.classList.add('failed');
                    status.className = 'test-status status-fail';
                    status.textContent = 'Ø®Ø·Ø§';
                    this.log(`ğŸ’¥ ${test.title}: ${error.message}`, 'error');
                }
                
                this.updateStats();
            }

            updateStats() {
                document.getElementById('passedTests').textContent = this.passed;
                document.getElementById('failedTests').textContent = this.failed;
                const rate = Math.round((this.passed / tests.length) * 100);
                document.getElementById('successRate').textContent = `${rate}%`;
            }

            log(message, type = 'info') {
                const consoleEl = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `log-${type}`;
                line.textContent = `[${new Date().toLocaleTimeString('fa-IR')}] ${message}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }

            reset() {
                this.passed = 0;
                this.failed = 0;
                
                tests.forEach(test => {
                    const card = document.getElementById(`test-${test.id}`);
                    const status = card.querySelector('.test-status');
                    
                    card.className = 'test-card';
                    status.className = 'test-status status-pending';
                    status.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                });
                
                document.getElementById('consoleOutput').innerHTML = '';
                this.updateStats();
                this.log('ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        document.addEventListener('DOMContentLoaded', () => {
            new SimpleTestRunner();
        });
    </script>
</body>
</html>
