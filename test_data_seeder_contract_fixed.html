<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ data-seeder (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
        }
        h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .description {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 0.95rem;
            border-right: 4px solid #3498db;
        }
        .test-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }
        .test-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s;
        }
        .test-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        .test-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        .test-desc {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding-right: 10px;
            border-right: 2px solid #adb5bd;
        }
        .test-log {
            background: #2d2d2d;
            color: #f0f0f0;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
            white-space: pre-wrap;
            direction: ltr;
            text-align: left;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
            font-family: inherit;
        }
        .btn-primary {
            background: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .summary {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        .summary-stats {
            display: flex;
            gap: 20px;
            justify-content: space-around;
            margin: 15px 0;
            text-align: center;
        }
        .stat-item {
            flex: 1;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ data-seeder (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)</h1>
        <div class="description">
            <strong>ğŸ“‹ Ù‡Ø¯Ù:</strong> ØªØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Contract Test) Ù…Ø§Ú˜ÙˆÙ„ data-seeder Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ IndexedDB ÙˆØ§Ù‚Ø¹ÛŒ.<br>
            <strong>ğŸ” Ø§ØµÙˆÙ„:</strong> Ù…Ø³ØªÙ‚Ù„ Ø§Ø² Ø§Ø¨Ø²Ø§Ø± Â· Ø§ÛŒØ²ÙˆÙ„Ù‡ Â· Ø±ÙØªØ§Ø±Ú¯Ø±Ø§ Â· Ù‚Ø·Ø¹ÛŒ Â· ØªÚ©â€ŒØ§Ø¯Ø¹Ø§ Â· Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Fake
        </div>

        <!-- Fake Implementation -->
        <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-top: 0; color: #2c3e50;">ğŸ“¦ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø¹Ù„ÛŒ (Fake DB)</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="window.fakeDB.reset()">ğŸ”„ Ø±ÛŒØ³Øª Fake DB</button>
                <button class="btn btn-secondary" onclick="showFakeState()">ğŸ“Š Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª</button>
            </div>
            <div id="fakeState" class="test-log" style="margin-top: 10px; max-height: 100px;">Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</div>
        </div>

        <div class="test-grid" id="testGrid">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ ØªÙˆØ³Ø· JavaScript Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>

        <div class="summary">
            <h3 style="margin-top: 0; color: #2c3e50;">ğŸ“Š Ø®Ù„Ø§ØµÙ‡ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">Ù…ÙˆÙÙ‚</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                <button class="btn btn-primary" onclick="runAllTests()">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
                <button class="btn btn-warning" onclick="resetAllTests()">ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø¹Ù„ÛŒ (Fake DB) ====================
        window.fakeDB = (function() {
            let store = {
                users: [],
                lessons: [],
                progress: []
            };
            
            return {
                // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                get: (table, id) => {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (!store[table]) {
                                reject(new Error(`Ø¬Ø¯ÙˆÙ„ ${table} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`));
                            } else if (id) {
                                const item = store[table].find(item => item.id === id);
                                resolve(item || null);
                            } else {
                                resolve([...store[table]]);
                            }
                        }, 10);
                    });
                },
                
                save: (table, data) => {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (!store[table]) {
                                reject(new Error(`Ø¬Ø¯ÙˆÙ„ ${table} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`));
                            } else if (!data || typeof data !== 'object') {
                                reject(new Error('Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª'));
                            } else {
                                const newItem = { ...data, id: data.id || Date.now() };
                                const index = store[table].findIndex(item => item.id === newItem.id);
                                if (index >= 0) {
                                    store[table][index] = newItem;
                                } else {
                                    store[table].push(newItem);
                                }
                                resolve(newItem);
                            }
                        }, 10);
                    });
                },
                
                delete: (table, id) => {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (!store[table]) {
                                reject(new Error(`Ø¬Ø¯ÙˆÙ„ ${table} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`));
                            } else {
                                store[table] = store[table].filter(item => item.id !== id);
                                resolve(true);
                            }
                        }, 10);
                    });
                },
                
                reset: () => {
                    store = {
                        users: [],
                        lessons: [],
                        progress: []
                    };
                    updateFakeState();
                },
                
                getState: () => ({ ...store })
            };
        })();

        // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Fake DB
        function showFakeState() {
            const state = window.fakeDB.getState();
            document.getElementById('fakeState').textContent = 
                `ğŸ“Š Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ${state.users.length} | Ø¯Ø±Ø³â€ŒÙ‡Ø§: ${state.lessons.length} | Ù¾ÛŒØ´Ø±ÙØª: ${state.progress.length}\n` +
                JSON.stringify(state, null, 2);
        }

        function updateFakeState() {
            const state = window.fakeDB.getState();
            document.getElementById('fakeState').textContent = 
                `ğŸ“Š Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ${state.users.length} | Ø¯Ø±Ø³â€ŒÙ‡Ø§: ${state.lessons.length} | Ù¾ÛŒØ´Ø±ÙØª: ${state.progress.length}`;
        }

        // ==================== Ù…Ø§Ú˜ÙˆÙ„ data-seeder (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§) ====================
        window.dataSeeder = {
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
            _validateCount: (count, methodName) => {
                if (count === undefined || count === null) {
                    throw new Error(`${methodName}: ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª`);
                }
                if (typeof count !== 'number') {
                    throw new Error(`${methodName}: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯`);
                }
                if (count <= 0) {
                    throw new Error(`${methodName}: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯`);
                }
                if (count > 100) {
                    throw new Error(`${methodName}: ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û±Û°Û° Ø¨Ø§Ø´Ø¯`);
                }
                return Math.floor(count);
            },

            seedLessons: async (count = 5) => {
                try {
                    const validCount = window.dataSeeder._validateCount(count, 'seedLessons');
                    
                    const lessons = [];
                    for (let i = 0; i < validCount; i++) {
                        lessons.push({
                            id: `lesson_${i + 1}`,
                            title: `Ø¯Ø±Ø³ ${i + 1}`,
                            words: [
                                { english: 'hello', persian: 'Ø³Ù„Ø§Ù…' },
                                { english: 'book', persian: 'Ú©ØªØ§Ø¨' }
                            ],
                            level: Math.floor(i / 2) + 1
                        });
                    }
                    
                    for (const lesson of lessons) {
                        await window.fakeDB.save('lessons', lesson);
                    }
                    return lessons;
                } catch (error) {
                    throw new Error(`seedLessons: ${error.message}`);
                }
            },
            
            seedUsers: async (count = 2) => {
                try {
                    const validCount = window.dataSeeder._validateCount(count, 'seedUsers');
                    
                    const users = [];
                    for (let i = 0; i < validCount; i++) {
                        users.push({
                            id: `user_${i + 1}`,
                            username: `user${i + 1}`,
                            email: `user${i + 1}@test.com`,
                            level: 1,
                            xp: 0
                        });
                    }
                    
                    for (const user of users) {
                        await window.fakeDB.save('users', user);
                    }
                    return users;
                } catch (error) {
                    throw new Error(`seedUsers: ${error.message}`);
                }
            },
            
            seedProgress: async (userId, lessonIds) => {
                try {
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ userId
                    if (!userId) {
                        throw new Error('seedProgress: Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                    }
                    if (typeof userId !== 'string') {
                        throw new Error('seedProgress: Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø±Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯');
                    }
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ lessonIds
                    if (!lessonIds) {
                        throw new Error('seedProgress: Ù„ÛŒØ³Øª Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                    }
                    if (!Array.isArray(lessonIds)) {
                        throw new Error('seedProgress: lessonIds Ø¨Ø§ÛŒØ¯ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯');
                    }
                    if (lessonIds.length === 0) {
                        throw new Error('seedProgress: Ø¢Ø±Ø§ÛŒÙ‡ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
                    const user = await window.fakeDB.get('users', userId);
                    if (!user) {
                        throw new Error(`seedProgress: Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${userId} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
                    }
                    
                    const progress = [];
                    for (const lessonId of lessonIds) {
                        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø±Ø³
                        const lesson = await window.fakeDB.get('lessons', lessonId);
                        if (!lesson) {
                            throw new Error(`seedProgress: Ø¯Ø±Ø³ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${lessonId} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
                        }
                        
                        progress.push({
                            id: `progress_${userId}_${lessonId}`,
                            userId,
                            lessonId,
                            stage: 0,
                            nextReview: new Date().toISOString(),
                            correctCount: 0,
                            totalAttempts: 0
                        });
                    }
                    
                    for (const item of progress) {
                        await window.fakeDB.save('progress', item);
                    }
                    return progress;
                } catch (error) {
                    throw new Error(error.message);
                }
            },
            
            seedAll: async () => {
                try {
                    await window.dataSeeder.seedLessons(3);
                    await window.dataSeeder.seedUsers(1);
                    const lessons = await window.fakeDB.get('lessons');
                    const users = await window.fakeDB.get('users');
                    if (users.length > 0 && lessons.length > 0) {
                        await window.dataSeeder.seedProgress(users[0].id, lessons.map(l => l.id));
                    }
                    return { users, lessons };
                } catch (error) {
                    throw new Error(`seedAll: ${error.message}`);
                }
            },
            
            clearAll: async () => {
                try {
                    window.fakeDB.reset();
                    return true;
                } catch (error) {
                    throw new Error(`clearAll: ${error.message}`);
                }
            }
        };

        // ==================== ØªØ¹Ø±ÛŒÙ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const tests = [
            {
                id: 1,
                title: 'seedLessons - Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ',
                desc: 'Ø¢ÛŒØ§ seedLessons Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± ØµØ­ÛŒØ­ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ØŸ',
                run: async () => {
                    await window.dataSeeder.clearAll();
                    const result = await window.dataSeeder.seedLessons(3);
                    
                    if (!Array.isArray(result)) throw new Error('Ø®Ø±ÙˆØ¬ÛŒ Ø¢Ø±Ø§ÛŒÙ‡ Ù†ÛŒØ³Øª');
                    if (result.length !== 3) throw new Error(`Ø·ÙˆÙ„ Ø¢Ø±Ø§ÛŒÙ‡ ${result.length} Ø§Ø³ØªØŒ Ø¨Ø§ÛŒØ¯ Û³ Ø¨Ø§Ø´Ø¯`);
                    
                    for (const lesson of result) {
                        if (!lesson.id || !lesson.title || !lesson.words || !lesson.level) {
                            throw new Error('Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø³ Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
                        }
                        if (!Array.isArray(lesson.words)) {
                            throw new Error('words Ø¨Ø§ÛŒØ¯ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯');
                        }
                    }
                    
                    const dbLessons = await window.fakeDB.get('lessons');
                    if (dbLessons.length !== 3) throw new Error(`Ø¯Ø± DB ${dbLessons.length} Ø¯Ø±Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ø¨Ø§ÛŒØ¯ Û³ Ø¨Ø§Ø´Ø¯`);
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø±Ø¹Ø§ÛŒØª Ø´Ø¯Ù‡';
                }
            },
            {
                id: 2,
                title: 'seedUsers - Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ',
                desc: 'Ø¢ÛŒØ§ seedUsers Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± ØµØ­ÛŒØ­ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ØŸ',
                run: async () => {
                    await window.dataSeeder.clearAll();
                    const result = await window.dataSeeder.seedUsers(2);
                    
                    if (!Array.isArray(result)) throw new Error('Ø®Ø±ÙˆØ¬ÛŒ Ø¢Ø±Ø§ÛŒÙ‡ Ù†ÛŒØ³Øª');
                    if (result.length !== 2) throw new Error(`Ø·ÙˆÙ„ Ø¢Ø±Ø§ÛŒÙ‡ ${result.length} Ø§Ø³ØªØŒ Ø¨Ø§ÛŒØ¯ Û² Ø¨Ø§Ø´Ø¯`);
                    
                    for (const user of result) {
                        if (!user.id || !user.username || !user.email) {
                            throw new Error('Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
                        }
                        if (typeof user.level !== 'number' || typeof user.xp !== 'number') {
                            throw new Error('level Ùˆ xp Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ù†Ø¯');
                        }
                    }
                    
                    const dbUsers = await window.fakeDB.get('users');
                    if (dbUsers.length !== 2) throw new Error(`Ø¯Ø± DB ${dbUsers.length} Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ø¨Ø§ÛŒØ¯ Û² Ø¨Ø§Ø´Ø¯`);
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø±Ø¹Ø§ÛŒØª Ø´Ø¯Ù‡';
                }
            },
            {
                id: 3,
                title: 'seedProgress - Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ',
                desc: 'Ø¢ÛŒØ§ seedProgress Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± ØµØ­ÛŒØ­ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ØŸ',
                run: async () => {
                    await window.dataSeeder.clearAll();
                    await window.dataSeeder.seedLessons(2);
                    await window.dataSeeder.seedUsers(1);
                    
                    const users = await window.fakeDB.get('users');
                    const lessons = await window.fakeDB.get('lessons');
                    
                    const result = await window.dataSeeder.seedProgress(users[0].id, lessons.map(l => l.id));
                    
                    if (!Array.isArray(result)) throw new Error('Ø®Ø±ÙˆØ¬ÛŒ Ø¢Ø±Ø§ÛŒÙ‡ Ù†ÛŒØ³Øª');
                    if (result.length !== 2) throw new Error(`Ø·ÙˆÙ„ Ø¢Ø±Ø§ÛŒÙ‡ ${result.length} Ø§Ø³ØªØŒ Ø¨Ø§ÛŒØ¯ Û² Ø¨Ø§Ø´Ø¯`);
                    
                    for (const prog of result) {
                        if (!prog.id || !prog.userId || !prog.lessonId) {
                            throw new Error('Ø³Ø§Ø®ØªØ§Ø± Ù¾ÛŒØ´Ø±ÙØª Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
                        }
                        if (typeof prog.stage !== 'number' || typeof prog.correctCount !== 'number') {
                            throw new Error('stage Ùˆ correctCount Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ù†Ø¯');
                        }
                        if (!prog.nextReview) throw new Error('nextReview ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                    }
                    
                    const dbProgress = await window.fakeDB.get('progress');
                    if (dbProgress.length !== 2) throw new Error(`Ø¯Ø± DB ${dbProgress.length} Ù¾ÛŒØ´Ø±ÙØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ø¨Ø§ÛŒØ¯ Û² Ø¨Ø§Ø´Ø¯`);
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø±Ø¹Ø§ÛŒØª Ø´Ø¯Ù‡';
                }
            },
            {
                id: 4,
                title: 'seedAll - Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡',
                desc: 'Ø¢ÛŒØ§ seedAll Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ø§Ø±ØªØ¨Ø§Ø· ØµØ­ÛŒØ­ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ',
                run: async () => {
                    await window.dataSeeder.clearAll();
                    const result = await window.dataSeeder.seedAll();
                    
                    if (!result.users || !result.lessons) {
                        throw new Error('Ø®Ø±ÙˆØ¬ÛŒ Ø³Ø§Ø®ØªØ§Ø± {users, lessons} Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯');
                    }
                    
                    const dbUsers = await window.fakeDB.get('users');
                    const dbLessons = await window.fakeDB.get('lessons');
                    const dbProgress = await window.fakeDB.get('progress');
                    
                    if (dbUsers.length === 0) throw new Error('Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡');
                    if (dbLessons.length === 0) throw new Error('Ø¯Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡');
                    
                    for (const prog of dbProgress) {
                        const userExists = dbUsers.some(u => u.id === prog.userId);
                        const lessonExists = dbLessons.some(l => l.id === prog.lessonId);
                        
                        if (!userExists) throw new Error(`Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯: ${prog.userId}`);
                        if (!lessonExists) throw new Error(`Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø³ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯: ${prog.lessonId}`);
                    }
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø§Ø±ØªØ¨Ø§Ø· ØµØ­ÛŒØ­ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯';
                }
            },
            {
                id: 5,
                title: 'clearAll - Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„',
                desc: 'Ø¢ÛŒØ§ clearAll Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ',
                run: async () => {
                    await window.dataSeeder.seedAll();
                    await window.dataSeeder.clearAll();
                    
                    const dbUsers = await window.fakeDB.get('users');
                    const dbLessons = await window.fakeDB.get('lessons');
                    const dbProgress = await window.fakeDB.get('progress');
                    
                    if (dbUsers.length !== 0) throw new Error('Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾Ø§Ú© Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
                    if (dbLessons.length !== 0) throw new Error('Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
                    if (dbProgress.length !== 0) throw new Error('Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§Ú© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯';
                }
            },
            {
                id: 6,
                title: 'Ù…Ù‚Ø§ÙˆÙ…Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø®Ø·Ø§ - Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡',
                desc: 'Ø¢ÛŒØ§ Ù…ØªØ¯Ù‡Ø§ Ø¨Ø§ ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ØŸ',
                run: async () => {
                    const errors = [];
                    
                    // ØªØ³Øª 1: seedLessons Ø¨Ø§ count Ù…Ù†ÙÛŒ
                    try {
                        await window.dataSeeder.seedLessons(-5);
                        errors.push('seedLessons Ø¨Ø§ count Ù…Ù†ÙÛŒ Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ±')) {
                            errors.push(`seedLessons: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 2: seedLessons Ø¨Ø§ count ØºÛŒØ±Ø¹Ø¯Ø¯ÛŒ
                    try {
                        await window.dataSeeder.seedLessons('abc');
                        errors.push('seedLessons Ø¨Ø§ count ØºÛŒØ±Ø¹Ø¯Ø¯ÛŒ Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯')) {
                            errors.push(`seedLessons: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 3: seedLessons Ø¨Ø§ count null
                    try {
                        await window.dataSeeder.seedLessons(null);
                        errors.push('seedLessons Ø¨Ø§ count null Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡')) {
                            errors.push(`seedLessons: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 4: seedProgress Ø¨Ø§ userId Ù†Ø§Ù…Ø¹ØªØ¨Ø±
                    try {
                        await window.dataSeeder.seedProgress(null, ['lesson1']);
                        errors.push('seedProgress Ø¨Ø§ userId null Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ù„Ø²Ø§Ù…ÛŒ')) {
                            errors.push(`seedProgress: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 5: seedProgress Ø¨Ø§ lessonIds ØºÛŒØ±Ø¢Ø±Ø§ÛŒÙ‡
                    try {
                        await window.dataSeeder.seedProgress('user1', 'not-array');
                        errors.push('seedProgress Ø¨Ø§ lessonIds ØºÛŒØ±Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯')) {
                            errors.push(`seedProgress: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 6: seedProgress Ø¨Ø§ Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø§Ù„ÛŒ
                    try {
                        await window.dataSeeder.seedProgress('user1', []);
                        errors.push('seedProgress Ø¨Ø§ Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø§Ù„ÛŒ Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯')) {
                            errors.push(`seedProgress: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    // ØªØ³Øª 7: seedProgress Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯
                    try {
                        await window.dataSeeder.seedProgress('non_existent_user', ['lesson1']);
                        errors.push('seedProgress Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø§ Ù†Ø¯Ø§Ø¯');
                    } catch (e) {
                        if (!e.message.includes('ÛŒØ§ÙØª Ù†Ø´Ø¯')) {
                            errors.push(`seedProgress: Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${e.message}`);
                        }
                    }
                    
                    if (errors.length > 0) {
                        throw new Error('Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø´Ø¯Ù‡:\n' + errors.join('\n'));
                    }
                    
                    return 'âœ… Ù‡Ù…Ù‡ Ø®Ø·Ø§Ù‡Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯';
                }
            }
        ];

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const testStatuses = new Array(tests.length).fill('pending');
        const testLogs = new Array(tests.length).fill('');

        function createTestCards() {
            const grid = document.getElementById('testGrid');
            grid.innerHTML = '';
            
            tests.forEach((test, index) => {
                const card = document.createElement('div');
                card.className = 'test-card';
                card.id = `test-${index}`;
                
                card.innerHTML = `
                    <div class="test-header">
                        <span class="test-title">${test.id}. ${test.title}</span>
                        <span class="test-status status-pending" id="status-${index}">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                    </div>
                    <div class="test-desc">${test.desc}</div>
                    <div class="test-log" id="log-${index}">Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runTest(${index})">â–¶ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                        <button class="btn btn-secondary" onclick="resetTest(${index})">ğŸ”„ Ø±ÛŒØ³Øª</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            updateSummary();
        }

        window.runTest = async (index) => {
            const statusEl = document.getElementById(`status-${index}`);
            const logEl = document.getElementById(`log-${index}`);
            
            statusEl.className = 'test-status status-pending';
            statusEl.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            logEl.innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...';
            
            try {
                const test = tests[index];
                const result = await test.run();
                
                testStatuses[index] = 'success';
                statusEl.className = 'test-status status-success';
                statusEl.innerHTML = 'âœ… Ù…ÙˆÙÙ‚';
                logEl.innerHTML = `âœ… ${result}`;
                
            } catch (error) {
                testStatuses[index] = 'failed';
                statusEl.className = 'test-status status-failed';
                statusEl.innerHTML = 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚';
                logEl.innerHTML = `âŒ Ø®Ø·Ø§: ${error.message}`;
            }
            
            updateSummary();
            updateFakeState();
        };

        window.runAllTests = async () => {
            for (let i = 0; i < tests.length; i++) {
                await window.runTest(i);
            }
        };

        window.resetTest = (index) => {
            testStatuses[index] = 'pending';
            document.getElementById(`status-${index}`).className = 'test-status status-pending';
            document.getElementById(`status-${index}`).innerHTML = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
            document.getElementById(`log-${index}`).innerHTML = 'Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯';
            updateSummary();
        };

        window.resetAllTests = () => {
            tests.forEach((_, index) => {
                testStatuses[index] = 'pending';
                document.getElementById(`status-${index}`).className = 'test-status status-pending';
                document.getElementById(`status-${index}`).innerHTML = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                document.getElementById(`log-${index}`).innerHTML = 'Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯';
            });
            window.fakeDB.reset();
            updateSummary();
        };

        function updateSummary() {
            const total = tests.length;
            const passed = testStatuses.filter(s => s === 'success').length;
            const failed = testStatuses.filter(s => s === 'failed').length;
            
            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            
            const progress = (passed / total) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        window.showFakeState = showFakeState;
        
        document.addEventListener('DOMContentLoaded', () => {
            createTestCards();
            updateFakeState();
        });
    </script>
</body>
</html>
