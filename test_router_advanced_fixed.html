<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farsinglish - ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: #e8eaf6;
            min-height: 100vh;
            padding: 15px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto;
            background: rgba(30, 35, 70, 0.95);
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        }
        h1 { 
            text-align: center; 
            margin-bottom: 20px;
            font-size: 1.6rem;
            color: #8c9eff;
        }
        .test-section { 
            margin: 15px 0;
            padding: 14px;
            background: rgba(40, 45, 80, 0.9);
            border-radius: 8px;
            border-left: 4px solid #536dfe;
        }
        .test-header { 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title { 
            font-size: 0.95rem; 
            font-weight: 600;
            color: #ffab91;
        }
        .test-result { 
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .pass { background: #4caf50; }
        .fail { background: #f44336; }
        .details { 
            margin-top: 8px;
            padding: 10px;
            background: rgba(20, 25, 60, 0.8);
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.8rem;
            color: #cfd8dc;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: rgba(40, 45, 80, 0.9);
            border-radius: 8px;
            text-align: center;
        }
        button {
            background: #304ffe;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin: 4px;
        }
        .controls { text-align: center; margin-top: 15px; }
        .simulation {
            margin: 20px 0;
            padding: 15px;
            background: rgba(50, 55, 90, 0.9);
            border-radius: 10px;
            border: 1px dashed rgba(140, 158, 255, 0.4);
        }
        .sim-btn {
            background: rgba(83, 109, 254, 0.2);
            border: 1px solid #536dfe;
            color: #8c9eff;
            padding: 6px 12px;
            border-radius: 6px;
            margin: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .route-display {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 6px;
            margin: 8px 0;
            color: #ffd54f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ (Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡)</h1>
        
        <div class="simulation">
            <h3>ğŸ® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ</h3>
            <div id="sim-controls">Ø¯Ú©Ù…Ù‡ "ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</div>
            <div class="route-display">
                Ù…Ø³ÛŒØ± ÙØ¹Ù„ÛŒ: <span id="current-route">/</span>
            </div>
            <div class="route-display">
                ÙˆØ¶Ø¹ÛŒØª: <span id="user-status">Ù…Ù‡Ù…Ø§Ù†</span>
            </div>
        </div>
        
        <div id="test-results"></div>
        
        <div class="summary">
            <p id="summary-text">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ Û¶ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡...</p>
        </div>
        
        <div class="controls">
            <button onclick="runAllTests()">ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button onclick="setupSimulation()">ğŸ® ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²</button>
            <button onclick="clearTests()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
        </div>
    </div>

    <script>
        // ==================== Advanced Router FIXED ====================
        class AdvancedRouterFixed {
            constructor() {
                this.routes = new Map();
                this.currentRoute = '/';
                this.history = [];
                this.isAuthenticated = false;
                this.userRole = 'guest';
                this.routeListeners = [];
                this.maxHistory = 20;
                this.navigationLock = false; // Ù‚ÙÙ„ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Concurrent
                
                this.initRoutes();
            }
            
            initRoutes() {
                const routes = {
                    '/': { name: 'Ø®Ø§Ù†Ù‡', auth: false, roles: ['guest', 'user', 'admin'] },
                    '/login': { name: 'ÙˆØ±ÙˆØ¯', auth: false, roles: ['guest'] },
                    '/dashboard': { name: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', auth: true, roles: ['user', 'admin'] },
                    '/lessons': { name: 'Ø¯Ø±ÙˆØ³', auth: true, roles: ['user', 'admin'] },
                    '/profile': { name: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„', auth: true, roles: ['user', 'admin'] },
                    '/admin': { name: 'Ù…Ø¯ÛŒØ±ÛŒØª', auth: true, roles: ['admin'] },
                    '/404': { name: 'ÛŒØ§ÙØª Ù†Ø´Ø¯', auth: false, roles: ['guest', 'user', 'admin'] }
                };
                
                Object.entries(routes).forEach(([path, config]) => {
                    this.routes.set(path, config);
                });
            }
            
            async navigate(toPath, options = {}) {
                // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Concurrent Navigation
                if (this.navigationLock) {
                    console.log('â³ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³ØªØŒ Ù…Ù†ØªØ¸Ø± Ø¨Ù…Ø§Ù†ÛŒØ¯...');
                    return false;
                }
                
                this.navigationLock = true;
                
                try {
                    // Ø§Ú¯Ø± Ù…Ø³ÛŒØ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
                    if (!this.routes.has(toPath)) {
                        console.log(`â›” Ù…Ø³ÛŒØ± ${toPath} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯`);
                        this._changeRoute('/404', toPath, false);
                        return false;
                    }
                    
                    const route = this.routes.get(toPath);
                    
                    // 1. Ø¨Ø±Ø±Ø³ÛŒ Guard Ù…Ù‡Ù…Ø§Ù†
                    if (toPath === '/login' && this.isAuthenticated) {
                        console.log('ğŸ”’ Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡');
                        this._changeRoute('/dashboard', toPath, false);
                        return false;
                    }
                    
                    // 2. Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                    if (route.auth && !this.isAuthenticated) {
                        console.log('ğŸ” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ†');
                        this._changeRoute('/login', toPath, false);
                        return false;
                    }
                    
                    // 3. Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
                    if (route.roles && !route.roles.includes(this.userRole)) {
                        console.log(`ğŸš« Ù†Ù‚Ø´ ${this.userRole} Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª`);
                        this._changeRoute('/', toPath, false);
                        return false;
                    }
                    
                    // 4. Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚
                    return this._changeRoute(toPath, this.currentRoute, true, options);
                    
                } finally {
                    // Ø­ØªÙ…Ø§Ù‹ Ù‚ÙÙ„ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†
                    this.navigationLock = false;
                }
            }
            
            _changeRoute(newPath, fromPath, success, options = {}) {
                const oldRoute = this.currentRoute;
                this.currentRoute = newPath;
                
                // Ù…Ø¯ÛŒØ±ÛŒØª ØªØ§Ø±ÛŒØ®Ú†Ù‡
                if (success && !options.replace && oldRoute !== newPath) {
                    this.history.push(oldRoute);
                    if (this.history.length > this.maxHistory) {
                        this.history.shift();
                    }
                }
                
                // Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ù‡ listeners
                this._notifyListeners({
                    from: fromPath,
                    to: newPath,
                    success,
                    timestamp: Date.now(),
                    userRole: this.userRole
                });
                
                console.log(`ğŸ“ ${success ? 'âœ…' : 'âŒ'} ${fromPath} â†’ ${newPath}`);
                return success;
            }
            
            onRouteChange(callback) {
                this.routeListeners.push(callback);
                return () => {
                    const index = this.routeListeners.indexOf(callback);
                    if (index > -1) this.routeListeners.splice(index, 1);
                };
            }
            
            _notifyListeners(data) {
                this.routeListeners.forEach(listener => {
                    try {
                        listener(data);
                    } catch (error) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± listener:', error);
                    }
                });
            }
            
            setAuth(authenticated, role = 'user') {
                this.isAuthenticated = authenticated;
                this.userRole = role;
                console.log(`ğŸ‘¤ ÙˆØ¶Ø¹ÛŒØª: ${authenticated ? 'Ù„Ø§Ú¯ÛŒÙ†' : 'Ù„Ø§Ú¯â€ŒØ§ÙˆØª'} | Ù†Ù‚Ø´: ${role}`);
            }
            
            goBack() {
                if (this.history.length > 0) {
                    const previous = this.history.pop();
                    return this.navigate(previous, { replace: true });
                }
                return false;
            }
            
            addRoute(path, config) {
                if (this.routes.has(path)) return false;
                
                this.routes.set(path, {
                    name: 'Ù…Ø³ÛŒØ± Ø¬Ø¯ÛŒØ¯',
                    auth: false,
                    roles: ['guest', 'user', 'admin'],
                    ...config
                });
                
                return true;
            }
            
            removeRoute(path) {
                if (['/', '/404', '/login'].includes(path)) return false;
                return this.routes.delete(path);
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ ====================
        const advancedTestsFixed = [
            {
                id: 1,
                title: "Ø³ÛŒØ³ØªÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ (Event Listeners)",
                run: async () => {
                    return new Promise((resolve) => {
                        const router = new AdvancedRouterFixed();
                        let eventReceived = false;
                        
                        const unsubscribe = router.onRouteChange((event) => {
                            if (event.to === '/dashboard' && event.success) {
                                eventReceived = true;
                                unsubscribe();
                                resolve(true);
                            }
                        });
                        
                        router.setAuth(true, 'user');
                        router.navigate('/dashboard');
                        
                        setTimeout(() => resolve(eventReceived), 500);
                    });
                }
            },
            {
                id: 2,
                title: "Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",
                run: async () => {
                    const router = new AdvancedRouterFixed();
                    router.setAuth(true, 'user');
                    
                    // ÛŒÚ© Ù…Ø³ÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø±
                    await router.navigate('/invalid-route');
                    const is404 = router.currentRoute === '/404';
                    
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ù‡ Ù…Ø³ÛŒØ± Ù…Ø¹ØªØ¨Ø±
                    await router.navigate('/dashboard');
                    const recovered = router.currentRoute === '/dashboard';
                    
                    return is404 && recovered;
                }
            },
            {
                id: 3,
                title: "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‡Ù…Ø²Ù…Ø§Ù† (Concurrent Navigation)",
                run: async () => {
                    const router = new AdvancedRouterFixed();
                    router.setAuth(true, 'user');
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ú†Ù†Ø¯ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ø²Ù…Ø§Ù†
                    const promises = [
                        router.navigate('/dashboard'),
                        router.navigate('/lessons'),
                        router.navigate('/profile')
                    ];
                    
                    const results = await Promise.all(promises);
                    
                    // Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· ÛŒÚ© Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯ (Ø§ÙˆÙ„ÛŒÙ†)
                    const successCount = results.filter(r => r).length;
                    const finalRoute = router.currentRoute;
                    
                    console.log(`Ù†ØªØ§ÛŒØ¬: ${results}, Ù…ÙˆÙÙ‚: ${successCount}, Ù…Ø³ÛŒØ± Ù†Ù‡Ø§ÛŒÛŒ: ${finalRoute}`);
                    
                    return successCount === 1 && finalRoute === '/dashboard';
                }
            },
            {
                id: 4,
                title: "ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ Ø­Ø¬Ù… Ø²ÛŒØ§Ø¯",
                run: async () => {
                    const router = new AdvancedRouterFixed();
                    router.setAuth(true, 'user');
                    
                    const startTime = Date.now();
                    
                    // ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ (Ù†Ù‡ Ù‡Ù…Ø²Ù…Ø§Ù†)
                    for (let i = 0; i < 10; i++) {
                        await router.navigate('/dashboard');
                        await router.navigate('/lessons');
                    }
                    
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ performance
                    const isPerformant = duration < 1000;
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ history size
                    const historyValid = router.history.length <= router.maxHistory;
                    
                    return isPerformant && historyValid;
                }
            },
            {
                id: 5,
                title: "Ø­Ø°Ù Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ± Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©",
                run: async () => {
                    const router = new AdvancedRouterFixed();
                    
                    // Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ±
                    const added = router.addRoute('/custom-path', {
                        name: 'Ø³ÙØ§Ø±Ø´ÛŒ',
                        auth: false
                    });
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯
                    const exists = router.routes.has('/custom-path');
                    
                    // Ø­Ø°Ù
                    const removed = router.removeRoute('/custom-path');
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯
                    const notExists = !router.routes.has('/custom-path');
                    
                    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù…Ø³ÛŒØ± Ø³ÛŒØ³ØªÙ…ÛŒ
                    const cannotRemoveSystem = !router.removeRoute('/');
                    
                    return added && exists && removed && notExists && cannotRemoveSystem;
                }
            },
            {
                id: 6,
                title: "ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø§Ø²Ú¯Ø´Øª",
                run: async () => {
                    const router = new AdvancedRouterFixed();
                    router.setAuth(true, 'user');
                    
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ú†Ù†Ø¯ Ù…Ø³ÛŒØ±
                    await router.navigate('/dashboard');
                    await router.navigate('/lessons');
                    await router.navigate('/profile');
                    
                    const historyCount = router.history.length; // Ø¨Ø§ÛŒØ¯ 3 Ø¨Ø§Ø´Ø¯
                    
                    // Ø¨Ø§Ø²Ú¯Ø´Øª
                    const back1 = router.goBack();
                    const route1 = router.currentRoute; // Ø¨Ø§ÛŒØ¯ '/lessons' Ø¨Ø§Ø´Ø¯
                    
                    const back2 = router.goBack();
                    const route2 = router.currentRoute; // Ø¨Ø§ÛŒØ¯ '/dashboard' Ø¨Ø§Ø´Ø¯
                    
                    return historyCount === 3 && 
                           back1 && route1 === '/lessons' &&
                           back2 && route2 === '/dashboard';
                }
            }
        ];

        // ==================== Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ØªØ¹Ø§Ù…Ù„ÛŒ ====================
        let simRouter = null;
        
        function setupSimulation() {
            simRouter = new AdvancedRouterFixed();
            const controls = document.getElementById('sim-controls');
            
            controls.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <button class="sim-btn" onclick="simLogin('user')">ğŸ‘¤ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</button>
                    <button class="sim-btn" onclick="simLogin('admin')">ğŸ‘‘ ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</button>
                    <button class="sim-btn" onclick="simLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
                </div>
                <div>
                    <button class="sim-btn" onclick="simNavigate('/')">ğŸ  Ø®Ø§Ù†Ù‡</button>
                    <button class="sim-btn" onclick="simNavigate('/login')">ğŸ” ÙˆØ±ÙˆØ¯</button>
                    <button class="sim-btn" onclick="simNavigate('/dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
                    <button class="sim-btn" onclick="simNavigate('/lessons')">ğŸ“š Ø¯Ø±ÙˆØ³</button>
                    <button class="sim-btn" onclick="simNavigate('/admin')">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª</button>
                </div>
                <div style="margin-top: 10px;">
                    <button class="sim-btn" onclick="simGoBack()">â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                    <button class="sim-btn" onclick="simAddRoute()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³ÛŒØ±</button>
                </div>
            `;
            
            // listener Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            simRouter.onRouteChange(updateSimulationUI);
            
            updateSimulationUI();
            console.log('âœ… Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ÙØ¹Ø§Ù„ Ø´Ø¯');
        }
        
        async function simLogin(role) {
            if (!simRouter) return;
            simRouter.setAuth(true, role);
            await simNavigate('/dashboard');
        }
        
        function simLogout() {
            if (!simRouter) return;
            simRouter.setAuth(false, 'guest');
            updateSimulationUI();
        }
        
        async function simNavigate(path) {
            if (!simRouter) return;
            await simRouter.navigate(path);
        }
        
        function simGoBack() {
            if (!simRouter) return;
            simRouter.goBack();
        }
        
        function simAddRoute() {
            if (!simRouter) return;
            const path = `/test-${Date.now().toString().slice(-4)}`;
            simRouter.addRoute(path, { name: 'ØªØ³Øª' });
            console.log(`Ù…Ø³ÛŒØ± ${path} Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
        }
        
        function updateSimulationUI() {
            if (!simRouter) return;
            
            document.getElementById('current-route').textContent = simRouter.currentRoute;
            
            const status = simRouter.isAuthenticated 
                ? `âœ… Ù„Ø§Ú¯ÛŒÙ† (${simRouter.userRole})` 
                : 'âŒ Ù…Ù‡Ù…Ø§Ù†';
            document.getElementById('user-status').textContent = status;
        }

        // ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        let passedTests = 0;
        let failedTests = 0;

        async function runAllTests() {
            passedTests = 0;
            failedTests = 0;
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            for (const test of advancedTestsFixed) {
                try {
                    const result = await test.run();
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-section';
                    
                    const testResult = result ? 'pass' : 'fail';
                    const resultText = result ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚';
                    
                    if (result) passedTests++;
                    else failedTests++;
                    
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result ${testResult}">${resultText}</div>
                        </div>
                    `;
                    
                    resultsDiv.appendChild(testDiv);
                    
                } catch (error) {
                    failedTests++;
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-section';
                    testDiv.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${test.id}. ${test.title}</div>
                            <div class="test-result fail">âŒ Ø®Ø·Ø§</div>
                        </div>
                        <div class="details">${error.message}</div>
                    `;
                    resultsDiv.appendChild(testDiv);
                }
                
                updateSummary();
            }
        }

        function clearTests() {
            document.getElementById('test-results').innerHTML = '';
            passedTests = failedTests = 0;
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('summary-text');
            const total = advancedTestsFixed.length;
            const percentage = total > 0 ? Math.round((passedTests / total) * 100) : 0;
            
            summary.textContent = 
                `âœ… ${passedTests} Ù…ÙˆÙÙ‚ | âŒ ${failedTests} Ù†Ø§Ù…ÙˆÙÙ‚ | ğŸ“Š ${percentage}% Ù‚Ø¨ÙˆÙ„ÛŒ`;
            
            summary.style.color = percentage === 100 ? '#4caf50' : 
                                 percentage >= 80 ? '#ff9800' : '#f44336';
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
        window.onload = () => {
            updateSummary();
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>
