<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡ - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 15px; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        button { background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 5px; width: calc(50% - 10px); }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .state-box { background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; margin-top: 15px; }
        .success { background: #27ae60; color: white; padding: 10px; border-radius: 6px; }
        .warning { background: #f39c12; color: white; padding: 10px; border-radius: 6px; }
        input, select { padding: 10px; margin: 5px 0; width: 100%; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”„ ØªØ³Øª Ø¯Ø³ØªÛŒ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡ (Rotation)</h1>
        <h2>Ø¨Ø±Ø±Ø³ÛŒ Ø­ÙØ¸ State Ø¯Ø± ØªØºÛŒÛŒØ± Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ</h2>
    </div>

    <div class="card">
        <h3>ğŸ“ ÙØ±Ù… ÙˆØ±ÙˆØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h3>
        <input type="text" id="nameInput" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" value="Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ">
        <input type="number" id="scoreInput" placeholder="Ø§Ù…ØªÛŒØ§Ø²" value="1250">
        <select id="levelSelect">
            <option value="1">Ù…Ø¨ØªØ¯ÛŒ Û±</option>
            <option value="2" selected>Ù…Ø¨ØªØ¯ÛŒ Û²</option>
            <option value="3">Ù…ØªÙˆØ³Ø· Û±</option>
            <option value="4">Ù…ØªÙˆØ³Ø· Û²</option>
        </select>
        
        <div class="btn-group">
            <button onclick="saveState()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ State</button>
            <button onclick="loadState()">ğŸ“‚ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ State</button>
            <button onclick="simulateRotation()">ğŸ”„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´</button>
            <button onclick="clearState()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ (Current State)</h3>
        <div id="currentState" class="state-box">
            Ù†Ø§Ù…: Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ | Ø§Ù…ØªÛŒØ§Ø²: Û±Û²ÛµÛ° | Ø³Ø·Ø­: Ù…Ø¨ØªØ¯ÛŒ Û²
        </div>
    </div>

    <div class="card">
        <h3>ğŸ§ª Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</h3>
        
        <div style="margin-bottom: 20px; padding: 10px; background: #e8f4f8; border-radius: 8px;">
            <h4>âœ… ØªØ³Øª Û±: Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø³ØªÛŒ</h4>
            <p>Û±. Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯</p>
            <p>Û². Ø¯Ú©Ù…Ù‡ "Ø°Ø®ÛŒØ±Ù‡ State" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
            <p>Û³. ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯ (F5)</p>
            <p>Û´. Ø¯Ú©Ù…Ù‡ "Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ State" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
            <button onclick="manualTest1()">ğŸ“‹ Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª Û±</button>
        </div>

        <div style="margin-bottom: 20px; padding: 10px; background: #e8f4f8; border-radius: 8px;">
            <h4>âœ… ØªØ³Øª Û²: Ú†Ø±Ø®Ø´ ÙˆØ§Ù‚Ø¹ÛŒ ØµÙØ­Ù‡</h4>
            <p>Û±. Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯</p>
            <p>Û². Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ú†Ø±Ø®Ø§Ù†ÛŒØ¯ (Portrait â†” Landscape)</p>
            <p>Û³. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­ÙØ¸ Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
            <button onclick="manualTest2()">ğŸ“‹ Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª Û²</button>
        </div>

        <div style="margin-bottom: 20px; padding: 10px; background: #e8f4f8; border-radius: 8px;">
            <h4>âœ… ØªØ³Øª Û³: Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´</h4>
            <p>Û±. Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯</p>
            <p>Û². Ø¯Ú©Ù…Ù‡ "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
            <p>Û³. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² SessionStorage Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯</p>
            <button onclick="manualTest3()">ğŸ“‹ Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª Û³</button>
        </div>

        <div style="margin-bottom: 20px; padding: 10px; background: #e8f4f8; border-radius: 8px;">
            <h4>âœ… ØªØ³Øª Û´: Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø³ Ø§Ø² Ú©Ø±Ø´ ÙØ±Ø¶ÛŒ</h4>
            <p>Û±. Ø¯Ú©Ù…Ù‡ "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
            <p>Û². ØµÙØ­Ù‡ Ø±ÙØ±Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
            <p>Û³. Ø¯Ú©Ù…Ù‡ "Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
            <button onclick="simulateCrash()">ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´</button>
            <button onclick="autoRecovery()">ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</button>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
        <div id="testLog" style="background: #2c3e50; color: #fff; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
            <p>â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...</p>
        </div>
        <button onclick="exportLog()" style="background: #27ae60; margin-top: 10px;">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´</button>
    </div>

    <script>
        // ---------- Ù…Ø¯ÛŒØ±ÛŒØª State Ø¨Ø§ SessionStorage ----------
        const STATE_KEY = 'farsinglish_rotation_test';
        
        // Ø°Ø®ÛŒØ±Ù‡ state
        function saveState() {
            const state = {
                name: document.getElementById('nameInput').value,
                score: document.getElementById('scoreInput').value,
                level: document.getElementById('levelSelect').value,
                levelText: document.getElementById('levelSelect').selectedOptions[0].text,
                timestamp: new Date().toLocaleString('fa-IR'),
                version: '1.0'
            };
            
            sessionStorage.setItem(STATE_KEY, JSON.stringify(state));
            localStorage.setItem(STATE_KEY + '_backup', JSON.stringify(state));
            updateCurrentState(state);
            addLog('âœ… State Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
            return state;
        }

        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ state
        function loadState() {
            let saved = sessionStorage.getItem(STATE_KEY);
            if (!saved) {
                saved = localStorage.getItem(STATE_KEY + '_backup');
                addLog('âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² localStorage (Ù¾Ø´ØªÛŒØ¨Ø§Ù†)', 'warning');
            }
            
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    document.getElementById('nameInput').value = state.name || '';
                    document.getElementById('scoreInput').value = state.score || 0;
                    document.getElementById('levelSelect').value = state.level || '2';
                    
                    updateCurrentState(state);
                    addLog('âœ… State Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯', 'success');
                    return state;
                } catch(e) {
                    addLog('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ State: ' + e.message, 'error');
                }
            } else {
                addLog('âŒ Ù‡ÛŒÚ† State Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ state
        function updateCurrentState(state) {
            const el = document.getElementById('currentState');
            if (state) {
                el.innerHTML = `
                    <strong>ğŸ‘¤ Ù†Ø§Ù…:</strong> ${state.name || '---'}<br>
                    <strong>â­ Ø§Ù…ØªÛŒØ§Ø²:</strong> ${state.score || 'Û°'}<br>
                    <strong>ğŸ“Š Ø³Ø·Ø­:</strong> ${state.levelText || '---'}<br>
                    <strong>â° Ø¢Ø®Ø±ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡:</strong> ${state.timestamp || '---'}<br>
                    <strong>ğŸ”– Ù†Ø³Ø®Ù‡:</strong> ${state.version || '1.0'}
                `;
            }
        }

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡
        function simulateRotation() {
            addLog('ğŸ”„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡...', 'info');
            const savedState = saveState();
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ®Ø±ÛŒØ¨ Ùˆ Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ
            setTimeout(() => {
                const recovered = loadState();
                if (recovered) {
                    addLog('âœ… Ú†Ø±Ø®Ø´ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒâ€ŒØ´Ø¯Ù‡: State Ø³Ø§Ù„Ù… Ù…Ø§Ù†Ø¯', 'success');
                } else {
                    addLog('âŒ Ú†Ø±Ø®Ø´ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒâ€ŒØ´Ø¯Ù‡: State Ø§Ø² Ø¯Ø³Øª Ø±ÙØª', 'error');
                }
            }, 100);
        }

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´
        function simulateCrash() {
            addLog('ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´ Ø¨Ø±Ù†Ø§Ù…Ù‡...', 'warning');
            saveState();
            setTimeout(() => {
                if (confirm('ØµÙØ­Ù‡ Ø±ÙØ±Ø´ Ø´ÙˆØ¯ØŸ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø´)')) {
                    location.reload();
                }
            }, 500);
        }

        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
        function autoRecovery() {
            addLog('ğŸ”„ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±...', 'info');
            loadState();
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† state
        function clearState() {
            sessionStorage.removeItem(STATE_KEY);
            localStorage.removeItem(STATE_KEY + '_backup');
            document.getElementById('nameInput').value = '';
            document.getElementById('scoreInput').value = '';
            document.getElementById('levelSelect').value = '2';
            updateCurrentState({
                name: '---',
                score: 'Û°',
                levelText: '---',
                timestamp: '---',
                version: '1.0'
            });
            addLog('ğŸ—‘ï¸ State Ù¾Ø§Ú© Ø´Ø¯', 'info');
        }

        // ---------- Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ ----------
        const logEntries = [];

        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString('fa-IR');
            const entry = { time, message, type };
            logEntries.push(entry);
            
            const logEl = document.getElementById('testLog');
            const color = {
                success: '#27ae60',
                error: '#e74c3c',
                warning: '#f39c12',
                info: '#3498db'
            }[type] || '#fff';
            
            logEl.innerHTML += `<p style="color: ${color}; margin: 3px 0;">â±ï¸ ${time} - ${message}</p>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        // ---------- ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ ----------
        function manualTest1() {
            addLog('ğŸ§ª ØªØ³Øª Û±: Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø³ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
            saveState();
        }

        function manualTest2() {
            addLog('ğŸ§ª ØªØ³Øª Û²: Ú†Ø±Ø®Ø´ ÙˆØ§Ù‚Ø¹ÛŒ - Ù„Ø·ÙØ§Ù‹ Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ú†Ø±Ø®Ø§Ù†ÛŒØ¯', 'info');
            saveState();
        }

        function manualTest3() {
            addLog('ğŸ§ª ØªØ³Øª Û³: Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´', 'info');
            simulateRotation();
        }

        // Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´
        function exportLog() {
            let report = 'ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ ØªØ³Øª Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡ - Farsinglish\n';
            report += '====================================\n';
            report += `ğŸ“… ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')}\n`;
            report += `â° Ø²Ù…Ø§Ù†: ${new Date().toLocaleTimeString('fa-IR')}\n`;
            report += '====================================\n\n';
            
            logEntries.forEach(entry => {
                report += `[${entry.time}] ${entry.message}\n`;
            });
            
            report += '\nâœ… Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ:\n';
            const success = logEntries.filter(e => e.type === 'success').length;
            const error = logEntries.filter(e => e.type === 'error').length;
            report += `Ù…ÙˆÙÙ‚: ${success} | Ø®Ø·Ø§: ${error} | Ú©Ù„: ${logEntries.length}\n`;
            
            alert(report);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ Ù…ØªÙ†ÛŒ
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rotation_test_${Date.now()}.txt`;
            a.click();
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        window.onload = function() {
            addLog('âœ… ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ State Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡', 'info');
            const saved = sessionStorage.getItem(STATE_KEY);
            if (saved) {
                addLog('â„¹ï¸ State Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ ÛŒØ§ÙØª Ø´Ø¯', 'info');
                if (confirm('State Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ ÛŒØ§ÙØª Ø´Ø¯. Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´ÙˆØ¯ØŸ')) {
                    loadState();
                }
            }
        };

        // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
        window.onbeforeunload = function() {
            const state = {
                name: document.getElementById('nameInput').value,
                score: document.getElementById('scoreInput').value,
                level: document.getElementById('levelSelect').value,
                levelText: document.getElementById('levelSelect').selectedOptions[0].text,
                timestamp: new Date().toLocaleString('fa-IR'),
                version: '1.0'
            };
            sessionStorage.setItem(STATE_KEY, JSON.stringify(state));
        };
    </script>
</body>
</html>
