<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª User Model (Ù¾ÛŒØ´Ø±ÙØªÙ‡) - Farsinglish</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 18px;
            background: var(--light);
            border-bottom: 3px solid #e2e8f0;
        }
        
        .stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 8px;
        }
        
        .achievement-preview {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            padding: 20px;
            margin: 20px;
            border-radius: 12px;
            border: 3px solid #e9d5ff;
        }
        
        .preview-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .achievement-badge {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .achievement-badge.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #f5f3ff, #ede9fe);
        }
        
        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .test-area {
            padding: 20px;
        }
        
        .test-group {
            margin-bottom: 25px;
        }
        
        .group-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .test-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s;
            position: relative;
        }
        
        .test-card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.1);
        }
        
        .test-card.passed {
            border-color: var(--success);
            background: linear-gradient(to right, #f0fdf4, #ffffff);
        }
        
        .test-card.failed {
            border-color: var(--danger);
            background: linear-gradient(to right, #fef2f2, #ffffff);
        }
        
        .test-card.running {
            border-color: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { border-color: #f59e0b; }
            50% { border-color: #fbbf24; }
            100% { border-color: #f59e0b; }
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .test-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .test-desc {
            color: #64748b;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .test-details {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #475569;
            border-right: 4px solid var(--primary);
            display: none;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: var(--light);
            border-top: 3px solid #e2e8f0;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-run {
            background: linear-gradient(to right, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .btn-run:hover {
            background: linear-gradient(to right, #7c3aed, #6d28d9);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }
        
        .btn-reset {
            background: linear-gradient(to right, #64748b, #94a3b8);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(to right, #475569, #64748b);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(100, 116, 139, 0.3);
        }
        
        .console {
            background: #1e293b;
            color: white;
            padding: 20px;
            margin: 0 20px 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #334155;
        }
        
        .console-header {
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .console-line {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
            line-height: 1.4;
        }
        
        .log-success { color: #34d399; }
        .log-error { color: #f87171; }
        .log-info { color: #60a5fa; }
        .log-warning { color: #fbbf24; }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
        }
        
        @media (max-width: 768px) {
            .tests-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ØªØ³Øª User Model (Ù¾ÛŒØ´Ø±ÙØªÙ‡)</h1>
            <p>ÙØ§ÛŒÙ„ Û² Ø§Ø² Û² | ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ XPØŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ</p>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalTests">5</div>
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
        </div>
        
        <div class="achievement-preview">
            <div class="preview-title">ğŸ† Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡</div>
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
        
        <div class="test-area">
            <div class="test-group">
                <div class="group-title">âš¡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ User Model</div>
                <div class="tests-grid" id="advancedTests">
                    <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
            </div>
        </div>
        
        <div class="console">
            <div class="console-header">ğŸ“ Ú©Ù†Ø³ÙˆÙ„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</div>
            <div id="consoleOutput"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-run" id="runTests">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ Ûµ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡
            </button>
            <button class="btn btn-reset" id="resetTests">
                <span>ğŸ”„</span>
                Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
            </button>
        </div>
        
        <div class="footer">
            ÙØ§ÛŒÙ„ Û² Ø§Ø² Û² | ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ User Model | Farsinglish
        </div>
    </div>

    <script>
        // ==================== User Model Ú©Ø§Ù…Ù„ ====================
        class UserModel {
            constructor(data = {}) {
                this.id = data.id || 'user_' + Date.now();
                this.username = data.username || '';
                this.email = data.email || '';
                this.experiencePoints = data.experiencePoints || 0;
                this.level = data.level || 1;
                this.streak = data.streak || 0;
                this.lastActiveDate = data.lastActiveDate || null;
                this.lessonsCompleted = data.lessonsCompleted || 0;
                this.totalStudyTime = data.totalStudyTime || 0;
                this.totalExercises = data.totalExercises || 0;
                this.correctAnswers = data.correctAnswers || 0;
                this.achievements = data.achievements || [];
                this.badges = data.badges || [];
                this.settings = data.settings || {
                    dailyGoal: 30,
                    notifications: true,
                    theme: 'light'
                };
            }

            static getRequiredXP(level) {
                return Math.floor(100 * Math.pow(level, 1.5));
            }

            addXP(amount) {
                if (amount <= 0) return false;

                const oldLevel = this.level;
                this.experiencePoints += amount;

                while (this.experiencePoints >= UserModel.getRequiredXP(this.level)) {
                    this.experiencePoints -= UserModel.getRequiredXP(this.level);
                    this.level++;
                }

                const leveledUp = this.level > oldLevel;
                this.updateDailyStreak();

                return {
                    oldLevel,
                    newLevel: this.level,
                    leveledUp,
                    currentXP: this.experiencePoints,
                    requiredXP: UserModel.getRequiredXP(this.level),
                    xpAdded: amount
                };
            }

            updateDailyStreak() {
                const today = new Date().toDateString();
                const lastActive = this.lastActiveDate ? new Date(this.lastActiveDate).toDateString() : null;

                if (!lastActive) {
                    this.streak = 1;
                } else if (lastActive === today) {
                    // Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù…Ø±ÙˆØ² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡
                } else {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastActive === yesterday.toDateString()) {
                        this.streak++;
                    } else {
                        this.streak = 1;
                    }
                }

                this.lastActiveDate = new Date().toISOString();
                return this.streak;
            }

            completeLesson(lessonDuration, exerciseCount, correctAnswers) {
                this.lessonsCompleted++;
                this.totalStudyTime += lessonDuration;
                this.totalExercises += exerciseCount;
                this.correctAnswers += correctAnswers;

                const accuracy = exerciseCount > 0 ? correctAnswers / exerciseCount : 0;
                const baseXP = 50;
                const durationBonus = Math.min(lessonDuration / 5, 20);
                const accuracyBonus = Math.floor(accuracy * 30);
                const streakBonus = this.streak * 2;

                const totalXP = baseXP + durationBonus + accuracyBonus + streakBonus;

                const xpResult = this.addXP(Math.floor(totalXP));
                this.checkAchievements();

                return {
                    ...xpResult,
                    lessonStats: {
                        accuracy: Math.round(accuracy * 100),
                        duration: lessonDuration,
                        totalExercises: exerciseCount,
                        correctAnswers: correctAnswers
                    }
                };
            }

            checkAchievements() {
                const newAchievements = [];
                
                if (this.level >= 5 && !this.achievements.includes('level_5')) {
                    newAchievements.push('level_5');
                    this.achievements.push('level_5');
                }
                if (this.level >= 10 && !this.achievements.includes('level_10')) {
                    newAchievements.push('level_10');
                    this.achievements.push('level_10');
                }

                if (this.lessonsCompleted >= 10 && !this.achievements.includes('lessons_10')) {
                    newAchievements.push('lessons_10');
                    this.achievements.push('lessons_10');
                }
                if (this.lessonsCompleted >= 50 && !this.achievements.includes('lessons_50')) {
                    newAchievements.push('lessons_50');
                    this.achievements.push('lessons_50');
                }

                if (this.streak >= 7 && !this.achievements.includes('streak_7')) {
                    newAchievements.push('streak_7');
                    this.achievements.push('streak_7');
                }
                if (this.streak >= 30 && !this.achievements.includes('streak_30')) {
                    newAchievements.push('streak_30');
                    this.achievements.push('streak_30');
                }

                return newAchievements;
            }

            getAccuracyRate() {
                if (this.totalExercises === 0) return 0;
                return Math.round((this.correctAnswers / this.totalExercises) * 100);
            }

            getLevelInfo() {
                const currentXP = this.experiencePoints;
                const requiredXP = UserModel.getRequiredXP(this.level);
                const progress = (currentXP / requiredXP) * 100;

                return {
                    level: this.level,
                    currentXP,
                    requiredXP,
                    progress: Math.round(progress),
                    xpForNextLevel: requiredXP - currentXP
                };
            }

            calculateTotalXP() {
                let total = this.experiencePoints;
                for (let i = 1; i < this.level; i++) {
                    total += UserModel.getRequiredXP(i);
                }
                return total;
            }

            validate() {
                const errors = [];

                if (!this.username || this.username.length < 3) {
                    errors.push('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                }

                if (this.email && !this.isValidEmail(this.email)) {
                    errors.push('Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }

                if (this.level < 1) {
                    errors.push('Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø¨Ø§Ø´Ø¯');
                }

                return {
                    isValid: errors.length === 0,
                    errors
                };
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡: Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ ÙˆØ§Ù‚Ø¹ÛŒ
            clone() {
                return new UserModel({
                    id: this.id,
                    username: this.username,
                    email: this.email,
                    experiencePoints: this.experiencePoints,
                    level: this.level,
                    streak: this.streak,
                    lastActiveDate: this.lastActiveDate,
                    lessonsCompleted: this.lessonsCompleted,
                    totalStudyTime: this.totalStudyTime,
                    totalExercises: this.totalExercises,
                    correctAnswers: this.correctAnswers,
                    achievements: [...this.achievements],
                    badges: [...this.badges],
                    settings: { ...this.settings }
                });
            }

            toJSON() {
                return {
                    id: this.id,
                    username: this.username,
                    level: this.level,
                    experiencePoints: this.experiencePoints,
                    streak: this.streak,
                    lessonsCompleted: this.lessonsCompleted,
                    accuracyRate: this.getAccuracyRate(),
                    achievements: this.achievements
                };
            }
        }

        // ==================== Ûµ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ ====================
        const advancedTests = [
            {
                id: 'test6',
                title: 'Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ø·Ø­ Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªÙˆØ§Ù„ÛŒ',
                run: function() {
                    const user = new UserModel();
                    
                    let totalXP = 0;
                    let levelUps = 0;
                    
                    for (let i = 1; i <= 3; i++) {
                        const xpNeeded = UserModel.getRequiredXP(i);
                        const result = user.addXP(xpNeeded);
                        totalXP += xpNeeded;
                        if (result.leveledUp) levelUps++;
                    }

                    const levelInfo = user.getLevelInfo();

                    return {
                        passed: user.level === 4 && 
                                levelUps === 3 &&
                                user.experiencePoints === 0,
                        message: user.level === 4 ? 
                                'âœ… Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ÛŒ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªÙ‚Ø§ Ú†Ù†Ø¯ Ø³Ø·Ø­ÛŒ',
                        details: {
                            finalLevel: user.level,
                            levelUps: levelUps,
                            currentXP: user.experiencePoints,
                            progress: levelInfo.progress + '%'
                        }
                    };
                }
            },
            {
                id: 'test7',
                title: 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø³Ø¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§',
                run: function() {
                    const user = new UserModel();
                    
                    // Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Ø³Ø·Ø­ 5
                    for (let i = 1; i <= 5; i++) {
                        user.addXP(UserModel.getRequiredXP(i));
                    }
                    
                    // ØªÚ©Ù…ÛŒÙ„ 10 Ø¯Ø±Ø³
                    for (let i = 0; i < 10; i++) {
                        user.completeLesson(15, 5, 4);
                    }

                    const hasLevelAchievement = user.achievements.includes('level_5');
                    const hasLessonsAchievement = user.achievements.includes('lessons_10');
                    const achievementCount = user.achievements.length;

                    return {
                        passed: hasLevelAchievement && 
                                hasLessonsAchievement &&
                                achievementCount >= 2,
                        message: hasLevelAchievement ? 
                                'âœ… Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø³Ø¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ø³Ø¨ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§',
                        details: {
                            achievements: user.achievements.join(', ') || 'Ù‡ÛŒÚ†',
                            achievementCount: achievementCount,
                            hasLevel5: hasLevelAchievement,
                            hasLessons10: hasLessonsAchievement
                        }
                    };
                }
            },
            {
                id: 'test8',
                title: 'Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØµØ­ÛŒØ­ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±',
                run: function() {
                    const validUser = new UserModel({
                        username: 'validuser123',
                        email: 'valid@example.com'
                    });

                    const invalidUser = new UserModel({
                        username: 'ab',
                        email: 'invalid-email'
                    });

                    const validResult = validUser.validate();
                    const invalidResult = invalidUser.validate();

                    return {
                        passed: validResult.isValid === true &&
                                invalidResult.isValid === false,
                        message: validResult.isValid ? 
                                'âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ',
                        details: {
                            validUser: validResult.isValid,
                            invalidUserErrors: invalidResult.errors.length,
                            sampleError: invalidResult.errors[0] || 'Ù‡ÛŒÚ†'
                        }
                    };
                }
            },
            {
                id: 'test9',
                title: 'Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¹Ù…ÛŒÙ‚',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø¨Ø± Ø´ÛŒØ¡ Ø§ØµÙ„ÛŒ',
                run: function() {
                    const original = new UserModel({
                        username: 'original',
                        level: 5,
                        experiencePoints: 150,
                        achievements: ['achievement1']
                    });

                    const clone = original.clone();
                    
                    // ØªØºÛŒÛŒØ± Ú©Ù„ÙˆÙ†
                    clone.username = 'cloned';
                    clone.addXP(100);
                    clone.achievements.push('new_achievement');

                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… ØªØ£Ø«ÛŒØ± Ø¨Ø± Ø§ØµÙ„ÛŒ
                    const originalUntouched = original.username === 'original' &&
                                             original.level === 5 &&
                                             original.experiencePoints === 150 &&
                                             original.achievements.length === 1;

                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ú©Ù„ÙˆÙ†
                    const cloneChanged = clone.username === 'cloned' &&
                                        clone.level > 5 &&
                                        clone.achievements.length === 2;

                    return {
                        passed: originalUntouched && cloneChanged,
                        message: originalUntouched ? 
                                'âœ… Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯' : 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„ÙˆÙ† Ø¹Ù…ÛŒÙ‚',
                        details: {
                            originalUsername: original.username,
                            cloneUsername: clone.username,
                            originalLevel: original.level,
                            cloneLevel: clone.level,
                            originalAchievements: original.achievements.length,
                            cloneAchievements: clone.achievements.length
                        }
                    };
                }
            },
            {
                id: 'test10',
                title: 'ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø³ÛŒØ³ØªÙ…',
                desc: 'Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ ØªÙ…Ø§Ù… ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§',
                run: function() {
                    const user = new UserModel({
                        username: 'integration_test'
                    });

                    user.addXP(75);
                    user.updateDailyStreak();
                    const lessonResult = user.completeLesson(45, 15, 12);
                    
                    const levelInfo = user.getLevelInfo();
                    const accuracy = user.getAccuracyRate();
                    
                    user.checkAchievements();
                    const json = user.toJSON();

                    const allPassed = user.level > 1 &&
                                    user.lessonsCompleted === 1 &&
                                    user.totalStudyTime === 45 &&
                                    accuracy === 80 &&
                                    json.level !== undefined;

                    return {
                        passed: allPassed,
                        message: allPassed ? 
                                'âœ… Ø³ÛŒØ³ØªÙ… User Model Ú©Ø§Ù…Ù„Ø§Ù‹ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø§Ø³Øª' : 
                                'âŒ Ù…Ø´Ú©Ù„ Ø¯Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø³ÛŒØ³ØªÙ…',
                        details: {
                            level: user.level,
                            lessonsCompleted: user.lessonsCompleted,
                            studyTime: user.totalStudyTime,
                            accuracy: accuracy + '%',
                            achievements: user.achievements.length
                        }
                    };
                }
            }
        ];

        // Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
        const achievementTemplates = [
            { id: 'level_5', name: 'Ø³Ø·Ø­ Ûµ', icon: 'â­' },
            { id: 'level_10', name: 'Ø³Ø·Ø­ Û±Û°', icon: 'ğŸŒŸ' },
            { id: 'lessons_10', name: 'Û±Û° Ø¯Ø±Ø³', icon: 'ğŸ“š' },
            { id: 'streak_7', name: 'Û· Ø±ÙˆØ² Ù…ØªÙˆØ§Ù„ÛŒ', icon: 'ğŸ”¥' },
            { id: 'accuracy_90', name: 'Ø¯Ù‚Øª Û¹Û°Ùª', icon: 'ğŸ¯' }
        ];

        // ==================== Test Runner ====================
        class AdvancedUserModelTestRunner {
            constructor() {
                this.tests = advancedTests;
                this.totalTests = this.tests.length;
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                this.initializeUI();
            }

            initializeUI() {
                // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§
                const achievementsGrid = document.getElementById('achievementsGrid');
                achievementTemplates.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'achievement-badge';
                    badge.id = `achievement-${achievement.id}`;
                    badge.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    `;
                    achievementsGrid.appendChild(badge);
                });

                // Ø§ÛŒØ¬Ø§Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§
                const container = document.getElementById('advancedTests');
                this.tests.forEach((test, index) => {
                    const testEl = document.createElement('div');
                    testEl.className = 'test-card';
                    testEl.id = `test-${test.id}`;
                    testEl.innerHTML = `
                        <div class="test-header">
                            <div class="test-title">${index + 1}. ${test.title}</div>
                            <div class="test-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                        </div>
                        <div class="test-desc">${test.desc}</div>
                        <div class="test-details" id="details-${test.id}"></div>
                    `;
                    container.appendChild(testEl);
                });

                document.getElementById('runTests').addEventListener('click', () => this.runAllTests());
                document.getElementById('resetTests').addEventListener('click', () => this.resetTests());
            }

            async runAllTests() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.resetTests();
                
                this.log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ User Model...', 'info');
                this.log('Ûµ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡: Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ØŒ Ú©Ù„ÙˆÙ†ØŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ', 'info');
                
                for (let i = 0; i < this.tests.length; i++) {
                    const test = this.tests[i];
                    await this.runSingleTest(test);
                    await this.delay(400);
                    this.updateAchievements(i + 1);
                }
                
                const successRate = Math.round((this.passed / this.totalTests) * 100);
                this.log(`ğŸ‰ ${this.passed}/${this.totalTests} ØªØ³Øª Ù…ÙˆÙÙ‚ (${successRate}%)`, 'success');
                this.isRunning = false;
                
                if (this.passed === this.totalTests) {
                    this.log('âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ User Model Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø±Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù†Ø¯!', 'success');
                }
            }

            async runSingleTest(test) {
                const testEl = document.getElementById(`test-${test.id}`);
                const statusEl = testEl.querySelector('.test-status');
                const detailsEl = document.getElementById(`details-${test.id}`);
                
                testEl.classList.add('running');
                statusEl.className = 'test-status status-pending';
                statusEl.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                try {
                    const result = test.run();
                    
                    testEl.classList.remove('running');
                    if (result.passed) {
                        this.passed++;
                        testEl.classList.add('passed');
                        statusEl.className = 'test-status status-pass';
                        statusEl.textContent = 'Ù…ÙˆÙÙ‚';
                        this.log(`âœ… ${test.title}: ${result.message}`, 'success');
                    } else {
                        this.failed++;
                        testEl.classList.add('failed');
                        statusEl.className = 'test-status status-fail';
                        statusEl.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                        this.log(`âŒ ${test.title}: ${result.message}`, 'error');
                    }
                    
                    if (result.details) {
                        detailsEl.style.display = 'block';
                        let detailsText = '';
                        for (const [key, value] of Object.entries(result.details)) {
                            detailsText += `${key}: ${value}\n`;
                        }
                        detailsEl.textContent = detailsText;
                    }
                    
                } catch (error) {
                    testEl.classList.remove('running');
                    this.failed++;
                    testEl.classList.add('failed');
                    statusEl.className = 'test-status status-fail';
                    statusEl.textContent = 'Ø®Ø·Ø§';
                    this.log(`ğŸ’¥ ${test.title}: ${error.message}`, 'error');
                }
                
                this.updateStats();
            }

            updateAchievements(testNumber) {
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù¾ÛŒØ´Ø±ÙØª ØªØ³Øªâ€ŒÙ‡Ø§
                const achievementsToActivate = Math.min(5, Math.floor(testNumber));
                
                achievementTemplates.slice(0, achievementsToActivate).forEach((achievement, index) => {
                    const badge = document.getElementById(`achievement-${achievement.id}`);
                    if (badge) {
                        setTimeout(() => {
                            badge.classList.add('active');
                        }, index * 200);
                    }
                });
            }

            updateStats() {
                document.getElementById('passedTests').textContent = this.passed;
                document.getElementById('failedTests').textContent = this.failed;
                const rate = Math.round((this.passed / this.totalTests) * 100);
                document.getElementById('successRate').textContent = `${rate}%`;
                
                const rateEl = document.getElementById('successRate').parentElement;
                if (rate >= 80) {
                    rateEl.style.background = '#d1fae5';
                    rateEl.style.color = '#065f46';
                } else if (rate >= 60) {
                    rateEl.style.background = '#fef3c7';
                    rateEl.style.color = '#92400e';
                } else {
                    rateEl.style.background = '#fee2e2';
                    rateEl.style.color = '#991b1b';
                }
            }

            log(message, type = 'info') {
                const consoleEl = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `console-line log-${type}`;
                
                const time = new Date().toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                line.textContent = `[${time}] ${message}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }

            resetTests() {
                this.passed = 0;
                this.failed = 0;
                this.isRunning = false;
                
                this.tests.forEach(test => {
                    const testEl = document.getElementById(`test-${test.id}`);
                    const statusEl = testEl.querySelector('.test-status');
                    const detailsEl = document.getElementById(`details-${test.id}`);
                    
                    testEl.className = 'test-card';
                    statusEl.className = 'test-status status-pending';
                    statusEl.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                    detailsEl.style.display = 'none';
                    detailsEl.textContent = '';
                });

                achievementTemplates.forEach(achievement => {
                    const badge = document.getElementById(`achievement-${achievement.id}`);
                    if (badge) badge.classList.remove('active');
                });
                
                document.getElementById('consoleOutput').innerHTML = '';
                this.updateStats();
                this.log('ğŸ”„ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ ====================
        document.addEventListener('DOMContentLoaded', () => {
            const runner = new AdvancedUserModelTestRunner();
            runner.log('ğŸ”§ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ User Model Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§', 'info');
            runner.log('Ù¾Ø³ Ø§Ø² Ù…ÙˆÙÙ‚ÛŒØª ÙØ§ÛŒÙ„ Û±ØŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÙˆÙ† Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯', 'info');
            runner.log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ Ûµ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯', 'info');
        });
    </script>
</body>
</html>
