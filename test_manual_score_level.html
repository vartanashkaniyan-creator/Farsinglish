<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø³Ø·Ø­ | Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; font-family: 'Tahoma', 'Vazir', sans-serif; }
        body { background: #f0f2f5; padding: 20px; max-width: 800px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 25px; border-radius: 20px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .card { background: white; border-radius: 18px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #dee2e6; transition: 0.2s; }
        .card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
        h2 { font-size: 1.4rem; color: #2c3e50; margin-bottom: 15px; border-right: 6px solid #3498db; padding-right: 15px; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 12px; margin: 20px 0; justify-content: center; }
        button { background: #3498db; border: none; color: white; padding: 14px 25px; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 3px 6px rgba(52,152,219,0.3); flex: 1 1 auto; min-width: 180px; border: 1px solid #2980b9; }
        button:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 7px 12px rgba(0,0,0,0.2); }
        button.reset { background: #95a5a6; border-color: #7f8c8d; box-shadow: none; }
        button.reset:hover { background: #7f8c8d; }
        .result-box { background: #f8fafc; border: 2px dashed #3498db; border-radius: 28px; padding: 20px; margin-top: 25px; font-size: 1.1rem; line-height: 2; }
        .badge { display: inline-block; background: #2ecc71; color: white; padding: 6px 14px; border-radius: 40px; font-size: 0.9rem; margin: 5px; }
        .level-up { background: #f1c40f; color: #2c3e50; font-weight: bold; padding: 12px; border-radius: 30px; text-align: center; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.9; } 50% { opacity: 1; background: #f39c12; } 100% { opacity: 0.9; } }
        hr { border: 1px solid #ddd; margin: 25px 0; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th { background: #34495e; color: white; padding: 12px; font-weight: 500; }
        td { padding: 12px; border-bottom: 1px solid #ecf0f1; text-align: center; }
        .highlight { background: #fff9e6; font-weight: bold; color: #e67e22; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§® ØªØ³Øª Ø¯Ø³ØªÛŒ Ø§Ù…ØªÛŒØ§Ø² (XP) Ùˆ Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ</h1>
        <p>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ´Ø±ÙØªØŒ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­ØŒ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø·Ø­</p>
    </div>

    <div class="card">
        <h2>ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</h2>
        <div id="userDisplay" style="background: #ecf0f1; padding: 15px; border-radius: 20px;">
            <!-- Ù¾Ø± via JS -->
        </div>
        <div class="btn-group">
            <button onclick="addXP(10)">â• +Û±Û° XP</button>
            <button onclick="addXP(25)">â• +Û²Ûµ XP</button>
            <button onclick="addXP(50)">â• +ÛµÛ° XP</button>
            <button onclick="addXP(100)">â• +Û±Û°Û° XP</button>
            <button onclick="completeLesson()">ğŸ“˜ ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ (Û´Û° XP)</button>
            <button onclick="perfectLesson()">ğŸŒŸ Ø¯Ø±Ø³ Ø¹Ø§Ù„ÛŒ (Û¸Û° XP)</button>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ“Š ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ</h2>
        <div class="btn-group">
            <button onclick="testInitialState()">Û±. Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡</button>
            <button onclick="testLevelOne()">Û². Ø³Ø·Ø­ Û± (0â†’99 XP)</button>
            <button onclick="testLevelTwo()">Û³. Ø³Ø·Ø­ Û² (100â†’249 XP)</button>
            <button onclick="testLevelThree()">Û´. Ø³Ø·Ø­ Û³ (250â†’449 XP)</button>
            <button onclick="testLevelFour()">Ûµ. Ø³Ø·Ø­ Û´ (450â†’699 XP)</button>
            <button onclick="testLevelFive()">Û¶. Ø³Ø·Ø­ Ûµ (700+ XP)</button>
            <button onclick="testLevelProgression()">Û·. Ù¾ÛŒØ´Ø±ÙØª Ø³Ø·Ø­ â†’ Ø³Ø·Ø­</button>
            <button onclick="testExactBoundary()">Û¸. Ù…Ø±Ø²Ù‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚</button>
            <button onclick="resetUser()" class="reset">ğŸ”„ Ø±ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±</button>
        </div>
    </div>

    <div class="result-box" id="output">
        <strong>ğŸ“‹ Ø®Ø±ÙˆØ¬ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</strong>
    </div>

    <hr>
    <div style="text-align: center; color: #7f8c8d; padding: 10px;">
        <span class="badge">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: Ø§Ø³ÙÙ†Ø¯ Û±Û´Û°Û´</span>
        <span class="badge">Farsinglish â€” ØªØ³Øª Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø³Ø·Ø­</span>
    </div>

    <script>
        // -------------------- Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø± (User Model) --------------------
        class UserProgress {
            constructor() {
                this.xp = 0;
                this.level = 1;
                this.lessonsCompleted = 0;
                this.perfectLessons = 0;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø¨Ø± Ø§Ø³Ø§Ø³ XP (ÙØ±Ù…ÙˆÙ„: level = 1 + floor(xp / 100) ØªØ§ 699, Ø¨Ø¹Ø¯ 5)
            calculateLevel(xp) {
                if (xp < 100) return 1;
                if (xp < 250) return 2;
                if (xp < 450) return 3;
                if (xp < 700) return 4;
                return 5;
            }

            // Ø§ÙØ²ÙˆØ¯Ù† XP Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø·Ø­
            addXp(amount) {
                this.xp += amount;
                const newLevel = this.calculateLevel(this.xp);
                const leveledUp = (newLevel > this.level);
                this.level = newLevel;
                return { newXp: this.xp, newLevel: this.level, leveledUp };
            }

            // ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ (Ù…Ø¹Ù…ÙˆÙ„ÛŒ)
            completeLesson() {
                this.lessonsCompleted++;
                return this.addXp(40);
            }

            // Ø¯Ø±Ø³ Ø¹Ø§Ù„ÛŒ
            perfectLesson() {
                this.perfectLessons++;
                return this.addXp(80);
            }

            // Ø±ÛŒØ³Øª
            reset() {
                this.xp = 0;
                this.level = 1;
                this.lessonsCompleted = 0;
                this.perfectLessons = 0;
            }

            // Ø¯Ø±ØµØ¯ ØªØ§ Ø³Ø·Ø­ Ø¨Ø¹Ø¯ÛŒ
            progressToNextLevel() {
                if (this.level === 5) return 100;
                const thresholds = [0, 100, 250, 450, 700];
                const currentThreshold = thresholds[this.level - 1];
                const nextThreshold = thresholds[this.level];
                const xpInLevel = this.xp - currentThreshold;
                const levelRange = nextThreshold - currentThreshold;
                return Math.min(100, Math.round((xpInLevel / levelRange) * 100));
            }

            // Ù†ÛŒØ§Ø² ØªØ§ Ø³Ø·Ø­ Ø¨Ø¹Ø¯
            xpToNextLevel() {
                if (this.level === 5) return 0;
                const thresholds = [0, 100, 250, 450, 700];
                return thresholds[this.level] - this.xp;
            }
        }

        // -------------------- Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±Ø¨Ø± --------------------
        const user = new UserProgress();
        const outputDiv = document.getElementById('output');
        const userDisplay = document.getElementById('userDisplay');

        function refreshDisplay() {
            const progress = user.progressToNextLevel();
            const xpNeeded = user.xpToNextLevel();
            userDisplay.innerHTML = `
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
                    <div><strong>âœ¨ XP:</strong> ${user.xp}</div>
                    <div><strong>ğŸ“Š Ø³Ø·Ø­:</strong> ${user.level}</div>
                    <div><strong>ğŸ“˜ Ø¯Ø±Ø³â€ŒÙ‡Ø§:</strong> ${user.lessonsCompleted}</div>
                    <div><strong>ğŸŒŸ Ø¹Ø§Ù„ÛŒ:</strong> ${user.perfectLessons}</div>
                    <div><strong>ğŸ“ˆ Ù¾ÛŒØ´Ø±ÙØª:</strong> ${progress}% ØªØ§ Ø³Ø·Ø­ Ø¨Ø¹Ø¯</div>
                    <div><strong>ğŸ¯ Ù†ÛŒØ§Ø² XP:</strong> ${xpNeeded > 0 ? xpNeeded : 'â€”'}</div>
                </div>
            `;
        }

        function log(message, type = 'info') {
            const prefix = type === 'success' ? 'âœ…' : (type === 'error' ? 'âŒ' : 'ğŸ”¹');
            outputDiv.innerHTML = `<p>${prefix} ${message}</p><hr style='margin:10px 0'>` + outputDiv.innerHTML;
            if (outputDiv.children.length > 6) outputDiv.removeChild(outputDiv.lastElementChild);
            refreshDisplay();
        }

        function clearOutput() {
            outputDiv.innerHTML = '<strong>ğŸ“‹ Ø®Ø±ÙˆØ¬ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</strong>';
        }

        // -------------------- Actions --------------------
        function addXP(amount) {
            const result = user.addXp(amount);
            log(`â• Ø§ÙØ²ÙˆØ¯Ù† ${amount} XP â†’ XP: ${result.newXp}, Ø³Ø·Ø­: ${result.newLevel} ${result.leveledUp ? 'ğŸš€ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­!' : ''}`, result.leveledUp ? 'success' : 'info');
        }

        function completeLesson() {
            const result = user.completeLesson();
            log(`ğŸ“˜ Ø¯Ø±Ø³ Ù…Ø¹Ù…ÙˆÙ„ÛŒ: +40 XP â†’ XP: ${result.newXp}, Ø³Ø·Ø­: ${result.newLevel}`, result.leveledUp ? 'success' : 'info');
        }

        function perfectLesson() {
            const result = user.perfectLesson();
            log(`ğŸŒŸ Ø¯Ø±Ø³ Ø¹Ø§Ù„ÛŒ: +80 XP â†’ XP: ${result.newXp}, Ø³Ø·Ø­: ${result.newLevel}`, result.leveledUp ? 'success' : 'info');
        }

        function resetUser() {
            user.reset();
            clearOutput();
            log('ğŸ”„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯');
            refreshDisplay();
        }

        // -------------------- ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ --------------------
        function testInitialState() {
            clearOutput();
            log('ğŸ” ØªØ³Øª Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡: XP Ø¨Ø§ÛŒØ¯ 0ØŒ Ø³Ø·Ø­ 1');
            if (user.xp === 0 && user.level === 1) log('âœ… Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ ØµØ­ÛŒØ­ Ø§Ø³Øª', 'success');
            else log(`âŒ Ø®Ø·Ø§: XP=${user.xp}, Ø³Ø·Ø­=${user.level}`, 'error');
        }

        function setXpAndCheck(xpTarget, expectedLevel, description) {
            user.reset();
            user.addXp(xpTarget);
            const ok = (user.level === expectedLevel);
            log(`${description} â†’ XP: ${user.xp}, Ø³Ø·Ø­: ${user.level} ${ok ? 'âœ…' : 'âŒ'}`, ok ? 'success' : 'error');
        }

        function testLevelOne() {
            setXpAndCheck(50, 1, 'Ø³Ø·Ø­ Û± (XP=50)');
            setXpAndCheck(99, 1, 'Ø³Ø·Ø­ Û± (XP=99)');
        }

        function testLevelTwo() {
            setXpAndCheck(100, 2, 'Ø³Ø·Ø­ Û² (XP=100)');
            setXpAndCheck(200, 2, 'Ø³Ø·Ø­ Û² (XP=200)');
        }

        function testLevelThree() {
            setXpAndCheck(250, 3, 'Ø³Ø·Ø­ Û³ (XP=250)');
            setXpAndCheck(350, 3, 'Ø³Ø·Ø­ Û³ (XP=350)');
        }

        function testLevelFour() {
            setXpAndCheck(450, 4, 'Ø³Ø·Ø­ Û´ (XP=450)');
            setXpAndCheck(600, 4, 'Ø³Ø·Ø­ Û´ (XP=600)');
        }

        function testLevelFive() {
            setXpAndCheck(700, 5, 'Ø³Ø·Ø­ Ûµ (XP=700)');
            setXpAndCheck(1200, 5, 'Ø³Ø·Ø­ Ûµ (XP=1200)');
        }

        function testLevelProgression() {
            clearOutput();
            user.reset();
            log('ğŸ”„ Ø´Ø±ÙˆØ¹ Ø§Ø² Ø³Ø·Ø­ Û±');
            user.addXp(90); log('+90 XP â†’ Ø³Ø·Ø­ Û±');
            user.addXp(15); log('+15 XP â†’ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø·Ø­ Û²');
            user.addXp(140); log('+140 XP â†’ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø·Ø­ Û³');
            user.addXp(200); log('+200 XP â†’ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø·Ø­ Û´');
            user.addXp(300); log('+300 XP â†’ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø·Ø­ Ûµ');
        }

        function testExactBoundary() {
            clearOutput();
            log('ğŸ” ØªØ³Øª Ù…Ø±Ø²Ù‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø³Ø·Ø­:');
            setXpAndCheck(99, 1, 'Ù…Ø±Ø² Û¹Û¹ (Ø³Ø·Ø­ Û±)');
            setXpAndCheck(100, 2, 'Ù…Ø±Ø² Û±Û°Û° (Ø³Ø·Ø­ Û²)');
            setXpAndCheck(249, 2, 'Ù…Ø±Ø² Û²Û´Û¹ (Ø³Ø·Ø­ Û²)');
            setXpAndCheck(250, 3, 'Ù…Ø±Ø² Û²ÛµÛ° (Ø³Ø·Ø­ Û³)');
            setXpAndCheck(449, 3, 'Ù…Ø±Ø² Û´Û´Û¹ (Ø³Ø·Ø­ Û³)');
            setXpAndCheck(450, 4, 'Ù…Ø±Ø² Û´ÛµÛ° (Ø³Ø·Ø­ Û´)');
            setXpAndCheck(699, 4, 'Ù…Ø±Ø² Û¶Û¹Û¹ (Ø³Ø·Ø­ Û´)');
            setXpAndCheck(700, 5, 'Ù…Ø±Ø² Û·Û°Û° (Ø³Ø·Ø­ Ûµ)');
        }

        // -------------------- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ --------------------
        window.onload = function() {
            refreshDisplay();
            clearOutput();
        };
    </script>
</body>
</html>
