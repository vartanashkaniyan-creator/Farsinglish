// ==================== تست اصلاح شده Email Validation ====================

async function testEmailValidation() {
    const testCases = [
        {
            email: "user@farsinglish.com",
            expected: true,
            description: "ایمیل معتبر"
        },
        {
            email: "user.test@sub.domain.com",
            expected: true,
            description: "ایمیل با ساب‌دامنه"
        },
        {
            email: "invalid-email",
            expected: false,
            description: "ایمیل بدون @"
        },
        {
            email: "user@",
            expected: false,
            description: "ایمیل بدون دامنه"
        },
        {
            email: "@domain.com",
            expected: false,
            description: "ایمیل بدون نام کاربری"
        },
        {
            email: "user@domain",
            expected: false,
            description: "ایمیل بدون پسوند دامنه"
        },
        {
            email: "user@domain.",
            expected: false,
            description: "ایمیل با نقطه انتهایی"
        },
        {
            email: "user.name+tag@domain.com",
            expected: true,
            description: "ایمیل با پلاس تگ"
        }
    ];

    let passedTests = 0;
    const details = [];

    testCases.forEach((testCase, index) => {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const isValid = emailRegex.test(testCase.email);
        const testPassed = isValid === testCase.expected;
        
        if (testPassed) passedTests++;
        
        details.push(`
            <div class="detail-row">
                <span class="detail-label">${testCase.description}:</span>
                <span class="detail-value ${testPassed ? 'success' : 'error'}">
                    ${testCase.email} → ${isValid ? 'معتبر' : 'نامعتبر'} 
                    ${testPassed ? '✅' : '❌'}
                </span>
            </div>
        `);
    });

    const successRate = Math.round((passedTests / testCases.length) * 100);

    return {
        success: passedTests === testCases.length,
        details: `
            <div class="detail-row">
                <span class="detail-label">تعداد تست‌ها:</span>
                <span class="detail-value">${testCases.length} تست</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">موفقیت:</span>
                <span class="detail-value ${passedTests === testCases.length ? 'success' : 'warning'}">
                    ${passedTests}/${testCases.length} (${successRate}%)
                </span>
            </div>
            ${details.join('')}
            <div class="detail-row">
                <span class="detail-label">یادآوری:</span>
                <span class="detail-value info">
                    بررسی یکتایی ایمیل در سطح دیتابیس انجام می‌شود
                </span>
            </div>
        `
    };
}
