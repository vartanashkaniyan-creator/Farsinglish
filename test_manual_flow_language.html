<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† - Farsinglish</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 15px; background: #f5f5f5; direction: rtl; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .test-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        button { background: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-size: 14px; cursor: pointer; margin: 5px; }
        button.success { background: #27ae60; }
        button.warning { background: #f39c12; }
        button.danger { background: #e74c3c; }
        .lang-box { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .output { background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; direction: ltr; text-align: left; }
        .rtl-output { direction: rtl; text-align: right; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td, th { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #34495e; color: white; }
        .success-bg { background: #d4edda; }
        .fail-bg { background: #f8d7da; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒ ØªØ³Øª Ø¯Ø³ØªÛŒ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†</h1>
        <h2>Farsinglish - Localization & RTL/LTR</h2>
    </div>

    <div class="test-card">
        <h3>ğŸ”¤ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ</h3>
        <div class="lang-box">
            <button onclick="setLanguage('fa')" class="success">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ (fa)</button>
            <button onclick="setLanguage('en')" class="success">ğŸ‡¬ğŸ‡§ English (en)</button>
            <button onclick="setLanguage('ar')" class="success">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (ar)</button>
            <button onclick="setLanguage('es')" class="success">ğŸ‡ªğŸ‡¸ EspaÃ±ol (es)</button>
        </div>
        <p>Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ: <strong id="currentLangDisplay">fa</strong></p>
        <p>Ø¬Ù‡Øª ØµÙØ­Ù‡: <strong id="currentDirDisplay">rtl</strong></p>
    </div>

    <div class="test-card">
        <h3>ğŸ“ ØªØ³Øª Ù…ØªÙˆÙ† ØªØ±Ø¬Ù…Ù‡â€ŒØ´Ø¯Ù‡</h3>
        <table id="translationTable">
            <tr><th>Ú©Ù„ÛŒØ¯</th><th>Ù…Ù‚Ø¯Ø§Ø± ØªØ±Ø¬Ù…Ù‡â€ŒØ´Ø¯Ù‡</th></tr>
        </table>
    </div>

    <div class="test-card">
        <h3>ğŸ§ª Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ</h3>
        
        <div style="margin: 15px 0;">
            <button onclick="runTest(1)">ğŸ§ª Û±. ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</button>
            <button onclick="runTest(2)">ğŸ§ª Û². ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ</button>
            <button onclick="runTest(3)">ğŸ§ª Û³. ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ø¨Ù‡ Ø¹Ø±Ø¨ÛŒ</button>
        </div>
        
        <div style="margin: 15px 0;">
            <button onclick="runTest(4)">ğŸ§ª Û´. Ø±ÙØ±Ø´ ØµÙØ­Ù‡ (Ø­ÙØ¸ Ø²Ø¨Ø§Ù†)</button>
            <button onclick="runTest(5)">ğŸ§ª Ûµ. Fallback Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</button>
        </div>

        <div style="margin: 15px 0;">
            <button onclick="runTest(6)">ğŸ§ª Û¶. ØªØºÛŒÛŒØ± Ø¬Ù‡Øª RTL â†” LTR</button>
            <button onclick="runTest(7)">ğŸ§ª Û·. Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</button>
        </div>

        <div id="testOutput" class="output rtl-output">
            Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...
        </div>
    </div>

    <div class="test-card">
        <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§</h3>
        <table>
            <tr><th>Ø±Ø¯ÛŒÙ</th><th>ØªØ³Øª</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr>
            <tbody id="testStatus"></tbody>
        </table>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="resetTests()" class="danger">ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
    </div>

    <script>
        // -------------------- Language Manager --------------------
        class LanguageManager {
            constructor() {
                this.currentLang = localStorage.getItem('app_language') || 'fa';
                this.translations = {
                    fa: {
                        'app_name': 'ÙØ§Ø±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´',
                        'welcome': 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯',
                        'login': 'ÙˆØ±ÙˆØ¯',
                        'logout': 'Ø®Ø±ÙˆØ¬',
                        'dashboard': 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯',
                        'lessons': 'Ø¯Ø±ÙˆØ³',
                        'profile': 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„',
                        'settings': 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª',
                        'not_found': 'Ù…ØªÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯'
                    },
                    en: {
                        'app_name': 'Farsinglish',
                        'welcome': 'Welcome',
                        'login': 'Login',
                        'logout': 'Logout',
                        'dashboard': 'Dashboard',
                        'lessons': 'Lessons',
                        'profile': 'Profile',
                        'settings': 'Settings',
                        'not_found': 'Text not found'
                    },
                    ar: {
                        'app_name': 'ÙØ§Ø±Ø³ÛŒÙ†Ú¯Ù„ÛŒØ´',
                        'welcome': 'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹',
                        'login': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                        'logout': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
                        'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                        'lessons': 'Ø§Ù„Ø¯Ø±ÙˆØ³',
                        'profile': 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
                        'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                        'not_found': 'Ø§Ù„Ù†Øµ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'
                    }
                };
                this.fallbackLang = 'en';
                this.init();
            }

            init() {
                this.applyDirection();
                this.updateUILanguage();
            }

            setLanguage(lang) {
                if (!this.translations[lang]) {
                    console.warn(`Ø²Ø¨Ø§Ù† ${lang} Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² fallback: ${this.fallbackLang}`);
                    lang = this.fallbackLang;
                }
                
                this.currentLang = lang;
                localStorage.setItem('app_language', lang);
                this.applyDirection();
                this.updateUILanguage();
                
                // Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†
                window.dispatchEvent(new CustomEvent('languageChanged', { detail: { language: lang } }));
                
                return lang;
            }

            getCurrentLang() {
                return this.currentLang;
            }

            getDirection() {
                return this.currentLang === 'fa' || this.currentLang === 'ar' ? 'rtl' : 'ltr';
            }

            applyDirection() {
                const dir = this.getDirection();
                document.documentElement.dir = dir;
                document.documentElement.lang = this.currentLang;
            }

            translate(key) {
                const langData = this.translations[this.currentLang];
                if (langData && langData[key] !== undefined) {
                    return langData[key];
                }
                
                // Fallback to English
                const fallbackData = this.translations[this.fallbackLang];
                if (fallbackData && fallbackData[key] !== undefined) {
                    console.warn(`Ú©Ù„ÛŒØ¯ "${key}" Ø¯Ø± Ø²Ø¨Ø§Ù† ${this.currentLang} ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² fallback: ${this.fallbackLang}`);
                    return fallbackData[key];
                }
                
                return key; // Return the key itself as last resort
            }

            updateUILanguage() {
                document.getElementById('currentLangDisplay').innerText = this.currentLang;
                document.getElementById('currentDirDisplay').innerText = this.getDirection();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ ØªØ±Ø¬Ù…Ù‡
                this.updateTranslationTable();
            }

            updateTranslationTable() {
                const table = document.getElementById('translationTable');
                const keys = ['app_name', 'welcome', 'login', 'logout', 'dashboard', 'lessons', 'profile', 'settings'];
                
                let html = '<tr><th>Ú©Ù„ÛŒØ¯</th><th>Ù…Ù‚Ø¯Ø§Ø± ØªØ±Ø¬Ù…Ù‡â€ŒØ´Ø¯Ù‡</th></tr>';
                keys.forEach(key => {
                    html += `<tr><td>${key}</td><td>${this.translate(key)}</td></tr>`;
                });
                
                table.innerHTML = html;
            }

            formatNumber(number) {
                if (this.currentLang === 'fa' || this.currentLang === 'ar') {
                    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ/Ø¹Ø±Ø¨ÛŒ
                    const persianDigits = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
                    return number.toString().replace(/\d/g, d => persianDigits[parseInt(d)]);
                }
                return number.toString();
            }
        }

        // -------------------- Test Runner --------------------
        const TestRunner = {
            tests: [
                { id: 1, name: 'ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', status: 'pending' },
                { id: 2, name: 'ØªØºÛŒÛŒØ± Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ', status: 'pending' },
                { id: 3, name: 'ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø¹Ø±Ø¨ÛŒ', status: 'pending' },
                { id: 4, name: 'Ø­ÙØ¸ Ø²Ø¨Ø§Ù† Ù¾Ø³ Ø§Ø² Ø±ÙØ±Ø´', status: 'pending' },
                { id: 5, name: 'Fallback Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯', status: 'pending' },
                { id: 6, name: 'ØªØºÛŒÛŒØ± Ø¬Ù‡Øª RTL/LTR', status: 'pending' },
                { id: 7, name: 'Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', status: 'pending' }
            ],

            updateStatus(testId, status) {
                const test = this.tests.find(t => t.id === testId);
                if (test) test.status = status;
                this.renderTable();
            },

            renderTable() {
                const tbody = document.getElementById('testStatus');
                let html = '';
                this.tests.forEach(test => {
                    const statusClass = test.status === 'passed' ? 'success-bg' : (test.status === 'failed' ? 'fail-bg' : '');
                    html += `<tr class="${statusClass}">
                        <td>${test.id}</td>
                        <td>${test.name}</td>
                        <td>${test.status === 'passed' ? 'âœ… Ù…ÙˆÙÙ‚' : (test.status === 'failed' ? 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚' : 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±')}</td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            },

            reset() {
                this.tests.forEach(t => t.status = 'pending');
                this.renderTable();
                document.getElementById('testOutput').innerHTML = 'Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...';
            }
        };

        // -------------------- Initialize --------------------
        const langManager = new LanguageManager();

        // -------------------- Test Functions --------------------
        function setLanguage(lang) {
            langManager.setLanguage(lang);
            showOutput(`âœ… Ø²Ø¨Ø§Ù† Ø¨Ù‡ ${lang} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª. Ø¬Ù‡Øª: ${langManager.getDirection()}`);
        }

        function runTest(testId) {
            let output = '';
            let success = true;

            try {
                switch(testId) {
                    case 1: // ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
                        langManager.setLanguage('en');
                        output = `âœ… Ø²Ø¨Ø§Ù† Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯: 
                        - Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡: ${langManager.translate('app_name')}
                        - Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯: ${langManager.translate('login')}
                        - Ø¬Ù‡Øª ØµÙØ­Ù‡: ${langManager.getDirection()}`;
                        TestRunner.updateStatus(1, 'passed');
                        break;

                    case 2: // ØªØºÛŒÛŒØ± Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
                        langManager.setLanguage('fa');
                        output = `âœ… Ø²Ø¨Ø§Ù† Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
                        - Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡: ${langManager.translate('app_name')}
                        - Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯: ${langManager.translate('login')}
                        - Ø¬Ù‡Øª ØµÙØ­Ù‡: ${langManager.getDirection()}`;
                        TestRunner.updateStatus(2, 'passed');
                        break;

                    case 3: // ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø¹Ø±Ø¨ÛŒ
                        langManager.setLanguage('ar');
                        output = `âœ… Ø²Ø¨Ø§Ù† Ø¨Ù‡ Ø¹Ø±Ø¨ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
                        - Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡: ${langManager.translate('app_name')}
                        - Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯: ${langManager.translate('login')}
                        - Ø¬Ù‡Øª ØµÙØ­Ù‡: ${langManager.getDirection()}`;
                        TestRunner.updateStatus(3, 'passed');
                        break;

                    case 4: // Ø­ÙØ¸ Ø²Ø¨Ø§Ù† Ù¾Ø³ Ø§Ø² Ø±ÙØ±Ø´
                        const savedLang = localStorage.getItem('app_language');
                        output = `âœ… Ø²Ø¨Ø§Ù† Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø¯Ø± localStorage: ${savedLang}
                        ğŸ”„ Ø­Ø§Ù„Ø§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯ (F5) Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ø²Ø¨Ø§Ù† ${savedLang} Ø­ÙØ¸ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.`;
                        TestRunner.updateStatus(4, 'passed');
                        break;

                    case 5: // Fallback Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯
                        const nonExistentKey = 'this_key_does_not_exist';
                        const fallbackValue = langManager.translate(nonExistentKey);
                        output = `âœ… Ú©Ù„ÛŒØ¯ "${nonExistentKey}" Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.
                        Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§Ø²Ú¯Ø´ØªÛŒ: "${fallbackValue}" (Ø¨Ø§ÛŒØ¯ Ø®ÙˆØ¯ Ú©Ù„ÛŒØ¯ Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)`;
                        TestRunner.updateStatus(5, 'passed');
                        break;

                    case 6: // ØªØºÛŒÛŒØ± Ø¬Ù‡Øª RTL/LTR
                        const currentDir = langManager.getDirection();
                        const newLang = currentDir === 'rtl' ? 'en' : 'fa';
                        langManager.setLanguage(newLang);
                        output = `âœ… Ø¬Ù‡Øª ØµÙØ­Ù‡ Ø§Ø² ${currentDir} Ø¨Ù‡ ${langManager.getDirection()} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.
                        Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ: ${langManager.currentLang}`;
                        TestRunner.updateStatus(6, 'passed');
                        break;

                    case 7: // Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
                        const numbers = [123, 4567, 890];
                        output = 'âœ… ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯:\n';
                        numbers.forEach(num => {
                            output += `${num} â†’ ${langManager.formatNumber(num)}\n`;
                        });
                        output += `Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ: ${langManager.currentLang}`;
                        TestRunner.updateStatus(7, 'passed');
                        break;

                    default:
                        output = 'âŒ ØªØ³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±';
                        success = false;
                }
            } catch(e) {
                output = `âŒ Ø®Ø·Ø§: ${e.message}`;
                success = false;
                TestRunner.updateStatus(testId, 'failed');
            }

            showOutput(output);
        }

        function showOutput(text) {
            document.getElementById('testOutput').innerHTML = text.replace(/\n/g, '<br>');
        }

        function resetTests() {
            TestRunner.reset();
            langManager.setLanguage('fa');
            showOutput('âœ… Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯. Ø²Ø¨Ø§Ù† Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª.');
        }

        // Event listener for language changes
        window.addEventListener('languageChanged', (e) => {
            console.log('Ø²Ø¨Ø§Ù† ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ Ø¨Ù‡:', e.detail.language);
        });

        // Initialize on load
        window.onload = function() {
            TestRunner.renderTable();
        };
    </script>
</body>
</html>
