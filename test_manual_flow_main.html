<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± - Farsinglish</title>
    <style>
        body {
            font-family: Vazir, Tahoma, Arial, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            padding: 24px;
        }
        h1 {
            font-size: 1.6rem;
            color: #1e3c5c;
            border-bottom: 2px solid #e1e8ed;
            padding-bottom: 12px;
            margin-top: 0;
        }
        .step-panel {
            background: #f8fafd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border: 1px solid #dde4ec;
        }
        .step-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: #0b4f6c;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .step-number {
            background: #0b4f6c;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        button {
            background: #2274a5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin: 5px 8px 5px 0;
            transition: 0.2s;
            border: 1px solid #1b5a7e;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:hover {
            background: #1b5a7e;
            transform: translateY(-1px);
        }
        button.secondary {
            background: #e7eef4;
            color: #1e3c5c;
            border-color: #b8ccd8;
        }
        .log-area {
            background: #1e2b36;
            color: #d4e6f1;
            border-radius: 10px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 250px;
            overflow-y: auto;
            margin-top: 16px;
            white-space: pre-wrap;
            direction: ltr;
            text-align: left;
            border: 2px solid #0e1a24;
        }
        .log-entry {
            border-bottom: 1px solid #3a4c5e;
            padding: 4px 0;
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            margin: 12px 0;
        }
        .output-panel {
            background: #e9f2f9;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-right: 4px solid #2274a5;
        }
        .badge {
            background: #d4e6f1;
            color: #0b4f6c;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        hr {
            border: none;
            border-top: 1px dashed #b8ccd8;
            margin: 16px 0;
        }
    </style>
</head>
<body>
<div class="container" id="app">
    <h1>ğŸ§ª ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø±ÛŒØ§Ù† Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± (Manual Flow)</h1>
    <p style="color: #4a6572;">Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„: Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/ÙˆØ±ÙˆØ¯ â†’ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³ â†’ ØªÙ…Ø±ÛŒÙ† â†’ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª â† SRS</p>

    <!-- Ú¯Ø§Ù… Û±: Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª -->
    <div class="step-panel">
        <div class="step-title"><span class="step-number">Û±</span> Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª (ÙˆØ±ÙˆØ¯/Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…)</div>
        <div class="flex-row">
            <button id="btnLogin">ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª</button>
            <button id="btnLogout" class="secondary">ğŸšª Ø®Ø±ÙˆØ¬</button>
            <button id="btnShowUser" class="secondary">ğŸ‘¤ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ</button>
        </div>
        <div id="authOutput" class="output-panel">ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯</div>
    </div>

    <!-- Ú¯Ø§Ù… Û²: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ -->
    <div class="step-panel">
        <div class="step-title"><span class="step-number">Û²</span> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</div>
        <div class="flex-row">
            <button id="btnLoadLessons">ğŸ“š Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø¯Ø±Ø³â€ŒÙ‡Ø§</button>
            <button id="btnSelectLesson">ğŸ“– Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³ Ø§ÙˆÙ„</button>
        </div>
        <div id="lessonsOutput" class="output-panel">Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡</div>
    </div>

    <!-- Ú¯Ø§Ù… Û³: ØªÙ…Ø±ÛŒÙ† Ùˆ Ù¾Ø§Ø³Ø® -->
    <div class="step-panel">
        <div class="step-title"><span class="step-number">Û³</span> Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªÙ…Ø±ÛŒÙ†</div>
        <div class="flex-row">
            <button id="btnGenerateExercise">ğŸ² ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ† ØªØµØ§Ø¯ÙÛŒ</button>
            <button id="btnAnswerCorrect">âœ… Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</button>
            <button id="btnAnswerWrong">âŒ Ù¾Ø§Ø³Ø® ØºÙ„Ø·</button>
        </div>
        <div id="exerciseOutput" class="output-panel">ØªÙ…Ø±ÛŒÙ†ÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª</div>
    </div>

    <!-- Ú¯Ø§Ù… Û´: Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ùˆ SRS -->
    <div class="step-panel">
        <div class="step-title"><span class="step-number">Û´</span> Ù¾ÛŒØ´Ø±ÙØª Ùˆ Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ (SRS)</div>
        <div class="flex-row">
            <button id="btnSaveProgress">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª ÙØ¹Ù„ÛŒ</button>
            <button id="btnShowProgress">ğŸ“Š Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´Ø±ÙØª</button>
            <button id="btnNextReview">â³ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ</button>
        </div>
        <div id="progressOutput" class="output-panel">Ù¾ÛŒØ´Ø±ÙØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
    </div>

    <!-- Ú¯Ø§Ù… Ûµ: Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ -->
    <hr>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button id="btnFullFlow" style="background: #2e7d32;">â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ú¯Ø§Ù…â€ŒØ¨Ù‡â€ŒÚ¯Ø§Ù… Ø®ÙˆØ¯Ú©Ø§Ø± (Ûµ Ù…Ø±Ø­Ù„Ù‡)</button>
        <button id="btnClearLog" class="secondary">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
    </div>

    <!-- Ù„Ø§Ú¯ Ø®Ø±ÙˆØ¬ÛŒ -->
    <div style="margin-top: 24px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span class="badge">ğŸ“‹ Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ</span>
            <span class="badge" id="logCounter">Û° Ø±ÙˆÛŒØ¯Ø§Ø¯</span>
        </div>
        <div id="logArea" class="log-area">[Ø³ÛŒØ³ØªÙ…] Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ù‡ Ú©Ø§Ø±. Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.</div>
    </div>
</div>

<script>
    (function() {
        // ********** Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) **********
        let currentUser = null;
        let lessons = [];
        let selectedLesson = null;
        let currentExercise = null;
        let currentProgress = {
            userId: null,
            lessonId: null,
            stage: 0,
            easeFactor: 2.5,
            interval: 0,
            nextReview: null,
            lastScore: null
        };

        // Ù…Ø§Ú˜ÙˆÙ„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ SRS (Ù‡Ù…Ø§Ù† srs-engine)
        const SRS = {
            calculateNextReview: function(score, stage, easeFactor, interval) {
                if (score < 3) { // Ù¾Ø§Ø³Ø® Ø¶Ø¹ÛŒÙ
                    return { stage: 0, easeFactor: Math.max(1.3, easeFactor - 0.2), interval: 1, nextReview: new Date(Date.now() + 86400000) };
                }
                // Ù¾Ø§Ø³Ø® Ø®ÙˆØ¨
                let newEaseFactor = easeFactor + (0.1 - (5 - score) * 0.08);
                newEaseFactor = Math.max(1.3, Math.min(2.5, newEaseFactor));
                let newInterval = 0;
                if (stage === 0) newInterval = 1;
                else if (stage === 1) newInterval = 6;
                else newInterval = Math.round(interval * newEaseFactor);
                return {
                    stage: stage + 1,
                    easeFactor: newEaseFactor,
                    interval: newInterval,
                    nextReview: new Date(Date.now() + newInterval * 86400000)
                };
            }
        };

        // ********** Ø§Ø¨Ø²Ø§Ø± Ù„Ø§Ú¯ **********
        const logArea = document.getElementById('logArea');
        const logCounter = document.getElementById('logCounter');
        let logEntries = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);
            logArea.innerHTML = logEntries.map(e => `<div class="log-entry">${e}</div>`).join('');
            logArea.scrollTop = logArea.scrollHeight;
            logCounter.textContent = logEntries.length + ' Ø±ÙˆÛŒØ¯Ø§Ø¯';
            console.log(message);
        }

        // ********** Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ UI **********
        function updateAuthOutput() {
            const out = document.getElementById('authOutput');
            if (currentUser) {
                out.innerText = `âœ… Ú©Ø§Ø±Ø¨Ø±: ${currentUser.name} (Ø§ÛŒÙ…ÛŒÙ„: ${currentUser.email}) | ØªÙˆÚ©Ù†: ${currentUser.token.substring(0,12)}...`;
            } else {
                out.innerText = 'ğŸ”´ Ø®Ø§Ø±Ø¬ Ø´Ø¯Ù‡ / ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡';
            }
        }

        function updateLessonsOutput() {
            const out = document.getElementById('lessonsOutput');
            if (lessons.length > 0) {
                let text = `ğŸ“š ${lessons.length} Ø¯Ø±Ø³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: `;
                text += lessons.map(l => l.title).join('ØŒ ');
                if (selectedLesson) text += ` | Ø¯Ø±Ø³ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡: ${selectedLesson.title}`;
                out.innerText = text;
            } else {
                out.innerText = 'Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡';
            }
        }

        function updateExerciseOutput() {
            const out = document.getElementById('exerciseOutput');
            if (currentExercise) {
                out.innerText = `ğŸ¯ ØªÙ…Ø±ÛŒÙ†: ${currentExercise.question} | Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: ${currentExercise.correctAnswer}`;
            } else {
                out.innerText = 'ØªÙ…Ø±ÛŒÙ†ÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª';
            }
        }

        function updateProgressOutput() {
            const out = document.getElementById('progressOutput');
            if (currentProgress.lessonId) {
                out.innerText = `ğŸ“ˆ Ø¯Ø±Ø³: ${currentProgress.lessonId} | stage: ${currentProgress.stage} | EF: ${currentProgress.easeFactor.toFixed(2)} | ÙØ§ØµÙ„Ù‡: ${currentProgress.interval} Ø±ÙˆØ² | Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: ${currentProgress.nextReview ? new Date(currentProgress.nextReview).toLocaleDateString('fa-IR') : 'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†'}`;
            } else {
                out.innerText = 'Ù¾ÛŒØ´Ø±ÙØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡';
            }
        }

        // ********** Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ **********
        document.getElementById('btnLogin').addEventListener('click', function() {
            currentUser = {
                id: 'user_1',
                name: 'Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ',
                email: 'ali@example.com',
                token: 'jwt_test_token_' + Math.random().toString(36).substring(2)
            };
            addLog(`ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚: ${currentUser.name}`);
            updateAuthOutput();
        });

        document.getElementById('btnLogout').addEventListener('click', function() {
            currentUser = null;
            selectedLesson = null;
            currentExercise = null;
            currentProgress = { userId: null, lessonId: null, stage: 0, easeFactor: 2.5, interval: 0, nextReview: null };
            addLog('Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨');
            updateAuthOutput();
            updateLessonsOutput();
            updateExerciseOutput();
            updateProgressOutput();
        });

        document.getElementById('btnShowUser').addEventListener('click', function() {
            if (currentUser) {
                addLog(`Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ: ${currentUser.name} (${currentUser.email})`);
            } else {
                addLog('Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡');
            }
        });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
        document.getElementById('btnLoadLessons').addEventListener('click', function() {
            lessons = [
                { id: 'L1', title: 'Ù…Ø¨ØªØ¯ÛŒ Û± - greetings', words: ['hello', 'goodbye'] },
                { id: 'L2', title: 'Ù…Ø¨ØªØ¯ÛŒ Û² - family', words: ['mother', 'father'] },
                { id: 'L3', title: 'Ù…ØªÙˆØ³Ø· - food', words: ['apple', 'bread'] }
            ];
            addLog(`Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${lessons.length} Ø¯Ø±Ø³ Ù†Ù…ÙˆÙ†Ù‡`);
            updateLessonsOutput();
        });

        document.getElementById('btnSelectLesson').addEventListener('click', function() {
            if (lessons.length === 0) {
                addLog('Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯', 'warn');
                return;
            }
            selectedLesson = lessons[0];
            currentProgress.lessonId = selectedLesson.id;
            currentProgress.userId = currentUser?.id || 'anonymous';
            addLog(`Ø¯Ø±Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯: ${selectedLesson.title}`);
            updateLessonsOutput();
        });

        // ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ† Ø³Ø§Ø¯Ù‡
        document.getElementById('btnGenerateExercise').addEventListener('click', function() {
            if (!selectedLesson) {
                addLog('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø±Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'warn');
                return;
            }
            const words = selectedLesson.words || ['hello', 'world'];
            const randomWord = words[Math.floor(Math.random() * words.length)];
            currentExercise = {
                type: 'translate',
                question: `Ù…Ø¹Ù†ÛŒ "${randomWord}" Ú†ÛŒØ³ØªØŸ`,
                correctAnswer: randomWord === 'hello' ? 'Ø³Ù„Ø§Ù…' : (randomWord === 'goodbye' ? 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸' : 'Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡')
            };
            addLog(`ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯: ${currentExercise.question}`);
            updateExerciseOutput();
        });

        document.getElementById('btnAnswerCorrect').addEventListener('click', function() {
            if (!currentExercise) {
                addLog('ØªÙ…Ø±ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'warn');
                return;
            }
            addLog('âœ… Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯');
            // Ø§Ø¹Ù…Ø§Ù„ Ø¯Ø± SRS (Ù†Ù…Ø±Ù‡ Û´)
            const newState = SRS.calculateNextReview(4, currentProgress.stage, currentProgress.easeFactor, currentProgress.interval);
            currentProgress.stage = newState.stage;
            currentProgress.easeFactor = newState.easeFactor;
            currentProgress.interval = newState.interval;
            currentProgress.nextReview = newState.nextReview;
            currentProgress.lastScore = 4;
            addLog(`SRS: stage=${newState.stage}, EF=${newState.easeFactor.toFixed(2)}, ÙØ§ØµÙ„Ù‡=${newState.interval} Ø±ÙˆØ²`);
            updateProgressOutput();
        });

        document.getElementById('btnAnswerWrong').addEventListener('click', function() {
            if (!currentExercise) {
                addLog('ØªÙ…Ø±ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'warn');
                return;
            }
            addLog('âŒ Ù¾Ø§Ø³Ø® ØºÙ„Ø· Ø¯Ø§Ø¯Ù‡ Ø´Ø¯');
            const newState = SRS.calculateNextReview(2, currentProgress.stage, currentProgress.easeFactor, currentProgress.interval);
            currentProgress.stage = newState.stage;
            currentProgress.easeFactor = newState.easeFactor;
            currentProgress.interval = newState.interval;
            currentProgress.nextReview = newState.nextReview;
            currentProgress.lastScore = 2;
            addLog(`SRS: stage=${newState.stage}, EF=${newState.easeFactor.toFixed(2)}, ÙØ§ØµÙ„Ù‡=${newState.interval} Ø±ÙˆØ²`);
            updateProgressOutput();
        });

        document.getElementById('btnSaveProgress').addEventListener('click', function() {
            if (!currentUser) { addLog('Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯', 'warn'); return; }
            if (!currentProgress.lessonId) { addLog('Ø¯Ø±Ø³ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡', 'warn'); return; }
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² (localStorage)
            const key = `progress_${currentUser.id}_${currentProgress.lessonId}`;
            localStorage.setItem(key, JSON.stringify(currentProgress));
            addLog(`Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³ ${currentProgress.lessonId} Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
        });

        document.getElementById('btnShowProgress').addEventListener('click', function() {
            addLog(`Ù¾ÛŒØ´Ø±ÙØª ÙØ¹Ù„ÛŒ: stage=${currentProgress.stage}, EF=${currentProgress.easeFactor}, Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: ${currentProgress.nextReview}`);
            updateProgressOutput();
        });

        document.getElementById('btnNextReview').addEventListener('click', function() {
            if (!currentProgress.nextReview) {
                addLog('Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ù…Ø´Ø®Øµ Ù†ÛŒØ³Øª');
            } else {
                const days = Math.round((new Date(currentProgress.nextReview) - new Date()) / 86400000);
                addLog(`Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${days} Ø±ÙˆØ² (${new Date(currentProgress.nextReview).toLocaleDateString('fa-IR')})`);
            }
        });

        // Ú¯Ø§Ù… Ú©Ø§Ù…Ù„ Ø®ÙˆØ¯Ú©Ø§Ø±
        document.getElementById('btnFullFlow').addEventListener('click', async function() {
            addLog('ğŸ”¥ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ú¯Ø§Ù…â€ŒØ¨Ù‡â€ŒÚ¯Ø§Ù… Ø®ÙˆØ¯Ú©Ø§Ø±');
            if (!currentUser) document.getElementById('btnLogin').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnLoadLessons').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnSelectLesson').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnGenerateExercise').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnAnswerCorrect').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnSaveProgress').click();
            await new Promise(r => setTimeout(r, 200));
            document.getElementById('btnShowProgress').click();
            addLog('âœ… Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ù…Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯');
        });

        document.getElementById('btnClearLog').addEventListener('click', function() {
            logEntries = [];
            logArea.innerHTML = '<div class="log-entry">[Ø³ÛŒØ³ØªÙ…] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯.</div>';
            logCounter.textContent = 'Û° Ø±ÙˆÛŒØ¯Ø§Ø¯';
        });

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        addLog('Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.');
    })();
</script>
</body>
</html>
