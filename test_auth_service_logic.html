<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุณุช auth-service ยท ููุทู ูุญุถ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            font-size: 1.5rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-grid {
            display: grid;
            gap: 15px;
        }
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-right: 4px solid #3498db;
        }
        .test-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .test-desc {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
            margin-bottom: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        pre {
            background: #2d3436;
            color: #dfe6e9;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            direction: ltr;
            text-align: left;
        }
        .success { color: #27ae60; }
        .error { color: #c0392b; }
        hr { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>๐งช ุชุณุช auth-service ยท ููุทู ูุญุถ</h1>
    <p>ููู ุชุณุชโูุง ูุณุชูู ุงุฒ ุงุจุฒุงุฑุ ุจุง ูุฑูุฏ ุซุงุจุช ู ุฎุฑูุฌ ูุงุจู ูุดุงูุฏู</p>

    <div class="test-grid">
        <!-- ฺฉุงุฑุช ฑ: ูุด ุฑูุฒ -->
        <div class="test-card">
            <div class="test-title">๐ ฑ. ูุด ฺฉุฑุฏู ุฑูุฒ ุนุจูุฑ</div>
            <div class="test-desc">ูุฑูุฏ: "123456" ยท ุฎุฑูุฌ ุจุงุฏ ุซุงุจุช ู ูุงุจู ุชุฃุฏ ุจุงุดุฏ</div>
            <button onclick="runTest1()">ุงุฌุฑุง ุชุณุช ฑ</button>
            <pre id="output1">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ฒ: ุชุฃุฏ ุฑูุฒ -->
        <div class="test-card">
            <div class="test-title">โ ฒ. ุชุฃุฏ ุฑูุฒ ุตุญุญ</div>
            <div class="test-desc">ูุด "123456" ุฑุง ุจุง "123456" ููุงุณู ฺฉู โ true</div>
            <button onclick="runTest2()">ุงุฌุฑุง ุชุณุช ฒ</button>
            <pre id="output2">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ณ: ุชุฃุฏ ุฑูุฒ ุบูุท -->
        <div class="test-card">
            <div class="test-title">โ ณ. ุชุฃุฏ ุฑูุฒ ุบูุท</div>
            <div class="test-desc">ูุด "123456" ุฑุง ุจุง "wrong" ููุงุณู ฺฉู โ false</div>
            <button onclick="runTest3()">ุงุฌุฑุง ุชุณุช ณ</button>
            <pre id="output3">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ด: ุงุนุชุจุงุฑุณูุฌ ูุงู ฺฉุงุฑุจุฑ -->
        <div class="test-card">
            <div class="test-title">๐ค ด. ุงุนุชุจุงุฑุณูุฌ ูุงู ฺฉุงุฑุจุฑ</div>
            <div class="test-desc">"ali123" (ณ-ฒฐ ฺฉุงุฑุงฺฉุชุฑุ ุญุฑู/ุนุฏุฏ) โ true</div>
            <button onclick="runTest4()">ุงุฌุฑุง ุชุณุช ด</button>
            <pre id="output4">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ต: ุงุนุชุจุงุฑุณูุฌ ูุงู ฺฉุงุฑุจุฑ ูุงูุนุชุจุฑ -->
        <div class="test-card">
            <div class="test-title">โ๏ธ ต. ูุงู ฺฉุงุฑุจุฑ ฺฉูุชุงู</div>
            <div class="test-desc">"ab" (ฺฉูุชุฑ ุงุฒ ณ ฺฉุงุฑุงฺฉุชุฑ) โ false</div>
            <button onclick="runTest5()">ุงุฌุฑุง ุชุณุช ต</button>
            <pre id="output5">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ถ: ุงุนุชุจุงุฑุณูุฌ ุงูู -->
        <div class="test-card">
            <div class="test-title">๐ง ถ. ุงูู ูุนุชุจุฑ</div>
            <div class="test-desc">"user@example.com" โ true</div>
            <button onclick="runTest6()">ุงุฌุฑุง ุชุณุช ถ</button>
            <pre id="output6">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ท: ุงุนุชุจุงุฑุณูุฌ ุงูู ูุงูุนุชุจุฑ -->
        <div class="test-card">
            <div class="test-title">๐ง ท. ุงูู ุจุฏูู @</div>
            <div class="test-desc">"userexample.com" โ false</div>
            <button onclick="runTest7()">ุงุฌุฑุง ุชุณุช ท</button>
            <pre id="output7">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ธ: ุชููุฏ ุชูฺฉู JWT ุณุงุฏู -->
        <div class="test-card">
            <div class="test-title">๐ ธ. ุชููุฏ ุชูฺฉู (JWT ููุง)</div>
            <div class="test-desc">ูุฑูุฏ userId=1, username=ali โ ุฎุฑูุฌ base64</div>
            <button onclick="runTest8()">ุงุฌุฑุง ุชุณุช ธ</button>
            <pre id="output8">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช น: ุงุนุชุจุงุฑุณูุฌ ุชูฺฉู ุตุญุญ -->
        <div class="test-card">
            <div class="test-title">โ น. ุชูฺฉู ูุนุชุจุฑ</div>
            <div class="test-desc">ุชูฺฉู ุชููุฏ ุดุฏู ุฑุง ุงุนุชุจุงุฑุณูุฌ ฺฉู โ true</div>
            <button onclick="runTest9()">ุงุฌุฑุง ุชุณุช น</button>
            <pre id="output9">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>

        <!-- ฺฉุงุฑุช ฑฐ: ุงุนุชุจุงุฑุณูุฌ ุชูฺฉู ุฏุณุชฺฉุงุฑโุดุฏู -->
        <div class="test-card">
            <div class="test-title">๐ซ ฑฐ. ุชูฺฉู ูุงูุนุชุจุฑ</div>
            <div class="test-desc">ุชูฺฉู ุฏุณุชฺฉุงุฑโุดุฏู โ false</div>
            <button onclick="runTest10()">ุงุฌุฑุง ุชุณุช ฑฐ</button>
            <pre id="output10">ููุชุธุฑ ุงุฌุฑุง...</pre>
        </div>
    </div>

    <hr>
    <button onclick="runAllTests()" style="background: #27ae60; padding: 12px 24px; font-size: 1rem;">โถ ุงุฌุฑุง ููู ุชุณุชโูุง</button>
    <button onclick="clearOutputs()" style="background: #7f8c8d;">๐งน ูพุงฺฉ ฺฉุฑุฏู ุฎุฑูุฌ</button>

    <script>
        // ---------- ูพุงุฏูโุณุงุฒ ุณุงุฏู auth-service (ููุทู ูุญุถ) ----------
        const authService = {
            // ูุด ุณุงุฏู (ูุฑฺฏุฒ ุฏุฑ ุชููุฏ ุงุณุชูุงุฏู ูฺฉูุฏ โ ููุท ุจุฑุง ุชุณุช)
            hashPassword(password) {
                if (!password || typeof password !== 'string') return '';
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                return 'hash_' + Math.abs(hash).toString(16);
            },

            verifyPassword(inputPassword, storedHash) {
                return this.hashPassword(inputPassword) === storedHash;
            },

            validateUsername(username) {
                if (!username || typeof username !== 'string') return false;
                return /^[a-zA-Z0-9_]{3,20}$/.test(username);
            },

            validateEmail(email) {
                if (!email || typeof email !== 'string') return false;
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            },

            // ุดุจูโุณุงุฒ JWT ุณุงุฏู (ููุท ุจุฑุง ููุงุด ููุทู)
            generateToken(userId, username) {
                const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
                const payload = btoa(JSON.stringify({ userId, username, iat: Date.now() }));
                const signature = btoa('fake_signature_' + userId + username);
                return `${header}.${payload}.${signature}`;
            },

            verifyToken(token) {
                if (!token || typeof token !== 'string') return false;
                const parts = token.split('.');
                if (parts.length !== 3) return false;
                try {
                    const payload = JSON.parse(atob(parts[1]));
                    return payload && payload.userId && payload.username;
                } catch {
                    return false;
                }
            }
        };

        // ุฐุฎุฑู ูุด ุจุฑุง ุชุณุชโูุง ฑ-ณ
        const testHash = authService.hashPassword('123456');

        // ---------- ุชูุงุจุน ุงุฌุฑุง ุชุณุชโูุง ----------
        function runTest1() {
            const input = '123456';
            const hash = authService.hashPassword(input);
            const expected = hash; // ุซุจุงุช ุฎุฑูุฌ
            const output = `
ูุด ุจุฑุง "${input}":
${hash}
โ ุทูู: ${hash.length} ฺฉุงุฑุงฺฉุชุฑ
โ๏ธ  ุงู ูุด ููุท ุจุฑุง ุชุณุช ุงุณุชุ ุงูฺฏูุฑุชู ูุงูุน ูุณุช.
            `;
            document.getElementById('output1').innerText = output;
        }

        function runTest2() {
            const input = '123456';
            const storedHash = testHash;
            const result = authService.verifyPassword(input, storedHash);
            const output = `ุชุฃุฏ "${input}" ุจุง ูุด "${storedHash}":
๐น ูุชุฌู: ${result ? 'โ true (ุตุญุญ)' : 'โ false (ุฎุทุง)'}
            `;
            document.getElementById('output2').innerText = output;
        }

        function runTest3() {
            const input = 'wrong';
            const storedHash = testHash;
            const result = authService.verifyPassword(input, storedHash);
            const output = `ุชุฃุฏ "${input}" ุจุง ูุด "${storedHash}":
๐น ูุชุฌู: ${result ? 'โ true (ูุจุงุฏ ุจุงุดุฏ)' : 'โ false (ุฏุฑุณุช)'}
            `;
            document.getElementById('output3').innerText = output;
        }

        function runTest4() {
            const username = 'ali123';
            const result = authService.validateUsername(username);
            const output = `ูุงู ฺฉุงุฑุจุฑ "${username}":
๐น ูุชุฌู: ${result ? 'โ ูุนุชุจุฑ' : 'โ ูุงูุนุชุจุฑ'}
            `;
            document.getElementById('output4').innerText = output;
        }

        function runTest5() {
            const username = 'ab';
            const result = authService.validateUsername(username);
            const output = `ูุงู ฺฉุงุฑุจุฑ "${username}":
๐น ูุชุฌู: ${result ? 'โ ูุนุชุจุฑ (ูุจุงุฏ ุจุงุดุฏ)' : 'โ ูุงูุนุชุจุฑ (ุฏุฑุณุช)'}
            `;
            document.getElementById('output5').innerText = output;
        }

        function runTest6() {
            const email = 'user@example.com';
            const result = authService.validateEmail(email);
            const output = `ุงูู "${email}":
๐น ูุชุฌู: ${result ? 'โ ูุนุชุจุฑ' : 'โ ูุงูุนุชุจุฑ'}
            `;
            document.getElementById('output6').innerText = output;
        }

        function runTest7() {
            const email = 'userexample.com';
            const result = authService.validateEmail(email);
            const output = `ุงูู "${email}":
๐น ูุชุฌู: ${result ? 'โ ูุนุชุจุฑ (ูุจุงุฏ ุจุงุดุฏ)' : 'โ ูุงูุนุชุจุฑ (ุฏุฑุณุช)'}
            `;
            document.getElementById('output7').innerText = output;
        }

        function runTest8() {
            const token = authService.generateToken(1, 'ali');
            const output = `ุชูฺฉู ุชููุฏ ุดุฏู ุจุฑุง userId=1, username=ali:
๐น ${token}
๐น ุชุนุฏุงุฏ ุจุฎุดโูุง: ${token.split('.').length}
            `;
            document.getElementById('output8').innerText = output;
        }

        function runTest9() {
            const token = authService.generateToken(1, 'ali');
            const isValid = authService.verifyToken(token);
            const output = `ุชูฺฉู: ${token}
๐น ุงุนุชุจุงุฑุณูุฌ: ${isValid ? 'โ ูุนุชุจุฑ' : 'โ ูุงูุนุชุจุฑ'}
            `;
            document.getElementById('output9').innerText = output;
        }

        function runTest10() {
            const token = authService.generateToken(1, 'ali');
            const tampered = token.slice(0, -5) + 'xyz'; // ุฏุณุชฺฉุงุฑ
            const isValid = authService.verifyToken(tampered);
            const output = `ุชูฺฉู ุงุตู: ${token}
ุชูฺฉู ุฏุณุชฺฉุงุฑโุดุฏู: ${tampered}
๐น ุงุนุชุจุงุฑุณูุฌ: ${isValid ? 'โ ูุนุชุจุฑ (ูุจุงุฏ ุจุงุดุฏ)' : 'โ ูุงูุนุชุจุฑ (ุฏุฑุณุช)'}
            `;
            document.getElementById('output10').innerText = output;
        }

        function runAllTests() {
            runTest1();
            runTest2();
            runTest3();
            runTest4();
            runTest5();
            runTest6();
            runTest7();
            runTest8();
            runTest9();
            runTest10();
        }

        function clearOutputs() {
            for (let i = 1; i <= 10; i++) {
                document.getElementById(`output${i}`).innerText = 'ููุชุธุฑ ุงุฌุฑุง...';
            }
        }
    </script>
</body>
</html>
