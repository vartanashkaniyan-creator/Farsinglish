<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ØªØ³Øª Ø¯Ø³ØªÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª - Farsinglish</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: #f8fafc;
            padding: 16px;
            color: #0f172a;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            font-size: 1.8rem;
            color: #0f172a;
            border-bottom: 4px solid #3b82f6;
            padding-bottom: 12px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .badge {
            background: #3b82f6;
            color: white;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 16px;
        }
        .progress-chart {
            background: #f1f5f9;
            padding: 16px;
            border-radius: 16px;
            margin: 16px 0;
            direction: ltr;
            text-align: left;
        }
        .xp-bar {
            background: #e2e8f0;
            height: 24px;
            border-radius: 30px;
            overflow: hidden;
            margin: 8px 0;
        }
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            width: 0%;
            transition: width 0.3s;
            color: white;
            font-size: 0.7rem;
            line-height: 24px;
            padding-right: 10px;
            box-sizing: border-box;
        }
        button {
            background: white;
            border: 2px solid #3b82f6;
            color: #3b82f6;
            padding: 12px 24px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: bold;
            margin: 8px 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #3b82f6;
            color: white;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
        }
        .btn-success {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        .btn-warning {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }
        .test-row {
            background: #f8fafc;
            border-radius: 16px;
            padding: 16px;
            margin: 16px 0;
            border-right: 6px solid #3b82f6;
        }
        .output {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 12px;
            font-family: monospace;
            direction: ltr;
            text-align: left;
            font-size: 0.9rem;
            overflow-x: auto;
            margin-top: 12px;
        }
        .level-badge {
            background: #f59e0b;
            color: black;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 40px;
            display: inline-block;
        }
        hr {
            margin: 24px 0;
            border: 1px dashed #cbd5e1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        td {
            padding: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <span>ğŸ“Š Farsinglish</span>
            <span style="font-size:0.9rem; background:#0f172a; color:white; padding:6px 16px; border-radius:40px;">ØªØ³Øª Ø¯Ø³ØªÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª</span>
        </h1>

        <!-- Ú©Ø§Ø±Øª Ø§ØµÙ„ÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª -->
        <div class="card">
            <div class="badge">ğŸ§  Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø± (Progress Model) - SM-2</div>
            
            <!-- Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ú©Ù†ÙˆÙ†ÛŒ -->
            <div id="currentStateCard" style="background: #dbeafe; padding: 16px; border-radius: 16px; margin-bottom: 20px;">
                <h3 style="display:flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>ğŸ“Œ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±</span>
                    <span id="levelDisplay" class="level-badge">Ø³Ø·Ø­ 1</span>
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>â­ XP: <span id="xpDisplay" style="font-weight:bold; color:#2563eb;">0</span></div>
                    <div>ğŸ¯ XP Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø³Ø·Ø­ Ø¨Ø¹Ø¯: <span id="xpNextDisplay" style="font-weight:bold;">100</span></div>
                    <div>ğŸ” ØªÚ©Ø±Ø§Ø± Ø¯Ø±Ø³: <span id="repetitionsDisplay">0</span></div>
                    <div>ğŸ“… ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ±: <span id="intervalDisplay">1</span> Ø±ÙˆØ²</div>
                    <div>âš¡ Ø¹Ø§Ù…Ù„ Ø³Ù‡ÙˆÙ„Øª: <span id="efDisplay">2.50</span></div>
                    <div>ğŸ—“ï¸ Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ: <span id="nextReviewDisplay">Ø§Ù…Ø±ÙˆØ²</span></div>
                </div>
                <div class="xp-bar" style="margin-top: 16px;">
                    <div id="xpFillBar" class="xp-fill" style="width: 0%;">0%</div>
                </div>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ -->
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px;">
                <button id="btnAddXp10" class="btn-primary">â• +Û±Û° XP</button>
                <button id="btnAddXp25" class="btn-primary">â• +Û²Ûµ XP</button>
                <button id="btnCompleteLesson" class="btn-success">âœ… ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ (Ú©ÛŒÙÛŒØª Ûµ)</button>
                <button id="btnPoorReview" class="btn-warning">âš ï¸ Ù…Ø±ÙˆØ± Ø¶Ø¹ÛŒÙ (Ú©ÛŒÙÛŒØª Û²)</button>
                <button id="btnSimulateDaily" class="">ğŸ“† Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ +Û± Ø±ÙˆØ²</button>
                <button id="btnResetProgress" style="background:#fee2e2; border-color:#ef4444; color:#b91c1c;">ğŸ”„ Ø±ÛŒØ³Øª Ù¾ÛŒØ´Ø±ÙØª</button>
            </div>

            <!-- Ù„Ø§Ú¯ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ -->
            <div style="margin-top: 8px;">
                <h3>ğŸ§ª Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø± ØªØ³Øª Ø¯Ø³ØªÛŒ (Ù…Ø±Ø§Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)</h3>
                <div style="background: #fef9c3; padding: 16px; border-radius: 16px;">
                    <p style="font-weight:bold;">1ï¸âƒ£ ØªØ³Øª Ø§ÙØ²Ø§ÛŒØ´ XP Ùˆ Ø³Ø·Ø­â€ŒØ¨Ù†Ø¯ÛŒ</p>
                    <p style="margin-right: 20px;">- Ø¯Ú©Ù…Ù‡ +Û±Û° XP Ø±Ø§ Ú†Ù†Ø¯ Ø¨Ø§Ø± Ø¨Ø²Ù† â†’ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª Ùˆ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­</p>
                    <p style="font-weight:bold; margin-top:12px;">2ï¸âƒ£ ØªØ³Øª ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³ (SRS)</p>
                    <p style="margin-right: 20px;">- Ø¯Ú©Ù…Ù‡ "ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³" Ø±Ø§ Ø¨Ø²Ù† â†’ ÙØ§ØµÙ„Ù‡ Ù…Ø±ÙˆØ±ØŒ ØªÚ©Ø±Ø§Ø± Ùˆ EF Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯</p>
                    <p style="font-weight:bold; margin-top:12px;">3ï¸âƒ£ ØªØ³Øª Ù…Ø±ÙˆØ± Ø¶Ø¹ÛŒÙ</p>
                    <p style="margin-right: 20px;">- Ø¯Ú©Ù…Ù‡ "Ù…Ø±ÙˆØ± Ø¶Ø¹ÛŒÙ" Ø±Ø§ Ø¨Ø²Ù† â†’ ÙØ§ØµÙ„Ù‡ Ø¨Ù‡ Û± Ø¨Ø±Ú¯Ø±Ø¯Ø¯ØŒ EF Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯</p>
                    <p style="font-weight:bold; margin-top:12px;">4ï¸âƒ£ ØªØ³Øª Ú¯Ø°Ø± Ø²Ù…Ø§Ù†</p>
                    <p style="margin-right: 20px;">- Ø¯Ú©Ù…Ù‡ "+Û± Ø±ÙˆØ²" Ø±Ø§ Ø¨Ø²Ù† â†’ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø±ÙˆØ±</p>
                </div>
            </div>

            <!-- Ø®Ø±ÙˆØ¬ÛŒ Ú©Ù†Ø³ÙˆÙ„ Ù…Ø¬Ø§Ø²ÛŒ -->
            <div style="margin-top: 24px;">
                <h3>ğŸ“‹ Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯ (Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±)</h3>
                <div id="logOutput" class="output">
                    [Ø³ÛŒØ³ØªÙ…] Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª...
                </div>
                <button id="btnClearLog" style="margin-top: 8px; background: #e2e8f0; border: none;">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø¯Ù„ (ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø³Ø§Ø®ØªØ§Ø±ÛŒØ§ÙØªÙ‡) -->
        <div class="card">
            <div class="badge">âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ</div>
            <p style="margin-bottom: 16px;">Ù‡Ø± ØªØ³Øª Ø±Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ø§Ø¬Ø±Ø§ Ùˆ Ù†ØªÛŒØ¬Ù‡ Ø±Ø§ Ø¨Ø§ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ù†.</p>
            
            <div class="test-row" id="test1">
                <h4>ğŸ§ª ØªØ³Øª Û±: Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ùˆ Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­</h4>
                <p>Ø´Ø±ÙˆØ¹ Ø§Ø² XP=0ØŒ Ø³Ø·Ø­ 1. Ø¨Ø§ Ù‡Ø± Ø¯Ø±Ø³ +25 XP. Ù¾Ø³ Ø§Ø² Û´ Ø¯Ø±Ø³ (Û±Û°Û° XP) Ø³Ø·Ø­ Û² Ø´ÙˆØ¯.</p>
                <button id="testLevelUp" class="btn-success" style="background:#0f172a;">Ø§Ø¬Ø±Ø§ÛŒ Ú¯Ø§Ù…â€ŒØ¨Ù‡â€ŒÚ¯Ø§Ù… ØªØ³Øª</button>
                <div id="test1Result" style="margin-top: 12px; padding: 8px; background: #f1f5f9; border-radius: 8px;">â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§...</div>
            </div>

            <div class="test-row" id="test2">
                <h4>ğŸ§ª ØªØ³Øª Û²: Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SRS - Ù¾Ø§Ø³Ø® Ø¹Ø§Ù„ÛŒ</h4>
                <p>Ú©ÛŒÙÛŒØª Ûµ: ØªÚ©Ø±Ø§Ø± 0 â†’ ÙØ§ØµÙ„Ù‡ 1 Ø±ÙˆØ²ØŒ ØªÚ©Ø±Ø§Ø± 1 â†’ ÙØ§ØµÙ„Ù‡ 6 Ø±ÙˆØ²ØŒ ØªÚ©Ø±Ø§Ø± 2+ â†’ ÙØ§ØµÙ„Ù‡ Ã— EF</p>
                <button id="testSrsPerfect" style="background:#0f172a; color:white;">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª SRS Ø¹Ø§Ù„ÛŒ</button>
                <div id="test2Result" style="margin-top: 12px; padding: 8px; background: #f1f5f9;">â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§...</div>
            </div>

            <div class="test-row" id="test3">
                <h4>ğŸ§ª ØªØ³Øª Û³: Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª (Ú©ÛŒÙÛŒØª &lt; Û³)</h4>
                <p>Ú©ÛŒÙÛŒØª Û²: ÙØ§ØµÙ„Ù‡ Ø¨Ù‡ Û± Ø¨Ø±Ú¯Ø±Ø¯Ø¯ØŒ ØªÚ©Ø±Ø§Ø± Û°ØŒ EF Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯.</p>
                <button id="testSrsPoor" style="background:#0f172a; color:white;">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ù¾Ø§Ø³Ø® Ø¶Ø¹ÛŒÙ</button>
                <div id="test3Result" style="margin-top: 12px; padding: 8px; background: #f1f5f9;">â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§...</div>
            </div>

            <div class="test-row" id="test4">
                <h4>ğŸ§ª ØªØ³Øª Û´: Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ state (ØªØ¯Ø§ÙˆÙ…)</h4>
                <p>Ù¾Ø³ Ø§Ø² Ù‡Ø± ØªØºÛŒÛŒØ±ØŒ state Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯. Ø¨Ø§åˆ·æ–° ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú¯Ø±Ø¯Ø¯.</p>
                <button id="testPersistence" style="background:#0f172a; color:white;">ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
                <div id="test4Result" style="margin-top: 12px; padding: 8px; background: #f1f5f9;">â³ Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø±Ø§...</div>
            </div>
        </div>
    </div>

    <script>
        // -------------------- Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª (Ù¾Ø§ÛŒØ¯Ø§Ø±) --------------------
        class ProgressModel {
            constructor() {
                this.xp = 0;
                this.level = 1;
                this.xpForNextLevel = 100;
                this.repetitions = 0;
                this.easeFactor = 2.5;
                this.interval = 1;
                this.lastReviewDate = new Date().toISOString().split('T')[0];
                this.nextReviewDate = this.lastReviewDate;
                this.lessonHistory = [];
                this.streakDays = 0;
                
                this.load(); // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² localStorage
            }

            // Ø§ÙØ²Ø§ÛŒØ´ XP
            addXp(amount) {
                this.xp += amount;
                this.calculateLevel();
                this.save();
                this.log(`ğŸ–ï¸ Ø§ÙØ²ÙˆØ¯Ù† ${amount} XP | Ù…Ø¬Ù…ÙˆØ¹: ${this.xp} | Ø³Ø·Ø­: ${this.level}`);
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø¨Ø± Ø§Ø³Ø§Ø³ XP
            calculateLevel() {
                let newLevel = 1;
                let xpRequired = 100;
                let totalXp = this.xp;
                
                while(totalXp >= xpRequired) {
                    totalXp -= xpRequired;
                    newLevel++;
                    xpRequired = Math.floor(xpRequired * 1.5); // Ø§ÙØ²Ø§ÛŒØ´ ØªØµØ§Ø¹Ø¯ÛŒ
                }
                
                this.level = newLevel;
                this.xpForNextLevel = xpRequired;
                return this.level;
            }

            // Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ù‡ Ø³Ø·Ø­ Ø¨Ø¹Ø¯
            getProgressPercent() {
                if (this.level === 1) return Math.min(100, (this.xp / 100) * 100);
                let xpInThisLevel = this.xp;
                let tempLevel = 1;
                let xpReq = 100;
                
                while(tempLevel < this.level) {
                    xpInThisLevel -= xpReq;
                    xpReq = Math.floor(xpReq * 1.5);
                    tempLevel++;
                }
                return Math.min(100, (xpInThisLevel / xpReq) * 100);
            }

            // Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ Ø¯Ø±Ø³ (SRS)
            recordReview(quality) {
                const oldInterval = this.interval;
                const oldEf = this.easeFactor;
                const oldRep = this.repetitions;

                // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… SM-2
                if (quality < 3) {
                    this.interval = 1;
                    this.repetitions = 0;
                    this.easeFactor = Math.max(1.3, this.easeFactor - 0.2);
                    this.log(`ğŸ”´ Ù¾Ø§Ø³Ø® Ø¶Ø¹ÛŒÙ (${quality}): ÙØ§ØµÙ„Ù‡=${this.interval}, EF=${this.easeFactor.toFixed(2)}`);
                } else {
                    if (this.repetitions === 0) {
                        this.interval = 1;
                    } else if (this.repetitions === 1) {
                        this.interval = 6;
                    } else {
                        this.interval = Math.round(this.interval * this.easeFactor);
                    }
                    
                    this.repetitions++;
                    let newEf = this.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    this.easeFactor = Math.max(1.3, Math.min(3.0, newEf));
                    
                    this.log(`ğŸŸ¢ Ù¾Ø§Ø³Ø® Ø¹Ø§Ù„ÛŒ (${quality}): ÙØ§ØµÙ„Ù‡=${this.interval}, ØªÚ©Ø±Ø§Ø±=${this.repetitions}, EF=${this.easeFactor.toFixed(2)}`);
                }

                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ® Ù…Ø±ÙˆØ±
                const today = new Date();
                this.lastReviewDate = today.toISOString().split('T')[0];
                const nextDate = new Date(today);
                nextDate.setDate(today.getDate() + this.interval);
                this.nextReviewDate = nextDate.toISOString().split('T')[0];
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† XP Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©ÛŒÙÛŒØª
                const xpGain = quality * 2 + 5;
                this.addXp(xpGain);
                
                this.save();
            }

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            save() {
                const state = {
                    xp: this.xp,
                    level: this.level,
                    repetitions: this.repetitions,
                    easeFactor: this.easeFactor,
                    interval: this.interval,
                    lastReviewDate: this.lastReviewDate,
                    nextReviewDate: this.nextReviewDate,
                    streakDays: this.streakDays
                };
                localStorage.setItem('farsinglish_progress', JSON.stringify(state));
                this.log('ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø± localStorage');
            }

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² localStorage
            load() {
                try {
                    const saved = localStorage.getItem('farsinglish_progress');
                    if (saved) {
                        const state = JSON.parse(saved);
                        this.xp = state.xp || 0;
                        this.level = state.level || 1;
                        this.repetitions = state.repetitions || 0;
                        this.easeFactor = state.easeFactor || 2.5;
                        this.interval = state.interval || 1;
                        this.lastReviewDate = state.lastReviewDate || new Date().toISOString().split('T')[0];
                        this.nextReviewDate = state.nextReviewDate || this.lastReviewDate;
                        this.streakDays = state.streakDays || 0;
                        this.log('ğŸ“‚ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø§Ø² localStorage');
                    }
                } catch(e) {
                    console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ:', e);
                }
            }

            // Ø±ÛŒØ³Øª Ù¾ÛŒØ´Ø±ÙØª
            reset() {
                localStorage.removeItem('farsinglish_progress');
                this.xp = 0;
                this.level = 1;
                this.repetitions = 0;
                this.easeFactor = 2.5;
                this.interval = 1;
                const today = new Date().toISOString().split('T')[0];
                this.lastReviewDate = today;
                this.nextReviewDate = today;
                this.streakDays = 0;
                this.log('ğŸ”„ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ù¾ÛŒØ´Ø±ÙØª');
                this.save();
            }

            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆØ² Ø¨Ø¹Ø¯
            nextDay() {
                const today = new Date(this.nextReviewDate);
                today.setDate(today.getDate() + 1);
                this.nextReviewDate = today.toISOString().split('T')[0];
                this.log(`â© Ø±ÙˆØ² Ø¨Ø¹Ø¯: Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${this.nextReviewDate}`);
                this.save();
            }

            log(message) {
                // Ø§ÛŒÙ†Ø¬Ø§ Ù„Ø§Ú¯ global Ø¯Ø§Ø±ÛŒÙ…
                window.dispatchEvent(new CustomEvent('progress-log', { detail: message }));
            }
        }

        // -------------------- Ù†Ù…ÙˆÙ†Ù‡ Ú¯Ù„ÙˆØ¨Ø§Ù„ --------------------
        const progress = new ProgressModel();
        let logEntries = ['[Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Ø¯Ø³ØªÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª Ø¢ØºØ§Ø² Ø´Ø¯'];

        // -------------------- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI --------------------
        function refreshUI() {
            document.getElementById('xpDisplay').innerText = progress.xp;
            document.getElementById('levelDisplay').innerText = `Ø³Ø·Ø­ ${progress.level}`;
            document.getElementById('repetitionsDisplay').innerText = progress.repetitions;
            document.getElementById('intervalDisplay').innerText = progress.interval;
            document.getElementById('efDisplay').innerText = progress.easeFactor.toFixed(2);
            document.getElementById('nextReviewDisplay').innerText = progress.nextReviewDate;
            
            const percent = progress.getProgressPercent();
            document.getElementById('xpFillBar').style.width = `${percent}%`;
            document.getElementById('xpFillBar').innerText = `${Math.round(percent)}%`;
            
            const xpRequired = progress.xpForNextLevel || 100;
            document.getElementById('xpNextDisplay').innerText = xpRequired;
        }

        // -------------------- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯ --------------------
        function addLog(message) {
            logEntries.push(`[${new Date().toLocaleTimeString('fa-IR')}] ${message}`);
            if (logEntries.length > 8) logEntries.shift();
            document.getElementById('logOutput').innerHTML = logEntries.join('<br>');
        }

        // -------------------- Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù„Ø§Ú¯ --------------------
        window.addEventListener('progress-log', (e) => {
            addLog(e.detail);
            refreshUI();
        });

        // -------------------- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ --------------------
        document.getElementById('btnAddXp10').addEventListener('click', () => progress.addXp(10));
        document.getElementById('btnAddXp25').addEventListener('click', () => progress.addXp(25));
        document.getElementById('btnCompleteLesson').addEventListener('click', () => progress.recordReview(5));
        document.getElementById('btnPoorReview').addEventListener('click', () => progress.recordReview(2));
        document.getElementById('btnSimulateDaily').addEventListener('click', () => progress.nextDay());
        document.getElementById('btnResetProgress').addEventListener('click', () => { progress.reset(); refreshUI(); });
        document.getElementById('btnClearLog').addEventListener('click', () => { 
            logEntries = ['[Ø³ÛŒØ³ØªÙ…] Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯']; 
            document.getElementById('logOutput').innerHTML = logEntries[0];
        });

        // -------------------- ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ --------------------
        document.getElementById('testLevelUp').addEventListener('click', function() {
            progress.reset();
            progress.addXp(25); // Ø¯Ø±Ø³ 1
            setTimeout(() => progress.addXp(25), 100); // Ø¯Ø±Ø³ 2
            setTimeout(() => progress.addXp(25), 200); // Ø¯Ø±Ø³ 3
            setTimeout(() => progress.addXp(25), 300); // Ø¯Ø±Ø³ 4 -> Ø³Ø·Ø­ 2
            document.getElementById('test1Result').innerHTML = 'âœ… ØªØ³Øª Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­ Ø§Ø¬Ø±Ø§ Ø´Ø¯ - XP=100, Ø³Ø·Ø­ 2 (Ø¯Ø± Û´ Ù…Ø±Ø­Ù„Ù‡)';
        });

        document.getElementById('testSrsPerfect').addEventListener('click', function() {
            progress.reset();
            progress.recordReview(5); // Ø¨Ø§Ø± Ø§ÙˆÙ„
            setTimeout(() => progress.recordReview(5), 200); // Ø¨Ø§Ø± Ø¯ÙˆÙ… -> ÙØ§ØµÙ„Ù‡ 6
            setTimeout(() => progress.recordReview(5), 400); // Ø¨Ø§Ø± Ø³ÙˆÙ… -> ÙØ§ØµÙ„Ù‡ * EF
            document.getElementById('test2Result').innerHTML = `âœ… ØªØ³Øª SRS Ø¹Ø§Ù„ÛŒ Ø§Ø¬Ø±Ø§ Ø´Ø¯ - ÙÙˆØ§ØµÙ„: 1, 6, ${progress.interval}`;
        });

        document.getElementById('testSrsPoor').addEventListener('click', function() {
            progress.reset();
            progress.recordReview(5); // Ø¹Ø§Ù„ÛŒ
            setTimeout(() => progress.recordReview(2), 200); // Ø¶Ø¹ÛŒÙ -> ÙØ§ØµÙ„Ù‡ 1
            const efAfter = progress.easeFactor.toFixed(2);
            document.getElementById('test3Result').innerHTML = `âœ… ØªØ³Øª Ù¾Ø§Ø³Ø® Ø¶Ø¹ÛŒÙ - ÙØ§ØµÙ„Ù‡=1, EF=${efAfter}`;
        });

        document.getElementById('testPersistence').addEventListener('click', function() {
            progress.save();
            const savedData = localStorage.getItem('farsinglish_progress');
            const div = document.getElementById('test4Result');
            if (savedData) {
                div.innerHTML = `âœ… Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙÙ‚ - Ø¯Ø§Ø¯Ù‡ Ø¯Ø± localStorage: <pre style="font-size:0.8rem;">${savedData}</pre>`;
            } else {
                div.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ';
            }
        });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            progress.load();
            refreshUI();
            addLog('ğŸš€ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ù…Ø¯Ù„ Ù¾ÛŒØ´Ø±ÙØª');
        };
    </script>
</body>
</html>
