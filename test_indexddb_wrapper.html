<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª IndexedDB Wrapper</title>
    <style>
        body { font-family: Tahoma; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 15px; margin: 10px 0; border-right: 5px solid #4CAF50; }
        .fail { border-right-color: #f44336; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª IndexedDB Wrapper</h1>
    <div id="results"></div>
    <button onclick="runTests()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</button>
    <button onclick="clearDB()">Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</button>

    <script>
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
        const script = document.createElement('script');
        script.src = 'core/db/indexeddb-wrapper.js';
        document.head.appendChild(script);

        script.onload = () => {
            console.log('âœ… ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
            document.getElementById('results').innerHTML += 
                '<div class="test success">ÙØ§ÛŒÙ„ indexeddb-wrapper.js Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯</div>';
        };

        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            try {
                // ØªØ³Øª Û±: Ø§ÛŒØ¬Ø§Ø¯ instance
                const db1 = IndexedDBWrapper.getInstance();
                const db2 = IndexedDBWrapper.getInstance();
                const isSingleton = db1 === db2;
                addTest('Singleton Pattern', isSingleton, 
                    'Ù‡Ø± Ø¯Ùˆ instance Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯');
                
                // ØªØ³Øª Û²: Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                await db1.connect('testDB', 1, {
                    'users': { keyPath: 'id' },
                    'lessons': { keyPath: 'lessonId' }
                });
                addTest('Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³', db1.isConnected(), 
                    'Ø§ØªØµØ§Ù„ Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨Ø§Ø´Ø¯');
                
                // ØªØ³Øª Û³: Ø¹Ù…Ù„ÛŒØ§Øª CRUD
                const testUser = { id: 1, name: 'ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±' };
                await db1.add('users', testUser);
                const retrieved = await db1.get('users', 1);
                addTest('Ø§ÙØ²ÙˆØ¯Ù† Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ', retrieved?.name === 'ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±', 
                    `Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù‡: ${retrieved?.name}`);
                
                // ØªØ³Øª Û´: Ø¢Ù¾Ø¯ÛŒØª
                await db1.update('users', { ...testUser, name: 'Ú©Ø§Ø±Ø¨Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡' });
                const updated = await db1.get('users', 1);
                addTest('Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ', updated?.name === 'Ú©Ø§Ø±Ø¨Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡',
                    `Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯: ${updated?.name}`);
                
                // ØªØ³Øª Ûµ: Ø­Ø°Ù
                await db1.delete('users', 1);
                const deleted = await db1.get('users', 1);
                addTest('Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯', deleted === undefined, 
                    'Ø±Ú©ÙˆØ±Ø¯ Ø¨Ø§ÛŒØ¯ Ø­Ø°Ù Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯');
                
                // ØªØ³Øª Û¶: Ø®Ø·Ø§Ú¯ÛŒØ±ÛŒ
                try {
                    await db1.get('table_not_exist', 1);
                    addTest('Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§', false, 'Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                } catch (e) {
                    addTest('Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§', true, `Ø®Ø·Ø§ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯: ${e.message}`);
                }
                
            } catch (error) {
                addTest('Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ', false, error.message);
            }
        }
        
        function addTest(name, passed, details) {
            const div = document.createElement('div');
            div.className = `test ${passed ? '' : 'fail'}`;
            div.innerHTML = `<strong>${passed ? 'âœ…' : 'âŒ'} ${name}</strong><br>
                            <small>${details}</small>`;
            document.getElementById('results').appendChild(div);
        }
        
        async function clearDB() {
            const db = IndexedDBWrapper.getInstance();
            await db.clearDatabase();
            document.getElementById('results').innerHTML += 
                '<div class="test">ğŸ—‘ï¸ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù¾Ø§Ú© Ø´Ø¯</div>';
        }
    </script>
</body>
</html>
